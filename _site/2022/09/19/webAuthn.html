
<!DOCTYPE>
<html lang="zh-cn" data-scribe-reduced-action-queue="true">
<head>
    <meta content='WebAuthn - Tate & Snow' name='title' />
    <meta content='WebAuthn - Tate & Snow' name='og:title' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <title>WebAuthn - Tate & Snow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>WebAuthn - Tate & Snow</title>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WebAuthn - Tate & Snow">
<meta name="twitter:keywords" content="WebAuthn - Tate & Snow" property='og:description' />
<meta property="og:type" content="article">
<meta property="og:title" content="WebAuthn - Tate & Snow">
<meta name="og:keywords" content="WebAuthn - Tate & Snow|WebAuthnä»€ä¹ˆæ˜¯ WebAuthn  æ­¤æ–‡ç« åŸºæœ¬æ‘˜è‡ªè°ˆè°ˆ WebAuthnWebAuthn(Web Authentication)ï¼Œæ˜¯ä¸€ä¸ªç”¨äºåœ¨æµè§ˆå™¨ä¸Šè¿›è¡Œè®¤è¯çš„ APIï¼ŒW3C å°†å…¶è¡¨è¿°ä¸º â€œAn API for access..."
  property='og:description' />
<link rel="icon" type="image/png" href="http://localhost:2333/style/favicons/favicon.ico" />
<link href="http://localhost:2333/style/favicons/favicon.ico" rel="shortcut icon" type="image/png">
<link rel="canonical" href="http://localhost:2333/">
<link rel="alternate" type="application/rss+xml" title="Liberxue" href="http://localhost:2333/feed.xml">
<meta charset="UTF-8">
<link rel="manifest" href="/manifest.json">
<link rel="shortcut icon" href="http://localhost:2333/style/favicons/favicon.ico" type="image/x-icon">
<meta name="keywords" content="WebAuthnä»€ä¹ˆæ˜¯ WebAuthn  æ­¤æ–‡ç« åŸºæœ¬æ‘˜è‡ªè°ˆè°ˆ WebAuthnWebAuthn(Web Authentication)ï¼Œæ˜¯ä¸€ä¸ªç”¨äºåœ¨æµè§ˆå™¨ä¸Šè¿›è¡Œè®¤è¯çš„ APIï¼ŒW3C å°†å…¶è¡¨è¿°ä¸º â€œAn API for access..." property='og:description'
/>
<meta name="description" content="Tate & Snow's Github blog" />
<link href="https://cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
<link href="http://localhost:2333/style/theme.css" rel="stylesheet"> 
<meta content='http://localhost:2333/2022/09/19/webAuthn.html' property='og:url' />
<meta content="http://localhost:2333/2022/09/19/webAuthn.html|WebAuthnä»€ä¹ˆæ˜¯ WebAuthn  æ­¤æ–‡ç« åŸºæœ¬æ‘˜è‡ªè°ˆè°ˆ WebAuthnWebAuthn(Web Authentication)ï¼Œæ˜¯ä¸€ä¸ªç”¨äºåœ¨æµè§ˆå™¨ä¸Šè¿›è¡Œè®¤è¯çš„ APIï¼ŒW3C å°†å…¶è¡¨è¿°ä¸º â€œAn API for access..." property='og:description'
/>
<meta content="article" property="og:type" /> 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136311746-1"></script>
<!-- <script async src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
<script>
  window.dataLayer = window.dataLayer || [];
  window.GA_TRACKING_ID = 'UA-136311746-1'
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('set', {
    'country': 'US',
    'currency': 'USD',
    'description': 'fuck',
  });
  gtag('config', GA_TRACKING_ID, {
    'custom_map': {
      'dimension1': 'post_title',
    },
    'post_title': 'test',
  });
</script>
<meta content="" property="fb:app_id" />
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>WebAuthn | Tate &amp; Snow</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="WebAuthn" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="add 2FA &amp; TOTP" />
<meta property="og:description" content="add 2FA &amp; TOTP" />
<link rel="canonical" href="http://localhost:2333/2022/09/19/webAuthn.html" />
<meta property="og:url" content="http://localhost:2333/2022/09/19/webAuthn.html" />
<meta property="og:site_name" content="Tate &amp; Snow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-09-19T17:52:00+08:00" />
<script type="application/ld+json">
{"description":"add 2FA &amp; TOTP","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:2333/2022/09/19/webAuthn.html"},"@type":"BlogPosting","url":"http://localhost:2333/2022/09/19/webAuthn.html","headline":"WebAuthn","dateModified":"2022-09-19T17:52:00+08:00","datePublished":"2022-09-19T17:52:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<script>
  (function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

</head>

<body class="dark-theme" gtools_scp_screen_capture_injected="true">
    <header id="header" class="header bg-white">
        <div class="navbar-container">
            <a href="Javascript:;" onclick="onClickLogo()" title="è®¿é—® Tate & Snow" class="navbar-logo menu-logo">
                <img src="http://localhost:2333/style/images/tate.webp" alt="Tate & Snow"> </a>
            <!-- <a href="/?tate" title="è®¿é—® Tate & Snow" class="navbar-logo">Tate & Snow</a>   -->
            <div class="navbar-menu">
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', '/')" title="è®¿é—® é¦–é¡µ" data-hover="é¦–é¡µ">é¦–é¡µ</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å‰ç«¯', '/front')" title="è®¿é—® å‰ç«¯" data-hover="å‰ç«¯">å‰ç«¯</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å†å²', '/history')" title="è®¿é—® å†å²" data-hover="å†å²">å†å²</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å…¶ä»–', '/other')" title="è®¿é—® å…¶ä»–" data-hover="å…¶ä»–">å…¶ä»–</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', '/tags')" title="è®¿é—® æ ‡ç­¾" data-hover="æ ‡ç­¾">æ ‡ç­¾</a>
                
                  <a class=" menu-item-about " href="Javascript:;" onclick="onClickMenu('å…³äº', '/README')" title="è®¿é—® å…³äº" data-hover="å…³äº">å…³äº</a>
                
            </div>
            <!-- <div class="navbar-menu">
                
                <a href="http://localhost:2333/">é¦–é¡µ</a>
                
                <a href="http://localhost:2333/front">å‰ç«¯</a>
                
                <a href="http://localhost:2333/history">å†å²</a>
                
                <a href="http://localhost:2333/other">å…¶ä»–</a>
                
                <a href="http://localhost:2333/tags">æ ‡ç­¾</a>
                
                <a href="http://localhost:2333/README">å…³äº</a>
                
            </div> -->
            <div class="navbar-search menu-item-search" onclick="onClickSearch()">
                <span class="icon-search"></span>
                <form id="cb-search-btn" role="search">
                    <span class="search-box">
                        <input type="text" class="input" id="cb-search-content" required="true" placeholder="æ ‡é¢˜ æ ‡ç­¾..." maxlength="30" autocomplete="off">
                    </span>
                </form>
            </div>
            <div class="navbar-mobile-menu" onclick="">
                <span class="icon-menu cross">
                    <span class="middle"></span>
                </span>
                <ul>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', 'http://localhost:2333/')">é¦–é¡µ</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å‰ç«¯', 'http://localhost:2333/front')">å‰ç«¯</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å†å²', 'http://localhost:2333/history')">å†å²</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…¶ä»–', 'http://localhost:2333/other')">å…¶ä»–</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', 'http://localhost:2333/tags')">æ ‡ç­¾</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…³äº', 'http://localhost:2333/README')">å…³äº</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </header>
    <a href="#header" class="back-to-top" onclick="onClickTop('WebAuthn')">â¤´Topâ¤´</a>
    <div class="post-header-thumb bg-white}">
        <div class="post-header-thumb-op"></div>
        <div class="post-header-thumb">
            <div class="post-header-thumb-container">
                <h1 class="post-title" itemprop="name headline">
                    WebAuthn</h1>
                <div class="post-data">
                    <time datetime="2022-09-19 17:52:00" itemprop="datePublished">
                      å‘å¸ƒæ—¶é—´ï¼š2022-09-19 17:52:00
                      &nbsp;&nbsp;&nbsp;
                      
                        ä¿®æ”¹æ—¶é—´ï¼š2022-09-19 19:56:00
                      
                    </time>
                    <a onclick="onClickCategory('åç«¯')" href="Javascript:;" title="è®¿é—® åç«¯" data-hover="åšå®¢åˆ†ç±»: åç«¯">åšå®¢åˆ†ç±»: åç«¯</a>
                    <!-- <a href="#read"> é˜…è¯»æ¬¡æ•°: comments</a>  -->
                </div>
                
                  <div role='update-description' class="post-data">
                    ä¿®æ”¹å†…å®¹ï¼šadd 2FA & TOTP
                  </div>
                
                <div class="post-tags">
                       
                    <a class="menu-item-tags" href="Javascript:;" onclick="onClickTag('docker')" title="è®¿é—®docker" data-hover="docker">
                        docker
                        <span>(2)</span>
                        
                    </a>
                       
                </div>
            </div>
        </div>
    </div>
    <article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
        <div class="post-header">
            <h1 class="post-title" itemprop="name headline">
                WebAuthn</h1>
            <div class="post-data">
                <time datetime="2022-09-19 17:52:00" itemprop="datePublished">2022-09-19 17:52:00</time>
            </div>
        </div>
        <div id="post-content" class="post-content" itemprop="articleBody">
            <p class="post-tags">
                   
                <a href="Javascript:;" onclick="onClickTag('docker')" title="è®¿é—®docker" data-hover="docker">
                    docker
                    <span>(2)</span>
                    </a>
                   
            </p>
            <h1 id="webauthn">WebAuthn</h1>

<h2 id="ä»€ä¹ˆæ˜¯-webauthn">ä»€ä¹ˆæ˜¯ WebAuthn</h2>

<blockquote>
  <p>æ­¤æ–‡ç« åŸºæœ¬æ‘˜è‡ª<a href="https://flyhigher.top/develop/2160.html#deep-into-webauthn">è°ˆè°ˆ WebAuthn</a></p>
</blockquote>

<p><strong>WebAuthn(Web Authentication)</strong>ï¼Œæ˜¯ä¸€ä¸ªç”¨äºåœ¨æµè§ˆå™¨ä¸Šè¿›è¡Œè®¤è¯çš„ APIï¼ŒW3C å°†å…¶è¡¨è¿°ä¸º â€œAn API for accessing Public Key Credentialsâ€ï¼Œå³â€œä¸€ä¸ªç”¨äºè®¿é—®å…¬é’¥å‡­è¯çš„ APIâ€ã€‚WebAuthn å¾ˆå¼ºå¤§ï¼Œå¼ºå¤§åˆ°è¢«è®¤ä¸ºæ˜¯ Web èº«ä»½è®¤è¯çš„æœªæ¥ã€‚ä½ æœ‰æƒ³è¿‡é€šè¿‡æŒ‡çº¹æˆ–è€…é¢éƒ¨è¯†åˆ«æ¥ç™»å½•ç½‘ç«™å—ï¼ŸWebAuthn å°±èƒ½åœ¨ä¿è¯å®‰å…¨å’Œéšç§çš„æƒ…å†µä¸‹è®©è¿™æ ·çš„æƒ³æ³•æˆä¸ºç°å®ã€‚WebAuthn æ ‡å‡†æ˜¯ FIDO2 æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œè€Œ FIDO2 åˆ™æ˜¯ç”± FIDO è”ç›Ÿå’Œ W3C å…±åŒæ¨å‡ºçš„ U2Fï¼ˆç°ç§°ä½œ FIDO1ï¼‰çš„åç»§æ ‡å‡†ï¼Œæ—¨åœ¨å¢å¼ºç½‘ç»œè®¤è¯çš„å®‰å…¨æ€§ã€‚</p>

<p><img src="http://localhost:2333/style/images/smms/webauthn.gif" alt="webauthn" /></p>

<blockquote>
  <p>ä½ å¯ä»¥åœ¨<a href="https://webauthn.guide/#registration">è¿™ä¸ªç½‘ç«™</a>è‡ªè¡Œä½“éªŒ WebAuthn ğŸ‘ˆ</p>
</blockquote>

<p>é¦–å…ˆæˆ‘ä»¬è¦å¼„æ¸…æ¥šä¸€äº›å¸¸ç”¨çš„æœ¯è¯­ï¼Œåœ¨ä¸€ä¸ªå®Œæ•´çš„ WebAuthn è®¤è¯æµç¨‹ä¸­ï¼Œé€šå¸¸æœ‰è¿™ä¹ˆå‡ ä¸ªè§’è‰²ï¼š</p>

<ul>
  <li><strong>Relying Party ä¾èµ–æ–¹ (RP)</strong> - æŒ‡æœåŠ¡æä¾›æ–¹ï¼Œå³ç½‘ç«™</li>
  <li><strong>User ç”¨æˆ·</strong> - æ­£å‡†å¤‡ç™»å½•çš„ä½ </li>
  <li><strong>Authenticator è®¤è¯å™¨</strong> - é€šå¸¸æŒ‡ USB Key æˆ–æ˜¯è®¾å¤‡å†…ç½®çš„æŒ‡çº¹æ‰«æå™¨ã€è™¹è†œæ‰«æå™¨ã€é¢éƒ¨è¯†åˆ«è£…ç½®ç­‰ï¼Œæ­£æ˜¯å®ƒä»¬åœ¨ä½¿ç”¨æµç¨‹ä¸­ä»£æ›¿äº†å¯†ç ç”šè‡³æ˜¯ç”¨æˆ·å</li>
  <li><strong>User Agent ç”¨æˆ·ä»£ç†</strong> - é€šå¸¸æŒ‡æµè§ˆå™¨æˆ–ç³»ç»Ÿï¼Œè´Ÿè´£ä¸è®¤è¯å™¨äº¤äº’</li>
</ul>

<p>è®¤è¯è¿‡ç¨‹é€šå¸¸åˆ†ä¸ºä¸¤ç§ï¼š</p>

<ul>
  <li>Registration Ceremony æ³¨å†Œä»ªå¼ - ç”¨æˆ·å‘è´¦æˆ·ä¸Šæ·»åŠ è®¤è¯å™¨</li>
  <li>Authentication Ceremony éªŒè¯ä»ªå¼ - ç”¨æˆ·é€šè¿‡å·²æ³¨å†Œçš„è®¤è¯å™¨éªŒè¯èº«ä»½</li>
</ul>

<p>åŒæ—¶ï¼Œè®¤è¯è¿‡ç¨‹ä¸­è¿˜ä¼šäº§ç”Ÿè¿™äº›å†…å®¹ï¼š</p>

<ul>
  <li><strong>Challenge æŒ‘æˆ˜</strong> - é€šå¸¸æ˜¯ä¸€ä¸²éšæœºå­—ç¬¦ä¸²</li>
  <li>Public Key Credential å…¬é’¥å‡­è¯ - ç”±è®¤è¯å™¨äº§ç”Ÿçš„å‡­è¯ï¼Œåœ¨æŠ€æœ¯ä¸Šä»£æ›¿äº†å¯†ç </li>
  <li>Attestation è¯æ˜ - æ³¨å†Œæ—¶è®¤è¯å™¨äº§ç”Ÿçš„éªŒè¯æ•°æ®</li>
  <li>Assertion æ–­è¨€ - éªŒè¯æ—¶è®¤è¯å™¨äº§ç”Ÿçš„éªŒè¯æ•°æ®</li>
</ul>

<blockquote>
  <p>å’Œ HTTPS ä¸€æ ·ï¼ŒWebAuthn ä½¿ç”¨éå¯¹ç§°åŠ å¯†çš„æ€è·¯æ¥ä¿è¯å®‰å…¨æ€§ï¼Œå…·ä½“ä»€ä¹ˆæ˜¯éå¯¹ç§°åŠ å¯†ï¼Œå¯ä»¥<a href="http://localhost:2333/2018/02/26/http-https-tcp.html#åŠ å¯†ç®—æ³•åŠæ•°å­—ç­¾å">å‚è€ƒè¿™ç¯‡</a> ğŸ‘ˆ</p>
</blockquote>

<h2 id="éå¯¹ç§°åŠ å¯†è®¤è¯æµç¨‹">éå¯¹ç§°åŠ å¯†è®¤è¯æµç¨‹</h2>

<p>å’Œæ™®é€šçš„å¯†ç ä¸€æ ·ï¼Œä½¿ç”¨ WebAuthn åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ³¨å†Œå’ŒéªŒè¯ã€‚æ³¨å†Œä»ªå¼ä¼šåœ¨ä¾èµ–æ–¹ä¸­å°†è®¤è¯å™¨çš„ä¸€äº›ä¿¡æ¯å’Œç”¨æˆ·å»ºç«‹å…³è”ï¼›è€ŒéªŒè¯ä»ªå¼åˆ™æ˜¯éªŒè¯è¿™äº›ä¿¡æ¯ä»¥ç™»ç¡®ä¿æ˜¯ç”¨æˆ·æœ¬äººåœ¨ç™»å½•ã€‚å³æ³¨å†Œä»ªå¼å°±æ˜¯è®¤è¯å™¨ç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ï¼Œç„¶åå°†å…¬é’¥äº¤ç»™ä¾èµ–æ–¹ï¼›è€ŒéªŒè¯ä»ªå¼æ˜¯ä¾èµ–æ–¹å‘é€ç»™è®¤è¯å™¨ä¸€æ®µæ–‡æœ¬ï¼Œè¦æ±‚è®¤è¯å™¨ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†åå‘å›ä»¥éªŒè¯ã€‚åœ¨å®é™…æƒ…å†µä¸­ï¼ŒWebAuthn æ˜¯åŸºäºæŒ‘æˆ˜-åº”ç­”æ¨¡å‹å·¥ä½œçš„ï¼š</p>

<ol>
  <li>æµè§ˆå™¨å‘ä¾èµ–æ–¹å‘é€æŸä¸ªç”¨æˆ·çš„æ³¨å†Œè¯·æ±‚</li>
  <li>ä¾èµ–æ–¹å‘æµè§ˆå™¨å‘é€æŒ‘æˆ˜ã€ä¾èµ–æ–¹ä¿¡æ¯å’Œç”¨æˆ·ä¿¡æ¯</li>
  <li>æµè§ˆå™¨å‘è®¤è¯å™¨å‘é€æŒ‘æˆ˜ã€ä¾èµ–æ–¹ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯å’Œå®¢æˆ·ç«¯ä¿¡æ¯ä»¥è¯·æ±‚åˆ›å»ºå…¬é’¥å‡­è¯</li>
  <li>è®¤è¯å™¨è¯·æ±‚ç”¨æˆ·åŠ¨ä½œï¼Œéšååˆ›å»ºä¸€å¯¹å…¬ç§é’¥ï¼Œå¹¶ä½¿ç”¨ç§é’¥ç­¾åæŒ‘æˆ˜ï¼ˆå³è¯æ˜ï¼‰ï¼Œå’Œå…¬é’¥ä¸€èµ·äº¤ç»™æµè§ˆå™¨</li>
  <li>æµè§ˆå™¨å°†ç­¾ååçš„æŒ‘æˆ˜å’Œå…¬é’¥å‘é€ç»™ä¾èµ–æ–¹</li>
  <li>ä¾èµ–æ–¹ç”¨å…¬é’¥éªŒè¯æŒ‘æˆ˜æ˜¯å¦ä¸å‘é€çš„ä¸€è‡´ï¼Œå¦‚æœæˆåŠŸåˆ™å°†å…¬é’¥ä¸ç”¨æˆ·ç»‘å®šï¼Œæ³¨å†Œå®Œæˆ</li>
</ol>

<p><img src="http://localhost:2333/style/images/smms/webAuthn-flow-1.webp" alt="flow-1" /></p>

<p>è€Œä¹‹åçš„éªŒè¯æµç¨‹å¦‚ä¸‹ï¼š</p>

<ol>
  <li>æµè§ˆå™¨å‘ä¾èµ–æ–¹å‘é€æŸä¸ªç”¨æˆ·çš„éªŒè¯è¯·æ±‚</li>
  <li>ä¾èµ–æ–¹å‘æµè§ˆå™¨å‘é€æŒ‘æˆ˜</li>
  <li>æµè§ˆå™¨å‘è®¤è¯å™¨å‘é€æŒ‘æˆ˜ã€ä¾èµ–æ–¹ä¿¡æ¯å’Œå®¢æˆ·ç«¯ä¿¡æ¯ä»¥è¯·æ±‚è·å–å…¬é’¥å‡­è¯</li>
  <li>è®¤è¯å™¨è¯·æ±‚ç”¨æˆ·åŠ¨ä½œï¼Œéšåé€šè¿‡ä¾èµ–æ–¹ä¿¡æ¯æ‰¾åˆ°å¯¹åº”ç§é’¥ï¼Œå¹¶ä½¿ç”¨ç§é’¥ç­¾åæŒ‘æˆ˜ï¼ˆå³æ–­è¨€ï¼‰ï¼Œäº¤ç»™æµè§ˆå™¨</li>
  <li>æµè§ˆå™¨å°†ç­¾ååçš„æŒ‘æˆ˜å‘é€ç»™ä¾èµ–æ–¹</li>
  <li>ä¾èµ–æ–¹ç”¨ä¹‹å‰å­˜å‚¨çš„å…¬é’¥éªŒè¯æŒ‘æˆ˜æ˜¯å¦ä¸å‘é€çš„ä¸€è‡´ï¼Œä¸€è‡´åˆ™éªŒè¯æˆåŠŸ</li>
</ol>

<p><img src="http://localhost:2333/style/images/smms/webAuthn-flow-2.webp" alt="flow-2" /></p>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒWebAuthn åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰éšç§æ•°æ®è¢«ä¼ è¾“ï¼Œç”¨æˆ·ä¿¡æ¯å®é™…ä¸ŠåªåŒ…å«ç”¨æˆ·åå’Œç”¨æˆ· IDã€‚å› æ­¤æˆ‘ä»¬å®Œå…¨å¯ä»¥è¯´ WebAuthn æ˜¯å®‰å…¨ä¸”ç§å¯†çš„ã€‚ä¸ºäº†é¿å…ç”¨æˆ·åœ¨ä¸åŒä¾èµ–æ–¹ä¹‹é—´è¢«è¿½è¸ªï¼Œè®¤è¯å™¨é€šå¸¸ä¼šä¸ºæ¯ä¸ªä¾èµ–æ–¹å’Œç”¨æˆ·çš„ç»„åˆéƒ½åˆ›å»ºä¸€å¯¹å…¬ç§é’¥ã€‚ä¸è¿‡ï¼Œç”±äºè®¤è¯å™¨çš„å­˜å‚¨ç©ºé—´æœ‰é™ï¼Œè®¤è¯å™¨é€šå¸¸ä¸ä¼šå­˜å‚¨æ¯ä¸€ä¸ªç§é’¥ï¼Œè€Œæ˜¯ä¼šé€šè¿‡å„ç±»ä¿¡æ¯å’Œçƒ§å½•åœ¨è®¤è¯å™¨å†…çš„ä¸»å¯†é’¥â€œç®—â€å‡ºå¯¹åº”çš„ç§é’¥ä»¥å®ç°æ— é™å¯¹å…¬ç§é’¥ã€‚å…·ä½“ç®—æ³•æ ¹æ®ä¸åŒå‚å•†ä¼šæœ‰æ‰€ä¸åŒã€‚å¯¹äº <strong>Yubikey</strong>ï¼Œä½ å¯ä»¥åœ¨<a href="https://developers.yubico.com/U2F/Protocol_details/Key_generation.html">è¿™é‡Œ</a>äº†è§£æ›´å¤šã€‚</p>

<h2 id="æµè§ˆå™¨-api">æµè§ˆå™¨ API</h2>

<p>è¦ä½¿ç”¨ WebAuthnï¼Œæˆ‘ä»¬å¿…é¡»è¦ä¾é æµè§ˆå™¨ä½œä¸ºåª’ä»‹å’ŒéªŒè¯å™¨è¿›è¡Œäº¤äº’ï¼Œè€Œè¿™å°±éœ€è¦æµè§ˆå™¨å¯¹äº WebAuthn çš„æ”¯æŒäº†ã€‚ç»å¤§å¤šæ•°æ–°ç‰ˆæœ¬çš„ç°ä»£æµè§ˆå™¨éƒ½ä¸º WebAuthn æä¾›äº†ç»Ÿä¸€çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Authentication_API">æ¥å£</a>ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code class="highlighter-rouge">navigator.credentials.create()</code> è¯·æ±‚è®¤è¯å™¨ç”Ÿæˆå…¬é’¥å‡­è¯å’Œ <code class="highlighter-rouge">navigator.credentials.get()</code> è¯·æ±‚è·å–å…¬é’¥å‡­è¯ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">navigator</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
    <span class="na">publicKey</span><span class="p">:</span> <span class="p">{</span>
        <span class="nx">challenge</span><span class="p">,</span> <span class="c1">// è½¬æ¢ä¸º Uint8Array çš„æŒ‘æˆ˜ï¼Œé•¿åº¦è‡³å°‘ä¸º 16ï¼Œå»ºè®®ä¸º 32</span>
        <span class="na">rp</span><span class="p">:</span> <span class="p">{</span> <span class="c1">// ä¾èµ–æ–¹ä¿¡æ¯</span>
            <span class="nx">id</span><span class="p">,</span> <span class="c1">// å¯é€‰ï¼Œä¾èµ–æ–¹ IDï¼Œå¿…é¡»ä¸ºå½“å‰åŸŸåæˆ–ä¸ºå½“å‰åŸŸåçš„å­é›†çš„åŸŸå</span>
            <span class="nx">name</span> <span class="c1">// ä¾èµ–æ–¹åç§°ï¼Œç”¨äºæ–¹ä¾¿ç”¨æˆ·è¾¨è®¤</span>
        <span class="p">},</span>
        <span class="na">user</span><span class="p">:</span> <span class="p">{</span>
            <span class="nx">id</span><span class="p">,</span> <span class="c1">// è½¬æ¢ä¸º Uint8Array çš„å­—ç¬¦ä¸²ã€‚å‡ºäºå®‰å…¨è€ƒé‡ï¼Œè¿™åº”å°½å¯èƒ½ä¸ä¸ä»»ä½•ç”¨æˆ·ä¿¡æ¯ç›¸å…³è”ï¼Œå¦‚ä¸è¦åŒ…å«ç”¨æˆ·åã€ç”¨æˆ·é‚®ç®±ç­‰</span>
            <span class="nx">name</span><span class="p">,</span> <span class="c1">// ç™»å½•ç”¨æˆ·å</span>
            <span class="nx">displayName</span> <span class="c1">// ç”¨äºæ˜¾ç¤ºçš„ç”¨æˆ·åç§°</span>
        <span class="p">},</span>
        <span class="na">pubKeyCredParams</span><span class="p">:</span> <span class="p">[</span> <span class="c1">// ä¸€ä¸ªç®—æ³•åˆ—è¡¨ï¼ŒæŒ‡æ˜ä¾èµ–æ–¹æ¥å—å“ªäº›ç­¾åç®—æ³•</span>
            <span class="p">{</span>
                <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">public-key</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// å€¼åªèƒ½ä¸º "public-key"</span>
                <span class="nx">alg</span> <span class="c1">// ä¸€ä¸ªè´Ÿæ•´æ•°ï¼Œå¦‚ -7ï¼Œç”¨äºæ ‡æ˜ç®—æ³•ã€‚å…·ä½“ç®—æ³•å¯¹åº”çš„æ•°å­—å¯ä»¥åœ¨ [COSE](https://www.iana.org/assignments/cose/cose.xhtml#algorithms) æ‰¾åˆ°</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="na">authenticatorSelection</span><span class="p">:</span> <span class="p">{</span> <span class="c1">// å¯é€‰ï¼Œç”¨äºè¿‡æ»¤æ­£ç¡®çš„è®¤è¯å™¨</span>
            <span class="nx">authenticatorAttachment</span><span class="p">,</span> <span class="c1">// æŒ‡å®šè¦æ±‚çš„è®¤è¯å™¨ç±»å‹</span>
            <span class="nx">userVerification</span> <span class="c1">// æŒ‡å®šè®¤è¯å™¨æ˜¯å¦éœ€è¦éªŒè¯â€œç”¨æˆ·ä¸ºæœ¬äºº (User Verified, UV)â€ï¼Œå¦åˆ™åªé¡»â€œç”¨æˆ·åœ¨åœº (User Present, UP)â€ã€‚</span>
        <span class="p">},</span>
        <span class="na">excludeCredentials</span><span class="p">:</span> <span class="p">[</span> <span class="c1">// å¯é€‰ï¼Œç”¨äºæ ‡è¯†è¦æ’é™¤çš„å‡­è¯ï¼Œå¯ä»¥é¿å…åŒä¸€ä¸ªç”¨æˆ·å¤šæ¬¡æ³¨å†ŒåŒä¸€ä¸ªè®¤è¯å™¨</span>
            <span class="p">{</span>
                <span class="nx">id</span><span class="p">,</span> <span class="c1">// è¦æ’é™¤çš„å‡­è¯ ID</span>
                <span class="na">transports</span><span class="p">:</span> <span class="p">[],</span> <span class="c1">// ç”¨äºæŒ‡å®šè¯¥å‡­è¯æ‰€éœ€çš„è®¤è¯å™¨ä¸ç”¨æˆ·ä»£ç†çš„é€šä¿¡æ–¹å¼</span>
                <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">public-key</span><span class="dl">"</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="nx">timeout</span> <span class="c1">// å¯é€‰ï¼Œæ–¹æ³•è¶…æ—¶æ—¶é—´çš„æ¯«ç§’æ•°ï¼Œè¶…æ—¶åå°†å¼ºåˆ¶ç»ˆæ­¢ create() å¹¶æŠ›å‡ºé”™è¯¯ã€‚è‹¥ä¸è®¾ç½®ï¼Œå°†ä½¿ç”¨ç”¨æˆ·ä»£ç†çš„é»˜è®¤å€¼</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>è€Œå¯¹äº navigator.credentials.get()ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥å¦‚ä¸‹çš„å‚æ•°ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">navigator</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="kd">get</span><span class="p">({</span>
    <span class="na">publicKey</span><span class="p">:</span> <span class="p">{</span>
        <span class="nx">challenge</span><span class="p">,</span>
        <span class="nx">rpId</span><span class="p">,</span> <span class="c1">// å¯é€‰ï¼Œä¾èµ–æ–¹ IDï¼Œéœ€è¦å’Œæ³¨å†Œè®¤è¯å™¨æ—¶çš„ä¸€è‡´</span>
        <span class="nx">userVerification</span><span class="p">,</span>
        <span class="na">allowCredentials</span><span class="p">:</span> <span class="p">[</span> <span class="c1">// å¯é€‰ï¼Œç”¨äºæ ‡è¯†å…è®¸çš„å‡­è¯ IDï¼Œä½¿ç”¨æˆ·ä»£ç†æ‰¾åˆ°æ­£ç¡®çš„è®¤è¯å™¨</span>
            <span class="p">{</span>
                <span class="nx">id</span><span class="p">,</span>
                <span class="na">transports</span><span class="p">:</span> <span class="p">[],</span>
                <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">public-key</span><span class="dl">"</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="nx">timeout</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>ä¸ç®¡æ˜¯è°ƒç”¨å“ªä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°ä¸€ä¸ª Promiseï¼Œå¹¶å¯ä»¥åœ¨ then ä¸­è·å¾—è®¤è¯å™¨è¿”å›çš„ PublicKeyCredential å¯¹è±¡:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">PublicKeyCredential</span> <span class="p">{</span>
    <span class="nl">rawId</span><span class="p">:</span> <span class="nb">ArrayBuffer</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="p">{},</span> <span class="c1">// ArrayBuffer çš„åŸå§‹å‡­è¯ ID</span>
    <span class="nx">response</span><span class="p">:</span> <span class="nx">AuthenticatorAttestationResponse</span> <span class="p">{</span>
        <span class="nl">attestationObject</span><span class="p">:</span> <span class="nb">ArrayBuffer</span><span class="p">(</span><span class="mi">390</span><span class="p">)</span> <span class="p">{},</span> <span class="c1">// CBOR ç¼–ç çš„è®¤è¯å™¨æ•°æ®ï¼ŒåŒ…å«å‡­è¯å…¬é’¥ã€å‡­è¯ IDã€ç­¾åï¼ˆå¦‚æœæœ‰ï¼‰ã€ç­¾åè®¡æ•°ç­‰ä¿¡æ¯</span>
        <span class="nx">clientDataJSON</span><span class="p">:</span> <span class="nb">ArrayBuffer</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span> <span class="p">{}</span> <span class="c1">// å®¢æˆ·ç«¯æ•°æ®ï¼ŒåŒ…å« originï¼ˆå³å‡­è¯è¯·æ±‚æ¥æºï¼‰ã€æŒ‘æˆ˜ç­‰ä¿¡æ¯</span>
    <span class="p">},</span>
    <span class="nx">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">VByF2w2hDXkVsevQFZdbOJdyCTGOrI1-sVEzOzsNnY0</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// Base64 URL ç¼–ç çš„å‡­è¯ ID</span>
    <span class="nx">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">public-key</span><span class="dl">"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä¸¾ä¸€ä¸ªç¨å¾®å®Œæ•´ç‚¹çš„ä¾‹å­ï¼Œç”¨çš„ ejs æ¨¡æ¿ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">navigator</span><span class="p">.</span><span class="nx">credentials</span>
  <span class="p">.</span><span class="kd">get</span><span class="p">({</span>
    <span class="na">publicKey</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// random, cryptographically secure, at least 16 bytes</span>
      <span class="na">challenge</span><span class="p">:</span> <span class="nx">base64url</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;%= challenge %&gt;</span><span class="dl">"</span><span class="p">),</span>
      <span class="na">allowCredentials</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="na">id</span><span class="p">:</span> <span class="nx">base64url</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;%= id %&gt;</span><span class="dl">"</span><span class="p">),</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">public-key</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">],</span>
      <span class="na">timeout</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span>
      <span class="na">authenticatorSelection</span><span class="p">:</span> <span class="p">{</span> <span class="na">userVerification</span><span class="p">:</span> <span class="dl">"</span><span class="s2">preferred</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">publicKeyCredentialToJSON</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
    <span class="c1">// Send data to relying party's servers</span>
    <span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/webauthn/authenticate</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">state</span><span class="p">:</span> <span class="dl">"</span><span class="s2">&lt;%= state %&gt;</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">provider</span><span class="p">:</span> <span class="dl">"</span><span class="s2">&lt;%= provider %&gt;</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">res</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">json</span><span class="p">),</span>
    <span class="p">});</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Invalid FIDO device</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre></div></div>

<h2 id="åŒå› ç´ è®¤è¯ä¸-totp">åŒå› ç´ è®¤è¯ä¸ TOTP</h2>

<p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸‰ç§ä¸åŒç±»å‹çš„è¯æ®ï¼Œå¯ä»¥è¯æ˜ä¸€ä¸ªäººçš„èº«ä»½ï¼š</p>

<ul>
  <li>ç§˜å¯†ä¿¡æ¯ï¼šåªæœ‰è¯¥ç”¨æˆ·çŸ¥é“ã€å…¶ä»–äººä¸çŸ¥é“çš„æŸç§ä¿¡æ¯ï¼Œæ¯”å¦‚å¯†ç ã€‚</li>
  <li>ä¸ªäººç‰©å“ï¼šè¯¥ç”¨æˆ·çš„ç§äººç‰©å“ï¼Œæ¯”å¦‚èº«ä»½è¯ã€é’¥åŒ™ã€‚</li>
  <li>ç”Ÿç†ç‰¹å¾ï¼šè¯¥ç”¨æˆ·çš„é—ä¼ ç‰¹å¾ï¼Œæ¯”å¦‚æŒ‡çº¹ã€ç›¸è²Œã€è™¹è†œç­‰ç­‰ã€‚</li>
</ul>

<p>è¿™äº›è¯æ®å°±ç§°ä¸ºä¸‰ç§â€å› ç´ â€ï¼ˆfactorï¼‰ã€‚å› ç´ è¶Šå¤šï¼Œè¯æ˜åŠ›å°±è¶Šå¼ºï¼Œèº«ä»½å°±è¶Šå¯é ã€‚<strong>åŒå› ç´ è®¤è¯ï¼ˆTwo-factor authenticationï¼Œç®€ç§° 2FAï¼‰</strong>åˆ™ä»£è¡¨åŒæ—¶éœ€è¦ä¸¤ä¸ªå› ç´ çš„è¯æ®ã€‚é“¶è¡Œå¡å°±æ˜¯æœ€å¸¸è§çš„åŒå› ç´ è®¤è¯ã€‚ç”¨æˆ·å¿…é¡»åŒæ—¶æä¾›é“¶è¡Œå¡å’Œå¯†ç ï¼Œæ‰èƒ½å–åˆ°ç°é‡‘ã€‚è¿˜æœ‰å›½å†…çš„å¾ˆå¤šç½‘ç«™è¦æ±‚ï¼Œç”¨æˆ·è¾“å…¥å¯†ç æ—¶ï¼Œéœ€è¦æä¾›çŸ­æ¶ˆæ¯å‘é€çš„éªŒè¯ç ï¼Œä»¥è¯æ˜ç”¨æˆ·ç¡®å®æ‹¥æœ‰è¯¥æ‰‹æœºã€‚</p>

<p>åŒå› ç´ è®¤è¯çš„ä¼˜ç‚¹åœ¨äºï¼Œæ¯”å•çº¯çš„å¯†ç ç™»å½•å®‰å…¨å¾—å¤šã€‚å°±ç®—å¯†ç æ³„éœ²ï¼Œåªè¦æ‰‹æœºè¿˜åœ¨ï¼Œè´¦æˆ·å°±æ˜¯å®‰å…¨çš„ã€‚å„ç§å¯†ç ç ´è§£æ–¹æ³•ï¼Œéƒ½å¯¹åŒå› ç´ è®¤è¯æ— æ•ˆã€‚ä½†æ˜¯ï¼ŒçŸ­æ¶ˆæ¯æ˜¯ä¸å®‰å…¨çš„ï¼Œå®¹æ˜“è¢«æ‹¦æˆªå’Œä¼ªé€ ï¼ŒSIM å¡ä¹Ÿå¯ä»¥å…‹éš†ã€‚å·²ç»æœ‰æ¡ˆä¾‹ï¼Œå…ˆä¼ªé€ èº«ä»½è¯ï¼Œå†ç”³è¯·ä¸€æ¨¡ä¸€æ ·çš„æ‰‹æœºå·ç ï¼ŒæŠŠé’±è½¬èµ°ã€‚å› æ­¤ï¼Œå®‰å…¨çš„åŒå› ç´ è®¤è¯ä¸æ˜¯å¯†ç  + çŸ­æ¶ˆæ¯çš„ç»„åˆï¼Œè€Œæ˜¯ä¸‹é¢è¦ä»‹ç»çš„ TOTPã€‚</p>

<p><strong>TOTP</strong> çš„å…¨ç§°æ˜¯â€åŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§å¯†ç â€ï¼ˆTime-based One-time Passwordï¼‰ã€‚å®ƒæ˜¯å…¬è®¤çš„å¯é è§£å†³æ–¹æ¡ˆï¼Œå·²ç»å†™å…¥å›½é™…æ ‡å‡† RFC6238ï¼š</p>

<ol>
  <li>ç”¨æˆ·å¼€å¯åŒå› ç´ è®¤è¯åï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªå¯†é’¥ã€‚</li>
  <li>æœåŠ¡å™¨æç¤ºç”¨æˆ·æ‰«æäºŒç»´ç ï¼ˆæˆ–è€…ä½¿ç”¨å…¶ä»–æ–¹å¼ï¼‰ï¼ŒæŠŠå¯†é’¥ä¿å­˜åˆ°ç”¨æˆ·çš„æ‰‹æœºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨å’Œç”¨æˆ·çš„æ‰‹æœºï¼Œç°åœ¨éƒ½æœ‰äº†åŒä¸€æŠŠå¯†é’¥ã€‚æ³¨æ„ï¼Œå¯†é’¥å¿…é¡»è·Ÿæ‰‹æœºç»‘å®šã€‚ä¸€æ—¦ç”¨æˆ·æ›´æ¢æ‰‹æœºï¼Œå°±å¿…é¡»ç”Ÿæˆå…¨æ–°çš„å¯†é’¥ã€‚</li>
  <li>ç”¨æˆ·ç™»å½•æ—¶ï¼Œæ‰‹æœºå®¢æˆ·ç«¯ä½¿ç”¨è¿™ä¸ªå¯†é’¥å’Œå½“å‰æ—¶é—´æˆ³ï¼Œç”Ÿæˆä¸€ä¸ªå“ˆå¸Œï¼Œæœ‰æ•ˆæœŸé»˜è®¤ä¸º 30 ç§’ã€‚ç”¨æˆ·åœ¨æœ‰æ•ˆæœŸå†…ï¼ŒæŠŠè¿™ä¸ªå“ˆå¸Œæäº¤ç»™æœåŠ¡å™¨ã€‚</li>
  <li>æœåŠ¡å™¨ä¹Ÿä½¿ç”¨å¯†é’¥å’Œå½“å‰æ—¶é—´æˆ³ï¼Œç”Ÿæˆä¸€ä¸ªå“ˆå¸Œï¼Œè·Ÿç”¨æˆ·æäº¤çš„å“ˆå¸Œæ¯”å¯¹ã€‚åªè¦ä¸¤è€…ä¸ä¸€è‡´ï¼Œå°±æ‹’ç»ç™»å½•ã€‚</li>
</ol>

<p>å…¶å®ç°åŸç†ä¹Ÿè¾ƒç®€å•ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">tfa</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">2fa</span><span class="dl">'</span><span class="p">)</span>

<span class="c1">// ç”Ÿæˆä¸€ä¸ª 32 ä½å­—ç¬¦çš„å¯†é’¥</span>
<span class="c1">// b5jjo0cz87d66mhwa9azplhxiao18zlx</span>
<span class="nx">tfa</span><span class="p">.</span><span class="nx">generateKey</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1">// ç”Ÿæˆå“ˆå¸Œï¼Œä¸”æœ‰æ•ˆæœŸé»˜è®¤ä¸º 30s</span>
<span class="kd">var</span> <span class="nx">tc</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">totp</span> <span class="o">=</span> <span class="nx">tfa</span><span class="p">.</span><span class="nx">generateCode</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">tc</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">totp</span><span class="p">)</span> <span class="c1">// 683464</span>
</code></pre></div></div>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>

<ol>
  <li><a href="https://flyhigher.top/develop/2160.html#deep-into-webauthn">è°ˆè°ˆ WebAuthn</a> By æ— å </li>
  <li><a href="https://webauthn.me/introduction">Web Authentication</a></li>
  <li><a href="https://www.ruanyifeng.com/blog/2017/11/2fa-tutorial.html">åŒå› ç´ è®¤è¯ï¼ˆ2FAï¼‰æ•™ç¨‹</a> By é˜®ä¸€å³°</li>
</ol>
 
<div id="gitalk-container"></div>
<script>
    var gitalk = new Gitalk({
      enable: true,
      clientID: '020f142489f80c92b097',
      clientSecret: '1fa083372b44031cf1b8249251515c4e3d54c69d',
      repo: 'tate-young.github.io',
      owner: 'Tate-Young',
      admin: ['Tate-Young'],
      id: location.pathname,      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
<!-- disqus -->
<!-- <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = 'https://tate-young.github.io/2022/09/19/webAuthn.html';
        this.page.identifier = '/2022/09/19/webAuthn';
        this.page.title = 'WebAuthn';
    };

    (function () { // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document,
            s = d.createElement('script');

        s.src = '//tate.disqus.com/embed.js'; // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript> -->


            <!-- <p class="post-info">
			æœ¬æ–‡ç”± <a href="/">liberxue</a> åˆ›ä½œï¼Œé‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">çŸ¥è¯†å…±äº«ç½²å4.0</a> å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯<br>æœ¬ç«™æ–‡ç« é™¤æ³¨æ˜è½¬è½½/å‡ºå¤„å¤–ï¼Œå‡ä¸ºæœ¬ç«™åŸåˆ›æˆ–ç¿»è¯‘ï¼Œè½¬è½½å‰è¯·åŠ¡å¿…ç½²å<br>æœ€åç¼–è¾‘æ—¶é—´ä¸º:2022-09-19 17:52:00</p> -->
        </div>
    </article>

    <!-- <div class="related-post-lists">
	<div class="post-lists">
		<div class="post-lists-body">
					<div class="post-list-item">
				<div class="post-list-item-container">
					<div class="item-label">
						<div class="item-title"><a href="induction.html">å½’çº³çš„éšæƒ³</a></div>
						<div class="item-meta clearfix">
														<div class="item-meta-ico bg-ico-image" style="background: url('../usr/themes/pinghsu/images/bg-ico.png') no-repeat;background-size: 40px auto;"></div>
	                        							<div class="item-meta-cat"><a href="../category/thoughts/index.html">Thoughts</a></div>
						</div>
					</div>
				</div>
			</div>
				</div>
	</div>
</div> -->

    <!-- <footer class="footer bg-white">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
	 <a class="social segmentfault" target="blank" href="https://segmentfault.com/u/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Segmentfault">Segmentfault</a>
    <a class="social github" target="blank" href="https://github.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="GitHub">GitHub</a>
    <a class="social twitter" target="blank" href="http://twitter.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Twitter">Twitter</a>
     <a class="social stackoverflow" target="blank" href="https://stackoverflow.com/users/6902190/liberxue" title="è®¿é—® LiberXue_stackoverflow" data-hover="StackOverflow">StackOverflow</a>
          <a class="social oschina" target="blank" href="https://my.oschina.net/bolanzw" title="è®¿é—® LiberXue_Oschina" data-hover="Oschina">Oschina</a>
     <a class="social rss" target="blank" href="/feed.xml"title="è®¿é—® LiberXue_RSS" data-hover="RSS">RSS</a>
	</div>
		</div>
	</div>
	<div class="footer-meta">
        <div class="footer-container">
            <div class="meta-item meta-copyright">
                <div class="meta-copyright-info">
                    <a href="/" class="info-logo">
                         <img src="http://localhost:2333/style/images/logo-liberxue.png"   title="è®¿é—® LiberXue_blog" data-hover="LiberXue_blog" alt="LiberXue_blog" /> </a>
                    <div class="info-text">
                        <p>Theme is <a href="http://www.liberxue.com/2017/08/03/Jekyllthemes.html" title="è®¿é—® Jekyll liberxueä¸»é¢˜"  data-hover="Jekyll liberxue"target="_blank">Jekyll liberxue</a> by <a href="http://www.liberxue.com/about" target="_blank">liberxue</a></p>
                        <p>Powered by <a href="http://localhost:2333/tags/#Jekyll" title="Jekyll" data-hover="Jekyll" target="_blank" rel="nofollow">Jekyll</a></p>
                        <p>&copy; 2017 <a href="/feed.xml"  title="è®¿é—® liberxue blog RSS" data-hover="liberxue blog RSS">liberxue blog RSS</a></p>
                        <p>æ€»è®¡æ–‡ç« ï¼šç¯‡</p>
                      <p>æœ¬blogå·²å¼€æºç‚¹å‡»Fork</p><iframe src="http://ghbtns.com/github-btn.html?user=liberxue&repo=liberxue.github.io&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
                    </div>
                </div>
            </div>
            <div class="meta-item meta-posts">
                <h3 class="meta-title">ç½®é¡¶æ–‡ç« </h3>
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
            </div>
            <div class="meta-item meta-comments">
                <h3 class="meta-title">æœ€æ–°æ–‡ç« </h3>
  
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
</div>
		</div>
    </div>
</footer> -->
<script src="//cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>
<script async src="/search/js/520.js"></script>
<script async src="/search/js/gtag.js"></script>
<script async src="/search/live2d/autoload.js"></script>
<!-- <script src="/search/js/canvas.js"></script> -->

<script>
    $(function () {
        setTimeout(function () {
            $('code').removeClass('hljs');
            $('code').removeClass('language');
        }, 90);
    });
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    <!--liberxueconnnet-menu-->
    <div id="directory-content" class="directory-content">
        <div id="directory"></div>
    </div>
    <!--liberxueconnnet-menu-->
    <script>
      const directoryContainer = document.getElementById('directory')
      const postTitle = document.getElementsByClassName('post-title')[0]
      var postDirectoryBuild = function () {
        var postChildren = function children(childNodes, reg) {
          var result = [],
              isReg = typeof reg === 'object',
              isStr = typeof reg === 'string',
              node, i, len;
          for (i = 0, len = childNodes.length; i < len; i++) {
            node = childNodes[i];
            if ((node.nodeType === 1 || node.nodeType === 9) &&
              (!reg ||
                  isReg && reg.test(node.tagName.toLowerCase()) ||
                  isStr && node.tagName.toLowerCase() === reg)) {
                result.push(node);
              }
            }
            return result;
          },
          createPostDirectory = function (article, directory, isDirNum) {
            var contentArr = [],
                titleId = [],
                levelArr, root, level,
                currentList, list, li, link, i, len;
            levelArr = (function (article, contentArr, titleId) {
                  var titleElem = postChildren(article.childNodes, /^h\d$/),
                      levelArr = [],
                      lastNum = 1,
                      lastRevNum = 1,
                      count = 0,
                      guid = 1,
                      id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                      lastRevNum, num, elem;
                  while (titleElem.length) {
                      elem = titleElem.shift();
                      contentArr.push(elem.innerHTML);
                      num = +elem.tagName.match(/\d/)[0];
                      if (num > lastNum) {
                          levelArr.push(1);
                          lastRevNum += 1;
                      } else if (num === lastRevNum ||
                          num > lastRevNum && num <= lastNum) {
                          levelArr.push(0);
                          lastRevNum = lastRevNum;
                      } else if (num < lastRevNum) {
                          levelArr.push(num - lastRevNum);
                          lastRevNum = num;
                      }
                      count += levelArr[levelArr.length - 1];
                      lastNum = num;
                      elem.id = elem.id || (id + guid++);
                      titleId.push(elem.id);
                  }
                  if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                  return levelArr;
              })(article, contentArr, titleId);
              currentList = root = document.createElement('ul');
              dirNum = [0];
              for (i = 0, len = levelArr.length; i < len; i++) {
                  level = levelArr[i];
                  if (level === 1) {
                      list = document.createElement('ul');
                      if (!currentList.lastElementChild) {
                          currentList.appendChild(document.createElement('li'));
                      }
                      currentList.lastElementChild.appendChild(list);
                      currentList = list;
                      dirNum.push(0);
                  } else if (level < 0) {
                      level *= 2;
                      while (level++) {
                          if (level % 2) dirNum.pop();
                          currentList = currentList.parentNode;
                      }
                  }
                  dirNum[dirNum.length - 1]++;
                  li = document.createElement('li');
                  link = document.createElement('a');
                  link.name = '#' + titleId[i];
                  link.href = 'Javascript:;'
                  link.className = "post-aside-anchor"
                  link.title = 'è®¿é—®' + titleId[i];
                  link.innerHTML = !isDirNum ? contentArr[i] :
                      dirNum.join('.') + ' ' + contentArr[i];
                  li.appendChild(link);
                  currentList.appendChild(li);
              }
            directory.appendChild(root);
          };
        createPostDirectory(document.getElementById('post-content'), directoryContainer, true);
      };
      postDirectoryBuild();
    </script>
    <script>
      // gtag('config', GA_TRACKING_ID, {
      //   'page_title' : 'Blog',
      //   'page_path': window.location.pathname,
      //   'post_title': 'watttsdfasdf',
      // });

    </script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        lang = hljs.initHighlightingOnLoad();
    </script>
</body>

</html>
