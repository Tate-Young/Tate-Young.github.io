
<!DOCTYPE>
<html lang="zh-cn" data-scribe-reduced-action-queue="true">
<head>
    <meta content='TypeScript é—®é¢˜æ”¶é›† - Tate & Snow' name='title' />
    <meta content='TypeScript é—®é¢˜æ”¶é›† - Tate & Snow' name='og:title' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <title>TypeScript é—®é¢˜æ”¶é›† - Tate & Snow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>TypeScript é—®é¢˜æ”¶é›† - Tate & Snow</title>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TypeScript é—®é¢˜æ”¶é›† - Tate & Snow">
<meta name="twitter:keywords" content="TypeScript é—®é¢˜æ”¶é›† - Tate & Snow" property='og:description' />
<meta property="og:type" content="article">
<meta property="og:title" content="TypeScript é—®é¢˜æ”¶é›† - Tate & Snow">
<meta name="og:keywords" content="TypeScript é—®é¢˜æ”¶é›† - Tate & Snow|TypeScript é—®é¢˜æ”¶é›†æ›´æ–°ç‚¹import typeåœ¨ä»¥å¾€ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦å¯¼å…¥ä¸€ä¸ªå€¼æˆ–ç±»å‹ï¼Œç›´æ¥å…¨éƒ¨å¯¼å…¥å³å¯ï¼Œåœ¨ TS è½¬ JS çš„æ—¶å€™ï¼ŒTS ä¼šè¯†åˆ«å‡ºé‚£äº›å¯¼å…¥é¡¹è¢«å½“åšç±»å‹ä½¿ç”¨ï¼Œå¹¶å°†å…¶åˆ é™¤ã€‚ä½†æ˜¯æœ‰æ—¶å€™ TS å¹¶ä¸èƒ½è¯†åˆ«æˆ‘ä»¬å¯¼å…¥..."
  property='og:description' />
<link rel="icon" type="image/png" href="http://localhost:2333/style/favicons/favicon.ico" />
<link href="http://localhost:2333/style/favicons/favicon.ico" rel="shortcut icon" type="image/png">
<link rel="canonical" href="http://localhost:2333/">
<link rel="alternate" type="application/rss+xml" title="Liberxue" href="http://localhost:2333/feed.xml">
<meta charset="UTF-8">
<link rel="manifest" href="/manifest.json">
<link rel="shortcut icon" href="http://localhost:2333/style/favicons/favicon.ico" type="image/x-icon">
<meta name="keywords" content="TypeScript é—®é¢˜æ”¶é›†æ›´æ–°ç‚¹import typeåœ¨ä»¥å¾€ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦å¯¼å…¥ä¸€ä¸ªå€¼æˆ–ç±»å‹ï¼Œç›´æ¥å…¨éƒ¨å¯¼å…¥å³å¯ï¼Œåœ¨ TS è½¬ JS çš„æ—¶å€™ï¼ŒTS ä¼šè¯†åˆ«å‡ºé‚£äº›å¯¼å…¥é¡¹è¢«å½“åšç±»å‹ä½¿ç”¨ï¼Œå¹¶å°†å…¶åˆ é™¤ã€‚ä½†æ˜¯æœ‰æ—¶å€™ TS å¹¶ä¸èƒ½è¯†åˆ«æˆ‘ä»¬å¯¼å…¥..." property='og:description'
/>
<meta name="description" content="Tate & Snow's Github blog" />
<link href="https://cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
<link href="http://localhost:2333/style/theme.css" rel="stylesheet"> 
<meta content='http://localhost:2333/2021/01/21/ts-update.html' property='og:url' />
<meta content="http://localhost:2333/2021/01/21/ts-update.html|TypeScript é—®é¢˜æ”¶é›†æ›´æ–°ç‚¹import typeåœ¨ä»¥å¾€ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦å¯¼å…¥ä¸€ä¸ªå€¼æˆ–ç±»å‹ï¼Œç›´æ¥å…¨éƒ¨å¯¼å…¥å³å¯ï¼Œåœ¨ TS è½¬ JS çš„æ—¶å€™ï¼ŒTS ä¼šè¯†åˆ«å‡ºé‚£äº›å¯¼å…¥é¡¹è¢«å½“åšç±»å‹ä½¿ç”¨ï¼Œå¹¶å°†å…¶åˆ é™¤ã€‚ä½†æ˜¯æœ‰æ—¶å€™ TS å¹¶ä¸èƒ½è¯†åˆ«æˆ‘ä»¬å¯¼å…¥..." property='og:description'
/>
<meta content="article" property="og:type" /> 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136311746-1"></script>
<!-- <script async src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
<script>
  window.dataLayer = window.dataLayer || [];
  window.GA_TRACKING_ID = 'UA-136311746-1'
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('set', {
    'country': 'US',
    'currency': 'USD',
    'description': 'fuck',
  });
  gtag('config', GA_TRACKING_ID, {
    'custom_map': {
      'dimension1': 'post_title',
    },
    'post_title': 'test',
  });
</script>
<meta content="" property="fb:app_id" />
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>TypeScript é—®é¢˜æ”¶é›† | Tate &amp; Snow</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="TypeScript é—®é¢˜æ”¶é›†" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="add infer keyword" />
<meta property="og:description" content="add infer keyword" />
<link rel="canonical" href="http://localhost:2333/2021/01/21/ts-update.html" />
<meta property="og:url" content="http://localhost:2333/2021/01/21/ts-update.html" />
<meta property="og:site_name" content="Tate &amp; Snow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-21T22:47:00+08:00" />
<script type="application/ld+json">
{"description":"add infer keyword","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:2333/2021/01/21/ts-update.html"},"@type":"BlogPosting","url":"http://localhost:2333/2021/01/21/ts-update.html","headline":"TypeScript é—®é¢˜æ”¶é›†","dateModified":"2021-01-21T22:47:00+08:00","datePublished":"2021-01-21T22:47:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<script>
  (function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

</head>

<body class="dark-theme" gtools_scp_screen_capture_injected="true">
    <header id="header" class="header bg-white">
        <div class="navbar-container">
            <a href="Javascript:;" onclick="onClickLogo()" title="è®¿é—® Tate & Snow" class="navbar-logo menu-logo">
                <img src="http://localhost:2333/style/images/tate.png" alt="Tate & Snow"> </a>
            <!-- <a href="/?tate" title="è®¿é—® Tate & Snow" class="navbar-logo">Tate & Snow</a>   -->
            <div class="navbar-menu">
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', '/')" title="è®¿é—® é¦–é¡µ" data-hover="é¦–é¡µ">é¦–é¡µ</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å‰ç«¯', '/front')" title="è®¿é—® å‰ç«¯" data-hover="å‰ç«¯">å‰ç«¯</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å†å²', '/history')" title="è®¿é—® å†å²" data-hover="å†å²">å†å²</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å…¶ä»–', '/other')" title="è®¿é—® å…¶ä»–" data-hover="å…¶ä»–">å…¶ä»–</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', '/tags')" title="è®¿é—® æ ‡ç­¾" data-hover="æ ‡ç­¾">æ ‡ç­¾</a>
                
                  <a class=" menu-item-about " href="Javascript:;" onclick="onClickMenu('å…³äº', '/README')" title="è®¿é—® å…³äº" data-hover="å…³äº">å…³äº</a>
                
            </div>
            <!-- <div class="navbar-menu">
                
                <a href="http://localhost:2333/">é¦–é¡µ</a>
                
                <a href="http://localhost:2333/front">å‰ç«¯</a>
                
                <a href="http://localhost:2333/history">å†å²</a>
                
                <a href="http://localhost:2333/other">å…¶ä»–</a>
                
                <a href="http://localhost:2333/tags">æ ‡ç­¾</a>
                
                <a href="http://localhost:2333/README">å…³äº</a>
                
            </div> -->
            <div class="navbar-search menu-item-search" onclick="onClickSearch()">
                <span class="icon-search"></span>
                <form id="cb-search-btn" role="search">
                    <span class="search-box">
                        <input type="text" class="input" id="cb-search-content" required="true" placeholder="æ ‡é¢˜ æ ‡ç­¾..." maxlength="30" autocomplete="off">
                    </span>
                </form>
            </div>
            <div class="navbar-mobile-menu" onclick="">
                <span class="icon-menu cross">
                    <span class="middle"></span>
                </span>
                <ul>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', 'http://localhost:2333/')">é¦–é¡µ</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å‰ç«¯', 'http://localhost:2333/front')">å‰ç«¯</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å†å²', 'http://localhost:2333/history')">å†å²</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…¶ä»–', 'http://localhost:2333/other')">å…¶ä»–</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', 'http://localhost:2333/tags')">æ ‡ç­¾</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…³äº', 'http://localhost:2333/README')">å…³äº</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </header>
    <a href="#header" class="back-to-top" onclick="onClickTop('TypeScript é—®é¢˜æ”¶é›†')">â¤´Topâ¤´</a>
    <div class="post-header-thumb bg-white}">
        <div class="post-header-thumb-op"></div>
        <div class="post-header-thumb">
            <div class="post-header-thumb-container">
                <h1 class="post-title" itemprop="name headline">
                    TypeScript é—®é¢˜æ”¶é›†</h1>
                <div class="post-data">
                    <time datetime="2021-01-21 22:47:00" itemprop="datePublished">
                      å‘å¸ƒæ—¶é—´ï¼š2021-01-21 22:47:00
                      &nbsp;&nbsp;&nbsp;
                      
                        ä¿®æ”¹æ—¶é—´ï¼š2022-06-13 15:08:00
                      
                    </time>
                    <a onclick="onClickCategory('å‰ç«¯')" href="Javascript:;" title="è®¿é—® å‰ç«¯" data-hover="åšå®¢åˆ†ç±»: å‰ç«¯">åšå®¢åˆ†ç±»: å‰ç«¯</a>
                    <!-- <a href="#read"> é˜…è¯»æ¬¡æ•°: comments</a>  -->
                </div>
                
                  <div role='update-description' class="post-data">
                    ä¿®æ”¹å†…å®¹ï¼šadd infer keyword
                  </div>
                
                <div class="post-tags">
                       
                    <a class="menu-item-tags" href="Javascript:;" onclick="onClickTag('TS')" title="è®¿é—®TS" data-hover="TS">
                        TS
                        <span>(3)</span>
                        
                    </a>
                       
                </div>
            </div>
        </div>
    </div>
    <article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
        <div class="post-header">
            <h1 class="post-title" itemprop="name headline">
                TypeScript é—®é¢˜æ”¶é›†</h1>
            <div class="post-data">
                <time datetime="2021-01-21 22:47:00" itemprop="datePublished">2021-01-21 22:47:00</time>
            </div>
        </div>
        <div id="post-content" class="post-content" itemprop="articleBody">
            <p class="post-tags">
                   
                <a href="Javascript:;" onclick="onClickTag('TS')" title="è®¿é—®TS" data-hover="TS">
                    TS
                    <span>(3)</span>
                    </a>
                   
            </p>
            <h1 id="typescript-é—®é¢˜æ”¶é›†">TypeScript é—®é¢˜æ”¶é›†</h1>

<h2 id="æ›´æ–°ç‚¹">æ›´æ–°ç‚¹</h2>

<h3 id="import-type">import type</h3>

<p>åœ¨ä»¥å¾€ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦å¯¼å…¥ä¸€ä¸ªå€¼æˆ–ç±»å‹ï¼Œç›´æ¥å…¨éƒ¨å¯¼å…¥å³å¯ï¼Œåœ¨ TS è½¬ JS çš„æ—¶å€™ï¼ŒTS ä¼šè¯†åˆ«å‡ºé‚£äº›å¯¼å…¥é¡¹è¢«å½“åšç±»å‹ä½¿ç”¨ï¼Œå¹¶å°†å…¶åˆ é™¤ã€‚ä½†æ˜¯æœ‰æ—¶å€™ TS å¹¶ä¸èƒ½è¯†åˆ«æˆ‘ä»¬å¯¼å…¥çš„åˆ°åº•æ˜¯å€¼è¿˜æ˜¯ç±»å‹ã€‚<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-8.html#type-only-imports-and-export"><strong>Typescript 3.8</strong></a> é‡Œæ–°å¢äº†ä¸€ä¸ªæ–°çš„è¯­æ³• <code class="highlighter-rouge">import type</code>ï¼Œå³ä»…å¯¼å…¥ç±»å‹ã€‚åŒæ · <code class="highlighter-rouge">export type</code> ä»…æä¾›ä¸€ä¸ªç”¨äºç±»å‹çš„å¯¼å‡ºï¼Œæœ€ç»ˆéƒ½ä¼šè¢«åˆ é™¤:</p>

<pre><code class="language-JS">import type { SomeThing } from "./some-module.js"

export type { SomeThing }
</code></pre>

<blockquote>
  <p>if youâ€™ve hit issues under <code class="highlighter-rouge">--isolatedModules</code>, TypeScriptâ€™s <code class="highlighter-rouge">transpileModule</code> API, or <code class="highlighter-rouge">Babel</code>, this feature might be relevant.</p>
</blockquote>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨ä»…ç±»å‹å¯¼å…¥åŠŸèƒ½æ—¶ï¼Œå¯¼å…¥ class çš„è¯ä¸èƒ½å¯¹å…¶è¿›è¡Œæ‰©å±•:</p>

<pre><code class="language-JS">import type { Component } from "react"

interface ButtonProps {
  // ...
}

class Button extends Component&lt;ButtonProps&gt; {
  //                 ~~~~~~~~~
  // error! 'Component' only refers to a type, but is being used as a value here.
  // ...
}
</code></pre>

<p>å·å¤–å·å¤–ï¼Œ<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-5.html#type-modifiers-on-import-names"><strong>4.5</strong></a> ç‰ˆæœ¬åˆæ›´æ–°äº†å†™æ³•ï¼š</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- import type { BaseType } from "./some-module.js"
- import { someFunc } from "./some-module.js"
</span><span class="gi">+ import { someFunc, type BaseType } from "./some-module.js"
</span></code></pre></div></div>

<h3 id="top-level-await">Top-Level Await</h3>

<p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬åœ¨ä½¿ç”¨ await è¯­æ³•çš„æ—¶å€™ï¼Œå¿…é¡»åŒ…è£¹åœ¨ async å‡½æ•°ä¸­ï¼Œç„¶åç«‹å³è°ƒç”¨è¯¥å‡½æ•°æ¥æ‰§è¡Œå¼‚æ­¥æ“ä½œ:</p>

<pre><code class="language-JS">async function main() {
  const response = await fetch("...");
  const greeting = await response.text();
  console.log(greeting);
}

main().catch((e) =&gt; console.error(e));
</code></pre>

<p><a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-8.html#top-level-await"><strong>Typescript 3.8</strong></a> æ–°å¢äº† <code class="highlighter-rouge">Top-Level Await</code> æ¥çœå»è¿™éƒ¨åˆ†åŒ…è£…ä»£ç ã€‚æ­¤å¤–æ³¨æ„ä¸€ç‚¹ï¼Œ<code class="highlighter-rouge">Top-Level await</code> åªåœ¨é¡¶çº§æ¨¡å—å·¥ä½œï¼Œæ‰€ä»¥ä»£ç ä¸­éœ€è¦å«æœ‰ export æˆ–è€… import æ‰ä¼šè®¤ä¸ºè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªæ¨¡å—ã€‚å¯¹äºæ²¡æœ‰ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ <code class="highlighter-rouge">export {}</code>:</p>

<pre><code class="language-JS">// é¡¶çº§æ¨¡å—
const response = await fetch("...");
const greeting = await response.text();
console.log(greeting);

// Make sure we're a module
export {};
</code></pre>

<h3 id="bigint">bigint</h3>

<p><a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-2.html#bigint"><strong>Typescript 3.2</strong></a> é’ˆå¯¹äº <a href="( http://localhost:2333/2020/05/05/js-floating-points.html#bigint )"><strong>BigInt</strong></a> ç±»å‹åšäº†æ”¯æŒï¼Œè¡¨ç¤ºä¸ºå°å†™çš„ <strong>bigint</strong>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œbigint å’Œ number æ˜¯ä¸¤ç§ä¸åŒçš„ç±»å‹:</p>

<pre><code class="language-JS">declare let foo: number;
declare let bar: bigint;

foo = bar; // error: Type 'bigint' is not assignable to type 'number'.
bar = foo; // error: Type 'number' is not assignable to type 'bigint'.

// æ··åˆè®¡ç®—ä½¿ç”¨çš„æ—¶å€™ï¼Œå¿…é¡»å°†æ•°å­—ç±»å‹è½¬æ¢ä¸º bigint
console.log(3.141592 * 10000n); // error
console.log(3145 * 10n); // error
console.log(BigInt(3145) * 10n); // okay!
</code></pre>

<h3 id="ts-nocheck--ts-ignore">@ts-nocheck / @ts-ignore</h3>

<p>ä¸ºäº†è®©ç”¨æˆ·èƒ½ä» JS åˆ° TS å¹³æ»‘è¿‡æ¸¡ï¼ŒåŸå…ˆèƒ½é€šè¿‡ <code class="highlighter-rouge">--allowJs</code> æ¥æ”¯æŒ TS å’Œ JS æ–‡ä»¶çš„æ··åˆåœ¨ä¸€èµ·ç¼–è¯‘ï¼Œä¸ä¼šå¯¹ JS æ–‡ä»¶å»åšç±»å‹æ£€æŸ¥ã€‚<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-3.html#errors-in-js-files-with---checkjs"><strong>Typescript 2.3</strong></a> å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®ç°å¯¹æ··åˆåœ¨ä¸€èµ·çš„ JS æ–‡ä»¶ä¸€èµ·åšç±»å‹æ£€æŸ¥:</p>

<ol>
  <li>é€šè¿‡å¼€å¯ <code class="highlighter-rouge">--checkJs</code> é…ç½®æ¥å¯¹ JS æ–‡ä»¶å»åšæ£€æµ‹ã€‚åœ¨ JS æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡åœ¨é¡¶éƒ¨æ·»åŠ  <code class="highlighter-rouge">@ts-nocheck</code> æ³¨é‡Šè·³è¿‡è¯¥æ–‡ä»¶ç±»å‹æ£€æµ‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ  <code class="highlighter-rouge">@ts-ignore</code> æ³¨é‡Šè·³è¿‡ä¸‹ä¸€è¡Œçš„æ–‡ä»¶ç±»å‹æ£€æµ‹</li>
  <li>ç›´æ¥é€šè¿‡ <code class="highlighter-rouge">@ts-check</code> å¯¹ JS æ–‡ä»¶å»åšæ£€æµ‹</li>
</ol>

<p>å¹¶ä¸”åšç±»å‹æ£€æµ‹çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥æ ¹æ® jsdoc çš„ç±»å‹æ³¨è§£è‡ªåŠ¨æ¥è¿›è¡Œåˆ¤æ–­:</p>

<pre><code class="language-JS">// @ts-check

/**
 * @param {string} input
*/
function foo ( input ) {
  input.tolowercase ()
      // ~~~~~~~~~~~ Error!  Should be toLowerCase
} 
</code></pre>

<blockquote>
  <p>åˆ°äº† <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#-ts-nocheck-in-typescript-files"><strong>Typescript 3.7</strong></a>ï¼Œ<code class="highlighter-rouge">@ts-nocheck</code> çš„æ³¨é‡Šä¹Ÿå¯ä»¥ä¸ä»…ä»…é’ˆå¯¹ JS æ–‡ä»¶ï¼ŒåŒæ ·å¯ä»¥ä½œç”¨äº TS æ–‡ä»¶ã€‚</p>
</blockquote>

<blockquote>
  <p>åˆ°äº† <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-1.html#checkjs-implies-allowjs"><strong>Typescript 4.1</strong></a>ï¼Œè®¾ç½® <code class="highlighter-rouge">--checkJs</code> çš„æ—¶å€™ä¼šé»˜è®¤å¼€é€š <code class="highlighter-rouge">--allowJS</code></p>
</blockquote>

<h3 id="ts-expect-error">@ts-expect-error</h3>

<p>å½“æˆ‘ä»¬é€šè¿‡ <code class="highlighter-rouge">@ts-expect-error</code> æ¥è¿›è¡Œæ³¨é‡Šæ—¶ï¼ŒTS æŠ›å‡ºçš„ç±»å‹é”™è¯¯ä¼šè¢«å¿½ç•¥ï¼›å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ <code class="highlighter-rouge">Unused '@ts-expect-error' directive.</code>ã€‚é€šå¸¸æˆ‘ä»¬çš„ä½¿ç”¨åœºæ™¯å¯èƒ½æ˜¯å•å…ƒæµ‹è¯•ï¼Œæ¯”å¦‚:</p>

<pre><code class="language-JS">function doStuff(abc: string, xyz: string) {
  assert(typeof abc === "string");
  assert(typeof xyz === "string");

  // do some stuff
}
</code></pre>

<pre><code class="language-JS">// å•å…ƒæµ‹è¯•
expect(() =&gt; {
  doStuff(123, 456);
}).toThrow();
</code></pre>

<p>å¦‚æœå•å…ƒæµ‹è¯•ä¹Ÿæ˜¯ç”¨ TS æ¥ç¼–å†™çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æŠ¥é”™:</p>

<pre><code class="language-JS">doStuff(123, 456);
//           ~~~
// error: Type 'number' is not assignable to type 'string'.
</code></pre>

<p>å› æ­¤é€šè¿‡ä¸Šè¿°çš„æ³¨é‡Šæˆ‘ä»¬å°±èƒ½è·³è¿‡è¿™ä¸ªç±»å‹æ£€æµ‹ã€‚ä½†æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒåœ¨åŠŸèƒ½ä¸Šå’Œ <code class="highlighter-rouge">@ts-ignore</code> å¾ˆç›¸ä¼¼å‘€ï¼Œä¸ºå•¥è¦å•ç‹¬å¼•å…¥è¿™ä¸ªæŒ‡ä»¤å‘¢ï¼Œä½ ä¼š pick è°ï¼Ÿä¸‹é¢æ˜¯å®˜ç½‘è´´å‡ºæ¥çš„ä¸¤è€…çš„æ¯”è¾ƒ:</p>

<ul>
  <li>Pick ts-expect-error if:</li>
</ul>

<ol>
  <li>youâ€™re writing test code where you actually want the type system to error on an operation</li>
  <li>you expect a fix to be coming in fairly quickly and you just need a quick workaround</li>
  <li>youâ€™re in a reasonably-sized project with a proactive team that wants to remove suppression comments as soon affected code is valid again</li>
</ol>

<ul>
  <li>Pick ts-ignore if:</li>
</ul>

<ol>
  <li>you have a larger project and new errors have appeared in code with no clear owner</li>
  <li>you are in the middle of an upgrade between two different versions of TypeScript, and a line of code errors in one version but not another.</li>
  <li>you honestly donâ€™t have the time to decide which of these options is better.</li>
</ol>

<h3 id="template-literal-types">Template Literal Types</h3>

<p><a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-1.html#template-literal-types"><strong>Typescript 4.1</strong></a> é‡Œå¼•å…¥äº†å­—ç¬¦ä¸²æ¨¡æ¿ç±»å‹ï¼Œç®€å•çš„çœ‹ä¸‹:</p>

<pre><code class="language-JS">type Color = "red" | "blue";
type Quantity = "one" | "two";

type SeussFish = `${Quantity | Color} fish`;
//   ^ = type SeussFish = "one fish" | "two fish" | "red fish" | "blue fish"
</code></pre>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸¾ä¸ªå®é™…ä¸€ç‚¹çš„æ —å­ï¼Œæ¯”å¦‚è¦ä¼ å…¥ä¸€äº›ä½ç§»å‚æ•°:</p>

<pre><code class="language-JS">type VerticalAlignment = "top" | "middle" | "bottom"
type HorizontalAlignment = "left" | "center" | "right"

// Takes
//   | "top-left"    | "top-center"    | "top-right"
//   | "middle-left" | "middle-center" | "middle-right"
//   | "bottom-left" | "bottom-center" | "bottom-right"

declare function setAlignment(value: `${VerticalAlignment}-${HorizontalAlignment}`): void

setAlignment("top-left");   // works!
setAlignment("top-middel"); // error!
// Argument of type '"top-middel"' is not assignable to parameter of type '"top-left" | "top-center" | "top-right" | "middle-left" | "middle-center" | "middle-right" | "bottom-left" | "bottom-center" | "bottom-right"'.
</code></pre>

<p>å†çœ‹ä¸ªç¨å¾®å¤æ‚ç‚¹çš„æ —å­:</p>

<pre><code class="language-JS">type PropEventSource&lt;T&gt; = {
  on&lt;K extends string &amp; keyof T&gt;
    (eventName: `${K}Changed`, callback: (newValue: T[K]) =&gt; void ): void;
};

declare function makeWatchedObject&lt;T&gt;(obj: T): T &amp; PropEventSource&lt;T&gt;;

let person = makeWatchedObject({
  firstName: "Homer",
  age: 42,
  location: "Springfield",
});

// works! 'newName' is typed as 'string'
person.on("firstNameChanged", newName =&gt; {
  // 'newName' has the type of 'firstName'
  console.log(`new name is ${newName.toUpperCase()}`);
});

// works! 'newAge' is typed as 'number'
person.on("ageChanged", newAge =&gt; {
  if (newAge &lt; 0) {
    console.log("warning! negative age");
  }
})
</code></pre>

<h3 id="key-remapping-in-mapped-types">Key Remapping in Mapped Types</h3>

<p>æ˜ å°„ç±»å‹å¯ä»¥åŸºäºä»»æ„é”®åˆ›å»ºæ–°çš„å¯¹è±¡ç±»å‹ï¼Œæ‰“ä¸ªæ¯”æ–¹:</p>

<pre><code class="language-JS">type Options = {
  [K in "noImplicitAny" | "strictNullChecks" | "strictFunctionTypes"]?: boolean
};
// same as
//   type Options = {
//     noImplicitAny?: boolean,
//     strictNullChecks?: boolean,
//     strictFunctionTypes?: boolean
//   };
</code></pre>

<p>ä½†æ˜¯æˆ‘ä»¬ç›®å‰èƒ½å¤Ÿåšçš„åªæ˜¯åœ¨ç»™å‡ºçš„å€¼é‡Œé¢å»ç”Ÿæˆ keyï¼Œè€Œä¸èƒ½æ˜ å°„åˆ°å…¶ä»– key å€¼ï¼Œ<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-1.html#template-literal-types"><strong>Typescript 4.1</strong></a> é€šè¿‡ <strong>as</strong> æä¾›äº†é‡æ–°æ˜ å°„çš„åŠŸèƒ½:</p>

<pre><code class="language-JS">type Getters&lt;T&gt; = {
  [K in keyof T as `get${Capitalize&lt;string &amp; K&gt;}`]: () =&gt; T[K]
};

interface Person {
  name: string
  age: number
  location: string
}

type LazyPerson = Getters&lt;Person&gt;
//   ^ = type LazyPerson = {
//       getName: () =&gt; string;
//       getAge: () =&gt; number;
//       getLocation: () =&gt; string;
//   }
</code></pre>

<p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨è¿™ä¸ªå®ç° Omit çš„æ•ˆæœ:</p>

<pre><code class="language-JS">// Remove the 'kind' property
type RemoveKindField&lt;T&gt; = {
  [K in keyof T as Exclude&lt;K, "kind"&gt;]: T[K]
};

interface Circle {
  kind: "circle"
  radius: number
}

type KindlessCircle = RemoveKindField&lt;Circle&gt;;
//   ^ = type KindlessCircle = {
//       radius: number
//   }
</code></pre>

<h2 id="é—®é¢˜æ”¶é›†">é—®é¢˜æ”¶é›†</h2>

<h3 id="union-type-with-filter--map">union type with filter / map</h3>

<p>å¯¹äºä¸€ä¸ªå˜é‡æ˜¯è”åˆæ•°ç»„ç±»å‹(union type)æ—¶ï¼Œæ— æ³•è°ƒç”¨å…¶ filter æˆ–è€… map æ–¹æ³•:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">person</span><span class="p">:</span> <span class="nx">string</span><span class="p">[]</span> <span class="o">|</span> <span class="nx">number</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nx">person</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">p</span><span class="p">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">v</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="http://localhost:2333/style/images/smms/ts-filter-map.png" alt="filter map" /></p>

<p>å¾ˆæ˜¾ç„¶ person.filter è‚¯å®šæ˜¯å¯è°ƒç”¨æ–¹æ³•ï¼Œä½†æ˜¯ TS å¯¹äºè¿™ç§æƒ…å†µçš„æç¤ºå´æ˜¯ The expression is not callableã€‚è§£å†³åŠæ³•æ˜¯å¯ä»¥æŠŠæ•°ç»„ç±»å‹ç”±è”åˆæ•°ç»„å˜ä¸ºæ•°ç»„å…ƒç´ ä¸ºè”åˆç±»å‹ï¼Œå¦‚ä¸‹ã€‚æ¨èé˜…è¯»ï¼š<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-3.html#key-remapping-in-mapped-types"><strong>TypeScript 3.3</strong></a>ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">person</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">string</span><span class="o">|</span> <span class="nx">number</span><span class="o">&gt;</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></div>

<h3 id="operands-for-delete-must-be-optional">Operands for delete must be optional</h3>

<p>å½“ä½¿ç”¨ delete æ“ä½œç¬¦ï¼Œè¿ç®—å…ƒå¿…é¡»ä¸º <code class="highlighter-rouge">any, unknown, never</code>ï¼Œæˆ–è€…ä¸ºå¯é€‰(å› ä¸ºå…¶ç±»å‹ä¸­åŒ…å«äº† undefined)ã€‚å¦åˆ™ä¼šæŠ¥é”™:</p>

<pre><code class="language-JS">interface Thing {
  prop: string
}

function f(x: Thing) {
  delete x.prop // The operand of a 'delete' operator must be optional.
}
</code></pre>

<p>ä¿®æ”¹çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦æŠŠç›¸å…³å±æ€§æ”¹ä¸º optional å³å¯:</p>

<pre><code class="language-JS">interface Thing {
  prop?: string
}
</code></pre>

<p>å¦‚æœç¢°åˆ°æ¯”è¾ƒå¤æ‚çš„æ —å­ï¼Œæ¯”å¦‚æ¥å£å®šä¹‰äº†å¤šä¸ªå±æ€§çš„è¯ï¼Œè¿˜å¯ä»¥ç”¨ä»¥ä¸‹è‡ªå®šä¹‰ç±»å‹å»ä¿®æ”¹:</p>

<pre><code class="language-JS">export type TPickPartial&lt;T, K extends keyof T&gt; = Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt; &amp; Partial&lt;Pick&lt;T, K&gt;&gt;

// ä¾‹å¦‚
type TTest = TPickPartial&lt;TAnotherTest, 'canSort' | 'scenes'&gt;
</code></pre>

<h3 id="objectkeys-using-numbers">Object.keys using numbers</h3>

<p>è°ƒç”¨ <strong>Object.keys</strong> è·å–å¯¹è±¡çš„ key å€¼ï¼Œåœ¨ç±»å‹æ£€æµ‹æ—¶é»˜è®¤ä¸º <code class="highlighter-rouge">string[]</code>ï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸ªé—®é¢˜:</p>

<pre><code class="language-JS">type Foo = { [key: number]: string }

const foo: Foo = { 100: 'foo', 200: 'bar' }
const sizes: number[] = Object.keys(foo) // Type 'string[]' is not assignable to type 'number[]
</code></pre>

<p>å› æ­¤æˆ‘ä»¬å¿…é¡»å°†å­—ç¬¦ä¸²ç±»å‹å…ˆè½¬æ¢ä¸ºæ•°å­—ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯é€šè¿‡ map æ¥å®ç°:</p>

<pre><code class="language-JS">const sizes: number[] = Object.keys(foo).map(Number)
</code></pre>

<p>æ¥çœ‹ä¸ªå®Œæ•´ä¸€ç‚¹çš„æ —å­:</p>

<pre><code class="language-JS">const weekMapping = {
  1: 'å‘¨ä¸€',
  2: 'å‘¨äºŒ',
  3: 'å‘¨ä¸‰',
  4: 'å‘¨å››',
  5: 'å‘¨äº”',
  6: 'å‘¨å…­',
  7: 'å‘¨æ—¥',
}

type TWeekKey = keyof typeof weekMapping

const keys = Object.keys(weekMapping).map(Number) as Array&lt;TWeekKey&gt;

function WeekSelector() {
  return (
    keys.map(key =&gt; (
      &lt;Button key={key}&gt;{weekMapping[key]}&lt;/Button&gt;
    ))
  )
}
</code></pre>

<h2 id="åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹-isdistributive">åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ isDistributive</h2>

<p>è¿™èŠ‚ä¸»è¦<a href="https://mp.weixin.qq.com/s/zSX7xLKSb86NVGStKQfqfw">å‚è€ƒè¿™é‡Œ</a>ï¼Œå…ˆçœ‹çœ‹ä»¥ä¸‹ res çš„ç±»å‹éƒ½æ˜¯å•¥ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åœºæ™¯ä¸€</span>
<span class="nx">type</span> <span class="nx">TTest</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="nx">number</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span>
<span class="nx">type</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">TTest</span><span class="o">&lt;</span><span class="mi">1</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="o">&gt;</span>

<span class="c1">// åœºæ™¯äºŒ</span>
<span class="nx">type</span> <span class="nx">TTest</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="kc">true</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span>
<span class="nx">type</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">TTest</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span>

<span class="c1">// åœºæ™¯ä¸‰</span>
<span class="nx">type</span> <span class="nx">TTest</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="kc">true</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span>
<span class="nx">type</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">TTest</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span>

<span class="c1">// åœºæ™¯å››</span>
<span class="nx">type</span> <span class="nx">TTest</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="kc">true</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span>
<span class="nx">type</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">TTest</span><span class="o">&lt;</span><span class="nx">never</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>é—®é¢˜è§£ç­”å¦‚ä¸‹ï¼š</p>

<pre><code class="language-TEXT">&lt;!-- åœºæ™¯ä¸€ --&gt;
ç­”æ¡ˆï¼š1 | 2
åŸå› ï¼šå¯¹äºåˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ï¼Œè”åˆç±»å‹çš„æ¯ä¸ªç±»å‹ä¼šå•ç‹¬ä¼ å…¥æ±‚å€¼ï¼ŒæŠŠæ¯ä¸ªçš„ç»“æœåˆå¹¶æˆè”åˆç±»å‹

&lt;!-- åœºæ™¯äºŒ --&gt;
ç­”æ¡ˆï¼š1 | 2
åŸå› ï¼šboolean å…¶å®ä¹Ÿæ˜¯è”åˆç±»å‹ï¼Œæ‰€ä»¥ä¼šæŠŠ true å’Œ false åˆ†åˆ«ä¼ å…¥æ±‚å€¼ï¼ŒåŒä¸Š

&lt;!-- åœºæ™¯ä¸‰ --&gt;
ç­”æ¡ˆï¼š1 | 2
åŸå› ï¼šæ¡ä»¶ç±»å‹å¯¹ any åšäº†ç‰¹æ®Šå¤„ç†ï¼Œå¦‚æœå·¦è¾¹æ˜¯ anyï¼Œé‚£ä¹ˆç›´æ¥æŠŠ trueType å’Œ falseType åˆå¹¶æˆè”åˆç±»å‹è¿”å›

&lt;!-- åœºæ™¯å›› --&gt;
ç­”æ¡ˆï¼šnever
åŸå› ï¼šå½“æ¡ä»¶ç±»å‹å·¦è¾¹æ˜¯ never æ—¶ï¼Œç›´æ¥è¿”å› never
</code></pre>

<p>æˆ‘ä»¬æ ¹æ®æºç æ¥è§£é‡Šä¸‹ï¼ŒTypeScript åœ¨å¤„ç†åˆ°æ¡ä»¶ç±»å‹ Conditional Type çš„æ—¶å€™ï¼Œä¼šè®¾ç½®ä¸€ä¸ª <strong>isDistributive</strong> çš„å±æ€§ï¼Œæ ¹æ®ç±»å‹å‚æ•°æ˜¯ä¸æ˜¯ checkTypeï¼ˆå·¦è¾¹çš„ç±»å‹ï¼‰æ¥è®¾ç½®ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getTypeFromConditionalTypeNode</span><span class="p">(</span><span class="nx">node</span><span class="p">:</span> <span class="nx">ConditionalTypeNode</span><span class="p">):</span> <span class="nx">Type</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">links</span> <span class="o">=</span> <span class="nx">getNodeLinks</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">links</span><span class="p">.</span><span class="nx">resolvedType</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">checkType</span> <span class="o">=</span> <span class="nx">getTypeFromTypeNode</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">checkType</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">aliasSymbol</span> <span class="o">=</span> <span class="nx">getAliasSymbolForTypeNode</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">aliasTypeArguments</span> <span class="o">=</span> <span class="nx">getTypeArgumentsForAliasSymbol</span><span class="p">(</span><span class="nx">aliasSymbol</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">allOuterTypeParameters</span> <span class="o">=</span> <span class="nx">getOuterTypeParameters</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="cm">/*includeThisTypes*/</span> <span class="kc">true</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">outerTypeParameters</span> <span class="o">=</span> <span class="nx">aliasTypeArguments</span> <span class="p">?</span> <span class="nx">allOuterTypeParameters</span> <span class="p">:</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">allOuterTypeParameters</span><span class="p">,</span> <span class="nx">tp</span> <span class="o">=&gt;</span> <span class="nx">isTypeParameterPossiblyReferenced</span><span class="p">(</span><span class="nx">tp</span><span class="p">,</span> <span class="nx">node</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">root</span><span class="p">:</span> <span class="nx">ConditionalRoot</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">node</span><span class="p">,</span>
      <span class="nx">checkType</span><span class="p">,</span>
      <span class="na">extendsType</span><span class="p">:</span> <span class="nx">getTypeFromTypeNode</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">extendsType</span><span class="p">),</span>
      <span class="na">isDistributive</span><span class="p">:</span> <span class="o">!!</span><span class="p">(</span><span class="nx">checkType</span><span class="p">.</span><span class="nx">flags</span> <span class="o">&amp;</span> <span class="nx">TypeFlags</span><span class="p">.</span><span class="nx">TypeParameter</span><span class="p">),</span>
      <span class="na">inferTypeParameters</span><span class="p">:</span> <span class="nx">getInferTypeParameters</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
      <span class="nx">outerTypeParameters</span><span class="p">,</span>
      <span class="na">instantiations</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
      <span class="nx">aliasSymbol</span><span class="p">,</span>
      <span class="nx">aliasTypeArguments</span>
    <span class="p">};</span>
    <span class="nx">links</span><span class="p">.</span><span class="nx">resolvedType</span> <span class="o">=</span> <span class="nx">getConditionalType</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="cm">/*mapper*/</span> <span class="kc">undefined</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">outerTypeParameters</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">root</span><span class="p">.</span><span class="nx">instantiations</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">,</span> <span class="nx">Type</span><span class="o">&gt;</span><span class="p">();</span>
      <span class="nx">root</span><span class="p">.</span><span class="nx">instantiations</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">getTypeListId</span><span class="p">(</span><span class="nx">outerTypeParameters</span><span class="p">),</span> <span class="nx">links</span><span class="p">.</span><span class="nx">resolvedType</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">links</span><span class="p">.</span><span class="nx">resolvedType</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å› ä¸º T extends number çš„ checkType æ˜¯ Tï¼Œæ‰€ä»¥è¿™é‡Œçš„ isDistributive å°±æ˜¯ trueï¼Œä¹Ÿå°±æ˜¯å®ƒæ˜¯åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ã€‚è¿™æ—¶ä¼šåœ¨æ±‚å€¼çš„æ—¶å€™æŠŠæ¯ä¸ªç±»å‹å•ç‹¬ä¼ å…¥æ±‚å€¼ï¼Œæœ€åæŠŠç»“æœåˆå¹¶ã€‚è¿™å°±æ˜¯åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹é‡åˆ°è”åˆç±»å‹æ—¶çš„å¤„ç†ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Distributive conditional types are distributed over union types. For example, when the</span>
<span class="c1">// distributive conditional type T extends U ? X : Y is instantiated with A | B for T, the</span>
<span class="c1">// result is (A extends U ? X : Y) | (B extends U ? X : Y). ğŸ‘ˆ</span>
<span class="nx">result</span> <span class="o">=</span> <span class="nx">distributionType</span> <span class="o">&amp;&amp;</span> <span class="nx">checkType</span> <span class="o">!==</span> <span class="nx">distributionType</span> <span class="o">&amp;&amp;</span> <span class="nx">distributionType</span><span class="p">.</span><span class="nx">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">TypeFlags</span><span class="p">.</span><span class="nx">Union</span> <span class="o">|</span> <span class="nx">TypeFlags</span><span class="p">.</span><span class="nx">Never</span><span class="p">)</span> <span class="p">?</span>
  <span class="nx">mapTypeWithAlias</span><span class="p">(</span><span class="nx">getReducedType</span><span class="p">(</span><span class="nx">distributionType</span><span class="p">),</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="nx">getConditionalType</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">prependTypeMapping</span><span class="p">(</span><span class="nx">checkType</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">newMapper</span><span class="p">)),</span> <span class="nx">aliasSymbol</span><span class="p">,</span> <span class="nx">aliasTypeArguments</span><span class="p">)</span> <span class="p">:</span>
  <span class="nx">getConditionalType</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">newMapper</span><span class="p">,</span> <span class="nx">aliasSymbol</span><span class="p">,</span> <span class="nx">aliasTypeArguments</span><span class="p">);</span>
</code></pre></div></div>

<p>åœºæ™¯ä¸€å’ŒäºŒéƒ½ä¼šèµ° mapTypeWithAlias è¿™ä¸ªæ–¹æ³•ã€‚åœºæ™¯ä¸‰çš„ any ä¼šå‘ç°èµ°äº† getConditionalType è¿™ä¸ªæ–¹æ³•ï¼Œä¹Ÿç¡®å®šäº† any ä¸å±äº union è”åˆç±»å‹ï¼Œç»§ç»­å¾€ä¸‹çœ‹ï¼Œæ„æ€å°±æ˜¯è¿”å› trueType å’Œ falseType çš„è”åˆç±»å‹ï¼Œå› ä¸º any åŒ¹é…ä»»ä½•ç±»å‹ï¼Œä¹Ÿå°±å¾—å‡ºæœ€ç»ˆç­”æ¡ˆ 1 | 2ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Return union of trueType and falseType for 'any' since it matches anything</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">checkType</span><span class="p">.</span><span class="nx">flags</span> <span class="o">&amp;</span> <span class="nx">TypeFlags</span><span class="p">.</span><span class="nx">Any</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isUnwrapped</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">(</span><span class="nx">extraTypes</span> <span class="o">||</span> <span class="p">(</span><span class="nx">extraTypes</span> <span class="o">=</span> <span class="p">[])).</span><span class="nx">push</span><span class="p">(</span><span class="nx">instantiateType</span><span class="p">(</span><span class="nx">getTypeFromTypeNode</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">trueType</span><span class="p">),</span> <span class="nx">combinedMapper</span> <span class="o">||</span> <span class="nx">mapper</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è‡³äº never æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾€ä¸‹èµ°äº†è¿™æ®µä»£ç ï¼Œç›´æ¥è¿”å› never äº†ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">.</span><span class="nx">flags</span> <span class="o">&amp;</span> <span class="nx">TypeFlags</span><span class="p">.</span><span class="nx">Never</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">type</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ€»ç»“ä¸€ä¸‹ï¼š<strong>æ¡ä»¶ç±»å‹å½“ checkTypeï¼ˆå·¦è¾¹çš„ç±»å‹ï¼‰æ˜¯ç±»å‹å‚æ•°çš„æ—¶å€™ï¼Œä¼šæœ‰ distributive çš„æ€§è´¨ï¼Œä¹Ÿå°±æ˜¯ä¼ å…¥è”åˆç±»å‹æ—¶ä¼šæŠŠæ¯ä¸ªç±»å‹å•ç‹¬ä¼ å…¥åšè®¡ç®—ï¼Œæœ€åæŠŠç»“æœåˆå¹¶è¿”å›ã€‚è¿™å«åšåˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ã€‚</strong></p>

<blockquote>
  <p>å…·ä½“æºç çš„è§£é‡Šè¯·<a href="https://mp.weixin.qq.com/s/zSX7xLKSb86NVGStKQfqfw">å‚è€ƒè¿™é‡Œ</a> ğŸ‘ˆ</p>
</blockquote>

<h2 id="infer-å…³é”®å­—">infer å…³é”®å­—</h2>

<p><strong>infer</strong> è¡¨ç¤ºåœ¨ extends æ¡ä»¶è¯­å¥ä¸­å¾…æ¨æ–­çš„ç±»å‹å˜é‡ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">type</span> <span class="nx">ParamType</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="nx">infer</span> <span class="nx">P</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">any</span> <span class="p">?</span> <span class="nx">P</span> <span class="p">:</span> <span class="nx">T</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">User</span> <span class="p">{</span>
  <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nl">age</span><span class="p">:</span> <span class="nx">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">type</span> <span class="nx">Func</span> <span class="o">=</span> <span class="p">(</span><span class="nx">user</span><span class="p">:</span> <span class="nx">User</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>

<span class="nx">type</span> <span class="nx">Param</span> <span class="o">=</span> <span class="nx">ParamType</span><span class="o">&lt;</span><span class="nx">Func</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// Param = User</span>
<span class="nx">type</span> <span class="nx">AA</span> <span class="o">=</span> <span class="nx">ParamType</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// string</span>
</code></pre></div></div>

<p>åœ¨ 2.8 ç‰ˆæœ¬ä¸­ï¼ŒTypeScript å†…ç½®äº†ä¸€äº›ä¸ infer æœ‰å…³çš„æ˜ å°„ç±»å‹ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">type</span> <span class="nx">ReturnType</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="nx">any</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="nx">infer</span> <span class="nx">P</span> <span class="p">?</span> <span class="nx">P</span> <span class="p">:</span> <span class="nx">any</span>
</code></pre></div></div>

<p>ç›¸æ¯”äºæ–‡ç« å¼€å§‹ç»™å‡ºçš„ç¤ºä¾‹ï¼Œ<code class="highlighter-rouge">ReturnType&lt;T&gt;</code> åªæ˜¯å°† infer P ä»å‚æ•°ä½ç½®ç§»åŠ¨åˆ°è¿”å›å€¼ä½ç½®ï¼Œå› æ­¤æ­¤æ—¶ P å³æ˜¯è¡¨ç¤ºå¾…æ¨æ–­çš„è¿”å›å€¼ç±»å‹ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">type</span> <span class="nx">Func</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="p">;</span>
<span class="nx">type</span> <span class="nx">Test</span> <span class="o">=</span> <span class="nx">ReturnType</span><span class="o">&lt;</span><span class="nx">Func</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// Test = User</span>
</code></pre></div></div>

<p>åŒæ ·çš„ï¼Œä¸€ä¸ªæ„é€ å‡½æ•°å¯ä»¥ä½¿ç”¨ new æ¥å®ä¾‹åŒ–ï¼Œå› æ­¤å®ƒçš„ç±»å‹é€šå¸¸è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">type</span> <span class="nx">Constructor</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="nx">any</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="nx">any</span>
</code></pre></div></div>

<p>å½“ infer ç”¨äºæ„é€ å‡½æ•°ç±»å‹ä¸­ï¼Œå¯ç”¨äºå‚æ•°ä½ç½® <code class="highlighter-rouge">new (...args: infer P) =&gt; any</code> å’Œè¿”å›å€¼ä½ç½® <code class="highlighter-rouge">new (...args: any[]) =&gt; infer P</code>ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// è·å–å‚æ•°ç±»å‹</span>
<span class="nx">type</span> <span class="nx">ConstructorParameters</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="k">new</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="nx">any</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="nx">any</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="k">new</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="nx">infer</span> <span class="nx">P</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">any</span>
  <span class="p">?</span> <span class="nx">P</span>
  <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>

<span class="c1">// è·å–å®ä¾‹ç±»å‹</span>
<span class="nx">type</span> <span class="nx">InstanceType</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="k">new</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="nx">any</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="nx">any</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="k">new</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="nx">any</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="nx">infer</span> <span class="nx">R</span> <span class="p">?</span> <span class="nx">R</span> <span class="p">:</span> <span class="nx">any</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">TestClass</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="kr">public</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="kr">public</span> <span class="nx">age</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="nx">type</span> <span class="nx">Params</span> <span class="o">=</span> <span class="nx">ConstructorParameters</span><span class="o">&lt;</span><span class="k">typeof</span> <span class="nx">TestClass</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// [string, number]</span>

<span class="nx">type</span> <span class="nx">Instance</span> <span class="o">=</span> <span class="nx">InstanceType</span><span class="o">&lt;</span><span class="k">typeof</span> <span class="nx">TestClass</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// TestClass</span>
</code></pre></div></div>

<blockquote>
  <p>æ­¤å¤–å¯å‚è€ƒ <a href="https://github.com/ascoders/weekly/blob/master/å‰æ²¿æŠ€æœ¯/207.ç²¾è¯»ã€ŠTypescript%20infer%20å…³é”®å­—ã€‹.md">weekly</a> å’Œ <a href="https://learntypescript.dev/09/l2-conditional-infer">coditional infer</a> ğŸ‘ˆ</p>
</blockquote>
 
<div id="gitalk-container"></div>
<script>
    var gitalk = new Gitalk({
      enable: true,
      clientID: '020f142489f80c92b097',
      clientSecret: '1fa083372b44031cf1b8249251515c4e3d54c69d',
      repo: 'tate-young.github.io',
      owner: 'Tate-Young',
      admin: ['Tate-Young'],
      id: location.pathname,      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
<!-- disqus -->
<!-- <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = 'https://tate-young.github.io/2021/01/21/ts-update.html';
        this.page.identifier = '/2021/01/21/ts-update';
        this.page.title = 'TypeScript é—®é¢˜æ”¶é›†';
    };

    (function () { // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document,
            s = d.createElement('script');

        s.src = '//tate.disqus.com/embed.js'; // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript> -->


            <!-- <p class="post-info">
			æœ¬æ–‡ç”± <a href="/">liberxue</a> åˆ›ä½œï¼Œé‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">çŸ¥è¯†å…±äº«ç½²å4.0</a> å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯<br>æœ¬ç«™æ–‡ç« é™¤æ³¨æ˜è½¬è½½/å‡ºå¤„å¤–ï¼Œå‡ä¸ºæœ¬ç«™åŸåˆ›æˆ–ç¿»è¯‘ï¼Œè½¬è½½å‰è¯·åŠ¡å¿…ç½²å<br>æœ€åç¼–è¾‘æ—¶é—´ä¸º:2021-01-21 22:47:00</p> -->
        </div>
    </article>

    <!-- <div class="related-post-lists">
	<div class="post-lists">
		<div class="post-lists-body">
					<div class="post-list-item">
				<div class="post-list-item-container">
					<div class="item-label">
						<div class="item-title"><a href="induction.html">å½’çº³çš„éšæƒ³</a></div>
						<div class="item-meta clearfix">
														<div class="item-meta-ico bg-ico-image" style="background: url('../usr/themes/pinghsu/images/bg-ico.png') no-repeat;background-size: 40px auto;"></div>
	                        							<div class="item-meta-cat"><a href="../category/thoughts/index.html">Thoughts</a></div>
						</div>
					</div>
				</div>
			</div>
				</div>
	</div>
</div> -->

    <!-- <footer class="footer bg-white">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
	 <a class="social segmentfault" target="blank" href="https://segmentfault.com/u/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Segmentfault">Segmentfault</a>
    <a class="social github" target="blank" href="https://github.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="GitHub">GitHub</a>
    <a class="social twitter" target="blank" href="http://twitter.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Twitter">Twitter</a>
     <a class="social stackoverflow" target="blank" href="https://stackoverflow.com/users/6902190/liberxue" title="è®¿é—® LiberXue_stackoverflow" data-hover="StackOverflow">StackOverflow</a>
          <a class="social oschina" target="blank" href="https://my.oschina.net/bolanzw" title="è®¿é—® LiberXue_Oschina" data-hover="Oschina">Oschina</a>
     <a class="social rss" target="blank" href="/feed.xml"title="è®¿é—® LiberXue_RSS" data-hover="RSS">RSS</a>
	</div>
		</div>
	</div>
	<div class="footer-meta">
        <div class="footer-container">
            <div class="meta-item meta-copyright">
                <div class="meta-copyright-info">
                    <a href="/" class="info-logo">
                         <img src="http://localhost:2333/style/images/logo-liberxue.png"   title="è®¿é—® LiberXue_blog" data-hover="LiberXue_blog" alt="LiberXue_blog" /> </a>
                    <div class="info-text">
                        <p>Theme is <a href="http://www.liberxue.com/2017/08/03/Jekyllthemes.html" title="è®¿é—® Jekyll liberxueä¸»é¢˜"  data-hover="Jekyll liberxue"target="_blank">Jekyll liberxue</a> by <a href="http://www.liberxue.com/about" target="_blank">liberxue</a></p>
                        <p>Powered by <a href="http://localhost:2333/tags/#Jekyll" title="Jekyll" data-hover="Jekyll" target="_blank" rel="nofollow">Jekyll</a></p>
                        <p>&copy; 2017 <a href="/feed.xml"  title="è®¿é—® liberxue blog RSS" data-hover="liberxue blog RSS">liberxue blog RSS</a></p>
                        <p>æ€»è®¡æ–‡ç« ï¼šç¯‡</p>
                      <p>æœ¬blogå·²å¼€æºç‚¹å‡»Fork</p><iframe src="http://ghbtns.com/github-btn.html?user=liberxue&repo=liberxue.github.io&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
                    </div>
                </div>
            </div>
            <div class="meta-item meta-posts">
                <h3 class="meta-title">ç½®é¡¶æ–‡ç« </h3>
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
            </div>
            <div class="meta-item meta-comments">
                <h3 class="meta-title">æœ€æ–°æ–‡ç« </h3>
  
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
</div>
		</div>
    </div>
</footer> -->
<script src="//cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>
<script async src="/search/js/520.js"></script>
<script async src="/search/js/gtag.js"></script>
<script async src="/search/live2d/autoload.js"></script>
<!-- <script src="/search/js/canvas.js"></script> -->

<script>
    $(function () {
        setTimeout(function () {
            $('code').removeClass('hljs');
            $('code').removeClass('language');
        }, 90);
    });
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    <!--liberxueconnnet-menu-->
    <div id="directory-content" class="directory-content">
        <div id="directory"></div>
    </div>
    <!--liberxueconnnet-menu-->
    <script>
      const directoryContainer = document.getElementById('directory')
      const postTitle = document.getElementsByClassName('post-title')[0]
      var postDirectoryBuild = function () {
        var postChildren = function children(childNodes, reg) {
          var result = [],
              isReg = typeof reg === 'object',
              isStr = typeof reg === 'string',
              node, i, len;
          for (i = 0, len = childNodes.length; i < len; i++) {
            node = childNodes[i];
            if ((node.nodeType === 1 || node.nodeType === 9) &&
              (!reg ||
                  isReg && reg.test(node.tagName.toLowerCase()) ||
                  isStr && node.tagName.toLowerCase() === reg)) {
                result.push(node);
              }
            }
            return result;
          },
          createPostDirectory = function (article, directory, isDirNum) {
            var contentArr = [],
                titleId = [],
                levelArr, root, level,
                currentList, list, li, link, i, len;
            levelArr = (function (article, contentArr, titleId) {
                  var titleElem = postChildren(article.childNodes, /^h\d$/),
                      levelArr = [],
                      lastNum = 1,
                      lastRevNum = 1,
                      count = 0,
                      guid = 1,
                      id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                      lastRevNum, num, elem;
                  while (titleElem.length) {
                      elem = titleElem.shift();
                      contentArr.push(elem.innerHTML);
                      num = +elem.tagName.match(/\d/)[0];
                      if (num > lastNum) {
                          levelArr.push(1);
                          lastRevNum += 1;
                      } else if (num === lastRevNum ||
                          num > lastRevNum && num <= lastNum) {
                          levelArr.push(0);
                          lastRevNum = lastRevNum;
                      } else if (num < lastRevNum) {
                          levelArr.push(num - lastRevNum);
                          lastRevNum = num;
                      }
                      count += levelArr[levelArr.length - 1];
                      lastNum = num;
                      elem.id = elem.id || (id + guid++);
                      titleId.push(elem.id);
                  }
                  if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                  return levelArr;
              })(article, contentArr, titleId);
              currentList = root = document.createElement('ul');
              dirNum = [0];
              for (i = 0, len = levelArr.length; i < len; i++) {
                  level = levelArr[i];
                  if (level === 1) {
                      list = document.createElement('ul');
                      if (!currentList.lastElementChild) {
                          currentList.appendChild(document.createElement('li'));
                      }
                      currentList.lastElementChild.appendChild(list);
                      currentList = list;
                      dirNum.push(0);
                  } else if (level < 0) {
                      level *= 2;
                      while (level++) {
                          if (level % 2) dirNum.pop();
                          currentList = currentList.parentNode;
                      }
                  }
                  dirNum[dirNum.length - 1]++;
                  li = document.createElement('li');
                  link = document.createElement('a');
                  link.name = '#' + titleId[i];
                  link.href = 'Javascript:;'
                  link.className = "post-aside-anchor"
                  link.title = 'è®¿é—®' + titleId[i];
                  link.innerHTML = !isDirNum ? contentArr[i] :
                      dirNum.join('.') + ' ' + contentArr[i];
                  li.appendChild(link);
                  currentList.appendChild(li);
              }
            directory.appendChild(root);
          };
        createPostDirectory(document.getElementById('post-content'), directoryContainer, true);
      };
      postDirectoryBuild();
    </script>
    <script>
      // gtag('config', GA_TRACKING_ID, {
      //   'page_title' : 'Blog',
      //   'page_path': window.location.pathname,
      //   'post_title': 'watttsdfasdf',
      // });

    </script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        lang = hljs.initHighlightingOnLoad();
    </script>
</body>

</html>
