
<!DOCTYPE>
<html lang="zh-cn" data-scribe-reduced-action-queue="true">
<head>
    <meta content='React Virtual DOM - Tate & Snow' name='title' />
    <meta content='React Virtual DOM - Tate & Snow' name='og:title' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <title>React Virtual DOM - Tate & Snow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>React Virtual DOM - Tate & Snow</title>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="React Virtual DOM - Tate & Snow">
<meta name="twitter:keywords" content="React Virtual DOM - Tate & Snow" property='og:description' />
<meta property="og:type" content="article">
<meta property="og:title" content="React Virtual DOM - Tate & Snow">
<meta name="og:keywords" content="React Virtual DOM - Tate & Snow|React Virtual DOMReal DOMä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è™šæ‹Ÿ DOMï¼Œå› ä¸ºæ›´æ–°çœŸå® DOM è€—æ—¶è€—åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸‹é¡µé¢æ˜¯æ€ä¹ˆæ¸²æŸ“æ„å»ºçš„ã€‚æ ¹æ® Webkit æ¸²æŸ“å¼•æ“å·¥ä½œæµå¯æ€»ç»“ä»¥ä¸‹äº”ä¸ªæ­¥éª¤ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡åšå®¢:  HT..."
  property='og:description' />
<link rel="icon" type="image/png" href="http://localhost:2333/style/favicons/favicon.ico" />
<link href="http://localhost:2333/style/favicons/favicon.ico" rel="shortcut icon" type="image/png">
<link rel="canonical" href="http://localhost:2333/">
<link rel="alternate" type="application/rss+xml" title="Liberxue" href="http://localhost:2333/feed.xml">
<meta charset="UTF-8">
<link rel="manifest" href="/manifest.json">
<link rel="shortcut icon" href="http://localhost:2333/style/favicons/favicon.ico" type="image/x-icon">
<meta name="keywords" content="React Virtual DOMReal DOMä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è™šæ‹Ÿ DOMï¼Œå› ä¸ºæ›´æ–°çœŸå® DOM è€—æ—¶è€—åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸‹é¡µé¢æ˜¯æ€ä¹ˆæ¸²æŸ“æ„å»ºçš„ã€‚æ ¹æ® Webkit æ¸²æŸ“å¼•æ“å·¥ä½œæµå¯æ€»ç»“ä»¥ä¸‹äº”ä¸ªæ­¥éª¤ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡åšå®¢:  HT..." property='og:description'
/>
<meta name="description" content="Tate & Snow's Github blog" />
<link href="https://cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
<link href="http://localhost:2333/style/theme.css" rel="stylesheet"> 
<meta content='http://localhost:2333/2019/10/24/react-virtual-dom.html' property='og:url' />
<meta content="http://localhost:2333/2019/10/24/react-virtual-dom.html|React Virtual DOMReal DOMä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è™šæ‹Ÿ DOMï¼Œå› ä¸ºæ›´æ–°çœŸå® DOM è€—æ—¶è€—åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸‹é¡µé¢æ˜¯æ€ä¹ˆæ¸²æŸ“æ„å»ºçš„ã€‚æ ¹æ® Webkit æ¸²æŸ“å¼•æ“å·¥ä½œæµå¯æ€»ç»“ä»¥ä¸‹äº”ä¸ªæ­¥éª¤ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡åšå®¢:  HT..." property='og:description'
/>
<meta content="article" property="og:type" /> 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136311746-1"></script>
<!-- <script async src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
<script>
  window.dataLayer = window.dataLayer || [];
  window.GA_TRACKING_ID = 'UA-136311746-1'
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('set', {
    'country': 'US',
    'currency': 'USD',
    'description': 'fuck',
  });
  gtag('config', GA_TRACKING_ID, {
    'custom_map': {
      'dimension1': 'post_title',
    },
    'post_title': 'test',
  });
</script>
<meta content="" property="fb:app_id" />
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>React Virtual DOM | Tate &amp; Snow</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="React Virtual DOM" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="React Virtual DOM" />
<meta property="og:description" content="React Virtual DOM" />
<link rel="canonical" href="http://localhost:2333/2019/10/24/react-virtual-dom.html" />
<meta property="og:url" content="http://localhost:2333/2019/10/24/react-virtual-dom.html" />
<meta property="og:site_name" content="Tate &amp; Snow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-24T15:55:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:2333/2019/10/24/react-virtual-dom.html"},"url":"http://localhost:2333/2019/10/24/react-virtual-dom.html","headline":"React Virtual DOM","dateModified":"2019-10-24T15:55:00+08:00","datePublished":"2019-10-24T15:55:00+08:00","description":"React Virtual DOM","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<script>
  (function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

</head>

<body class="dark-theme" gtools_scp_screen_capture_injected="true">
    <header id="header" class="header bg-white">
        <div class="navbar-container">
            <a href="Javascript:;" onclick="onClickLogo()" title="è®¿é—® Tate & Snow" class="navbar-logo menu-logo">
                <img src="http://localhost:2333/style/images/tate.png" alt="Tate & Snow"> </a>
            <!-- <a href="/?tate" title="è®¿é—® Tate & Snow" class="navbar-logo">Tate & Snow</a>   -->
            <div class="navbar-menu">
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', '/')" title="è®¿é—® é¦–é¡µ" data-hover="é¦–é¡µ">é¦–é¡µ</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å‰ç«¯', '/front')" title="è®¿é—® å‰ç«¯" data-hover="å‰ç«¯">å‰ç«¯</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å†å²', '/history')" title="è®¿é—® å†å²" data-hover="å†å²">å†å²</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å…¶ä»–', '/other')" title="è®¿é—® å…¶ä»–" data-hover="å…¶ä»–">å…¶ä»–</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', '/tags')" title="è®¿é—® æ ‡ç­¾" data-hover="æ ‡ç­¾">æ ‡ç­¾</a>
                
                  <a class=" menu-item-about " href="Javascript:;" onclick="onClickMenu('å…³äº', '/README')" title="è®¿é—® å…³äº" data-hover="å…³äº">å…³äº</a>
                
            </div>
            <!-- <div class="navbar-menu">
                
                <a href="http://localhost:2333/">é¦–é¡µ</a>
                
                <a href="http://localhost:2333/front">å‰ç«¯</a>
                
                <a href="http://localhost:2333/history">å†å²</a>
                
                <a href="http://localhost:2333/other">å…¶ä»–</a>
                
                <a href="http://localhost:2333/tags">æ ‡ç­¾</a>
                
                <a href="http://localhost:2333/README">å…³äº</a>
                
            </div> -->
            <div class="navbar-search menu-item-search" onclick="onClickSearch()">
                <span class="icon-search"></span>
                <form id="cb-search-btn" role="search">
                    <span class="search-box">
                        <input type="text" class="input" id="cb-search-content" required="true" placeholder="æ ‡é¢˜ æ ‡ç­¾..." maxlength="30" autocomplete="off">
                    </span>
                </form>
            </div>
            <div class="navbar-mobile-menu" onclick="">
                <span class="icon-menu cross">
                    <span class="middle"></span>
                </span>
                <ul>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', 'http://localhost:2333/')">é¦–é¡µ</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å‰ç«¯', 'http://localhost:2333/front')">å‰ç«¯</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å†å²', 'http://localhost:2333/history')">å†å²</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…¶ä»–', 'http://localhost:2333/other')">å…¶ä»–</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', 'http://localhost:2333/tags')">æ ‡ç­¾</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…³äº', 'http://localhost:2333/README')">å…³äº</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </header>
    <a href="#header" class="back-to-top" onclick="onClickTop('React Virtual DOM')">â¤´Topâ¤´</a>
    <div class="post-header-thumb bg-white}">
        <div class="post-header-thumb-op"></div>
        <div class="post-header-thumb">
            <div class="post-header-thumb-container">
                <h1 class="post-title" itemprop="name headline">
                    React Virtual DOM</h1>
                <div class="post-data">
                    <time datetime="2019-10-24 15:55:00" itemprop="datePublished">
                      å‘å¸ƒæ—¶é—´ï¼š2019-10-24 15:55:00
                      &nbsp;&nbsp;&nbsp;
                      
                        ä¿®æ”¹æ—¶é—´ï¼š2019-12-09 14:30:00
                      
                    </time>
                    <a onclick="onClickCategory('å‰ç«¯')" href="Javascript:;" title="è®¿é—® å‰ç«¯" data-hover="åšå®¢åˆ†ç±»: å‰ç«¯">åšå®¢åˆ†ç±»: å‰ç«¯</a>
                    <!-- <a href="#read"> é˜…è¯»æ¬¡æ•°: comments</a>  -->
                </div>
                <div class="post-tags">
                       
                    <a class="menu-item-tags" href="Javascript:;" onclick="onClickTag('React')" title="è®¿é—®React" data-hover="React">
                        React
                        <span>(10)</span>
                        
                    </a>
                       
                </div>
            </div>
        </div>
    </div>
    <article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
        <div class="post-header">
            <h1 class="post-title" itemprop="name headline">
                React Virtual DOM</h1>
            <div class="post-data">
                <time datetime="2019-10-24 15:55:00" itemprop="datePublished">2019-10-24 15:55:00</time>
            </div>
        </div>
        <div id="post-content" class="post-content" itemprop="articleBody">
            <p class="post-tags">
                   
                <a href="Javascript:;" onclick="onClickTag('React')" title="è®¿é—®React" data-hover="React">
                    React
                    <span>(10)</span>
                    </a>
                   
            </p>
            <h1 id="react-virtual-dom">React Virtual DOM</h1>

<h2 id="real-dom">Real DOM</h2>

<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è™šæ‹Ÿ DOMï¼Œå› ä¸ºæ›´æ–°çœŸå® DOM è€—æ—¶è€—åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸‹é¡µé¢æ˜¯æ€ä¹ˆæ¸²æŸ“æ„å»ºçš„ã€‚æ ¹æ® Webkit æ¸²æŸ“å¼•æ“å·¥ä½œæµå¯æ€»ç»“ä»¥ä¸‹äº”ä¸ªæ­¥éª¤ï¼Œå…·ä½“å¯ä»¥<a href="http://localhost:2333/2018/02/10/html-how-browsers-work.html">å‚è€ƒæˆ‘çš„è¿™ç¯‡åšå®¢</a>:</p>

<ul>
  <li>HTML Parser å°† HTML è§£ææˆ DOM;</li>
  <li>CSS Parser å°† CSS è§£ææˆ CSSOM;</li>
  <li>ç»“åˆ DOM å’Œ CSSOMï¼Œç”Ÿæˆä¸€æ£µæ¸²æŸ“æ ‘ Render Tree;</li>
  <li>å¸ƒå±€(layout)ï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å‡ ä½•ä¿¡æ¯;</li>
  <li>ç»˜åˆ¶(painting)ï¼Œå°†æ¸²æŸ“å™¨çš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</li>
</ul>

<p><img src="https://hackernoon.com/hn-images/1*4s99HTDCA0UUyOc39k5dag.png" alt="webkit æ¸²æŸ“å¼•æ“" /></p>

<p>è€Œå½“æˆ‘ä»¬åšå¦‚ä¸‹æ“ä½œï¼Œä¿®æ”¹ DOM çš„å€¼æ—¶ï¼Œå®ƒåˆä¼šæŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ¥ä¸€éã€‚ä¿®æ”¹ n éå°±èµ° n éï¼Œæ€§èƒ½è‡ªç„¶å°±ä¸‹æ¥äº†:</p>

<pre><code class="language-HTML">document.getElementById('elementId').innerHTML = "Tate &amp; Snow"
</code></pre>

<h2 id="virtual-dom">Virtual DOM</h2>

<p><strong>Virtual DOM</strong> å…¶å®æ˜¯é€šè¿‡ JavaScript å¯¹è±¡çš„å½¢å¼æ¥æè¿°çœŸå® DOMï¼Œå®ƒä¹‹æ‰€ä»¥æ›´å¿«æ˜¯ç”±äºä»¥ä¸‹å‡ ç‚¹:</p>

<ul>
  <li>ä½¿ç”¨é«˜æ•ˆçš„ diff ç®—æ³•æ¥å¯»æ‰¾å˜æ›´</li>
  <li>æ‰¹é‡æ›´æ–°æ“ä½œ</li>
  <li>é«˜æ•ˆåœ°æ›´æ–°å­èŠ‚ç‚¹</li>
  <li>ä½¿ç”¨ observable è€Œä¸æ˜¯è„æ£€æµ‹</li>
</ul>

<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ state æˆ– props æ›´æ–°çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘ç»„ä»¶çš„æ¸²æŸ“ï¼Œè€Œåœ¨è°ƒç”¨ Render æ–¹æ³•æ—¶ï¼Œå°±ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„è™šæ‹Ÿ DOMï¼Œå†åŠ ä¸Š React å¯åŠ¨æ—¶å€™ç”Ÿæˆçš„è™šæ‹Ÿ DOMï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ diff ç®—æ³•æ¥æ¯”è¾ƒä¸¤æ£µæ ‘çš„å·®å¼‚ï¼Œä»è€Œä»¥æœ€å°æ“ä½œæ•°æ¥æ›´æ–°çœŸå® DOMã€‚é‚£ä¹ˆå®ƒå¦‚ä½•æ¥æŸ¥æ‰¾è¿™äº›å·®å¼‚çš„å‘¢ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤:</p>

<ol>
  <li>çˆ¶èŠ‚ç‚¹æ›´æ–°åˆ™å­èŠ‚ç‚¹å…¨éƒ¨æ›´æ–° - å½“ç„¶æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨é€šè¿‡ hooks ç­‰é˜»æ­¢ä¸å¿…è¦çš„æ¸²æŸ“</li>
  <li>å¹¿åº¦ä¼˜å…ˆéå† - å½“éå†å‡ºæ¥çˆ¶èŠ‚ç‚¹è¢«ä¿®æ”¹æ—¶ï¼Œå­èŠ‚ç‚¹å°±ä¸ç”¨åšå¤šä½™çš„éå†äº†</li>
  <li><a href="https://www.reactjscn.com/docs/reconciliation.html">åè°ƒ(Reconciliation)</a> - ä¸çœŸå® DOM ä¿æŒåŒæ­¥</li>
</ol>

<p><img src="https://i0.wp.com/programmingwithmosh.com/wp-content/uploads/2018/11/lnrn_0201.png?ssl=1" alt="diff" /></p>

<p>æœ‰ä¸€äº›è§£å†³å°†ä¸€æ£µæ ‘è½¬æ¢ä¸ºå¦ä¸€æ£µæ ‘çš„æœ€å°æ“ä½œæ•°ç®—æ³•é—®é¢˜çš„é€šç”¨æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œæ ‘ä¸­å…ƒç´ ä¸ªæ•°ä¸º nï¼Œæœ€å…ˆè¿›çš„ç®—æ³• çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n^3) ã€‚è‹¥æˆ‘ä»¬åœ¨ React ä¸­ä½¿ç”¨ï¼Œå±•ç¤º 1000 ä¸ªå…ƒç´ åˆ™éœ€è¦è¿›è¡Œ 10 äº¿æ¬¡çš„æ¯”è¾ƒã€‚è¿™æ“ä½œå¤ªè¿‡æ˜‚è´µï¼Œç›¸åï¼ŒReact åŸºäºä¸¤ç‚¹å‡è®¾ï¼Œå®ç°äº†ä¸€ä¸ªå¯å‘çš„ O(n) ç®—æ³•ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºå•¥ä¹‹å‰çš„å…ˆè¿›ç®—æ³•æ—¶é—´å¤æ‚åº¦éƒ½ä¸º O(n^3)ï¼Œè€Œä¹‹ååªæœ‰ O(n) äº†å‘¢ï¼Œè¦å›ç­”è¿™ä¸ªé—®é¢˜å¯ä»¥ä¾æ®<a href="https://www.zhihu.com/question/66851503/answer/246766239">çŸ¥ä¹è¿™ç¯‡å›ç­”</a>:</p>

<pre><code class="language-TEXT">Prev                  Last
          A                     A  
         / \                   / \
        /   \                 /   \
       B     D     ====&gt;     D     B
      /                             \
     C                               C
</code></pre>

<p>ä¼ ç»Ÿ Diff ç®—æ³•çš„è¯ï¼Œå…ˆè¦ä¸¤ä¸¤æ¯”å¯¹èŠ‚ç‚¹æ˜¯å¦ç›¸åŒï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n^2)ï¼Œå³:</p>

<pre><code class="language-TEXT">PA -&gt; LA
PA -&gt; LB
PA -&gt; LC
PA -&gt; LD
PB -&gt; LA
...
</code></pre>

<p>æ‰¾åˆ°å·®å¼‚åè¿˜è¦è®¡ç®—æœ€å°è½¬æ¢æ–¹å¼ï¼Œæ¯”å¦‚æ–°å¢æˆ–åˆ é™¤ï¼Œæ­¤æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œå› æ­¤æœ€ç»ˆç»“æœä¸º O(n^3)ã€‚React çš„å¤„ç†æ–¹å¼å¯ä»¥ç®€åŒ–ä¸ºä»¥ä¸‹ï¼Œåªç”¨éå†ä¸€éï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º O(n):</p>

<pre><code class="language-TEXT"># æŒ‰å¶å­èŠ‚ç‚¹ä½ç½®æ¯”è¾ƒ
PA -&gt; LA   # ç›¸åŒ
PB -&gt; LD   # ä¸åŒï¼Œåˆ é™¤ PBï¼Œæ·»åŠ  LD
PD -&gt; LB   # ä¸åŒï¼Œæ›´æ–°
PC -&gt; Null # Last æ ‘æ²¡æœ‰è¯¥èŠ‚ç‚¹ï¼Œæ‰€ä»¥åˆ é™¤ PC å³å¯
Null -&gt; LC # Prev æ ‘æ²¡æœ‰è¯¥èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ·»åŠ  C åˆ°è¯¥ä½ç½®
</code></pre>

<p>React åœ¨æ›´æ–°èŠ‚ç‚¹ä¸Šè¿˜éµå¾ªäº†ä»¥ä¸‹ä¸¤æ¡è§„åˆ™ï¼Œä½¿å¾—æ•ˆç‡è¿›ä¸€æ­¥æé«˜:</p>

<ul>
  <li>ä¸¤ä¸ªä¸åŒç±»å‹çš„å…ƒç´ å°†äº§ç”Ÿä¸åŒçš„æ ‘ - æ¯å½“æ ¹å…ƒç´ æœ‰ä¸åŒç±»å‹ï¼ŒReact å°†å¸è½½æ—§æ ‘å¹¶é‡æ–°æ„å»ºæ–°æ ‘ã€‚å½“æ¯”è¾ƒä¸¤ä¸ªç›¸åŒç±»å‹çš„ React DOM å…ƒç´ æ—¶ï¼ŒReact åˆ™ä¼šè§‚å¯ŸäºŒè€…çš„å±æ€§ï¼Œä¿æŒç›¸åŒçš„åº•å±‚ DOM èŠ‚ç‚¹ï¼Œå¹¶ä»…æ›´æ–°å˜åŒ–çš„å±æ€§</li>
  <li>é€šè¿‡æ¸²æŸ“å™¨é™„å¸¦ key å±æ€§ - ä½¿ç”¨ key æ¥åŒ¹é…åŸæœ¬æ ‘çš„å­èŠ‚ç‚¹å’Œæ–°æ ‘çš„å­èŠ‚ç‚¹ï¼ŒKeys åº”è¯¥æ˜¯ç¨³å®šçš„ï¼Œå¯é¢„æµ‹çš„ï¼Œä¸”å”¯ä¸€çš„</li>
</ul>

<p>ç¬¬ä¸€ç‚¹æˆ‘ä»¬æ¥ä¸¾ä¸ªæ —å­:</p>

<pre><code class="language-JS">// ä¹‹å‰
&lt;div&gt;
  &lt;Counter /&gt;
&lt;/div&gt;

// ä¹‹å - å°†ä¼šé”€æ¯æ—§çš„ Counter å¹¶é‡è£…æ–°çš„ Counter
&lt;span&gt;
  &lt;Counter /&gt;
&lt;/span&gt;
</code></pre>

<pre><code class="language-JS">// ä¹‹å‰
&lt;div className="before" title="stuff" /&gt;

// ä¹‹å - ä»…æ›´æ”¹åº•å±‚ DOM å…ƒç´ çš„ className
&lt;div className="after" title="stuff" /&gt;
</code></pre>

<p>ç¬¬äºŒç‚¹æˆ‘ä»¬æ¥ä¸¾ä¸ªæ —å­ï¼Œå¯¹æ¯”ä¸‹ä¸ç”¨ key å±æ€§çš„åæœ:</p>

<pre><code class="language-JS">// ä¸ä½¿ç”¨ key
// ä¹‹å‰
&lt;ul&gt;
  &lt;li&gt;Duke&lt;/li&gt;
  &lt;li&gt;Villanova&lt;/li&gt;
&lt;/ul&gt;

// ä¹‹å - ä¼šè°ƒæ•´æ¯ä¸ªå­èŠ‚ç‚¹ï¼Œè€Œä¸ä¼šä¿ç•™æœªæ›´æ”¹çš„å­èŠ‚ç‚¹
&lt;ul&gt;
  &lt;li&gt;Connecticut&lt;/li&gt;
  &lt;li&gt;Duke&lt;/li&gt;
  &lt;li&gt;Villanova&lt;/li&gt;
&lt;/ul&gt;
</code></pre>

<pre><code class="language-JS">// ä½¿ç”¨ key
// ä¹‹å‰
&lt;ul&gt;
  &lt;li key="2015"&gt;Duke&lt;/li&gt;
  &lt;li key="2016"&gt;Villanova&lt;/li&gt;
&lt;/ul&gt;

// ä¹‹å - åªç”¨æ–°å»º key='2014' çš„å­èŠ‚ç‚¹ï¼Œå…¶ä»–å­èŠ‚ç‚¹ç§»åŠ¨å³å¯
&lt;ul&gt;
  &lt;li key="2014"&gt;Connecticut&lt;/li&gt;
  &lt;li key="2015"&gt;Duke&lt;/li&gt;
  &lt;li key="2016"&gt;Villanova&lt;/li&gt;
&lt;/ul&gt;
</code></pre>

<blockquote>
  <p>ä¸‡ä¸å¾—å·²ï¼Œä½ å¯ä»¥ä¼ é€’ä»–ä»¬åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ä½œä¸º keyã€‚è‹¥å…ƒç´ æ²¡æœ‰é‡æ’ï¼Œè¯¥æ–¹æ³•æ•ˆæœä¸é”™ï¼Œä½†é‡æ’ä¼šä½¿å¾—å…¶å˜æ…¢</p>
</blockquote>

<h2 id="react-fiber">React Fiber</h2>

<p>å…¶å®ä¸Šè¿°çš„åè°ƒæ¯”è¾ƒå¹¿ä¹‰ï¼Œå…·ä½“åº”è¯¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªè¿‡ç¨‹:</p>

<ul>
  <li><strong>åè°ƒé˜¶æ®µ</strong>(reconciliation) - ï¼šåœ¨è¿™ä¸ªé˜¶æ®µ React ä¼šæ›´æ–°æ•°æ®ç”Ÿæˆæ–°çš„ Virtual DOMï¼Œç„¶åé€šè¿‡ Diff ç®—æ³•ï¼Œå¿«é€Ÿæ‰¾å‡ºéœ€è¦æ›´æ–°çš„å…ƒç´ ï¼Œæ”¾åˆ°æ›´æ–°é˜Ÿåˆ—ä¸­å»ï¼Œå¾—åˆ°æ–°çš„æ›´æ–°é˜Ÿåˆ—</li>
  <li><strong>æ¸²æŸ“é˜¶æ®µ</strong>(commit) - è¿™ä¸ªé˜¶æ®µ React ä¼šéå†æ›´æ–°é˜Ÿåˆ—ï¼Œå°†å…¶æ‰€æœ‰çš„å˜æ›´ä¸€æ¬¡æ€§æ›´æ–°åˆ° DOM ä¸Šã€‚commit å®Œæˆåï¼Œå°†æ‰§è¡Œ <code class="highlighter-rouge">componentDidMount</code> å‡½æ•°</li>
</ul>

<p><a href="https://github.com/acdlite/react-fiber-architecture">React Fiber</a> æ˜¯ React v16 å‘å¸ƒçš„åè°ƒçš„æ–°æ ¸å¿ƒç®—æ³•ï¼Œå³ <code class="highlighter-rouge">Fiber reconciler</code>ï¼Œç”¨ä»¥ä»£æ›¿ä¹‹å‰çš„ <code class="highlighter-rouge">Stack reconciler</code>ã€‚å¯ä»¥å¸¦æ¥æ›´å¥½çš„æ€§èƒ½ä¼˜åŒ–ï¼Œå®ƒæ˜¯åŸºäº <code class="highlighter-rouge">Scheduling</code>(å†³å®šå·¥ä½œä»€ä¹ˆæ—¶å€™æ‰§è¡Œ)æ¥å®ç°çš„ï¼Œæ€»ç»“æ¥è®²:</p>

<ul>
  <li>pause work and come back to it later - æš‚åœå·¥ä½œï¼Œç¨åå›æ¥</li>
  <li>assign priority to different types of work. - ä¸ºä¸åŒç±»å‹å·¥ä½œè®¾ç½®ä¼˜å…ˆçº§</li>
  <li>reuse previously completed work. - å¤ç”¨å·²ç»å®Œæˆçš„å·¥ä½œ</li>
  <li>abort work if itâ€™s no longer needed. - ä¸­æ­¢ä¸éœ€è¦çš„å·¥ä½œ</li>
</ul>

<blockquote>
  <p>The <strong>reconciler</strong> is the part of React which contains the algorithm used to diff one tree with another to determine which parts need to be changed</p>
</blockquote>

<p>åè°ƒç®—æ³•ï¼ˆStack Reconcilerï¼‰ä¼šä¸€æ¬¡åŒæ­¥å¤„ç†æ•´ä¸ªç»„ä»¶æ ‘ï¼Œæ¥æ¯”è¾ƒæ–°æ—§ä¸¤é¢—æ ‘ï¼Œå¾—åˆ°éœ€è¦æ›´æ–°çš„éƒ¨åˆ†ã€‚è¿™ä¸ªè¿‡ç¨‹åŸºäºé€’å½’è°ƒç”¨ï¼Œä¸€æ—¦å¼€å§‹åˆ™å¾ˆéš¾å»æ‰“æ–­ï¼Œè€Œä¸”æ¶‰åŠå¤§é‡çš„è®¡ç®—å°±ä¼šå µå¡æ•´ä¸ªä¸»çº¿ç¨‹ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¼˜å…ˆçº§è°ƒæ•´å·¥ä½œï¼Œä½¿å¾—å¤§é‡çš„è®¡ç®—å¯ä»¥è¢«æ‹†è§£ï¼Œå¼‚æ­¥åŒ–ï¼Œæµè§ˆå™¨ä¸»çº¿ç¨‹å¾—ä»¥é‡Šæ”¾ï¼Œä¿è¯äº†æ¸²æŸ“çš„å¸§ç‡ï¼Œä»è€Œæé«˜å“åº”æ€§ã€‚æ‰€ä»¥æ›´ä¼˜è§£æ˜¯æ¯æ¬¡åªåšä¸€ä¸ªå•å…ƒä»»åŠ¡ï¼Œç„¶åå›åˆ°ä¸»çº¿ç¨‹çœ‹ä¸‹æœ‰æ²¡æœ‰ä»€ä¹ˆæ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡éœ€è¦å¤„ç†ï¼Œå¦‚æœæœ‰åˆ™å…ˆå¤„ç†ï¼Œæ²¡æœ‰åˆ™ç»§ç»­æ‰§è¡Œ:</p>

<p><img src="https://i.loli.net/2019/11/12/sO8M9qKJikV1Pm3.png" alt="react-fiber.png" /></p>

<p>ç”±äºé€’å½’è°ƒç”¨ç”Ÿæˆçš„è°ƒç”¨æ ˆæˆ‘ä»¬æœ¬èº«æ— æ³•æ§åˆ¶ï¼Œè€Œ Fiber å®ç°äº† <strong>virtual stack frame</strong>ï¼Œå¯ä»¥å»æŒ‰éœ€å»æ‰‹åŠ¨æ§åˆ¶ã€‚</p>

<blockquote>
  <p>The advantage of reimplementing the stack is that you can keep stack frames in memory and execute them however (and whenever) you want. This is crucial for accomplishing the goals we have for scheduling.</p>
</blockquote>

<p>React ä¸»è¦ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback"><strong>requestIdelCallback</strong></a> API æ¥å®ç°è¿™ç§ç‰¹æ€§ï¼Œå¯¹äºä¸æ”¯æŒçš„ä¼šè‡ªåŠ¨åŠ ä¸Š pollyfillã€‚é€šå¸¸å®¢æˆ·ç«¯çº¿ç¨‹æ‰§è¡Œä»»åŠ¡æ—¶ä¼šä»¥å¸§çš„å½¢å¼åˆ’åˆ†ï¼Œå¤§éƒ¨åˆ†è®¾å¤‡æ§åˆ¶åœ¨ 30-60 å¸§æ˜¯ä¸ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼›åœ¨ä¸¤ä¸ªæ‰§è¡Œå¸§ä¹‹é—´ï¼Œä¸»çº¿ç¨‹é€šå¸¸ä¼šæœ‰ä¸€å°æ®µç©ºé—²æ—¶é—´ï¼ŒrequestIdleCallback å¯ä»¥åœ¨è¿™ä¸ª<strong>ç©ºé—²æœŸï¼ˆIdle Periodï¼‰</strong>è°ƒç”¨<strong>ç©ºé—²æœŸå›è°ƒï¼ˆIdle Callbackï¼‰</strong>ä»è€Œæ‰§è¡Œä¸€äº›ä»»åŠ¡:</p>

<p><img src="https://i.loli.net/2019/11/12/hkbz9ILCm4qlnaJ.png" alt="react-requestIdelCallback.png" /></p>

<p>é€šè¿‡å°†åè°ƒè¿‡ç¨‹ï¼Œåˆ†è§£æˆå°çš„å·¥ä½œå•å…ƒçš„æ–¹å¼ï¼Œå¯ä»¥è®©é¡µé¢å¯¹äºæµè§ˆå™¨äº‹ä»¶çš„å“åº”æ›´åŠ åŠæ—¶ã€‚ä½†æ˜¯å¦å¤–ä¸€ä¸ªé—®é¢˜è¿˜æ˜¯æ²¡æœ‰è§£å†³ï¼Œå°±æ˜¯å¦‚æœå½“å‰åœ¨å¤„ç†çš„ react æ¸²æŸ“è€—æ—¶è¾ƒé•¿ï¼Œä»ç„¶ä¼šé˜»å¡åé¢çš„æ¸²æŸ“ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ fiber reconciler å¢åŠ äº†ä¼˜å…ˆçº§ç­–ç•¥:</p>

<pre><code class="language-JSON">module.exports = {
  NoWork: 0, // No work is pending.
  SynchronousPriority: 1, // For controlled text inputs. Synchronous side-effects.
  AnimationPriority: 2, // Needs to complete before the next frame.
  HighPriority: 3, // Interaction that needs to complete pretty soon to feel responsive.
  LowPriority: 4, // Data fetching, or result from updating stores.
  OffscreenPriority: 5, // Won't be visible but do the work in case it becomes visible.
}
</code></pre>

<p>å¦ä¸€æ–¹é¢ç”±äºåè°ƒé˜¶æ®µä¼šè¢«æ‰“æ–­ï¼Œå¯èƒ½ä¼šå¯¼è‡´ commit å‰çš„è¿™äº›ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¤šæ¬¡æ‰§è¡Œã€‚react å®˜æ–¹ç›®å‰å·²ç»æŠŠ <code class="highlighter-rouge">componentWillMount</code>ã€<code class="highlighter-rouge">componentWillReceiveProps</code> å’Œ <code class="highlighter-rouge">componetWillUpdate</code> æ ‡è®°ä¸º <code class="highlighter-rouge">unsafe</code>ï¼Œå¹¶ä½¿ç”¨æ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° <code class="highlighter-rouge">getDerivedStateFromProps</code> å’Œ <code class="highlighter-rouge">getSnapshotBeforeUpdate</code> è¿›è¡Œæ›¿æ¢ã€‚</p>

<p><img src="https://i.loli.net/2019/11/12/kjEibw9mTK2FLgQ.png" alt="react-fiber-phase.png" /></p>

<blockquote>
  <p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ youtube å‘å¸ƒçš„ stack ä¸ fiber å¯¹æ¯”è§†é¢‘ï¼Œ<a href="https://www.youtube.com/watch?v=Qu_6ItnlDQg">æˆ³è¿™é‡Œ</a> ğŸ‘ˆã€‚å®Œæ•´<a href="https://www.youtube.com/watch?v=ZCuYPiUIONs">è§†é¢‘æˆ³è¿™é‡Œ</a> ğŸ‘ˆ</p>
</blockquote>

<h2 id="snabbdom">snabbdom</h2>

<p>Vue åˆ™æ˜¯åŸºäº <a href="https://github.com/snabbdom/snabbdom"><strong>snabbdom</strong></a> VDOM åº“æ¥å®ç° diff ç®—æ³•ï¼Œå®ƒä¸“æ³¨äºä½¿ç”¨çš„ç®€å•ä»¥åŠåŠŸèƒ½å’Œçš„æ¨¡å‹åŒ–ï¼Œå¹¶åœ¨æ•ˆç‡å’Œæ€§èƒ½ä¸Šæœ‰ç€å¾ˆå¥½çš„è¡¨ç°ã€‚</p>

<p>åœ¨ snabbdom ä¸­æä¾›äº† <code class="highlighter-rouge">h</code> å‡½æ•°åšä¸ºåˆ›å»º VDOM çš„ä¸»è¦å‡½æ•°ï¼Œh å‡½æ•°æ¥å—çš„ä¸‰ä¸ªå‚æ•°åŒæ—¶æ­ç¤ºäº† diff ç®—æ³•ä¸­å…³æ³¨çš„ä¸‰ä¸ªæ ¸å¿ƒï¼šèŠ‚ç‚¹ç±»å‹ï¼Œå±æ€§æ•°æ®ï¼Œå­èŠ‚ç‚¹å¯¹è±¡ã€‚è€Œ <code class="highlighter-rouge">patch</code> æ–¹æ³•å³æ˜¯ç”¨æ¥åˆ›å»ºåˆå§‹ DOM èŠ‚ç‚¹ä¸æ›´æ–° VDOM çš„ diff æ ¸å¿ƒå‡½æ•°ã€‚ä¸€ä¸ªä½¿ç”¨ snabbdom åˆ›å»ºçš„ demo æ˜¯è¿™æ ·çš„:</p>

<pre><code class="language-JS">import snabbdom from 'snabbdom';
import h from 'snabbdom/h'; // helper function for creating vnodes

const patch = snabbdom.init([
  require('snabbdom/modules/class'),          // makes it easy to toggle classes
  require('snabbdom/modules/props'),          // for setting properties on DOM elements
  require('snabbdom/modules/style'),          // handles styling on elements with support for animations
  require('snabbdom/modules/eventlisteners'), // attaches event listeners
]);

var vnode = h('div', {style: {fontWeight: 'bold'}}, 'Hello world');
patch(document.getElementById('placeholder'), vnode)
</code></pre>

<blockquote>
  <p>Therefore, the mainstream diff algorithm of VirtualDOM tends to be consistent at present. In the main diff idea, snabbdom and react have basically the same reconilation method.</p>
</blockquote>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>

<ol>
  <li><a href="https://hackernoon.com/virtual-dom-in-reactjs-43a3fdb1d130">Virtual DOM in ReactJS</a> By Rupesh Mishra</li>
  <li><a href="https://programmingwithmosh.com/react/react-virtual-dom-explained/">React Virtual DOM Explained in Simple English</a> By Mosh Hamedani</li>
  <li><a href="https://github.com/creeperyang/blog/issues/44">å­¦ä¹ ä¸ç†è§£ React Fiber</a> By creeperyang</li>
  <li><a href="https://www.zhihu.com/question/49496872">çŸ¥ä¹ - å¦‚ä½•ç†è§£ React Fiber æ¶æ„ï¼Ÿ</a></li>
  <li><a href="https://juejin.im/post/5ab7b3a2f265da2378403e57">React Fiber</a> - å¦–åƒ§é£æœˆ</li>
  <li><a href="https://zhuanlan.zhihu.com/p/35876032">æ¢ç´¢ Virtual DOM çš„å‰ä¸–ä»Šç”Ÿ</a> - éƒ­ç¾½å³°</li>
</ol>
 
<div id="gitalk-container"></div>
<script>
    var gitalk = new Gitalk({
      enable: true,
      clientID: '020f142489f80c92b097',
      clientSecret: '1fa083372b44031cf1b8249251515c4e3d54c69d',
      repo: 'tate-young.github.io',
      owner: 'Tate-Young',
      admin: ['Tate-Young'],
      id: location.pathname,      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
<!-- disqus -->
<!-- <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = 'https://tate-young.github.io/2019/10/24/react-virtual-dom.html';
        this.page.identifier = '/2019/10/24/react-virtual-dom';
        this.page.title = 'React Virtual DOM';
    };

    (function () { // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document,
            s = d.createElement('script');

        s.src = '//tate.disqus.com/embed.js'; // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript> -->


            <!-- <p class="post-info">
			æœ¬æ–‡ç”± <a href="/">liberxue</a> åˆ›ä½œï¼Œé‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">çŸ¥è¯†å…±äº«ç½²å4.0</a> å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯<br>æœ¬ç«™æ–‡ç« é™¤æ³¨æ˜è½¬è½½/å‡ºå¤„å¤–ï¼Œå‡ä¸ºæœ¬ç«™åŸåˆ›æˆ–ç¿»è¯‘ï¼Œè½¬è½½å‰è¯·åŠ¡å¿…ç½²å<br>æœ€åç¼–è¾‘æ—¶é—´ä¸º:2019-10-24 15:55:00</p> -->
        </div>
    </article>

    <!-- <div class="related-post-lists">
	<div class="post-lists">
		<div class="post-lists-body">
					<div class="post-list-item">
				<div class="post-list-item-container">
					<div class="item-label">
						<div class="item-title"><a href="induction.html">å½’çº³çš„éšæƒ³</a></div>
						<div class="item-meta clearfix">
														<div class="item-meta-ico bg-ico-image" style="background: url('../usr/themes/pinghsu/images/bg-ico.png') no-repeat;background-size: 40px auto;"></div>
	                        							<div class="item-meta-cat"><a href="../category/thoughts/index.html">Thoughts</a></div>
						</div>
					</div>
				</div>
			</div>
				</div>
	</div>
</div> -->

    <!-- <footer class="footer bg-white">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
	 <a class="social segmentfault" target="blank" href="https://segmentfault.com/u/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Segmentfault">Segmentfault</a>
    <a class="social github" target="blank" href="https://github.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="GitHub">GitHub</a>
    <a class="social twitter" target="blank" href="http://twitter.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Twitter">Twitter</a>
     <a class="social stackoverflow" target="blank" href="https://stackoverflow.com/users/6902190/liberxue" title="è®¿é—® LiberXue_stackoverflow" data-hover="StackOverflow">StackOverflow</a>
          <a class="social oschina" target="blank" href="https://my.oschina.net/bolanzw" title="è®¿é—® LiberXue_Oschina" data-hover="Oschina">Oschina</a>
     <a class="social rss" target="blank" href="/feed.xml"title="è®¿é—® LiberXue_RSS" data-hover="RSS">RSS</a>
	</div>
		</div>
	</div>
	<div class="footer-meta">
        <div class="footer-container">
            <div class="meta-item meta-copyright">
                <div class="meta-copyright-info">
                    <a href="/" class="info-logo">
                         <img src="http://localhost:2333/style/images/logo-liberxue.png"   title="è®¿é—® LiberXue_blog" data-hover="LiberXue_blog" alt="LiberXue_blog" /> </a>
                    <div class="info-text">
                        <p>Theme is <a href="http://www.liberxue.com/2017/08/03/Jekyllthemes.html" title="è®¿é—® Jekyll liberxueä¸»é¢˜"  data-hover="Jekyll liberxue"target="_blank">Jekyll liberxue</a> by <a href="http://www.liberxue.com/about" target="_blank">liberxue</a></p>
                        <p>Powered by <a href="http://localhost:2333/tags/#Jekyll" title="Jekyll" data-hover="Jekyll" target="_blank" rel="nofollow">Jekyll</a></p>
                        <p>&copy; 2017 <a href="/feed.xml"  title="è®¿é—® liberxue blog RSS" data-hover="liberxue blog RSS">liberxue blog RSS</a></p>
                        <p>æ€»è®¡æ–‡ç« ï¼šç¯‡</p>
                      <p>æœ¬blogå·²å¼€æºç‚¹å‡»Fork</p><iframe src="http://ghbtns.com/github-btn.html?user=liberxue&repo=liberxue.github.io&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
                    </div>
                </div>
            </div>
            <div class="meta-item meta-posts">
                <h3 class="meta-title">ç½®é¡¶æ–‡ç« </h3>
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
            </div>
            <div class="meta-item meta-comments">
                <h3 class="meta-title">æœ€æ–°æ–‡ç« </h3>
  
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
</div>
		</div>
    </div>
</footer> -->
<script src="//cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>
<script async src="/search/js/520.js"></script>
<script async src="/search/js/gtag.js"></script>
<script async src="/search/live2d/autoload.js"></script>
<!-- <script src="/search/js/canvas.js"></script> -->

<script>
    $(function () {
        setTimeout(function () {
            $('code').removeClass('hljs');
            $('code').removeClass('language');
        }, 90);
    });
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    <!--liberxueconnnet-menu-->
    <div id="directory-content" class="directory-content">
        <div id="directory"></div>
    </div>
    <!--liberxueconnnet-menu-->
    <script>
      const directoryContainer = document.getElementById('directory')
      const postTitle = document.getElementsByClassName('post-title')[0]
      var postDirectoryBuild = function () {
        var postChildren = function children(childNodes, reg) {
          var result = [],
              isReg = typeof reg === 'object',
              isStr = typeof reg === 'string',
              node, i, len;
          for (i = 0, len = childNodes.length; i < len; i++) {
            node = childNodes[i];
            if ((node.nodeType === 1 || node.nodeType === 9) &&
              (!reg ||
                  isReg && reg.test(node.tagName.toLowerCase()) ||
                  isStr && node.tagName.toLowerCase() === reg)) {
                result.push(node);
              }
            }
            return result;
          },
          createPostDirectory = function (article, directory, isDirNum) {
            var contentArr = [],
                titleId = [],
                levelArr, root, level,
                currentList, list, li, link, i, len;
            levelArr = (function (article, contentArr, titleId) {
                  var titleElem = postChildren(article.childNodes, /^h\d$/),
                      levelArr = [],
                      lastNum = 1,
                      lastRevNum = 1,
                      count = 0,
                      guid = 1,
                      id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                      lastRevNum, num, elem;
                  while (titleElem.length) {
                      elem = titleElem.shift();
                      contentArr.push(elem.innerHTML);
                      num = +elem.tagName.match(/\d/)[0];
                      if (num > lastNum) {
                          levelArr.push(1);
                          lastRevNum += 1;
                      } else if (num === lastRevNum ||
                          num > lastRevNum && num <= lastNum) {
                          levelArr.push(0);
                          lastRevNum = lastRevNum;
                      } else if (num < lastRevNum) {
                          levelArr.push(num - lastRevNum);
                          lastRevNum = num;
                      }
                      count += levelArr[levelArr.length - 1];
                      lastNum = num;
                      elem.id = elem.id || (id + guid++);
                      titleId.push(elem.id);
                  }
                  if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                  return levelArr;
              })(article, contentArr, titleId);
              currentList = root = document.createElement('ul');
              dirNum = [0];
              for (i = 0, len = levelArr.length; i < len; i++) {
                  level = levelArr[i];
                  if (level === 1) {
                      list = document.createElement('ul');
                      if (!currentList.lastElementChild) {
                          currentList.appendChild(document.createElement('li'));
                      }
                      currentList.lastElementChild.appendChild(list);
                      currentList = list;
                      dirNum.push(0);
                  } else if (level < 0) {
                      level *= 2;
                      while (level++) {
                          if (level % 2) dirNum.pop();
                          currentList = currentList.parentNode;
                      }
                  }
                  dirNum[dirNum.length - 1]++;
                  li = document.createElement('li');
                  link = document.createElement('a');
                  link.name = '#' + titleId[i];
                  link.href = 'Javascript:;'
                  link.className = "post-aside-anchor"
                  link.title = 'è®¿é—®' + titleId[i];
                  link.innerHTML = !isDirNum ? contentArr[i] :
                      dirNum.join('.') + ' ' + contentArr[i];
                  li.appendChild(link);
                  currentList.appendChild(li);
              }
            directory.appendChild(root);
          };
        createPostDirectory(document.getElementById('post-content'), directoryContainer, true);
      };
      postDirectoryBuild();
    </script>
    <script>
      // gtag('config', GA_TRACKING_ID, {
      //   'page_title' : 'Blog',
      //   'page_path': window.location.pathname,
      //   'post_title': 'watttsdfasdf',
      // });

    </script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        lang = hljs.initHighlightingOnLoad();
    </script>
</body>

</html>
