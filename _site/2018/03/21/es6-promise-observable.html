
<!DOCTYPE>
<html lang="zh-cn" data-scribe-reduced-action-queue="true">

<head>
    <meta content='Promise & Observable - Tate & Snow' name='title' />
    <meta content='Promise & Observable - Tate & Snow' name='og:title' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <title>Promise & Observable - Tate & Snow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Promise & Observable - Tate & Snow</title>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Promise & Observable - Tate & Snow">
<meta name="twitter:keywords" content="Promise & Observable - Tate & Snow" property='og:description' />
<meta property="og:type" content="article">
<meta property="og:title" content="Promise & Observable - Tate & Snow">
<meta name="og:keywords" content="Promise & Observable - Tate & Snow|Promise &amp; ObservablePromiseä¸‰ç§çŠ¶æ€Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼ŒES6 å°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ã€‚Promise å¯¹è±¡æœ‰ä¸‰ç§çŠ¶æ€:  pending - è¿›è¡Œä¸­  fulfille..."
  property='og:description' />
<link rel="icon" type="image/png" href="http://localhost:4000/style/favicons/favicon.ico" />
<link href="http://localhost:4000/style/favicons/favicon.ico" rel="shortcut icon" type="image/png">
<link rel="canonical" href="http://localhost:4000/">
<link rel="alternate" type="application/rss+xml" title="Liberxue" href="http://localhost:4000/feed.xml">
<meta charset="UTF-8">
<link rel="manifest" href="/manifest.json">
<link rel="shortcut icon" href="http://localhost:4000/style/favicons/favicon.ico" type="image/x-icon">
<meta name="keywords" content="Promise &amp; ObservablePromiseä¸‰ç§çŠ¶æ€Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼ŒES6 å°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ã€‚Promise å¯¹è±¡æœ‰ä¸‰ç§çŠ¶æ€:  pending - è¿›è¡Œä¸­  fulfille..." property='og:description'
/>
<meta name="description" content="nothing is more practicla than a good theory" />
<link href="https://cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
<link href="http://localhost:4000/style/theme.css" rel="stylesheet"> 
<meta content='http://localhost:4000/2018/03/21/es6-promise-observable.html' property='og:url' />
<meta content="http://localhost:4000/2018/03/21/es6-promise-observable.html|Promise &amp; ObservablePromiseä¸‰ç§çŠ¶æ€Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼ŒES6 å°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ã€‚Promise å¯¹è±¡æœ‰ä¸‰ç§çŠ¶æ€:  pending - è¿›è¡Œä¸­  fulfille..." property='og:description'
/>
<meta content="article" property="og:type" />  
<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'UA-101222464-1', 'auto');
  ga('send', 'pageview');
</script>
 
</head>

<body class="" gtools_scp_screen_capture_injected="true">
    <header id="header" class="header bg-white">
        <div class="navbar-container">
            <a href="/?tate" title="è®¿é—® Tate & Snow" class="navbar-logo">
                <img src="https://i.loli.net/2018/03/13/5aa74f5b4c2c7.png" alt="Tate & Snow"> </a>
            <!-- <a href="/?tate" title="è®¿é—® Tate & Snow" class="navbar-logo">Tate & Snow</a>   -->
            <div class="navbar-menu">
                
                <a href="/?tate" title="è®¿é—® é¦–é¡µ" data-hover="é¦–é¡µ">é¦–é¡µ</a>
                
                <a href="/front?tate" title="è®¿é—® å‰ç«¯" data-hover="å‰ç«¯">å‰ç«¯</a>
                
                <a href="/tool?tate" title="è®¿é—® æ¡†æ¶" data-hover="æ¡†æ¶">æ¡†æ¶</a>
                
                <a href="/back?tate" title="è®¿é—® åç«¯" data-hover="åç«¯">åç«¯</a>
                
                <a href="/tags?tate" title="è®¿é—® æ ‡ç­¾" data-hover="æ ‡ç­¾">æ ‡ç­¾</a>
                
                <a href="/README?tate" title="è®¿é—® å…³äº" data-hover="å…³äº">å…³äº</a>
                
            </div>
            <!-- <div class="navbar-menu">
                
                <a href="http://localhost:4000/">é¦–é¡µ</a>
                
                <a href="http://localhost:4000/front">å‰ç«¯</a>
                
                <a href="http://localhost:4000/tool">æ¡†æ¶</a>
                
                <a href="http://localhost:4000/back">åç«¯</a>
                
                <a href="http://localhost:4000/tags">æ ‡ç­¾</a>
                
                <a href="http://localhost:4000/README">å…³äº</a>
                
            </div> -->
            <div class="navbar-search" onclick="">
                <span class="icon-search"></span>
                <form id="cb-search-btn" role="search">
                    <span class="search-box">
                        <input type="text" class="input" id="cb-search-content" required="true" placeholder="æ ‡é¢˜ æ ‡ç­¾..." maxlength="30" autocomplete="off">
                    </span>
                </form>
            </div>
            <div class="navbar-mobile-menu" onclick="">
                <span class="icon-menu cross">
                    <span class="middle"></span>
                </span>
                <ul>
                    
                    <li>
                        <a href="http://localhost:4000/">é¦–é¡µ</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/front">å‰ç«¯</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/tool">æ¡†æ¶</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/back">åç«¯</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/tags">æ ‡ç­¾</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/README">å…³äº</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </header>
    <a href="#header" class="back-to-top">â¤´Topâ¤´</a>
    <div class="post-header-thumb bg-white}">
        <div class="post-header-thumb-op"></div>
        <div class="post-header-thumb">
            <div class="post-header-thumb-container">
                <h1 class="post-title" itemprop="name headline">
                    Promise & Observable</h1>
                <div class="post-data">
                    <time datetime="2018-03-21 15:07:00" itemprop="datePublished">å‘å¸ƒæ—¶é—´ï¼š2018-03-21 15:07:00</time>
                    <a href="/tags#å‰ç«¯" title="è®¿é—® å‰ç«¯" data-hover="åšå®¢åˆ†ç±»: å‰ç«¯">åšå®¢åˆ†ç±»: å‰ç«¯</a>
                    <!-- <a href="#read"> é˜…è¯»æ¬¡æ•°: comments</a>  -->
                </div>
                <div class="post-tags">
                       
                    <a href="/tags#ES6" title="è®¿é—®ES6" data-hover="ES6">
                        ES6
                        <span>(10)</span>
                        
                    </a>
                       
                </div>
            </div>
        </div>
    </div>
    <article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
        <div class="post-header">
            <h1 class="post-title" itemprop="name headline">
                Promise & Observable</h1>
            <div class="post-data">
                <time datetime="2018-03-21 15:07:00" itemprop="datePublished">2018-03-21 15:07:00</time>
            </div>
        </div>
        <div id="post-content" class="post-content" itemprop="articleBody">
            <p class="post-tags">
                   
                <a href="/tags#ES6" title="è®¿é—®ES6" data-hover="ES6">
                    ES6
                    <span>(10)</span>
                    </a>
                   
            </p>
            <h1 id="promise--observable">Promise &amp; Observable</h1>

<h2 id="promise">Promise</h2>

<h3 id="ä¸‰ç§çŠ¶æ€">ä¸‰ç§çŠ¶æ€</h3>

<p><strong>Promise</strong> æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼ŒES6 å°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ã€‚Promise å¯¹è±¡æœ‰ä¸‰ç§çŠ¶æ€:</p>

<ul>
  <li><strong>pending</strong> - è¿›è¡Œä¸­</li>
  <li><strong>fulfilled</strong> - å·²æˆåŠŸ - Promise.resolve()</li>
  <li><strong>rejected</strong> - å·²å¤±è´¥ - Promise.reject()</li>
</ul>

<p>åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ï¼Œå³ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜åŒ–ã€‚Promise å¯¹è±¡çš„ç¼ºç‚¹:</p>

<ul>
  <li>ä¸€æ—¦æ‰§è¡Œä¾¿æ— æ³•å–æ¶ˆ</li>
  <li>å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒPromise å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨</li>
  <li>å½“å¤„äº pending çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µ</li>
</ul>

<p>ES6 è§„å®šï¼ŒPromise å¯¹è±¡æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Promise å®ä¾‹ï¼ŒPromise å¸¸è§çš„é—®é¢˜å¯<a href="https://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html">å‚è§è¿™é‡Œ</a> ğŸ‘ˆã€‚</p>

<pre><code class="language-JS">const promise = new Promise((resolve, reject) =&gt; {
  if (/* å¼‚æ­¥æ“ä½œæˆåŠŸ */){
    resolve(value);
  } else {
    reject(error);
  }
});
</code></pre>

<pre><code class="language-JS">promise
  .then(function(value) {
    // è¿™é‡Œå¦‚ä½•æ“ä½œ
  })
  .catch(function(err) {
    // err
  });
</code></pre>

<p>å¦‚ä¸Šï¼Œè¿™é‡Œå¦‚ä½•æ“ä½œï¼Œé€šå¸¸æœ‰ä¸‰ç§é€‰æ‹©:</p>

<ul>
  <li>return another promise</li>
  <li>return a synchronous value (or undefined)</li>
  <li>throw a synchronous error</li>
</ul>

<p>ä¸¾ä¸ªç”¨ Promise å¯¹è±¡å®ç°çš„ Ajax æ“ä½œçš„æ —å­ ğŸŒ°:</p>

<pre><code class="language-JS">const getJSON = (url) =&gt; {
  const promise = new Promise((resolve, reject) =&gt; {
    const handler = _ =&gt; {
      if (this.readyState !== 4) {
        return;
      }
      if (this.status === 200) {
        resolve(this.response);
      } else {
        reject(new Error(this.statusText));
      }
    };
    const client = new XMLHttpRequest();
    client.open("GET", url);
    client.onreadystatechange = handler;
    client.responseType = "json";
    client.setRequestHeader("Accept", "application/json");
    client.send();

  });

  return promise;
};

getJSON("/posts.json").then((json) =&gt; {
  console.log('Contents: ' + json);
}, (err) =&gt; {
  console.error('å‡ºé”™äº†', err);
});
</code></pre>

<h3 id="then--catch--finally">then / catch / finally</h3>

<p><strong>then</strong> æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹(è‹¥ä¸æ˜¯ Promise å®ä¾‹ï¼Œåˆ™ä¼šè°ƒç”¨ Promise.resolve æ–¹æ³•ï¼Œå°†è¿”å›å€¼è½¬ä¸º Promise å®ä¾‹)ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ã€‚ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å®Œæˆä»¥åï¼Œä¼šå°†è¿”å›ç»“æœä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ã€‚</p>

<pre><code class="language-JS">promise.then((data) =&gt; {
  return data.info;
}).then((info) =&gt; {
  // ...
});
</code></pre>

<p><strong>catch</strong> æ˜¯ç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥æ•è· then æ–¹æ³•é‡Œå›è°ƒå‡½æ•°è¿è¡Œä¸­æŠ›å‡ºçš„é”™è¯¯å’Œ rejected çŠ¶æ€ã€‚è·Ÿä¼ ç»Ÿçš„ try/catch ä»£ç å—ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨ catch æ–¹æ³•æŒ‡å®šé”™è¯¯å¤„ç†çš„å›è°ƒå‡½æ•°ï¼ŒPromise å¯¹è±¡æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šä¼ é€’åˆ°å¤–å±‚ä»£ç ã€‚</p>

<pre><code class="language-JS">getJSON('/post/test.json').then((post) =&gt; {
  return getJSON(post.commentURL);
}).then((comments) =&gt; {
  // some code
}).catch((error) =&gt; {
  // æ•è·å‰é¢ä¸‰ä¸ª Promise äº§ç”Ÿçš„é”™è¯¯æˆ– rejected çŠ¶æ€
});
</code></pre>

<p>æ³¨æ„ then(resolveHandler, rejectHandler) æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•° rejectHandler æ— æ³•æ•è· resolveHandler è‡ªèº«æŠ›å‡ºçš„é”™è¯¯:</p>

<pre><code class="language-JS">Promise.resolve().then(function () {
  console.log('previous then')
}).then(function () {
  throw new Error('current then');
}, function (err) {
  console.log(err) // æ— æ³•æ•è·é”™è¯¯
})

Promise.resolve().then(function () {
  throw new Error('previous then');
}).then(function () {
  throw new Error('current then');
}, function (err) {
  console.log(err) // æ•è·é”™è¯¯: 'previous then'
})
</code></pre>

<p>å› æ­¤å»ºè®®ä½¿ç”¨ catch è¿›è¡Œæ•è·ã€‚è‹¥åœ¨ then ä¹‹å‰è°ƒç”¨ catch æ–¹æ³•ï¼Œåˆ™ catch åªä¼šæ•è·ä¹‹å‰äº§ç”Ÿçš„é”™è¯¯ã€‚</p>

<pre><code class="language-JS">// bad
promise
  .then(function(data) {
    // success
  }, function(err) {
    // error
  });

// good
promise
  .then(function(data) { //cb
    // success
  })
  .catch(function(err) {
    // error
  });
</code></pre>

<p><strong>finally</strong> æ˜¯ ES2018 å¼•å…¥æ ‡å‡†çš„æ–°æ–¹æ³•ï¼Œä¸ç®¡ promise æœ€åçš„çŠ¶æ€å¦‚ä½•ï¼Œåœ¨æ‰§è¡Œå®Œ then æˆ– catch æŒ‡å®šçš„å›è°ƒå‡½æ•°ä»¥åï¼Œéƒ½ä¼šæ‰§è¡Œ finally æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚
å®ç°æ–¹å¼å¦‚ä¸‹:</p>

<pre><code class="language-JS">Promise.prototype.finally = function(callback) {
  let P = this.constructor;
  return this.then(
    value  =&gt; P.resolve(callback()).then(() =&gt; value),
    reason =&gt; P.resolve(callback()).then(() =&gt; { throw reason })
  );
};
</code></pre>

<h3 id="promiseall">Promise.all</h3>

<p><strong>Promise.all</strong> æ–¹æ³•ç”¨äºå°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p>

<pre><code class="language-JS">const p = Promise.all([p1, p2, p3]).then(...);
</code></pre>

<ul>
  <li>åªæœ‰ p1ã€p2ã€p3 çš„çŠ¶æ€éƒ½å˜æˆ fulfilledï¼Œp çš„çŠ¶æ€æ‰ä¼šå˜æˆ fulfilledï¼Œæ­¤æ—¶ p1ã€p2ã€p3 çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™ p çš„å›è°ƒå‡½æ•°</li>
  <li>åªè¦ p1ã€p2ã€p3 ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢« rejectedï¼Œp çš„çŠ¶æ€å°±å˜æˆ rejectedï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢« reject çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™ p çš„å›è°ƒå‡½æ•°</li>
</ul>

<p>å¦‚æœä½œä¸ºå‚æ•°çš„ Promise å®ä¾‹å®šä¹‰äº† catch æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä¸€æ—¦å¤„äº rejected çŠ¶æ€ï¼Œå°†ä¸ä¼šè§¦å‘ Promise.all() çš„ catch æ–¹æ³•:</p>

<pre><code class="language-JS">const p1 = new Promise((resolve, reject) =&gt; {
  resolve('tate');
})

const p2 = new Promise((resolve, reject) =&gt; {
  throw new Error('something goes wrong');
})
.then(result =&gt; result)
.catch(e =&gt; e); // è¿”å›å€¼çŠ¶æ€å˜ä¸º resovledï¼Œå°†ä¼šæ‰§è¡Œä¸‹é¢çš„ then å›è°ƒï¼Œé™¤éæ˜¾ç¤º Promise.reject(e) æ‰ä¼šè¢« ä¸‹é¢çš„ catch æ•è·

Promise.all([p1, p2])
.then(result =&gt; console.log(result))
.catch(e =&gt; console.log(e)); // ["tate", Error: something goes wrong at Promise]
</code></pre>

<h3 id="promiserace">Promise.race</h3>

<p><strong>Promise.race</strong> æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p>

<pre><code class="language-JS">const p = Promise.race([p1, p2, p3]).then(...);
</code></pre>

<ul>
  <li>åªè¦ p1ã€p2ã€p3 ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œp çš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚ç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™ p çš„å›è°ƒå‡½æ•°</li>
</ul>

<h2 id="observable">Observable</h2>

<h3 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ</h3>

<p><strong>RxJS</strong> æ˜¯ ReactiveX ç¼–ç¨‹ç†å¿µçš„ JavaScript ç‰ˆæœ¬ã€‚ReactiveX æ¥è‡ªå¾®è½¯ï¼Œå®ƒæ˜¯ä¸€ç§é’ˆå¯¹å¼‚æ­¥æ•°æ®æµçš„ç¼–ç¨‹ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå°†ä¸€åˆ‡æ•°æ®ï¼ŒåŒ…æ‹¬ HTTP è¯·æ±‚ã€DOM äº‹ä»¶æˆ–è€…æ™®é€šæ•°æ®ç­‰åŒ…è£…æˆæµçš„å½¢å¼ï¼Œç„¶åç”¨å¼ºå¤§ä¸°å¯Œçš„æ“ä½œç¬¦å¯¹æµè¿›è¡Œå¤„ç†ï¼Œä½¿ä½ èƒ½ä»¥åŒæ­¥ç¼–ç¨‹çš„æ–¹å¼å¤„ç†å¼‚æ­¥æ•°æ®ï¼Œå¹¶ç»„åˆä¸åŒçš„æ“ä½œç¬¦æ¥è½»æ¾ä¼˜é›…çš„å®ç°ä½ æ‰€éœ€è¦çš„åŠŸèƒ½ã€‚RxJS ä¸­è§£å†³å¼‚æ­¥äº‹ä»¶ç®¡ç†çš„åŸºæœ¬æ¦‚å¿µå¦‚ä¸‹:</p>

<ul>
  <li><strong>Observable</strong> å¯è§‚å¯Ÿå¯¹è±¡ - å•æ’­ï¼Œè¡¨ç¤ºä¸€ä¸ªå¯è°ƒç”¨çš„æœªæ¥å€¼æˆ–è€…äº‹ä»¶çš„é›†åˆ</li>
  <li><strong>Observer</strong> è§‚å¯Ÿè€… - ä¸€ä¸ªå›è°ƒå‡½æ•°é›†åˆ,å®ƒçŸ¥é“æ€æ ·å»ç›‘å¬è¢« Observable å‘é€çš„å€¼</li>
  <li><strong>Subscription</strong> è®¢é˜… -  è¡¨ç¤ºä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡çš„æ‰§è¡Œï¼Œä¸»è¦ç”¨äºå–æ¶ˆæ‰§è¡Œ</li>
  <li><strong>Operators</strong> æ“ä½œç¬¦ -  çº¯ç²¹çš„å‡½æ•°ï¼Œä½¿å¾—ä»¥å‡½æ•°å¼ç¼–ç¨‹çš„æ–¹å¼å¤„ç†é›†åˆï¼Œæ¯”å¦‚ mapã€filterã€contactã€flatmap</li>
  <li><strong>Subject</strong> ä¸»é¢˜ - å¤šæ’­ï¼Œæ˜¯å…è®¸å€¼è¢«å¤šæ’­åˆ°å¤šä¸ªè§‚å¯Ÿè€…çš„ä¸€ç§ç‰¹æ®Šçš„ Observableï¼ŒåŒæ—¶ä¹Ÿå¯ä½œä¸º Observer</li>
  <li><strong>Schedulers</strong> è°ƒåº¦è€… -  ç”¨æ¥æ§åˆ¶å¹¶å‘ï¼Œå½“è®¡ç®—å‘ç”Ÿçš„æ—¶å€™å…è®¸æˆ‘ä»¬åè°ƒï¼Œæ¯”å¦‚ setTimeoutã€requestAnimationFrame</li>
</ul>

<p>åœ¨ä»£ç ä¸­ä½¿ç”¨æ—¶é¿å…æ·»åŠ æ•´ä¸ª RxJS åº“:</p>

<pre><code class="language-JS">// bad
import Rx from 'rxjs/Rx';
Rx.Observable.of(1,2,3);

// good
import {Observable} from 'rxjs/Observable';
import 'rxjs/add/observable/of';
import 'rxjs/add/operator/map';
Observable.of(1,2,3).map(x =&gt; x + '!!!'); // etc
</code></pre>

<p>Observable å¯ä»¥å’Œ Promise ä¹‹é—´äº’ç›¸è½¬æ¢:</p>

<pre><code class="language-JS">const ob = Observable.fromPromise(somePromise); // Promise --&gt; Observable
const promise = someObservable.toPromise(); // Observable --&gt; Promise
</code></pre>

<p>ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼Œä¾‹å¦‚æ³¨å†Œäº‹ä»¶ç›‘å¬:</p>

<pre><code class="language-JS">// ä»¥å¾€
var button = document.querySelector('button');
button.addEventListener('click', () =&gt; console.log('Clicked!'));
</code></pre>

<pre><code class="language-JS">// Observable
var button = document.querySelector('button');
Observable.fromEvent(button, 'click').subscribe(() =&gt; console.log('Clicked!'));
</code></pre>

<p>æ —å­æ‹“å±•å¼€ï¼Œæ¯”å¦‚æ¯ç§’æœ€å¤šåªèƒ½ç‚¹å‡»ä¸€æ¬¡çš„å®ç°:</p>

<pre><code class="language-JS">// çº¯ JS
var count = 0;
var rate = 1000;
var lastClick = Date.now() - rate;
var button = document.querySelector('button');
button.addEventListener('click', () =&gt; {
  if (Date.now() - lastClick &gt;= rate) {
    console.log(`Clicked ${++count} times`);
    lastClick = Date.now();
  }
});
</code></pre>

<pre><code class="language-JS">// Observable
var button = document.querySelector('button');
Observable.fromEvent(button, 'click')
.throttleTime(1000)
.scan(count =&gt; count + 1, 0) // ç±»ä¼¼ reduceï¼Œå›è°ƒå‡½æ•°çš„è¿”å›å€¼å°†æˆä¸ºä¸‹ä¸€æ¬¡å›è°ƒå‡½æ•°è¿è¡Œæ—¶è¦ä¼ é€’çš„ä¸‹ä¸€ä¸ªå‚æ•°å€¼
.subscribe(count =&gt; console.log(`Clicked ${count} times`));
</code></pre>

<h3 id="observable-å¯è§‚å¯Ÿå¯¹è±¡">Observable å¯è§‚å¯Ÿå¯¹è±¡</h3>

<p><strong>Observable</strong> å¯è§‚å¯Ÿå¯¹è±¡ï¼Œç®€å•æ¥è¯´æ•°æ®å°±åœ¨ Observable ä¸­æµåŠ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨å„ç§ <strong>operator</strong> æ“ä½œç¬¦å¯¹æµè¿›è¡Œå¤„ç†ã€‚ä½œä¸º Observable åºåˆ—å¿…é¡»è¢«â€è®¢é˜…â€æ‰èƒ½å¤Ÿè§¦å‘ä¸Šè¿°è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ <strong>subscribe</strong>(å‘å¸ƒ/è®¢é˜…æ¨¡å¼)ã€‚è®¢é˜…æ˜¯å®Œå…¨åŒæ­¥çš„ï¼Œå°±åƒè°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚</p>

<pre><code class="language-JS">const ob = Observable.interval(1000); // æ¯éš” 1000ms å‘å°„ä¸€ä¸ªé€’å¢çš„æ•°æ®ï¼Œå³ 0 -&gt; 1 -&gt; 2 ...
ob.take(3).map(n =&gt; n * 2).filter(n =&gt; n &gt; 0).subscribe(n =&gt; console.log(n)); // take(3) ä¸ºå–å‰ä¸‰ä¸ªæ•°æ®
// 2 ç¬¬äºŒç§’
// 4 ç¬¬ä¸‰ç§’
</code></pre>

<p>ä¸‹é¢æ˜¯å¯è§‚å¯Ÿå¯¹è±¡æ‰§è¡Œå¯ä»¥å‘é€çš„ä¸‰ç§ç±»å‹çš„å€¼:</p>

<ul>
  <li><strong>next</strong> - å‘é€ä¸€ä¸ªæ•°å­— / å­—ç¬¦ä¸² / å¯¹è±¡ç­‰å€¼ã€‚</li>
  <li><strong>error</strong> - å‘é€ä¸€ä¸ªé”™è¯¯æˆ–è€…å¼‚å¸¸ã€‚</li>
  <li><strong>complete</strong> - ä¸å‘é€å€¼ã€‚</li>
</ul>

<pre><code class="language-JS">// create æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ Observable å¯¹è±¡ï¼Œæ¥æ”¶ Observer è§‚å¯Ÿè€…å‚æ•°
var foo = Observable.create((observer) =&gt; {
console.log('tate');
observer.next(0);
observer.next(1);
observer.next(2);
// observer.complete();
});

console.log('before');
foo.subscribe((x) =&gt; { // åŒæ­¥ è¿”å›ä¸€ä¸ª subscription å¯¹è±¡
console.log(x);
});
console.log('after');
// 'before' 'tate' 0 1 2 'after'
</code></pre>

<h3 id="observer-è§‚å¯Ÿè€…">Observer è§‚å¯Ÿè€…</h3>

<p><strong>Observer</strong> è§‚å¯Ÿè€…æ˜¯å¯è§‚å¯Ÿå¯¹è±¡æ‰€å‘é€æ•°æ®çš„æ¶ˆè´¹è€…ï¼Œè§‚å¯Ÿè€…ç®€å•è€Œè¨€æ˜¯ä¸€ç»„å›è°ƒå‡½æ•°ï¼Œåˆ†åˆ«å¯¹åº”ä¸€ç§è¢«å¯è§‚å¯Ÿå¯¹è±¡å‘é€çš„é€šçŸ¥çš„ç±»å‹ï¼Œå³ next, error å’Œ completeã€‚è¦æƒ³ä½¿ç”¨è§‚å¯Ÿè€…ï¼Œéœ€è¦è®¢é˜…å¯è§‚å¯Ÿå¯¹è±¡ï¼Œå³ <code>observable.subscribe(observer)</code>ã€‚</p>

<pre><code class="language-JS">observable.subscribe({
  next: x =&gt; console.log(x),
  error: err =&gt; console.error(err),
  complete: () =&gt; console.log('end of the stream')
})

// å½“è®¢é˜…ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡ï¼Œä½ å¯èƒ½ä»…ä»…æä¾›å›è°ƒæ¥ä½œä¸ºå‚æ•°å°±å¤Ÿäº†ï¼Œå¹¶ä¸éœ€è¦å®Œæ•´çš„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½œä¸ºç¤ºä¾‹:
observable.subscribe(x =&gt; console.log('Observer got a next value: ' + x));

// æˆ–è€…é€šè¿‡å°†ä¸‰ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°æä¾›ä¸‰ç§å›è°ƒ
observable.subscribe(
  x =&gt; console.log('Observer got a next value: ' + x),
  err =&gt; console.error('Observer got an error: ' + err),
  () =&gt; console.log('Observer got a complete notification')
);
</code></pre>

<h3 id="subscription-è®¢é˜…">Subscription è®¢é˜…</h3>

<p><strong>Subscription</strong> è®¢é˜…é€šå¸¸æ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡çš„æ‰§è¡Œï¼Œè®¢é˜…å¯¹è±¡æœ‰ä¸€ä¸ª <strong>unsubscribe</strong> æ–¹æ³•ç”¨æ¥é‡Šæ”¾èµ„æºæˆ–è€…å–æ¶ˆå¯è§‚å¯Ÿå¯¹è±¡çš„æ‰§è¡Œã€‚</p>

<pre><code class="language-JS">var observable = Observable.from([10, 20, 30]); // from å¯å°†å‡ ä¹æ‰€æœ‰çš„ä¸œè¥¿è½¬åŒ–ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡
var subscription = observable.subscribe(x =&gt; console.log(x));
// Later:
subscription.unsubscribe();
</code></pre>

<h3 id="subject-ä¸»é¢˜">Subject ä¸»é¢˜</h3>

<h4 id="subject">Subject</h4>

<p><strong>Subject</strong> ä¸»é¢˜æ˜¯å…è®¸å€¼è¢«å¤šæ’­åˆ°å¤šä¸ªè§‚å¯Ÿè€…çš„ä¸€ç§ç‰¹æ®Šçš„ Observableï¼Œç„¶è€Œçº¯ç²¹çš„å¯è§‚å¯Ÿå¯¹è±¡æ˜¯å•æ’­çš„(æ¯ä¸€ä¸ªè®¢é˜…çš„è§‚å¯Ÿè€…æ‹¥æœ‰å•ç‹¬çš„å¯è§‚å¯Ÿå¯¹è±¡çš„æ‰§è¡Œ)ã€‚</p>

<ul>
  <li><strong>æ¯ä¸€ä¸ª Subject éƒ½æ˜¯ä¸€ä¸ª Observable å¯è§‚å¯Ÿå¯¹è±¡</strong> - ç»™å®šä¸€ä¸ª Subject åï¼Œä½ å¯ä»¥è®¢é˜…å®ƒï¼Œæä¾›çš„è§‚å¯Ÿè€…å°†ä¼šæ­£å¸¸çš„å¼€å§‹æ¥æ”¶å€¼ã€‚ä»è§‚å¯Ÿè€…çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä¸èƒ½åˆ¤æ–­ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡çš„æ‰§è¡Œæ—¶æ¥è‡ªäºå•æ’­çš„ Observable è¿˜æ˜¯æ¥è‡ªäºä¸€ä¸ª Subject</li>
  <li><strong>æ¯ä¸€ä¸ª Subject éƒ½æ˜¯ä¸€ä¸ª Observer è§‚å¯Ÿè€…å¯¹è±¡</strong> - å®ƒæ˜¯ä¸€ä¸ªæ‹¥æœ‰ next/error/complete æ–¹æ³•çš„å¯¹è±¡ã€‚è¦æƒ³ Subject æä¾›ä¸€ä¸ªæ–°çš„å€¼ï¼Œåªéœ€è°ƒç”¨ next()ï¼Œå®ƒå°†ä¼šè¢«å¤šæ’­è‡³ç”¨æ¥ç›‘å¬Subject çš„è§‚å¯Ÿè€…</li>
</ul>

<pre><code class="language-JS">// import { BehaviorSubject, Observable, Subscription } from 'rxjs'
// Subject æœ‰ä¸¤ä¸ªè§‚å¯Ÿè€…
var subject = new Subject();

subject.subscribe({
  next: (v) =&gt; console.log('observerA: ' + v)
});
subject.subscribe({
  next: (v) =&gt; console.log('observerB: ' + v)
});

subject.next(1); // observerA: 1 observerB: 1
subject.next(2); // observerA: 2 observerB: 2
</code></pre>

<p>ç”±äº Subject ä¹Ÿæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œè¿™å°±æ„å‘³ç€ä½ å¯ä»¥æä¾›ä¸€ä¸ª Subject å½“åš observable.subscribe() çš„å‚æ•°ï¼Œå¦‚ä¸‹:</p>

<pre><code class="language-JS">var observable = Observable.from([1, 2, 3]);

observable.subscribe(subject); // You can subscribe providing a Subject
// observerA: 1 observerB: 1
// observerA: 2 observerB: 2
// observerA: 3 observerB: 3
</code></pre>

<h4 id="behaviorsubject">BehaviorSubject</h4>

<p><strong>BehaviorSubject</strong> ä¹Ÿå±äº Subjectï¼Œå®ƒå‚¨å­˜ç€è¦å‘å°„ç»™æ¶ˆè´¹è€…çš„æœ€æ–°çš„å€¼ã€‚æ— è®ºä½•æ—¶ä¸€ä¸ªæ–°çš„è§‚å¯Ÿè€…è®¢é˜…å®ƒï¼Œéƒ½ä¼šç«‹å³æ¥å—åˆ°è¿™ä¸ªæ¥è‡ª BehaviorSubject çš„å½“å‰å€¼ã€‚å¯¹äºè¡¨ç¤ºâ€éšæ—¶é—´çš„å€¼â€æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œäººçš„ç”Ÿæ—¥çš„äº‹ä»¶æµæ˜¯ä¸€ä¸ª Subject,ç„¶è€Œäººçš„å¹´é¾„çš„æµæ˜¯ä¸€ä¸ª BehaviorSubjectã€‚</p>

<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒBehaviorSubject è¢«åˆå§‹åŒ–ä¸º 0ï¼Œç¬¬ä¸€ä¸ªè§‚å¯Ÿè€…å°†ä¼šåœ¨è®¢é˜…çš„æ—¶å€™æ¥æ”¶åˆ°è¿™ä¸ªå€¼ã€‚ç¬¬äºŒä¸ªè§‚å¯Ÿè€…æ¥æ”¶æ•°å€¼ 2ï¼Œå³ä½¿å®ƒæ˜¯åœ¨æ•°å€¼ 2 è¢«å‘é€ä¹‹åè®¢é˜…çš„:</p>

<pre><code class="language-JS">var subject = new BehaviorSubject(0); // 0 is the initial value

subject.subscribe({
  next: (v) =&gt; console.log('observerA: ' + v)
});

subject.next(1);
subject.next(2);

subject.subscribe({
  next: (v) =&gt; console.log('observerB: ' + v)
});

subject.next(3);
// observerA: 0
// observerA: 1
// observerA: 2 observerB: 2
// observerA: 3 observerB: 3
</code></pre>

<h4 id="replaysubject">ReplaySubject</h4>

<p><strong>ReplaySubect</strong> ç±»ä¼¼äº BehaviorSubjectï¼Œä¸€ä¸ª ReplaySubject ä»ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡çš„æ‰§è¡Œä¸­è®°å½•å¤šä¸ªå€¼ï¼Œå¹¶ä¸”å¯ä»¥é‡æ–°å‘é€ç»™æ–°çš„è®¢é˜…è€…ã€‚</p>

<pre><code class="language-JS">var subject = new ReplaySubject(3); // buffer 3 values for new subscribers ï¼Œæ³¨:ç¼“å­˜äº†ä¸‰ä¸ªå€¼ã€‚
// é™¤äº†æŒ‡å®šç¼“å­˜å€¼ä¸ªæ•°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ªä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´ï¼Œè¡¨ç¤ºè¿™ä¸ªæœ‰æ•ˆæ—¶é—´æ®µå†…çš„æœ‰æ•ˆä¸ªæ•°
// var subject = new ReplaySubject(3, 500 /* windowTime */);

subject.subscribe({
  next: (v) =&gt; console.log('observerA: ' + v)
});

subject.next(1);
subject.next(2);
subject.next(3);
subject.next(4);

subject.subscribe({
  next: (v) =&gt; console.log('observerB: ' + v)
});

subject.next(5);
// observerA: 1 observerA: 2 observerA: 3 observerA: 4
// observerB: 2 observerB: 3 observerB: 4
// observerA: 5 observerB: 5
</code></pre>

<h4 id="asyncsubject">AsyncSubject</h4>

<p><strong>AsyncSubject</strong> ä»…åœ¨æ‰§è¡Œç»“æŸ(complete)æ—¶å‘é€ç»™è§‚å¯Ÿè€…å¯è§‚å¯Ÿå¯¹è±¡æ‰§è¡Œçš„æœ€æ–°å€¼ã€‚</p>

<pre><code class="language-JS">var subject = new AsyncSubject();

subject.subscribe({
  next: (v) =&gt; console.log('observerA: ' + v)
});

subject.next(1);
subject.next(2);

subject.subscribe({
  next: (v) =&gt; console.log('observerB: ' + v)
});

subject.next(3);
subject.complete(); // observerA: 3 observerB: 3
</code></pre>

<h3 id="operators-æ“ä½œç¬¦">Operators æ“ä½œç¬¦</h3>

<h4 id="æ“ä½œç¬¦ä¸€è§ˆè¡¨">æ“ä½œç¬¦ä¸€è§ˆè¡¨</h4>

<p><strong>Operators</strong> æ“ä½œç¬¦æ˜¯å¯è§‚å¯Ÿå¯¹è±¡ä¸Šå®šä¹‰çš„æ–¹æ³•ã€‚æ¯ä¸€ä¸ªæ“ä½œç¬¦éƒ½æ˜¯åŸºäºå½“å‰å¯è§‚å¯Ÿå¯¹è±¡åˆ›å»ºä¸€ä¸ªæ–°çš„å¯è§‚å¯Ÿå¯¹è±¡çš„å‡½æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªå•çº¯æ— å®³çš„æ“ä½œï¼Œä¹‹å‰çš„å¯è§‚å¯Ÿå¯¹è±¡ä»ç„¶ä¿æŒä¸å˜ã€‚</p>

<p>å¸¸ç”¨æ“ä½œç¬¦ä¸€è§ˆ:</p>

<ul>
  <li><strong>åˆ›å»ºæ“ä½œç¬¦</strong></li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">åˆ›å»ºæ“ä½œç¬¦</th>
      <th style="text-align: left">æè¿°</th>
      <th style="text-align: left">æ —å­</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>create</strong></td>
      <td style="text-align: left">åˆ›å»ºä¸€ä¸ªæ–°çš„ Observable</td>
      <td style="text-align: left"><code>Observable.create((observer) =&gt; ...)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>empty</strong></td>
      <td style="text-align: left">ä»…ä»…å‘å‡º complete é€šçŸ¥ï¼Œå…¶ä»–ä»€ä¹ˆä¹Ÿä¸åš</td>
      <td style="text-align: left"><code>Observable.empty()</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>from</strong></td>
      <td style="text-align: left">è½¬åŒ–ä¸ºä¸€ä¸ª Observable</td>
      <td style="text-align: left"><code>Observable.from([1, 2, 3])</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>fromEvent</strong></td>
      <td style="text-align: left">åˆ›å»ºä¸€ä¸ªæ¥è‡ªäº DOM äº‹ä»¶ï¼Œæˆ–è€… Node çš„ EventEmitter äº‹ä»¶æˆ–è€…å…¶ä»–äº‹ä»¶çš„ Observable</td>
      <td style="text-align: left"><code>Observable.fromEvent(document, 'click')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>fromPromise</strong></td>
      <td style="text-align: left">å°† Promise è½¬åŒ–ä¸ºä¸€ä¸ª Observable</td>
      <td style="text-align: left"><code>Observable.fromPromise(fetch('http://myserver.com/'))</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>of</strong></td>
      <td style="text-align: left">åˆ›å»ºä¸€ä¸ª Observableï¼Œè¿ç»­å‘å°„æŒ‡å®šå‚æ•°çš„å€¼ï¼Œæœ€åå‘å‡º complete</td>
      <td style="text-align: left"><code>Observable.of(1, 2, 3)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>interval</strong></td>
      <td style="text-align: left">è¿”å›ä¸€ä¸ªåœ¨å›ºå®šæ—¶é—´é—´éš”å‘å‡ºæ— é™è‡ªå¢çš„åºåˆ—æ•´æ•°,å¦‚æ¯ 1 ç§’å‘å‡ºè‡ªå¢çš„æ•°å­—</td>
      <td style="text-align: left"><code>Observable.interval(1000)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>timer</strong></td>
      <td style="text-align: left">åŒ intervalï¼Œä½†å¢åŠ å»¶è¿Ÿæ‰§è¡Œï¼Œå¦‚æ¯éš” 1 ç§’å‘å‡ºè‡ªå¢çš„æ•°å­—ï¼Œ5 ç§’åå¼€å§‹å‘é€</td>
      <td style="text-align: left"><code>Observable.timer(5000, 1000)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>range</strong></td>
      <td style="text-align: left">å‘å‡ºåŒºé—´èŒƒå›´å†…çš„æ•°å­—åºåˆ—</td>
      <td style="text-align: left"><code>Observable.range(1, 10)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>error</strong></td>
      <td style="text-align: left">ä»…ä»…å‘å‡º error é€šçŸ¥ï¼Œå…¶ä»–ä»€ä¹ˆä¹Ÿä¸åš</td>
      <td style="text-align: left"><code>Observable.throw(new Error('oops!'))</code></td>
    </tr>
  </tbody>
</table>

<ul>
  <li><strong>è½¬æ¢æ“ä½œç¬¦</strong></li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">è½¬æ¢æ“ä½œç¬¦</th>
      <th style="text-align: left">æè¿°</th>
      <th style="text-align: left">æ —å­</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>map</strong></td>
      <td style="text-align: left">åŒ Array.prototype.map()</td>
      <td style="text-align: left"><code>ob.map(ev =&gt; ev.clientX)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>mapTo</strong></td>
      <td style="text-align: left">å¯ä»¥æŠŠä¼ è¿›æ¥çš„å€¼æ”¹æˆä¸€ä¸ªå›ºå®šçš„å€¼</td>
      <td style="text-align: left"><code>ob.mapTo(1)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>scan</strong></td>
      <td style="text-align: left">ç±»ä¼¼ reduce + lastï¼Œå›è°ƒå‡½æ•°çš„è¿”å›å€¼å°†æˆä¸ºä¸‹ä¸€æ¬¡å›è°ƒå‡½æ•°è¿è¡Œæ—¶è¦ä¼ é€’çš„ä¸‹ä¸€ä¸ªå‚æ•°å€¼</td>
      <td style="text-align: left"><code>ob.scan((count) =&gt; count + 1, 0)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>mergeMap</strong></td>
      <td style="text-align: left">å°†æ¯ä¸ªæºå€¼æŠ•å°„æˆ Observableï¼Œå†å°†è¯¥ Observable ä¼šåˆå¹¶åˆ°è¾“å‡º Observable ä¸­</td>
      <td style="text-align: left"><code>ob.mergeMap(x =&gt; Observable.interval(1000).map(i =&gt; x+i)))</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>switchMap</strong></td>
      <td style="text-align: left">å°†æ¯ä¸ªå€¼æ˜ å°„æˆ Observableï¼Œç„¶åä½¿ç”¨ switch æ‰“å¹³æ‰€æœ‰çš„å†…éƒ¨ Observable</td>
      <td style="text-align: left"><code>ob.switchMap((ev) =&gt; Observable.interval(1000))</code></td>
    </tr>
  </tbody>
</table>

<pre><code class="language-JS">const source = Rx.Observable.of('Hello');
//map to inner observable and flatten
const example = source.mergeMap(val =&gt; Observable.of(`${val} World!`));
const subscribe = example.subscribe(val =&gt; console.log(val)); // 'Hello World!'
</code></pre>

<ul>
  <li><strong>è¿‡æ»¤æ“ä½œç¬¦</strong></li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">è¿‡æ»¤æ“ä½œç¬¦</th>
      <th style="text-align: left">æè¿°</th>
      <th style="text-align: left">æ —å­</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>debounceTime</strong></td>
      <td style="text-align: left">å»¶æ—¶æ‰§è¡Œï¼Œä½†æ˜¯åªé€šè¿‡æ¯æ¬¡å¤§é‡å‘é€ä¸­çš„æœ€æ–°å€¼</td>
      <td style="text-align: left"><code>ob.debounceTime(500)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>distinct</strong></td>
      <td style="text-align: left">å¾—åˆ°çš„ä¸åŒçš„å€¼</td>
      <td style="text-align: left"><code>Observable.of(1, 2, 2, 3).max()</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>distinctUntilChanged</strong></td>
      <td style="text-align: left">å¾—åˆ°çš„ä¸å‰ä¸€é¡¹ä¸åŒçš„å€¼</td>
      <td style="text-align: left"><code>Observable.of(1, 2, 2, 3).distinctUntilChanged()</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>distinctUntilKeyChanged</strong></td>
      <td style="text-align: left">åŸºäºæŒ‡å®šçš„ key å¾—åˆ°ä¸å‰ä¸€é¡¹ä¸åŒçš„å€¼</td>
      <td style="text-align: left"><code>ob.distinctUntilKeyChanged()</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>filter</strong></td>
      <td style="text-align: left">åŒ Array.prototype.filter()</td>
      <td style="text-align: left"><code>ob.filter(x =&gt; x % 2 === 1)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>first</strong></td>
      <td style="text-align: left">åªå‘å‡ºç¬¬ä¸€æ¬¡æ»¡è¶³æ¡ä»¶çš„å€¼ï¼Œåä¹‹åˆ™ä¸º last</td>
      <td style="text-align: left"><code>ob.first(x =&gt; x % 2 === 1)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>skip</strong></td>
      <td style="text-align: left">è·³è¿‡å‘å‡ºçš„å‰ n ä¸ªå€¼ï¼Œè·³è¿‡å n ä¸ªå€¼åˆ™ä¸º skipLast</td>
      <td style="text-align: left"><code>ob.skip(2)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>throttleTime</strong></td>
      <td style="text-align: left">è®©ä¸€ä¸ªå€¼é€šè¿‡ï¼Œç„¶ååœ¨æ¥ä¸‹æ¥çš„ duration æ¯«ç§’å†…å¿½ç•¥æºå€¼</td>
      <td style="text-align: left"><code>ob.throttleTime(1000)</code></td>
    </tr>
  </tbody>
</table>

<pre><code class="language-JS">Observable.of(1, 1, 2, 2, 2, 1, 1, 2, 3, 3, 4)
  .distinctUntilChanged()
  .subscribe(x =&gt; console.log(x)); // 1, 2, 1, 2, 3, 4

Observable.of&lt;Person&gt;(
  { age: 1, name: 'tate'},
  { age: 2, name: 'snow'},
  { age: 3, name: 'tate'},
  { age: 4, name: 'tate'})
  .distinctUntilKeyChanged('name')
  .subscribe(x =&gt; console.log(x.age)); // 1, 2, 3
</code></pre>

<ul>
  <li><strong>ç»„åˆæ“ä½œç¬¦</strong></li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">ç»„åˆæ“ä½œç¬¦</th>
      <th style="text-align: left">æè¿°</th>
      <th style="text-align: left">æ —å­</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>concat</strong></td>
      <td style="text-align: left">æ‹¼æ¥ï¼ŒæŒ‰ç…§é¡ºåºå°†å‘å‡ºçš„å¤šä¸ªå€¼æ‹¼æ¥èµ·æ¥ï¼Œå¯ä»¥æœ‰é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•</td>
      <td style="text-align: left"><code>ob.concat(ob1)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>merge</strong></td>
      <td style="text-align: left">åˆå¹¶ï¼ŒæŠŠå¤šä¸ªå€¼åˆå¹¶åˆ°ä¸€ä¸ªå€¼ä¸­ï¼Œå¯ä»¥æœ‰é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•</td>
      <td style="text-align: left"><code>ob.merge(ob1)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>forkJoin</strong></td>
      <td style="text-align: left">åŒ Promise.allï¼Œç­‰åˆ°æ‰€æœ‰çš„ Observable éƒ½å®Œæˆåï¼Œæ‰ä¸€æ¬¡æ€§è¿”å›å€¼</td>
      <td style="text-align: left"><code>ob.forkJoin(ob1, ob2)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>race</strong></td>
      <td style="text-align: left">ç±»ä¼¼ Promise.raceï¼Œè¿”å›ç»„åˆä¸­ç¬¬ä¸€ä¸ªå‘å‡ºé¡¹çš„ Observable çš„é•œåƒ</td>
      <td style="text-align: left"><code>ob.race(ob1, ob2)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>startWith</strong></td>
      <td style="text-align: left">å…ˆå‘å‡ºæŒ‡å®šé¡¹ï¼Œç„¶åå‘å‡ºç”±æº Observable å‘å‡ºçš„é¡¹</td>
      <td style="text-align: left"><code>ob.startWith(1)</code></td>
    </tr>
  </tbody>
</table>

<p>æ³¨æ„ concat å’Œ merge çš„åŒºåˆ«ï¼Œconcat æ˜¯æŒ‰é¡ºåºæ‹¼æ¥å€¼:</p>

<pre><code class="language-JS">var source = Observable.interval(500).take(3);
var source2 = Observable.interval(300).take(6);
var example = source.merge(source2);
example.subscribe({
    x =&gt;  console.log(x)
});
// 0 0 1 2 1 3 2 4 5
</code></pre>

<p>æŒ‰ç…§ <strong>Marble Diagram</strong> å›¾è§£çš„è¯:</p>

<pre><code class="language-TEXT">source : ----0----1----2|
source2: --0--1--2--3--4--5|
            merge()
example: --0-01--21-3--(24)--5|
            concat()
example: ----0----1----2--0--1--2--3--4--5|
</code></pre>

<ul>
  <li><strong>å…¶ä»–æ“ä½œç¬¦</strong></li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">å…¶ä»–æ“ä½œç¬¦</th>
      <th style="text-align: left">æè¿°</th>
      <th style="text-align: left">æ —å­</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>delay</strong></td>
      <td style="text-align: left">å»¶è¿Ÿæ‰§è¡Œï¼Œæ¯ä¸ªæ•°æ®é¡¹çš„å‘å‡ºæ—¶é—´éƒ½å¾€åæ¨ç§»å›ºå®šçš„æ¯«ç§’æ•°</td>
      <td style="text-align: left"><code>ob.delay(1000)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>toPromise</strong></td>
      <td style="text-align: left">è½¬æ¢ä¸º Promise</td>
      <td style="text-align: left"><code>ob.toPromise()</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>max</strong></td>
      <td style="text-align: left">è·å–ä¸€è¿ä¸²æ•°å­—ä¸­çš„æœ€å¤§å€¼ï¼Œåä¹‹ä¸º min</td>
      <td style="text-align: left"><code>Observable.of(1, 2, 3).max()</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>every</strong></td>
      <td style="text-align: left">è¿”å›å¸ƒå°”å€¼ï¼Œæ‰€æœ‰é¡¹æ˜¯å¦éƒ½æ»¡è¶³æŒ‡å®šæ¡ä»¶</td>
      <td style="text-align: left"><code>Observable.of(1, 2, 3).every(x =&gt; x &gt; 0)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>find</strong></td>
      <td style="text-align: left">æ‰¾åˆ°ç¬¬ä¸€ä¸ªé€šè¿‡æµ‹è¯•çš„å€¼å¹¶å°†å…¶å‘å‡ºï¼ŒfindIndex åˆ™è¿”å›ç´¢å¼•å€¼</td>
      <td style="text-align: left"><code>Observable.of(1, 2, 3).find(x =&gt; x &gt; 0)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>count</strong></td>
      <td style="text-align: left">è®¡ç®—æºçš„å‘é€æ•°é‡ï¼Œå¹¶å½“æºå®Œæˆæ—¶å‘å‡ºè¯¥æ•°å€¼</td>
      <td style="text-align: left"><code>ob.count(x =&gt; x &gt; 0)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>reduce</strong></td>
      <td style="text-align: left">å½“æº Observable å®Œæˆæ—¶ï¼Œè¿”å› ç´¯åŠ çš„ç»“æœï¼Œåªä¼šè¿”å›ä¸€ä¸ªå€¼</td>
      <td style="text-align: left"><code>ob.reduce((acc, one) =&gt; acc + one, seed)</code></td>
    </tr>
  </tbody>
</table>

<pre><code class="language-JS">// ä½¿ç”¨æ¯”è¾ƒå‡½æ•° max æ¥è·å–æœ€å¤§å€¼çš„é¡¹
interface Person {
  age: number,
  name: string
}
Observable.of&lt;Person&gt;(
  {age: 26, name: 'tate'},
  {age: 18, name: 'snow'})
  .max&lt;Person&gt;((a: Person, b: Person) =&gt; a.age &lt; b.age ? -1 : 1)
  .subscribe((x: Person) =&gt; console.log(x.name)); // 'tate'
</code></pre>

<h4 id="mergemap--forkjoin">mergeMap / forkJoin</h4>

<p>ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼Œå¦‚æœå‘é€çš„ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œéœ€è¦ä¾èµ–äºä¸Šä¸€ä¸ªè¯·æ±‚çš„æ•°æ®ï¼ŒåµŒå¥—çš„å†™æ³•å¾ˆå†—é•¿:</p>

<pre><code class="language-JS">// Angular
apiUrl = 'https://jsonplaceholder.typicode.com/users';
username: string = '';
user: any;

ngOnInit() {
  this.http.get(this.apiUrl)
    .map(res =&gt; res.json())
    .subscribe(users =&gt; {
      let username = users[0].username;
      this.http.get(`${this.apiUrl}?username=${username}`)
        .map(res =&gt; res.json())
        .subscribe(
          user =&gt; {
            this.username = username;
            this.user = user;
          });
    });
  }
</code></pre>

<p>ä½¿ç”¨ mergeMap å¯ä»¥ä¼˜åŒ–æ”¹å†™ä¸º:</p>

<pre><code class="language-JS">ngOnInit() {
  this.http.get(this.apiUrl)
    .map(res =&gt; res.json())
    .mergeMap(users =&gt; {
      this.username = users[0].username;
      return this.http.get(`${this.apiUrl}?username=${this.username}`)
        .map(res =&gt; res.json())
    })
    .subscribe(user =&gt; this.user = user);
}
</code></pre>

<p>è‹¥å¯¹äºå¹¶å‘çš„ http è¯·æ±‚ï¼Œåˆ™å¯ä»¥é‡‡ç”¨ç±»ä¼¼ Promise.all çš„å†™æ³•ï¼Œå³ä½¿ç”¨ forkJoin():</p>

<pre><code class="language-JS">ngOnInit() {
  let post1 = this.http.get(`${this.apiUrl}/1`);
  let post2 = this.http.get(`${this.apiUrl}/2`);

  Observable.forkJoin(post1, post2)
    .subscribe(results =&gt; {
      this.post1 = results[0];
      this.post2 = results[1];
    });
  }
</code></pre>

<h4 id="switchmap">switchMap</h4>

<p>switchMap æ“ä½œç¬¦ç”¨äºå¯¹æº Observable å¯¹è±¡å‘å‡ºçš„å€¼ï¼Œåšæ˜ å°„å¤„ç†ã€‚è‹¥æœ‰æ–°çš„ Observable å¯¹è±¡å‡ºç°ï¼Œä¼šåœ¨æ–°çš„ Observable å¯¹è±¡å‘å‡ºæ–°å€¼åï¼Œé€€è®¢å‰ä¸€ä¸ªæœªå¤„ç†å®Œçš„ Observable å¯¹è±¡ã€‚ä¸¾ä¸ªæœç´¢çš„æ —å­ ğŸŒ°ï¼Œæ‘˜è‡ª Angular å®˜ç½‘:</p>

<pre><code class="language-JS">export class HeroSearchComponent implements OnInit {
  heroes: Observable&lt;Hero[]&gt;;
  private searchTerms = new Subject&lt;string&gt;(); // åˆ›å»ºä¸€ä¸ªä¸»é¢˜
  constructor(
    private heroSearchService: HeroSearchService,
    private router: Router) {}
  // Push a search term into the observable stream.
  search(term: string): void {
    this.searchTerms.next(term);
  }
  ngOnInit(): void {
    this.heroes = this.searchTerms
      .debounceTime(300)        // wait 300ms after each keystroke before considering the term
      .distinctUntilChanged()   // ignore if next search term is same as previous
      .switchMap(term =&gt; term   // switch to new observable each time the term changes
        // return the http search observable
        ? this.heroSearchService.search(term)
        // or the observable of empty heroes if there was no search term
        : Observable.of&lt;Hero[]&gt;([]))
      .catch(error =&gt; {
        // TODO: add real error handling
        console.log(error);
        return Observable.of&lt;Hero[]&gt;([]);
      });
  }
  gotoDetail(hero: Hero): void {
    this.router.navigate(['/detail', hero.id]);
  }
}
</code></pre>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>

<ol>
  <li><a href="http://es6.ruanyifeng.com/#docs/promise">ECMAScript 6 å…¥é—¨</a> By é˜®ä¸€å³°</li>
  <li><a href="http://cn.rx.js.org/">RxJS - å®˜æ–¹è¯‘æ–‡</a></li>
  <li><a href="https://segmentfault.com/a/1190000012252368">Introduction to RxJS</a> By TonyZhu</li>
  <li><a href="https://segmentfault.com/a/1190000010088631">ä½¿ç”¨ RxJS å¤„ç†å¤šä¸ª Http è¯·æ±‚</a> By semlinker</li>
  <li><a href="http://www.cnblogs.com/solodancer/p/7954846.html">Observable çš„ Operators é›†åˆ</a> By soloDancer_è® </li>
  <li><a href="https://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html">We have a problem with promises</a> By Nolan Lawson</li>
</ol>
 
<div id="gitalk-container"></div>
<script>
    var gitalk = new Gitalk({
      enable: true,
      clientID: '020f142489f80c92b097',
      clientSecret: '1fa083372b44031cf1b8249251515c4e3d54c69d',
      repo: 'tate-young.github.io',
      owner: 'Tate-Young',
      admin: ['Tate-Young'],
      id: location.pathname,      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
<!-- disqus -->
<!-- <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = 'https://tate-young.github.io/2018/03/21/es6-promise-observable.html';
        this.page.identifier = '/2018/03/21/es6-promise-observable';
        this.page.title = 'Promise & Observable';
    };

    (function () { // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document,
            s = d.createElement('script');

        s.src = '//tate.disqus.com/embed.js'; // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript> -->


            <!-- <p class="post-info">
			æœ¬æ–‡ç”± <a href="/">liberxue</a> åˆ›ä½œï¼Œé‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">çŸ¥è¯†å…±äº«ç½²å4.0</a> å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯<br>æœ¬ç«™æ–‡ç« é™¤æ³¨æ˜è½¬è½½/å‡ºå¤„å¤–ï¼Œå‡ä¸ºæœ¬ç«™åŸåˆ›æˆ–ç¿»è¯‘ï¼Œè½¬è½½å‰è¯·åŠ¡å¿…ç½²å<br>æœ€åç¼–è¾‘æ—¶é—´ä¸º:2018-03-21 15:07:00</p> -->
        </div>
    </article>

    <!-- <div class="related-post-lists">
	<div class="post-lists">
		<div class="post-lists-body">
					<div class="post-list-item">
				<div class="post-list-item-container">
					<div class="item-label">
						<div class="item-title"><a href="induction.html">å½’çº³çš„éšæƒ³</a></div>
						<div class="item-meta clearfix">
														<div class="item-meta-ico bg-ico-image" style="background: url('../usr/themes/pinghsu/images/bg-ico.png') no-repeat;background-size: 40px auto;"></div>
	                        							<div class="item-meta-cat"><a href="../category/thoughts/index.html">Thoughts</a></div>
						</div>
					</div>
				</div>
			</div>
				</div>
	</div>
</div> -->

    <!-- <footer class="footer bg-white">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
	 <a class="social segmentfault" target="blank" href="https://segmentfault.com/u/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Segmentfault">Segmentfault</a>
    <a class="social github" target="blank" href="https://github.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="GitHub">GitHub</a>
    <a class="social twitter" target="blank" href="http://twitter.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Twitter">Twitter</a>
     <a class="social stackoverflow" target="blank" href="https://stackoverflow.com/users/6902190/liberxue" title="è®¿é—® LiberXue_stackoverflow" data-hover="StackOverflow">StackOverflow</a>
          <a class="social oschina" target="blank" href="https://my.oschina.net/bolanzw" title="è®¿é—® LiberXue_Oschina" data-hover="Oschina">Oschina</a>
     <a class="social rss" target="blank" href="/feed.xml"title="è®¿é—® LiberXue_RSS" data-hover="RSS">RSS</a>
	</div>
		</div>
	</div>
	<div class="footer-meta">
        <div class="footer-container">
            <div class="meta-item meta-copyright">
                <div class="meta-copyright-info">
                    <a href="/" class="info-logo">
                         <img src="http://localhost:4000/style/images/logo-liberxue.png"   title="è®¿é—® LiberXue_blog" data-hover="LiberXue_blog" alt="LiberXue_blog" /> </a>
                    <div class="info-text">
                        <p>Theme is <a href="http://www.liberxue.com/2017/08/03/Jekyllthemes.html" title="è®¿é—® Jekyll liberxueä¸»é¢˜"  data-hover="Jekyll liberxue"target="_blank">Jekyll liberxue</a> by <a href="http://www.liberxue.com/about" target="_blank">liberxue</a></p>
                        <p>Powered by <a href="http://localhost:4000/tags/#Jekyll" title="Jekyll" data-hover="Jekyll" target="_blank" rel="nofollow">Jekyll</a></p>
                        <p>&copy; 2017 <a href="/feed.xml"  title="è®¿é—® liberxue blog RSS" data-hover="liberxue blog RSS">liberxue blog RSS</a></p>
                        <p>æ€»è®¡æ–‡ç« ï¼šç¯‡</p>
                      <p>æœ¬blogå·²å¼€æºç‚¹å‡»Fork</p><iframe src="http://ghbtns.com/github-btn.html?user=liberxue&repo=liberxue.github.io&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
                    </div>
                </div>
            </div>
            <div class="meta-item meta-posts">
                <h3 class="meta-title">ç½®é¡¶æ–‡ç« </h3>
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
            </div>
            <div class="meta-item meta-comments">
                <h3 class="meta-title">æœ€æ–°æ–‡ç« </h3>
          
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
    
</div>
		</div>
    </div>
</footer> -->
<script src="//cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>
<script src="/search/js/cb-search.js"></script>
<!-- <script src="/search/js/canvas.js"></script> -->

<script>
    $(function () {
        setTimeout(function () {
            $('code').removeClass('hljs');
            $('code').removeClass('language');
        }, 90);
    });
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
    <!--liberxueconnnet-menu-->
    <div id="directory-content" class="directory-content">
        <div id="directory"></div>
    </div>
    <!--liberxueconnnet-menu-->
    <script>
        var postDirectoryBuild = function () {
            var postChildren = function children(childNodes, reg) {
                    var result = [],
                        isReg = typeof reg === 'object',
                        isStr = typeof reg === 'string',
                        node, i, len;
                    for (i = 0, len = childNodes.length; i < len; i++) {
                        node = childNodes[i];
                        if ((node.nodeType === 1 || node.nodeType === 9) &&
                            (!reg ||
                                isReg && reg.test(node.tagName.toLowerCase()) ||
                                isStr && node.tagName.toLowerCase() === reg)) {
                            result.push(node);
                        }
                    }
                    return result;
                },
                createPostDirectory = function (article, directory, isDirNum) {
                    var contentArr = [],
                        titleId = [],
                        levelArr, root, level,
                        currentList, list, li, link, i, len;
                    levelArr = (function (article, contentArr, titleId) {
                        var titleElem = postChildren(article.childNodes, /^h\d$/),
                            levelArr = [],
                            lastNum = 1,
                            lastRevNum = 1,
                            count = 0,
                            guid = 1,
                            id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                            lastRevNum, num, elem;
                        while (titleElem.length) {
                            elem = titleElem.shift();
                            contentArr.push(elem.innerHTML);
                            num = +elem.tagName.match(/\d/)[0];
                            if (num > lastNum) {
                                levelArr.push(1);
                                lastRevNum += 1;
                            } else if (num === lastRevNum ||
                                num > lastRevNum && num <= lastNum) {
                                levelArr.push(0);
                                lastRevNum = lastRevNum;
                            } else if (num < lastRevNum) {
                                levelArr.push(num - lastRevNum);
                                lastRevNum = num;
                            }
                            count += levelArr[levelArr.length - 1];
                            lastNum = num;
                            elem.id = elem.id || (id + guid++);
                            titleId.push(elem.id);
                        }
                        if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                        return levelArr;
                    })(article, contentArr, titleId);
                    currentList = root = document.createElement('ul');
                    dirNum = [0];
                    for (i = 0, len = levelArr.length; i < len; i++) {
                        level = levelArr[i];
                        if (level === 1) {
                            list = document.createElement('ul');
                            if (!currentList.lastElementChild) {
                                currentList.appendChild(document.createElement('li'));
                            }
                            currentList.lastElementChild.appendChild(list);
                            currentList = list;
                            dirNum.push(0);
                        } else if (level < 0) {
                            level *= 2;
                            while (level++) {
                                if (level % 2) dirNum.pop();
                                currentList = currentList.parentNode;
                            }
                        }
                        dirNum[dirNum.length - 1]++;
                        li = document.createElement('li');
                        link = document.createElement('a');
                        link.href = '#' + titleId[i];
                        link.title = 'è®¿é—®' + titleId[i];
                        link.title = 'è®¿é—®' + titleId[i];
                        link.innerHTML = !isDirNum ? contentArr[i] :
                            dirNum.join('.') + ' ' + contentArr[i];
                        li.appendChild(link);
                        currentList.appendChild(li);
                    }
                    directory.appendChild(root);
                };
            createPostDirectory(document.getElementById('post-content'), document.getElementById('directory'), true);
        };
        postDirectoryBuild();
    </script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        lang = hljs.initHighlightingOnLoad();
    </script>
</body>

</html>
