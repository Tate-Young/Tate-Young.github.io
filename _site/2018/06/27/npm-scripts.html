
<!DOCTYPE>
<html lang="zh-cn" data-scribe-reduced-action-queue="true">
<head>
    <meta content='NPM Scripts - Tate & Snow' name='title' />
    <meta content='NPM Scripts - Tate & Snow' name='og:title' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <title>NPM Scripts - Tate & Snow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>NPM Scripts - Tate & Snow</title>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NPM Scripts - Tate & Snow">
<meta name="twitter:keywords" content="NPM Scripts - Tate & Snow" property='og:description' />
<meta property="og:type" content="article">
<meta property="og:title" content="NPM Scripts - Tate & Snow">
<meta name="og:keywords" content="NPM Scripts - Tate & Snow|NPM ScriptsNPM Scriptspackage.jsonpackage.json æ–‡ä»¶å®šä¹‰äº†é¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–æ¨¡å—å’Œé…ç½®ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡ npm init å‘½ä»¤æ¥åˆ›å»º package.json æ–‡ä»¶ï¼Œä½¿ç”¨å‚æ•° -f å¯è·³è¿‡æ­¤é—®..."
  property='og:description' />
<link rel="icon" type="image/png" href="http://localhost:2333/style/favicons/favicon.ico" />
<link href="http://localhost:2333/style/favicons/favicon.ico" rel="shortcut icon" type="image/png">
<link rel="canonical" href="http://localhost:2333/">
<link rel="alternate" type="application/rss+xml" title="Liberxue" href="http://localhost:2333/feed.xml">
<meta charset="UTF-8">
<link rel="manifest" href="/manifest.json">
<link rel="shortcut icon" href="http://localhost:2333/style/favicons/favicon.ico" type="image/x-icon">
<meta name="keywords" content="NPM ScriptsNPM Scriptspackage.jsonpackage.json æ–‡ä»¶å®šä¹‰äº†é¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–æ¨¡å—å’Œé…ç½®ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡ npm init å‘½ä»¤æ¥åˆ›å»º package.json æ–‡ä»¶ï¼Œä½¿ç”¨å‚æ•° -f å¯è·³è¿‡æ­¤é—®..." property='og:description'
/>
<meta name="description" content="Tate & Snow's Github blog" />
<link href="https://cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
<link href="http://localhost:2333/style/theme.css" rel="stylesheet"> 
<meta content='http://localhost:2333/2018/06/27/npm-scripts.html' property='og:url' />
<meta content="http://localhost:2333/2018/06/27/npm-scripts.html|NPM ScriptsNPM Scriptspackage.jsonpackage.json æ–‡ä»¶å®šä¹‰äº†é¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–æ¨¡å—å’Œé…ç½®ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡ npm init å‘½ä»¤æ¥åˆ›å»º package.json æ–‡ä»¶ï¼Œä½¿ç”¨å‚æ•° -f å¯è·³è¿‡æ­¤é—®..." property='og:description'
/>
<meta content="article" property="og:type" /> 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136311746-1"></script>
<!-- <script async src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
<script>
  window.dataLayer = window.dataLayer || [];
  window.GA_TRACKING_ID = 'UA-136311746-1'
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('set', {
    'country': 'US',
    'currency': 'USD',
    'description': 'fuck',
  });
  gtag('config', GA_TRACKING_ID, {
    'custom_map': {
      'dimension1': 'post_title',
    },
    'post_title': 'test',
  });
</script>
<meta content="" property="fb:app_id" />
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>NPM Scripts | Tate &amp; Snow</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="NPM Scripts" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="æ–°å¢ npm link ä½¿ç”¨" />
<meta property="og:description" content="æ–°å¢ npm link ä½¿ç”¨" />
<link rel="canonical" href="http://localhost:2333/2018/06/27/npm-scripts.html" />
<meta property="og:url" content="http://localhost:2333/2018/06/27/npm-scripts.html" />
<meta property="og:site_name" content="Tate &amp; Snow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-27T17:57:00+08:00" />
<script type="application/ld+json">
{"description":"æ–°å¢ npm link ä½¿ç”¨","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:2333/2018/06/27/npm-scripts.html"},"@type":"BlogPosting","url":"http://localhost:2333/2018/06/27/npm-scripts.html","headline":"NPM Scripts","dateModified":"2018-06-27T17:57:00+08:00","datePublished":"2018-06-27T17:57:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<script>
  (function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

</head>

<body class="dark-theme" gtools_scp_screen_capture_injected="true">
    <header id="header" class="header bg-white">
        <div class="navbar-container">
            <a href="Javascript:;" onclick="onClickLogo()" title="è®¿é—® Tate & Snow" class="navbar-logo menu-logo">
                <img src="http://localhost:2333/style/images/tate.png" alt="Tate & Snow"> </a>
            <!-- <a href="/?tate" title="è®¿é—® Tate & Snow" class="navbar-logo">Tate & Snow</a>   -->
            <div class="navbar-menu">
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', '/')" title="è®¿é—® é¦–é¡µ" data-hover="é¦–é¡µ">é¦–é¡µ</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å‰ç«¯', '/front')" title="è®¿é—® å‰ç«¯" data-hover="å‰ç«¯">å‰ç«¯</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å†å²', '/history')" title="è®¿é—® å†å²" data-hover="å†å²">å†å²</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å…¶ä»–', '/other')" title="è®¿é—® å…¶ä»–" data-hover="å…¶ä»–">å…¶ä»–</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', '/tags')" title="è®¿é—® æ ‡ç­¾" data-hover="æ ‡ç­¾">æ ‡ç­¾</a>
                
                  <a class=" menu-item-about " href="Javascript:;" onclick="onClickMenu('å…³äº', '/README')" title="è®¿é—® å…³äº" data-hover="å…³äº">å…³äº</a>
                
            </div>
            <!-- <div class="navbar-menu">
                
                <a href="http://localhost:2333/">é¦–é¡µ</a>
                
                <a href="http://localhost:2333/front">å‰ç«¯</a>
                
                <a href="http://localhost:2333/history">å†å²</a>
                
                <a href="http://localhost:2333/other">å…¶ä»–</a>
                
                <a href="http://localhost:2333/tags">æ ‡ç­¾</a>
                
                <a href="http://localhost:2333/README">å…³äº</a>
                
            </div> -->
            <div class="navbar-search menu-item-search" onclick="onClickSearch()">
                <span class="icon-search"></span>
                <form id="cb-search-btn" role="search">
                    <span class="search-box">
                        <input type="text" class="input" id="cb-search-content" required="true" placeholder="æ ‡é¢˜ æ ‡ç­¾..." maxlength="30" autocomplete="off">
                    </span>
                </form>
            </div>
            <div class="navbar-mobile-menu" onclick="">
                <span class="icon-menu cross">
                    <span class="middle"></span>
                </span>
                <ul>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', 'http://localhost:2333/')">é¦–é¡µ</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å‰ç«¯', 'http://localhost:2333/front')">å‰ç«¯</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å†å²', 'http://localhost:2333/history')">å†å²</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…¶ä»–', 'http://localhost:2333/other')">å…¶ä»–</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', 'http://localhost:2333/tags')">æ ‡ç­¾</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…³äº', 'http://localhost:2333/README')">å…³äº</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </header>
    <a href="#header" class="back-to-top" onclick="onClickTop('NPM Scripts')">â¤´Topâ¤´</a>
    <div class="post-header-thumb bg-white}">
        <div class="post-header-thumb-op"></div>
        <div class="post-header-thumb">
            <div class="post-header-thumb-container">
                <h1 class="post-title" itemprop="name headline">
                    NPM Scripts</h1>
                <div class="post-data">
                    <time datetime="2018-06-27 17:57:00" itemprop="datePublished">
                      å‘å¸ƒæ—¶é—´ï¼š2018-06-27 17:57:00
                      &nbsp;&nbsp;&nbsp;
                      
                        ä¿®æ”¹æ—¶é—´ï¼š2021-09-13 11:27:00
                      
                    </time>
                    <a onclick="onClickCategory('å‰ç«¯')" href="Javascript:;" title="è®¿é—® å‰ç«¯" data-hover="åšå®¢åˆ†ç±»: å‰ç«¯">åšå®¢åˆ†ç±»: å‰ç«¯</a>
                    <!-- <a href="#read"> é˜…è¯»æ¬¡æ•°: comments</a>  -->
                </div>
                
                  <div role='update-description' class="post-data">
                    ä¿®æ”¹å†…å®¹ï¼šæ–°å¢ npm link ä½¿ç”¨
                  </div>
                
                <div class="post-tags">
                       
                    <a class="menu-item-tags" href="Javascript:;" onclick="onClickTag('NPM')" title="è®¿é—®NPM" data-hover="NPM">
                        NPM
                        <span>(3)</span>
                        
                    </a>
                       
                </div>
            </div>
        </div>
    </div>
    <article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
        <div class="post-header">
            <h1 class="post-title" itemprop="name headline">
                NPM Scripts</h1>
            <div class="post-data">
                <time datetime="2018-06-27 17:57:00" itemprop="datePublished">2018-06-27 17:57:00</time>
            </div>
        </div>
        <div id="post-content" class="post-content" itemprop="articleBody">
            <p class="post-tags">
                   
                <a href="Javascript:;" onclick="onClickTag('NPM')" title="è®¿é—®NPM" data-hover="NPM">
                    NPM
                    <span>(3)</span>
                    </a>
                   
            </p>
            <h1 id="npm-scripts">NPM Scripts</h1>

<h2 id="npm-scripts-1">NPM Scripts</h2>

<h3 id="packagejson">package.json</h3>

<p><strong>package.json</strong> æ–‡ä»¶å®šä¹‰äº†é¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–æ¨¡å—å’Œé…ç½®ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡ <code class="highlighter-rouge">npm init</code> å‘½ä»¤æ¥åˆ›å»º package.json æ–‡ä»¶ï¼Œä½¿ç”¨å‚æ•° <strong>-f</strong> å¯è·³è¿‡æ­¤é—®ç­”ç¯èŠ‚:</p>

<pre><code class="language-SHELL">npm init

# è·³è¿‡é—®ç­”ç¯èŠ‚ï¼Œå¿«é€Ÿåˆ›å»º
npm init -f
</code></pre>

<p>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨åˆå§‹åŒ–å‰é€šè¿‡ <code class="highlighter-rouge">npm config</code> å‘½ä»¤å»ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œä¹‹åé€šè¿‡åˆå§‹åŒ–æ—¶éƒ½ä¼šå¥—ç”¨æ­¤é…ç½®é¡¹:</p>

<pre><code class="language-SHELL">npm config set init.author.name "tate"
npm config set init.author.email "smd.tate@gmail.com"
npm config set init.license "MIT"
</code></pre>

<pre><code class="language-SHELL"># æŸ¥çœ‹æ‰€æœ‰ npm é…ç½®
npm config list
</code></pre>

<p>åˆ›å»ºçš„ package.json æ–‡ä»¶å¤§è‡´å¦‚ä¸‹:</p>

<pre><code class="language-JSON">{
  "name": "npm_scripts",
  "version": "1.0.0",
  "description": "tate",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "author": "tate &lt;smd.tate@gmail.com&gt;",
  "license": "MIT"
}
</code></pre>

<h3 id="è„šæœ¬å‘½ä»¤-scripts">è„šæœ¬å‘½ä»¤ scripts</h3>

<p>package.json æ–‡ä»¶é‡Œçš„ scripts å±æ€§ä¸‹å¯ä»¥è‡ªå®šä¹‰æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ <code class="highlighter-rouge">npm run</code> è¿›è¡ŒæŸ¥çœ‹:</p>

<pre><code class="language-JSON">"scripts": {
  "call:tate": "echo tate",
  "call:snow": "echo snow",
}
</code></pre>

<p>å¯ä»¥é€šè¿‡ç¬¦å· <strong>&amp;&amp;</strong> å’Œ <strong>&amp;</strong> å®ç°ä¸²è¡Œå’Œå¹¶è¡Œè„šæœ¬:</p>

<pre><code class="language-JSON">// ä¸²è¡Œè„šæœ¬ &amp;&amp;
"test": "npm run call:tate &amp;&amp; npm run call:snow &amp;&amp; ..."

// å¹¶è¡Œè„šæœ¬ &amp;
"test": "npm run call:tate &amp; npm run call:snow &amp; ..."
</code></pre>

<p>è¿è¡Œçš„è„šæœ¬æ¯”è¾ƒå¤šçš„è¯å¯ä»¥é‡‡ç”¨ <strong><a href="https://www.npmjs.com/package/npm-run-all">npm-run-all</a></strong> å®ç°æ›´è½»é‡å’Œç®€æ´çš„å¤šå‘½ä»¤è¿è¡Œ:</p>

<pre><code class="language-JSON">// ä¸²è¡Œè„šæœ¬
"test": "npm-run-all call:tate call:snow ..."
// ä¼˜åŒ–
"test": "npm-run-all call:*"

// å¹¶è¡Œè„šæœ¬ --parallel
"test": "npm-run-all call:* --parallel"
</code></pre>

<h3 id="ä¼ é€’å‚æ•°-">ä¼ é€’å‚æ•° â€“</h3>

<p>â€œ<strong>â€“</strong>â€ åˆ†éš”ç¬¦ç”¨æ¥ç»™å®é™…è¿è¡Œçš„æŒ‡ä»¤ä¼ é€’é¢å¤–çš„å‚æ•°ï¼Œä¸¾ä¸ªæ —å­ ğŸŒ°:</p>

<pre><code class="language-JSON">// å‡è®¾è¦ä¼ å…¥ä¸€ä¸ª watch å‚æ•°
"call:tate": "echo tate",
"call:tate:watch": "echo tate --watch",

// ä¼˜åŒ–ã€‚é€šè¿‡ -- åˆ†éš”ç¬¦ä¼ å‚æ•°
// å®é™…æ‰§è¡Œçš„å³æ˜¯ echo tate --watch
"call:tate:watch": "npm run call:tate -- --watch",
</code></pre>

<h3 id="é’©å­-hooks">é’©å­ hooks</h3>

<p>å†…ç½®çš„é’©å­å¯åˆ†ä¸º <strong>pre</strong> å’Œ <strong>post</strong> é’©å­è„šæœ¬ï¼Œå¦‚ä¸‹:</p>

<pre><code class="language-JSON">"test": "echo tate",
"pretest": "echo pre-tate",
"posttest": "echo post-tate"
</code></pre>

<p>å½“æ‰§è¡Œå‘½ä»¤ <code class="highlighter-rouge">npm test</code> æ—¶ï¼Œå®é™…æ‰§è¡Œäº† â€œpretest ==&gt; test ==&gt; posttestâ€ã€‚è‡ªå®šä¹‰å‘½ä»¤ä¹Ÿé€‚ç”¨ã€‚é…åˆ git hooks å¯ä»¥åœ¨æäº¤ä»£ç å‰åè¿›è¡Œä¸€äº›æ ¡éªŒè¾“å‡ºï¼Œè¿™é‡Œæ¨èä½¿ç”¨ <a href="https://www.npmjs.com/package/husky">husky</a>ã€‚</p>

<pre><code class="language-JSON">"precommit": "npm test",
"prepush": "npm test"
</code></pre>

<p>åœ¨æ‰§è¡Œ <code class="highlighter-rouge">git commit</code> å‘½ä»¤æ—¶ï¼Œprecommit é’©å­ä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€‚åˆ©ç”¨é’©å­æˆ‘ä»¬å¯ä»¥å®Œæˆå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚è§„èŒƒæ ¡éªŒã€æ£€æµ‹å†²çªé˜»æ­¢æäº¤ç­‰ã€‚å…·ä½“æ —å­å¯ä»¥å‚è€ƒä¸‹é¢ <a href="#git-hooks-å®è·µç¤ºä¾‹">git hooks å®è·µç¤ºä¾‹</a> ğŸ‘‡</p>

<h3 id="å˜é‡-npm_package">å˜é‡ $npm_package</h3>

<p>é€šè¿‡å‘½ä»¤<code class="highlighter-rouge">npm run env</code>å³å¯æŸ¥çœ‹æ‰€æœ‰å˜é‡åˆ—è¡¨:</p>

<pre><code class="language-SHELL">npm run env | grep npm_package | sort
</code></pre>

<p>è¦æƒ³åœ¨ scripts å†…ä½¿ç”¨å˜é‡ï¼Œä¸åŒç¯å¢ƒä¸‹æœ‰ä¸¤ç§è®¿é—®æ–¹å¼ï¼Œæ¯”å¦‚è®¿é—®é¡¹ç›®åç§° name:</p>

<pre><code class="language-JSON">// The following only works on Mac OS X/Linux (bash)
"bash-script": "echo Hello $npm_package_name",
// The following only works on a Windows machine
"win-script": "echo Hello %npm_package_name%"
</code></pre>

<p>è·¨å¹³å°ä½¿ç”¨çš„è¯å¯ä»¥ä½¿ç”¨ <a href="https://www.npmjs.com/package/cross-var">cross-var</a> æˆ–æ›´è½»é‡çš„ cross-var-no-babel:</p>

<pre><code class="language-JSON">// å•å‘½ä»¤å†™æ³•
"script": "cross-var echo Hello $npm_package_name"
// å¤šå‘½ä»¤å†™æ³•
"build:css": "cross-var \"node-sass src/index.scss | postcss -c .postcssrc.json | cssmin &gt; public/$npm_package_version/index.min.css\"",
</code></pre>

<h3 id="è·¨å¹³å°å…¼å®¹">è·¨å¹³å°å…¼å®¹</h3>

<p>é™¤äº†ä¸Šè¿°çš„å˜é‡ï¼Œè¿˜æœ‰æ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œä¹Ÿéœ€è¦è€ƒè™‘è·¨å¹³å°å…¼å®¹ï¼Œæ¯”å¦‚:</p>

<ul>
  <li>rimraf æˆ– del-cli: ç”¨æ¥åˆ é™¤æ–‡ä»¶å’Œç›®å½•ï¼Œå®ç°ç±»ä¼¼äº <code class="highlighter-rouge">rm -rf</code> çš„åŠŸèƒ½ï¼›</li>
  <li>cpr: ç”¨äºæ‹·è´ã€å¤åˆ¶æ–‡ä»¶å’Œç›®å½•ï¼Œå®ç°ç±»ä¼¼äº <code class="highlighter-rouge">cp -r</code> çš„åŠŸèƒ½ï¼›</li>
  <li>make-dir-cli: ç”¨äºåˆ›å»ºç›®å½•ï¼Œå®ç°ç±»ä¼¼äº <code class="highlighter-rouge">mkdir -p</code> çš„åŠŸèƒ½</li>
</ul>

<pre><code class="language-JSON">"cover:cleanup": "rm -rf coverage &amp;&amp; rm -rf .nyc_output",
// è·¨å¹³å°è½¬æ¢
"cover:cleanup": "rimraf coverage &amp;&amp; rimraf .nyc_output"
</code></pre>

<p>è®¾ç½®ç¯å¢ƒå˜é‡æ—¶å¯ä»¥é‡‡ç”¨ <a href="https://www.npmjs.com/package/cross-env"><strong>cross-env</strong></a>:</p>

<pre><code class="language-JSON">"test": "NODE_ENV=test mocha tests/",
// è·¨å¹³å°è½¬æ¢
"test": "cross-env NODE_ENV=test mocha tests/",
</code></pre>

<p>ä½†æ˜¯ cross-env å¹¶ä¸èƒ½è§£å†³å¤§å‹é¡¹ç›®ä¸­è‡ªå®šä¹‰ç¯å¢ƒå˜é‡çš„æŒä¹…åŒ–é—®é¢˜ï¼Œè¿™é‡Œå†æ¨èä¸€ä¸ª <a href="https://github.com/toddbluhm/env-cmd"><strong>env-cmd</strong></a>ï¼Œå…¶ç¼ºç‚¹æ˜¯ä¸æ”¯æŒåœ¨å‘½ä»¤è¡Œä¸­è‡ªå®šä¹‰ç¯å¢ƒå˜é‡:</p>

<pre><code class="language-TEXT"># æ–‡ä»¶ ./test/.env
ENV1=THANKS
ENV2=FOR ALL
ENV3=THE FISH
</code></pre>

<pre><code class="language-JSON">{
  "scripts": {
    "test": "env-cmd ./test/.env mocha -R spec"
  }
}
</code></pre>

<pre><code class="language-SHELL"># å‘½ä»¤è¡Œ
./node_modules/.bin/env-cmd ./test/.env node index.js
</code></pre>

<p>å¯¹äºæ›´å¤æ‚çš„ç¯å¢ƒï¼Œæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ <code class="highlighter-rouge">.env-cmdrc</code> ä¸­å®šä¹‰ç¯å¢ƒå˜é‡:</p>

<pre><code class="language-JSON">{
  "dev": {
    "ENV1": "Thanks",
    "ENV2": "For All"
  },
  "test": {
    "ENV1": "No Thanks",
    "ENV3": "!"
  },
  "prod": {
    "ENV1": "The Fish"
  }
}
</code></pre>

<pre><code class="language-JSON">{
  "scripts": {
    "test": "env-cmd dev mocha -R spec"
  }
}
</code></pre>

<pre><code class="language-SHELL"># å‘½ä»¤è¡ŒåŒæ—¶ä¼ è¾“å¤šä¸ªé…ç½®
./node_modules/.bin/env-cmd test,production node index.js
</code></pre>

<h3 id="ç‰ˆæœ¬å·ä¸-semver-è§„èŒƒ">ç‰ˆæœ¬å·ä¸ SemVer è§„èŒƒ</h3>

<p>è¿™é‡Œå¯¹ç‰ˆæœ¬å·åšä¸€äº›è§£é‡Šï¼Œä¸»è¦æ ¼å¼ä¸º <code class="highlighter-rouge">major.minor.patch</code> ï¼Œå³<code class="highlighter-rouge">ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è¡¥ç‰ˆæœ¬å·</code>ï¼Œ<strong>SemVer(Semantic Version)</strong> è¯­ä¹‰åŒ–è§„èŒƒå¯ä»¥<a href="https://semver.org/lang/zh-CN/">å‚è€ƒè¿™é‡Œ</a>:</p>

<ul>
  <li>æ³¢æµªç¬¦å·(<strong>~</strong>) - ä¼šæ›´æ–°åˆ°å½“å‰ minor version(ä¸­é—´æ•°å­—)ä¸­æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚æ›´æ–° ~1.10.0ï¼Œè¿™ä¸ªåº“ä¼šå»åŒ¹é…æ›´æ–°åˆ° 1.10.x çš„æœ€æ–°ç‰ˆæœ¬</li>
  <li>æ’å…¥ç¬¦å·(<strong>^</strong>) - ä¼šæ›´æ–°åˆ°å½“å‰ major version(é¦–ä½æ•°å­—)ä¸­æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚æ›´æ–° ^1.10.0ï¼Œè¿™ä¸ªåº“ä¼šå»åŒ¹é…æ›´æ–°åˆ° 1.x.x çš„æœ€æ–°ç‰ˆæœ¬</li>
  <li>ä¸å¸¦ç¬¦å· - åŒ¹é…å…·ä½“ç‰ˆæœ¬å·</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">åºå·</th>
      <th style="text-align: left">æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>major</strong></td>
      <td style="text-align: left">è¿›è¡Œä¸å‘ä¸‹å…¼å®¹çš„ä¿®æ”¹æ—¶ï¼Œé€’å¢ä¸»ç‰ˆæœ¬å·</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>minor</strong></td>
      <td style="text-align: left">ä¿æŒå‘ä¸‹å…¼å®¹,æ–°å¢ç‰¹æ€§æ—¶ï¼Œé€’å¢æ¬¡ç‰ˆæœ¬å·</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>patch</strong></td>
      <td style="text-align: left">ä¿æŒå‘ä¸‹å…¼å®¹,ä¿®å¤é—®é¢˜ä½†ä¸å½±å“ç‰¹æ€§æ—¶ï¼Œé€’å¢ä¿®è®¢å·</td>
    </tr>
  </tbody>
</table>

<p>å½“æŸä¸ªç‰ˆæœ¬æ”¹åŠ¨æ¯”è¾ƒå¤§ã€å¹¶éç¨³å®šè€Œä¸”å¯èƒ½æ— æ³•æ»¡è¶³é¢„æœŸçš„å…¼å®¹æ€§éœ€æ±‚æ—¶ï¼Œä½ å¯èƒ½è¦å…ˆå‘å¸ƒä¸€ä¸ªå…ˆè¡Œç‰ˆæœ¬ã€‚å…ˆè¡Œç‰ˆæœ¬å·å¯ä»¥åŠ åˆ° <code class="highlighter-rouge">ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·</code> çš„åé¢ï¼Œå…ˆåŠ ä¸Šä¸€ä¸ªè¿æ¥å·å†åŠ ä¸Šä¸€è¿ä¸²ä»¥å¥ç‚¹åˆ†éš”çš„æ ‡è¯†ç¬¦å’Œç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯:</p>

<ol>
  <li>å†…éƒ¨ç‰ˆæœ¬(alpha)</li>
  <li>å…¬æµ‹ç‰ˆæœ¬(beta)</li>
  <li>æ­£å¼ç‰ˆæœ¬çš„å€™é€‰ç‰ˆæœ¬ rc: å³ Release candiate</li>
</ol>

<pre><code class="language-JSON">"dependencies": {
  "async": "1.2.1", # å›ºå®šç‰ˆæœ¬
  "chokidar": "^1.0.0",
  "vizion": "latest", # å½“å‰å‘å¸ƒç‰ˆæœ¬
  "babel": "^5.x",
  "pm2-logs": "~0.1.1",
  "ikt": "git+http://ikt.pm2.io/ikt.git#master", # Git URL å½¢å¼çš„ä¾èµ–
  "punt": "*", # ä»»æ„ç‰ˆæœ¬
  "express": "&gt;=3.0.0",
  "connect": "1.30.2 - 2.30.2",
}
</code></pre>

<p>åœ¨å¼€å‘ä¸­è‚¯å®šå°‘ä¸äº†å¯¹ä¸€äº›ç‰ˆæœ¬å·çš„æ“ä½œï¼Œå¦‚æœè¿™äº›ç‰ˆæœ¬å·ç¬¦åˆ SemVer è§„èŒƒ ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ç”¨äºæ“ä½œç‰ˆæœ¬çš„ npm åŒ… <a href="https://github.com/semver/semver">semver</a> æ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ¯”è¾ƒç‰ˆæœ¬å¤§å°ã€æå–ç‰ˆæœ¬ä¿¡æ¯ç­‰æ“ä½œ:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// æ¯”è¾ƒç‰ˆæœ¬å·å¤§å°</span>
<span class="nx">semver</span><span class="p">.</span><span class="nx">gt</span><span class="p">(</span><span class="dl">'</span><span class="s1">1.2.3</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">9.8.7</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// false</span>
<span class="nx">semver</span><span class="p">.</span><span class="nx">lt</span><span class="p">(</span><span class="dl">'</span><span class="s1">1.2.3</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">9.8.7</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// true</span>

<span class="c1">// åˆ¤æ–­ç‰ˆæœ¬å·æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œè¿”å›è§£æåç¬¦åˆè§„èŒƒçš„ç‰ˆæœ¬å·ã€‚</span>
<span class="nx">semver</span><span class="p">.</span><span class="nx">valid</span><span class="p">(</span><span class="dl">'</span><span class="s1">1.2.3</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// '1.2.3'</span>
<span class="nx">semver</span><span class="p">.</span><span class="nx">valid</span><span class="p">(</span><span class="dl">'</span><span class="s1">a.b.c</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// null</span>

<span class="c1">// å°†å…¶ä»–ç‰ˆæœ¬å·å¼ºåˆ¶è½¬æ¢æˆ semver ç‰ˆæœ¬å·</span>
<span class="nx">semver</span><span class="p">.</span><span class="nx">valid</span><span class="p">(</span><span class="nx">semver</span><span class="p">.</span><span class="nx">coerce</span><span class="p">(</span><span class="dl">'</span><span class="s1">v2</span><span class="dl">'</span><span class="p">))</span> <span class="c1">// '2.0.0'</span>
<span class="nx">semver</span><span class="p">.</span><span class="nx">valid</span><span class="p">(</span><span class="nx">semver</span><span class="p">.</span><span class="nx">coerce</span><span class="p">(</span><span class="dl">'</span><span class="s1">42.6.7.9.3-alpha</span><span class="dl">'</span><span class="p">))</span> <span class="c1">// '42.6.7'</span>

<span class="c1">// ä¸€äº›å…¶ä»–ç”¨æ³•</span>
<span class="nx">semver</span><span class="p">.</span><span class="nx">clean</span><span class="p">(</span><span class="dl">'</span><span class="s1">  =v1.2.3   </span><span class="dl">'</span><span class="p">)</span> <span class="c1">// '1.2.3'</span>
<span class="nx">semver</span><span class="p">.</span><span class="nx">satisfies</span><span class="p">(</span><span class="dl">'</span><span class="s1">1.2.3</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">1.x || &gt;=2.5.0 || 5.0.0 - 7.2.3</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// true</span>
<span class="nx">semver</span><span class="p">.</span><span class="nx">minVersion</span><span class="p">(</span><span class="dl">'</span><span class="s1">&gt;=1.0.0</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// '1.0.0'</span>
</code></pre></div></div>

<p>æˆ‘ä»¬çš„ç›®çš„æ˜¯ä¿è¯å›¢é˜Ÿä¸­ä½¿ç”¨çš„ä¾èµ–ä¸€è‡´æˆ–è€…ç¨³å®šï¼Œè€Œä¸æ˜¯æ°¸è¿œä¸å»æ›´æ–°è¿™äº›ä¾èµ–ã€‚å®é™…å¼€å‘åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬è™½ç„¶ä¸éœ€è¦æ¯æ¬¡éƒ½å»å®‰è£…æ–°çš„ç‰ˆæœ¬ï¼Œä»ç„¶éœ€è¦å®šæ—¶å»å‡çº§ä¾èµ–ç‰ˆæœ¬ï¼Œæ¥è®©æˆ‘ä»¬äº«å—ä¾èµ–åŒ…å‡çº§å¸¦æ¥çš„é—®é¢˜ä¿®å¤ã€æ€§èƒ½æå‡ã€æ–°ç‰¹æ€§æ›´æ–°ã€‚ä½¿ç”¨ <code class="highlighter-rouge">npm outdated</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ—å‡ºæœ‰å“ªäº›è¿˜æ²¡æœ‰å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–:</p>

<ol>
  <li>Red means thereâ€™s a newer version matching your semver requirements, so you should update now. - æ‰§è¡Œ <code class="highlighter-rouge">npm update</code> å°†ä¼šå®‰è£…æ­¤éƒ¨åˆ†ä¾èµ–</li>
  <li>Yellow indicates that thereâ€™s a newer version above your semver requirements (<strong>usually new major, or new 0.x minor</strong>) so proceed with caution.</li>
</ol>

<p><img src="http://localhost:2333/style/images/smms/npm-outdated.png" alt="npm outdated" /></p>

<blockquote>
  <p>è¿™é‡Œä¹Ÿæ¨èä¸€ä¸ª vscode æ’ä»¶ - <a href="https://marketplace.visualstudio.com/items?itemName=pflannery.vscode-versionlens&amp;wt.mc_id=vscode-versionlens-gitlab">Version Lens</a></p>
</blockquote>

<blockquote>
  <p>é€šè¿‡è„šæœ¬è¿›è¡Œç‰ˆæœ¬æ§åˆ¶å¯ä»¥<a href="#ç‰ˆæœ¬æ§åˆ¶å®è·µ">å‚è€ƒä¸‹é¢</a> ğŸ‘‡</p>
</blockquote>

<h3 id="ä¾èµ–-dependencies">ä¾èµ– dependencies</h3>

<p>package.json é‡Œé…ç½®ä¾èµ–çš„åœ°æ–¹æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ dependenciesã€devDependenciesã€peerDependencies ç­‰ï¼Œæ¥ä¸‹æ¥ä¼šä»‹ç»ä¸‹ä¸€äº›åŒºåˆ«:</p>

<p>ä¸€ã€<strong>dependencies / devDependencies</strong></p>

<p>dependencies æŒ‡å®šäº†é¡¹ç›®è¿è¡Œæ‰€ä¾èµ–çš„æ¨¡å—ï¼Œå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ä¾èµ–æ¨¡å—éƒ½å¯ä»¥é…ç½®åˆ°è¿™é‡Œã€‚</p>

<p>æœ‰ä¸€äº›åŒ…æœ‰å¯èƒ½ä½ åªæ˜¯åœ¨å¼€å‘ç¯å¢ƒä¸­ç”¨åˆ°ï¼Œä¾‹å¦‚ä½ ç”¨äºæ£€æµ‹ä»£ç è§„èŒƒçš„ eslintï¼Œç”¨äºè¿›è¡Œæµ‹è¯•çš„ jestï¼Œç”¨æˆ·ä½¿ç”¨ä½ çš„åŒ…æ—¶å³ä½¿ä¸å®‰è£…è¿™äº›ä¾èµ–ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œåè€Œå®‰è£…ä»–ä»¬ä¼šè€—è´¹æ›´å¤šçš„æ—¶é—´å’Œèµ„æºï¼Œæ‰€ä»¥ä½ å¯ä»¥æŠŠè¿™äº›ä¾èµ–æ·»åŠ åˆ° devDependencies ä¸­ï¼Œè¿™äº›ä¾èµ–ç…§æ ·ä¼šåœ¨ä½ æœ¬åœ°è¿›è¡Œ npm install æ—¶è¢«å®‰è£…å’Œç®¡ç†ï¼Œä½†æ˜¯ä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒå®‰è£…éƒ½ä¼šæ·»åŠ  <code class="highlighter-rouge">--production</code> å‚æ•°ã€‚åªä¼šå®‰è£… dependencies é‡Œçš„ä¾èµ–ã€‚</p>

<p>äºŒã€<strong>peerDependencies</strong></p>

<p>peerDependencies ç”¨äºæŒ‡å®šä½ æ­£åœ¨å¼€å‘çš„æ¨¡å—æ‰€ä¾èµ–çš„ç‰ˆæœ¬ä»¥åŠç”¨æˆ·å®‰è£…çš„ä¾èµ–åŒ…ç‰ˆæœ¬çš„å…¼å®¹æ€§ã€‚æˆ‘ä»¬ç›´æ¥æ‹¿ antD æ¥ä¸¾ä¸ªä¾‹å­ï¼Œpackage.json ä¸­æœ‰å¦‚ä¸‹é…ç½®:</p>

<pre><code class="language-JSON">{
  "peerDependencies": {
    "react": "&gt;=16.0.0",
    "react-dom": "&gt;=16.0.0"
  }
}
</code></pre>

<p>è¿™é‡Œçš„æ„æ€æ˜¯å¦‚æœè¦æ¥å…¥ antD å¹¶ä¿è¯é¡¹ç›®ç¨³å®šçš„è¯ï¼ŒReact ç‰ˆæœ¬éœ€è¦ä¿æŒ 16.0.0 ä»¥ä¸Šï¼Œè€Œå½“ä½ å¼€å‘æ—¶ä¾èµ–çš„ React ç‰ˆæœ¬æ˜¯ 15.x çš„è¯ï¼Œnpm@2 åˆ™å¼ºåˆ¶å®¿ä¸»ç¯å¢ƒå®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ reactï¼Œnpm@3 ä»¥ä¸Šä¼šç»™ç”¨æˆ·æ‰“å°è­¦å‘Šæç¤ºã€‚</p>

<p>ä¸‰ã€<strong>optionalDependencies</strong></p>

<p>æŸäº›åœºæ™¯ä¸‹ï¼Œä¾èµ–åŒ…å¯èƒ½ä¸æ˜¯å¼ºä¾èµ–çš„ï¼Œè¿™ä¸ªä¾èµ–åŒ…çš„åŠŸèƒ½å¯æœ‰å¯æ— ï¼Œå½“è¿™ä¸ªä¾èµ–åŒ…æ— æ³•è¢«è·å–åˆ°æ—¶ï¼Œä½ å¸Œæœ› npm install ç»§ç»­è¿è¡Œï¼Œè€Œä¸ä¼šå¯¼è‡´å¤±è´¥ï¼Œä½ å¯ä»¥å°†è¿™ä¸ªä¾èµ–æ”¾åˆ° optionalDependencies ä¸­ï¼Œæ³¨æ„ optionalDependencies ä¸­çš„é…ç½®å°†ä¼šè¦†ç›–æ‰ dependenciesï¼Œæ‰€ä»¥åªéœ€åœ¨ä¸€ä¸ªåœ°æ–¹è¿›è¡Œé…ç½®ã€‚å½“ç„¶ï¼Œå¼•ç”¨ optionalDependencies ä¸­å®‰è£…çš„ä¾èµ–æ—¶ï¼Œä¸€å®šè¦åšå¥½å¼‚å¸¸å¤„ç†ï¼Œå¦åˆ™åœ¨æ¨¡å—è·å–ä¸åˆ°æ—¶ä¼šå¯¼è‡´æŠ¥é”™ã€‚</p>

<p>å››ã€<strong>bundledDependencies</strong></p>

<p>å’Œä»¥ä¸Šå‡ ä¸ªä¸åŒï¼ŒbundledDependencies çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œå¯ä»¥æŒ‡å®šä¸€äº›æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å°†åœ¨è¿™ä¸ªåŒ…å‘å¸ƒæ—¶è¢«ä¸€èµ·æ‰“åŒ…:</p>

<pre><code class="language-JSON">{
  "bundledDependencies": ["package1" , "package2"]
}
</code></pre>

<h3 id="bin">bin</h3>

<p><strong>bin</strong> å­—æ®µç”¨æ¥æŒ‡å®šå„ä¸ªå†…éƒ¨å‘½ä»¤å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ã€‚å¯ä»¥å‚è€ƒ <code class="highlighter-rouge">create-react-app</code>ã€<code class="highlighter-rouge">angular-cli</code>ã€<code class="highlighter-rouge">material-ui codemod</code> è¿™äº›å·¥å…·åº“:</p>

<pre><code class="language-JSON">{
  "bin": {
    "myapp": "./cli.js"
  }
}
</code></pre>

<p>å½“å®‰è£…é¡¹ç›®çš„æ—¶å€™ï¼Œä¼šå»ºç«‹ cli.js çš„è½¯é“¾æ¥åˆ° <code class="highlighter-rouge">/usr/local/bin/myapp</code>ã€‚å¦‚æœä½ ä»…æœ‰ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåå­—å¿…é¡»è·Ÿ package name ä¸€è‡´ï¼Œå†™æ³•ä¸Šæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼:</p>

<pre><code class="language-JSON">{
  "name": "my-program",
  "version": "1.2.5",
  "bin": "./path/to/program"
}

// same as
{
  "name": "my-program",
  "version": "1.2.5",
  "bin": {
    "my-program": "./path/to/program"
  }
}
</code></pre>

<blockquote>
  <p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè„šæœ¬æ–‡ä»¶å¿…é¡»ä»¥ <code class="highlighter-rouge"><span class="err">#</span><span class="o">!</span><span class="sr">/usr/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">env</span> <span class="nx">node</span></code> å¼€å¤´ï¼Œä¸ç„¶æ²¡åŠæ³•ä»¥ node æ‰§è¡Œã€‚</p>
</blockquote>

<h2 id="scripty">scripty</h2>

<p>å½“è„šæœ¬å‘½ä»¤æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ <a href="https://github.com/testdouble/scripty">scripty</a> å°† scripts å‰¥ç¦»åˆ°å•ç‹¬æ–‡ä»¶ä¸­ç®¡ç†ï¼Œè¿˜æ˜¯çœ‹æœ€åˆçš„æ —å­:</p>

<pre><code class="language-SHELL">"call:tate": "echo tate",
"call:snow": "echo snow",
</code></pre>

<p>å¯¹åº”æ ¹ç›®å½•ä¸‹åˆ›å»ºè„šæœ¬æ–‡ä»¶ï¼Œæ³¨æ„åœ¨æ‰§è¡Œè„šæœ¬æ—¶å¿…é¡»æ‹¥æœ‰å¯æ‰§è¡Œæƒé™:</p>

<pre><code class="language-SHELL">touch scripts/call/tate.sh # å†…å®¹ä¸º echo 'tate in scripty'
touch scripts/call/snow.sh

# æ·»åŠ å¯æ‰§è¡Œæƒé™
chmod -R a+x scripts/**/*.sh
</code></pre>

<p>ç„¶åå°† scripts åšä¿®æ”¹:</p>

<pre><code class="language-SHELL">"call:tate": "scripty",
"call:snow": "scripty",
</code></pre>

<p>æ‰§è¡Œå‘½ä»¤<code class="highlighter-rouge">npm run call:tate</code>åï¼Œä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯:</p>

<pre><code class="language-SHELL">&gt; npm_scripts@1.0.0 call:tate /Users/tate/Desktop/lazyload-test
&gt; scripty

Executing "/Users/tate/Desktop/lazyload-test/scripts/call/tate.sh":

&gt; echo 'tate in scripty'
</code></pre>

<blockquote>
  <p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ node æ¥ç®¡ç†ï¼Œå°† shell è„šæœ¬æ”¹ä¸º node è„šæœ¬å¹¶æ‰§è¡Œï¼Œ<a href="https://www.npmjs.com/package/shelljs">shelljs</a> å¯ä»¥åœ¨ node ä¸­ä½¿ç”¨ shell å‘½ä»¤ã€‚</p>
</blockquote>

<blockquote>
  <p>ç”±äºç›®å‰æ²¡æœ‰å®æˆ˜ï¼Œå…³äºå¦‚ä½•æ„å»ºæµæ°´çº¿å¯ç›´æ¥<a href="https://juejin.im/book/5a1212bc51882531ea64df07/section/5a1214e3f265da432b4a6ad2">å‚è€ƒå°å†Œè¿™é‡Œ</a>ã€‚</p>
</blockquote>

<h2 id="yarn--npm">yarn &amp; npm</h2>

<p><strong>åŒ…ç®¡ç†å™¨</strong>: ä»£ç é€šè¿‡åŒ…(package)æˆ–è€…ç§°ä¸ºæ¨¡å—(module)çš„æ–¹å¼æ¥å…±äº«ã€‚ä¸€ä¸ªåŒ…é‡ŒåŒ…å«æ‰€æœ‰éœ€è¦å…±äº«çš„ä»£ç ï¼Œä»¥åŠæè¿°åŒ…ä¿¡æ¯çš„æ–‡ä»¶ï¼Œç§°ä¸º package.jsonã€‚å’Œ NPM 5 çš„  <code class="highlighter-rouge">package-lock.json</code> é”æ–‡ä»¶ç±»ä¼¼ï¼Œé€šè¿‡ <code class="highlighter-rouge">yarn.lock</code> è®°å½•æ¯ä¸€ä¸ªä¾èµ–é¡¹çš„ç¡®åˆ‡ç‰ˆæœ¬ä¿¡æ¯ã€‚</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">npm å‘½ä»¤</th>
      <th style="text-align: left">yarn å‘½ä»¤</th>
      <th style="text-align: left">åŠŸèƒ½æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">npm i</td>
      <td style="text-align: left">yarn (install)</td>
      <td style="text-align: left">æ ¹æ® package.json å®‰è£…æ‰€æœ‰ä¾èµ–</td>
    </tr>
    <tr>
      <td style="text-align: left">npm i (â€“save/-S) [package]</td>
      <td style="text-align: left">yarn add [package]</td>
      <td style="text-align: left">æ·»åŠ ä¾èµ–åŒ…è‡³ dependencies</td>
    </tr>
    <tr>
      <td style="text-align: left">npm i [â€“save-dev/-D] [package]</td>
      <td style="text-align: left">yarn add [â€“dev/-D] [package]</td>
      <td style="text-align: left">æ·»åŠ ä¾èµ–åŒ…è‡³ devDependencies</td>
    </tr>
    <tr>
      <td style="text-align: left">npm i [â€“global/-g]</td>
      <td style="text-align: left">yarn global add</td>
      <td style="text-align: left">å…¨å±€å®‰è£…ä¾èµ–åŒ…</td>
    </tr>
    <tr>
      <td style="text-align: left">npm uninstall [package]</td>
      <td style="text-align: left">yarn remove [package]</td>
      <td style="text-align: left">ç§»é™¤ä¾èµ–åŒ…</td>
    </tr>
    <tr>
      <td style="text-align: left">npm update</td>
      <td style="text-align: left">yarn upgrade</td>
      <td style="text-align: left">å‡çº§ä¾èµ–åŒ…</td>
    </tr>
    <tr>
      <td style="text-align: left">npm init</td>
      <td style="text-align: left">yarn init</td>
      <td style="text-align: left">äº’åŠ¨å¼åˆ›å»º package.json æ–‡ä»¶</td>
    </tr>
    <tr>
      <td style="text-align: left">npm run</td>
      <td style="text-align: left">yarn run</td>
      <td style="text-align: left">è¿è¡Œ package.json ä¸­é¢„å®šä¹‰çš„è„šæœ¬</td>
    </tr>
  </tbody>
</table>

<p>yarn åœ¨ mac çš„ä¸¤ç§å®‰è£…æ–¹å¼:</p>

<pre><code class="language-SHELL"># é€šè¿‡ npm å®‰è£…
npm install --global yarn

# é€šè¿‡ homebrew å®‰è£…
brew install yarn
</code></pre>

<p>æ›´æ–°æ–¹å¼:</p>

<pre><code class="language-SHELL"># é€šè¿‡ Homebrew æ›´æ–°
brew upgrade yarn

# é€šè¿‡ yarn æ›´æ–°
yarn global add yarn
</code></pre>

<p>é‚£ä¹ˆå†ç®€å•å¯¹æ¯”ä¸‹ <code class="highlighter-rouge">npm install</code> å’Œ <code class="highlighter-rouge">update</code> çš„åŒºåˆ«ï¼Œå³å¯¹äºå·²ç»å®‰è£…çš„åŒ…ï¼Œæ²¡æœ‰æ˜ç¡®ç‰ˆæœ¬å·çš„ï¼Œå‰è€…ä¼šå¿½ç•¥:</p>

<pre><code class="language-TEXT">{
  "name":          "my-project",
  "version":       "1.0",                             // install   update
  "dependencies":  {                                  // ------------------
    "already-installed-versionless-module":  "*",     // ignores   "1.0" -&gt; "1.1"
    "already-installed-semver-module":       "^1.4.3" // ignores   "1.4.3" -&gt; "1.5.2"
    "already-installed-versioned-module":    "3.4.1"  // ignores   ignores
    "not-yet-installed-versionless-module":  "*",     // installs  installs
    "not-yet-installed-semver-module":       "^4.2.1" // installs  installs
    "not-yet-installed-versioned-module":    "2.7.8"  // installs  installs
  }
}
</code></pre>

<p>å¦å¤–å¯¹äºå®‰è£… <code class="highlighter-rouge">devDependecies</code> ä¸­çš„ä¾èµ–è¿˜æœ‰ä¸€äº›åŒºåˆ«:</p>

<ul>
  <li>npm install é»˜è®¤ä¼šå®‰è£…ï¼Œé™¤éæ·»åŠ  <code class="highlighter-rouge">--production</code> å‚æ•°</li>
  <li>npm update ä¸ä¼šé»˜è®¤å®‰è£…ï¼Œé™¤éæ·»åŠ  <code class="highlighter-rouge">--dev</code> å‚æ•°</li>
</ul>

<p>å¦‚æœè¦ç”¨ npm æŸ¥çœ‹æŒ‡å®šåº“çš„æ‰€æœ‰å†å²ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ <code class="highlighter-rouge">npm view xxx versions</code> å‘½ä»¤:</p>

<pre><code class="language-SHELL">$npm view @date-io/date-fns versions

[ '0.0.1',
  '0.0.2',
  '1.0.0',
  ...
  '2.6.1' ]
</code></pre>

<p>è¿™é‡Œå†ä»‹ç»ä¸‹å…³äº <code class="highlighter-rouge">npm install</code> çš„åŸç†ï¼Œå…·ä½“<a href="https://cloud.tencent.com/developer/article/1555982">å‚è€ƒè¿™ç¯‡æ–‡ç« </a>:</p>

<p><img src="http://localhost:2333/style/images/smms/npm-install.png" alt="npm install" /></p>

<blockquote>
  <p>å…³äº <strong>pnpm</strong> å¯ä»¥å‚è€ƒ<a href="http://localhost:23332021/03/24/pnpm.html">è¿™ç¯‡åšå®¢</a> ğŸ‘ˆ</p>
</blockquote>

<h2 id="npx">npx</h2>

<p><a href="https://github.com/zkat/npx"><strong>npx</strong></a> æ˜¯ <a href="https://github.com/npm/npm/releases/tag/v5.2.0">npm@5.2.0</a> å¼•å…¥çš„ä¸€ä¸ªå‘½ä»¤ï¼Œé‚£ä¹ˆå®ƒæ˜¯ç”¨æ¥å¹²å˜›çš„å‘¢ï¼Ÿé‡‡ç”¨å®˜æ–¹çš„è¯´æ³•å°±æ˜¯:</p>

<blockquote>
  <p>npx is a tool intended to help round out the experience of using packages from the npm registryâ€Šâ€”â€Šthe same way npm makes it super easy to install and manage dependencies hosted on the registry, npx makes it easy to use CLI tools and other executables hosted on the registry. It greatly simplifies a number of things that, until now, required a bit of ceremony to do with plain npm</p>
</blockquote>

<h2 id="npm-link">npm link</h2>

<pre><code class="language-SHELL">npm link (in package dir)
npm link [&lt;@scope&gt;/]&lt;pkg&gt;[@&lt;version&gt;]

alias: npm ln
</code></pre>

<p>First, <code class="highlighter-rouge">npm link</code> in a package folder will create a symlink in the global folder <code class="highlighter-rouge">{prefix}/lib/node_modules/&lt;package&gt;</code> that links to the package where the npm link command was executed. It will also link any bins in the package to <code class="highlighter-rouge">{prefix}/bin/{name}</code>. Note that npm link uses the global prefix (see npm prefix -g for its value).</p>

<p>Next, in some other location, <code class="highlighter-rouge">npm link &lt;package-name&gt;</code> will create a symbolic link from globally-installed package-name to <code class="highlighter-rouge">node_modules/</code> of the current folder.</p>

<pre><code class="language-SHELL">cd ~/projects/node-redis    # go into the package directory
npm link                    # creates global link
cd ~/projects/node-bloggy   # go into some other package directory.
npm link redis              # link-install the package
</code></pre>

<blockquote>
  <p>Now, any changes to <em>~/projects/node-redis</em> will be reflected in <em>~/projects/node-bloggy/node_modules/node-redis/</em>. <strong>Note that the link should be to the package name, not the directory name for that package</strong>.</p>
</blockquote>

<h3 id="æŠ›å¼ƒ-run-script">æŠ›å¼ƒ run-script</h3>

<p>åœ¨è¿™ä¹‹å‰ï¼Œnpm ç”Ÿæ€è¶Šæ¥è¶Šå€¾å‘äºå°† devDependencies å®‰è£…åŒ…ä½œä¸ºé¡¹ç›®æœ¬åœ°(project-local)ä¾èµ–å®‰è£…ï¼Œè€Œä¸æ˜¯å…¨å±€å®‰è£…ï¼Œè¿™æ ·å°±æ›´åŠ æ–¹ä¾¿å»ç®¡ç†åƒ gulpã€webpack è¿™äº›å·¥å…·çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ webpack æœ¬åœ°å®‰è£…æ—¶å°±æ¨èå±€éƒ¨å®‰è£…:</p>

<blockquote>
  <p>å¯¹äºå¤§å¤šæ•°é¡¹ç›®ï¼Œæˆ‘ä»¬å»ºè®®æœ¬åœ°å®‰è£…ã€‚è¿™å¯ä»¥åœ¨å¼•å…¥çªç ´å¼å˜æ›´(breaking change)ç‰ˆæœ¬æ—¶ï¼Œæ›´å®¹æ˜“åˆ†åˆ«å‡çº§é¡¹ç›®ã€‚é€šå¸¸ä¼šé€šè¿‡è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ª npm scripts ä»¥åœ¨æœ¬åœ° node_modules ç›®å½•ä¸­æŸ¥æ‰¾å®‰è£…çš„ webpackï¼Œæƒ³è¦è¿è¡Œæœ¬åœ°å®‰è£…çš„ webpackï¼Œä½ å¯ä»¥é€šè¿‡ node_modules/.bin/webpack æ¥è®¿é—®å®ƒçš„ bin ç‰ˆæœ¬ã€‚<a href="https://webpack.docschina.org/guides/installation/">è¯¦è§è¿™é‡Œ</a> ğŸ‘ˆ</p>
</blockquote>

<p>è¾£ä¹ˆæ­¤å‰è¦è¿™ä¹ˆåšçš„è¯ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•:</p>

<p>1ã€åœ¨ run-script ä¸­ç”³æ˜ï¼Œå¹¶æ‰§è¡Œ <code class="highlighter-rouge">npm build</code></p>

<pre><code class="language-JSON">"scripts": {
  "build": "webpack --config webpack.config.js"
}
</code></pre>

<p>2ã€ç›´æ¥æ‰¾åˆ°é¡¹ç›®æœ¬åœ°çš„ä½ç½®å¹¶æ‰§è¡Œ</p>

<pre><code class="language-SHELL">./node_modules/.bin/webpack --config webpack.config.js
</code></pre>

<p>æŠ›å¼€ä»¥ä¸Šä¸¤ç§å†™æ³•è€Œä½¿ç”¨ npx çš„è¯ï¼Œåªç”¨è¾“å…¥ä¸‹é¢å‘½ä»¤å³å¯:</p>

<pre><code class="language-SHELL">npx webpack --config webpack.config.js
</code></pre>

<h3 id="executing-one-off-commands">Executing one-off commands</h3>

<p>npx å¯ä»¥è®©ä½ å»æ‰§è¡Œ npm åŒ…é‡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶è€Œä¸ç”¨å»å…¨å±€å®‰è£…ä»–ä»¬ï¼Œå› æ­¤åˆ©ç”¨ npx è¿˜å¯ä»¥å®ç° Executing one-off commandsï¼Œå³æ‰§è¡Œä¸€æ¬¡æ€§å‘½ä»¤ã€‚npx is the last thing you need to globally install: &gt; <code class="highlighter-rouge">npm i -g npx</code> (this command also updates npx)ã€‚</p>

<p>ä¸‹é¢ä¸¾ä¸ª <code class="highlighter-rouge">create-react-app</code> æ —å­ï¼Œ<code class="highlighter-rouge">$ npx create-react-app my-cool-new-app</code> å®‰è£…äº†ä¸€ä¸ªä¸´æ—¶çš„åŒ…å¹¶è¿è¡Œ, æ²¡æœ‰æ±¡æŸ“å…¨å±€å®‰è£…è€Œä¸”å‘½ä»¤ç®€å•:</p>

<p><img src="https://cdn-images-1.medium.com/max/1600/1*OlIRsvVO5aK7ja9HmwXz_Q.gif" alt="create-react-app" /></p>

<p>ä¸‹åˆ—æ˜¯ä¸€äº›æ¯”è¾ƒæœ‰è¶£çš„åŒ…ï¼Œå¯ä»¥ç”¨ npx å°è¯•ä¸€ç•ª ğŸ˜œï¼Œæ›´å¤šå‘½ä»¤å¯ä»¥å‚è€ƒ <a href="https://github.com/junosuarez/awesome-npx">awesome-npx</a>:</p>

<pre><code class="language-TEXT">[~] npx cowsay Tate
npx: 10 å®‰è£…æˆåŠŸï¼Œç”¨æ—¶ 1.223 ç§’
 _____
&lt; Tate &gt;
 -----
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||
</code></pre>

<pre><code class="language-TEXT">[~] npx happy-birthday -u snow
npx: 2 å®‰è£…æˆåŠŸï¼Œç”¨æ—¶ 0.776 ç§’

ğŸ‚
ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã€snowï¼
ğŸ‰
</code></pre>

<p>npx è¿˜æ”¯æŒä¸€äº›å…¶ä»–çš„å‚æ•°:</p>

<p><img src="https://cdn-images-1.medium.com/max/1600/1*JqCC1irC-XxXAWiThpOUiw.gif" alt="npx-options" /></p>

<blockquote>
  <p><code class="highlighter-rouge">$ npx -p cowsay -p lolcatjs -c 'echo "$npm_package_name@$npm_package_version" | cowsay | lolcatjs'</code> installs both cowsay and lolcatjs, and gives the script access to a slew of <code class="highlighter-rouge">$npm_</code> variables from run scripts.</p>
</blockquote>

<h3 id="æ§åˆ¶-node-ç‰ˆæœ¬">æ§åˆ¶ node ç‰ˆæœ¬</h3>

<p>node ç‰ˆæœ¬çš„æ§åˆ¶ä¹‹å‰ä¸€èˆ¬éƒ½é‡‡ç”¨ <a href="https://github.com/nvm-sh/nvm"><strong>nvm</strong></a>ã€<a href="https://github.com/tj/n"><strong>n</strong></a> ç­‰ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œç°åœ¨çš„è¯ npx å°±èƒ½åšåˆ°ï¼Œä¸è¿‡åªæ˜¯ä¸´æ—¶åœ°å»ç”¨æŒ‡å®š node ç‰ˆæœ¬:</p>

<pre><code class="language-SHELL">npx -p node@&lt;version&gt;
</code></pre>

<pre><code class="language-SHELL">[~] npx node@6 -v
v6.17.1
[~] npx -p node@7 -- node -v
v7.10.1
[~] node -v
v11.14.0
</code></pre>

<p>ä¸‹å›¾æ˜¯ n çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œ<code class="highlighter-rouge">n &lt;version&gt;</code> å°±èƒ½å®‰è£…:</p>

<p><img src="https://camo.githubusercontent.com/e3c6ac1ad2a69e2e969597b69d794658cb64df88/687474703a2f2f6e696d69742e696f2f696d616765732f6e2f6e2e676966" alt="n" /></p>

<h2 id="nrm">nrm</h2>

<p><a href="https://github.com/Pana/nrm"><strong>nrm</strong></a> å¯ä»¥æ–¹ä¾¿ç®¡ç† npm æº:</p>

<pre><code class="language-SHELL">nrm ls

# npm -----  https://registry.npmjs.org/
# yarn ----- https://registry.yarnpkg.com
# cnpm ----  http://r.cnpmjs.org/
# taobao --  https://registry.npm.taobao.org/
# nj ------  https://registry.nodejitsu.com/
# skimdb -- https://skimdb.npmjs.com/registry
</code></pre>

<pre><code class="language-SHELL"># switch registry to cnpm
nrm use cnpm
# Registry has been set to: http://r.cnpmjs.org/
</code></pre>

<p>æˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ å’Œåˆ é™¤ç§æœçš„ npm é•œåƒåœ°å€:</p>

<pre><code class="language-SHELL"># å…·ä½“å¯ä»¥æŸ¥çœ‹ nrm help
nrm add test http://XXX:4873/
nrm del test
</code></pre>

<h2 id="git-hooks-å®è·µç¤ºä¾‹">git hooks å®è·µç¤ºä¾‹</h2>

<pre><code class="language-JSON">// package.json
{
   "husky": {
    "hooks": {
      "pre-merge-commit": "node build/bin/pre-merge-commit.js",
      "pre-commit": "node build/bin/pre-commit.js",
      "pre-push": "node build/bin/pre-push.js",
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
  }
}
</code></pre>

<h3 id="pre-commit">pre-commit</h3>

<pre><code class="language-JS">const shell = require('shelljs')
const fs = require('fs')
const path = require('path')

const STARTCOLOR = '\033[31m'
const ENDCOLOR = '\033[0m'
const CYAN_COLOR = '\x1B[36m'
shell.config.silent = true

/**
 * åˆ¤æ–­æ˜¯å¦å®‰è£…äº† Git
 */
function checkGit() {
  if (!shell.which('git')) {
    shell.echo(`${STARTCOLOR}==================================================${ENDCOLOR}`)
    shell.echo(`${STARTCOLOR}å½“å‰ç¯å¢ƒæ²¡æœ‰å®‰è£… Gitï¼Œè¯·å®‰è£…åå†è¯•ï¼${ENDCOLOR}`)
    shell.echo(`${STARTCOLOR}==================================================${ENDCOLOR}`)
    shell.exit(1)
  }
}

/**
 * æ ¡éªŒå½“å‰ç”¨æˆ·é‚®ç®±æ˜¯å¦ç¬¦åˆå…¬å¸è§„èŒƒ
 */
function checkEmail() {
  const VALID_EMAIL_SUFFIX = '@xxx.com'
  const CURRENT_EMAIL = shell.exec('git config --get user.email', { silent: true }).trim()

  if (!CURRENT_EMAIL.endsWith(VALID_EMAIL_SUFFIX)) {
    shell.echo(`${STARTCOLOR}==================================================${ENDCOLOR}`)
    shell.echo(`${STARTCOLOR}å½“å‰é‚®ç®±æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é…ç½®ä¸º @xxx.com é‚®ç®±ï¼${ENDCOLOR}`)
    shell.echo(`${STARTCOLOR}git config --local user.name åå­—${ENDCOLOR}`)
    shell.echo(`${STARTCOLOR}git config --local user.email é‚®ç®±${ENDCOLOR}`)
    shell.echo(`${STARTCOLOR}==================================================${ENDCOLOR}`)
    shell.exit(1)
  }
}

/**
 * æ ¡éªŒæ˜¯å¦å­˜åœ¨å†²çªæ–‡ä»¶
 */
function checkConflict() {
  const REG = /(^|\r|\n|\r\n)&lt;{7,8} HEAD|^={7,8}(\r|\n|\r\n|$)|&gt;{7,8}.*(\r|\n|\r\n|$)/gm
  const CHANGED = shell.exec('git diff --cached --name-only --relative', { silent: true }).stdout.trim().split('\n')
  const EXCLUDE = /node_modules/g

  if (CHANGED) {
    const filter = CHANGED.filter(file =&gt; {
      if (!EXCLUDE.test(file)) return file
    })
    const existsFiles = []

    for (const file of filter) {
      try {
        fs.accessSync(file, fs.constants.F_OK)
        existsFiles.push(file)
      } catch (err) {}
    }

    const conflict = shell.grep('-l', REG, existsFiles).stdout.trim()
    if (conflict) {
      shell.echo(`${STARTCOLOR}==================================================${ENDCOLOR}`)
      shell.echo(`${STARTCOLOR}${conflict}${ENDCOLOR}\n`)
      shell.echo(`${STARTCOLOR}ä»¥ä¸Šæ–‡ä»¶å­˜åœ¨å†²çªæœªå¤„ç†ï¼Œè¯·å¤„ç†åå†æäº¤ï¼${ENDCOLOR}`)
      shell.echo(`${STARTCOLOR}==================================================${ENDCOLOR}`)
      shell.exit(1)
    }
  }
}

function checkCode(isFix = false) {
  const ESLINT_PATH = path.resolve(__dirname, '../../node_modules/.bin/eslint')
  const ESLINTRC_PATH = path.resolve(__dirname, '../../.eslintrc.js')
  const CHECK_TIME = '2020/01/01'
  const SUFFIX_FILE_REG = /\.vue?$|\.js?$/ // æ–‡ä»¶åç¼€
  const CHECK_FOLDER = ['examples/', 'packages/', 'src/'] // åªæ£€æŸ¥è¿™äº›ç›®å½•
  // const EXCLUDE_FOLDER_REG = // // è¿‡æ»¤æ‰çš„ç›®å½•

  function getStatusFile() {
    return new Promise((resolve, reject) =&gt; {
      shell.exec(`git status -s ${CHECK_FOLDER.join(' ')}`, { silent: true }, (code, stdout, stderr) =&gt; {
        let files = stdout
        files = files
          .split('\n')
          .filter(file =&gt; {
            const head = file.charAt(0)
            return /[ACMR]/.test(head) &amp;&amp; SUFFIX_FILE_REG.test(file)
          })
          .map(str =&gt; {
            const length = str.split(' ').length - 1                       
            return str.split(' ')[length]
          })

        files.length ? resolve(files) : isFix ? reject('&gt; Git æš‚å­˜åŒºæ²¡æœ‰ç¬¦åˆæ–‡ä»¶ï¼Œæ— æ³•æ‰§è¡Œä¿®å¤å‘½ä»¤') : reject('&gt; Git æš‚å­˜åŒºæ²¡æœ‰éœ€è¦æ ¡éªŒçš„æ–‡ä»¶ï¼Œè·³è¿‡æ‰§è¡Œ')
      })
    })
  }

  function getNewFiles(files) {
    return files.map(file =&gt; {
      return new Promise((resolve, reject) =&gt; {
        shell.exec(`git log --all --before=${CHECK_TIME} -n1 -- ${file}`, { silent: true }, (code, stdout, stderr) =&gt; {
          resolve({
            newFile: stdout === '' ? true : false,
            file,
          })
        })
      }) 
    })
  }

  function doEsLint(filenames) {
    return Promise.all(filenames).then(res =&gt; {
      const checkFiles = []

      for (const item of res) {
        if (item.newFile) checkFiles.push(item.file)
      }

      if (checkFiles.length) {
        return new Promise((resolve, reject) =&gt; {
          shell.exec(`${ESLINT_PATH} -c ${ESLINTRC_PATH} ${checkFiles.join(' ')} ${isFix ? '--fix': ''}`, { silent: true }, (code, stdout, stderr) =&gt; {
            resolve({
              content: stdout || stderr,
            })
          })
        })
      } else {
        isFix ? reject('&gt; Git æš‚å­˜åŒºæ²¡æœ‰ç¬¦åˆæ–‡ä»¶ï¼Œæ— æ³•æ‰§è¡Œä¿®å¤å‘½ä»¤') : reject('&gt; Git æš‚å­˜åŒºæ²¡æœ‰éœ€è¦æ ¡éªŒçš„æ–‡ä»¶ï¼Œè·³è¿‡æ ¡éªŒ')
      }
    })
  }

  getStatusFile()
    .then(getNewFiles)
    .then(doEsLint)
    .then((res) =&gt; {
      if (isFix) {
        shell.echo('&gt; å·²ä¿®å¤ ES Lintã€Œ ä»£ç é£æ ¼ ã€è­¦å‘Šï¼Œè¯·å†æ¬¡æ£€æŸ¥ä»£ç åæ‰§è¡Œ git add &amp; git commit\n')
      } else if (res &amp;&amp; res.content) {
          shell.echo(`${CYAN_COLOR}${res.content}${CYAN_COLOR}`)
          shell.echo(`${STARTCOLOR}ä»¥ä¸Šä»£ç ä¸ç¬¦åˆä»£ç é£æ ¼ï¼Œè¯·å¤„ç†åå†æäº¤ï¼\n${ENDCOLOR}`)
          shell.echo('ES Lint æ£€æµ‹åˆ°ä»£ç é£æ ¼ä¸ç»Ÿä¸€ï¼Œå¯å‚è€ƒï¼š')
          shell.echo('ES Lint å®˜æ–¹æ–‡æ¡£ï¼šhttps://cn.eslint.org/docs/rules/')
          // shell.echo('æ³¨1ï¼šä¸€é”®ä¿®å¤å¯æ‰§è¡Œ `npm run eslint-fix`ï¼ˆå»ºè®®å°è¯•æ‰‹åŠ¨ä¿®å¤ï¼Œå…»æˆä»£ç é£æ ¼å†ä½¿ç”¨ï¼‰')
          shell.echo('æ³¨2ï¼šå¦‚æœ‰è§„åˆ™æœªè¦†ç›–åˆ°çš„æƒ…å†µï¼Œè¯·è”ç³» lintianhao å¤„ç†\n')
          shell.exit(1)
      } else {
          shell.echo('&gt; ES Lint æ ¡éªŒé€šè¿‡ï¼')
      }
    })
    .catch((msg) =&gt; {
      shell.echo(msg)
    })
}

if (process.argv.includes('--fix')) {
  shell.echo('&gt; ES Lint æ‰§è¡Œä¿®å¤å‘½ä»¤ï¼Œè¯·ç¨ç­‰...')
  checkCode(true)
} else {
  checkGit()
  checkEmail()
  checkConflict()

  shell.echo('&gt; ES Lint æ ¡éªŒä¸­ï¼Œè¯·ç¨ç­‰...')
  checkCode()
}
</code></pre>

<h3 id="pre-merge-commit--pre-push">pre-merge-commit / pre-push</h3>

<pre><code class="language-JS">const shell = require('shelljs')

/**
 * æ ¡éªŒåˆå¹¶çš„åˆ†æ”¯ï¼Œä¸èƒ½å‘ master å’Œ dev åˆ†æ”¯åˆå¹¶ä»£ç 
 */
function checkCommitBranch() {
  let branch = shell.exec('git rev-parse --symbolic --abbrev-ref HEAD', { silent: true }).stdout.trim()
  let forBiddenBranch = ['master', 'dev']
  if (forBiddenBranch.includes(branch)) {
    shell.echo(`&gt; ç¦æ­¢å¾€${forBiddenBranch.join(', ')} merge ä»£ç ï¼Œè¯·ä½¿ç”¨merge requests`)
    shell.exit(1)
  }
}

checkCommitBranch()
</code></pre>

<h2 id="ç‰ˆæœ¬æ§åˆ¶å®è·µ">ç‰ˆæœ¬æ§åˆ¶å®è·µ</h2>

<pre><code class="language-JSON">// package.json
{
  "scripts": {
    "pub": "npm run test &amp;&amp; sh path/git.sh &amp;&amp; sh path/release.sh",
  }
}
</code></pre>

<h3 id="gitsh">git.sh</h3>

<pre><code class="language-SHELL">git checkout dev

check () {
  if test -n "$(git status --porcelain)"; then
    echo 'Unclean working tree. Commit or stash changes first.' &gt;&amp;2;
    exit 128;
  fi

  if ! git fetch --quiet 2&gt;/dev/null; then
    echo 'There was a problem fetching your branch. Run `git fetch` to see more...' &gt;&amp;2;
    exit 128;
  fi

  if test "0" != "$(git rev-list --count --left-only @'{u}'...HEAD)"; then
    echo 'Remote history differ. Please pull changes.' &gt;&amp;2;
    exit 128;
  fi
}


check
echo 'No conflicts.' &gt;&amp;2

git checkout master
git pull
git merge dev
git push --no-verify

check
echo 'merge dev to master.' &gt;&amp;2
</code></pre>

<h3 id="releasesh">release.sh</h3>

<pre><code class="language-SHELL">VERSION_TYPE=('major' 'minor' 'patch')

# package.json version
PACKVERSION=''
PACKVERSIONARR=''

re="\"(version)\": \"([^\"]*)\""
# get package.json version
while read -r l; do
  if [[ $l =~ $re ]]; then
    value="${BASH_REMATCH[2]}"
    PACKVERSION="$value"
  fi
done &lt; package.json

PACKVERSIONARR=(${PACKVERSION//./ })

# version
VERSION=`npx select-version-cli`
read -p "Releasing $VERSION - are you sure? (y/n)" -n 1 -r
echo

if [[ $REPLY =~ ^[Yy]$ ]] &amp;&amp; [[ ! $VERSION =~ '-' ]]; then

  PUBLISHARR=(${VERSION//./ })

  # patch, minor, major
  PUBLISH_TYPE=
  i=0
  while [[ $PUBLISH_TYPE == "" ]]; do
    if [ ${PACKVERSIONARR[i]} -ne ${PUBLISHARR[i]} ]; then
      PUBLISH_TYPE=${VERSION_TYPE[i]}
    fi
    let i+=1
  done
  
  echo "Releasing $VERSION ...$PUBLISH_TYPE"
  
  # æ›´æ–° package.json ç‰ˆæœ¬å·
  npm version $VERSION --message "feat: version $VERSION"

  # build
  VERSION=$VERSION npm run build

  # tag
  if [ $PUBLISH_TYPE == 'minor' ] || [ $PUBLISH_TYPE == 'major' ]; then
    git tag "v$VERSION"
    git push origin refs/tags/"v$VERSION" --no-verify
  fi
  
  # commit 
  git add .
  git commit -m "feat: build $VERSION"
  git push --no-verify

  # publish
  npm publish
else
  echo 'please select patch, minor, major'
fi
</code></pre>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>

<ol>
  <li><a href="https://juejin.im/book/5a1212bc51882531ea64df07/section/5a1212bcf265da431c6fe677">æ˜é‡‘å°å†Œ - ç”¨ npm script æ‰“é€ è¶…æºœçš„å‰ç«¯å·¥ä½œæµ</a> By ç‹ä»•å†›</li>
  <li><a href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html">npm scripts ä½¿ç”¨æŒ‡å—</a> By é˜®ä¸€å³°</li>
  <li><a href="http://www.qcyoung.com/2016/02/28/%E4%BD%BF%E7%94%A8npm%20scripts%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE/#bei-jing">ä½¿ç”¨ npm scripts æ„å»ºé¡¹ç›®</a> By é’æ˜¥æ ·</li>
  <li><a href="https://yarnpkg.com/zh-Hans/docs">yarn å®˜ç½‘</a></li>
  <li><a href="https://jeffjade.com/2017/12/30/135-npm-vs-yarn-detial-memo/">Npm vs Yarn ä¹‹å¤‡å¿˜è¯¦å•</a> By æ™šæ™´å¹½è‰è½©è½©ä¸»</li>
  <li><a href="https://cloud.tencent.com/developer/article/1020507">npm5 æ–°ç‰ˆåŠŸèƒ½ç‰¹æ€§è§£æåŠä¸ yarn è¯„æµ‹å¯¹æ¯”</a> By é©¬é“–</li>
  <li><a href="https://github.com/ragingDream/blog/issues/32">Package.json ä¸­åº“çš„ç‰ˆæœ¬å·è¯¦è§£</a> By ragingDream</li>
  <li><a href="https://stackoverflow.com/questions/12478679/npm-install-vs-update-whats-the-difference">npm install vs. update - whatâ€™s the difference? - stackoverflow</a></li>
  <li><a href="https://medium.com/@maybekatz/introducing-npx-an-npm-package-runner-55f7d4bd282b">Introducing npx: an npm package runner</a> By Kat MarchÃ¡n</li>
  <li><a href="https://cloud.tencent.com/developer/article/1555982">npm install åŸç†åˆ†æ</a> by ConardLi</li>
</ol>
 
<div id="gitalk-container"></div>
<script>
    var gitalk = new Gitalk({
      enable: true,
      clientID: '020f142489f80c92b097',
      clientSecret: '1fa083372b44031cf1b8249251515c4e3d54c69d',
      repo: 'tate-young.github.io',
      owner: 'Tate-Young',
      admin: ['Tate-Young'],
      id: location.pathname,      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
<!-- disqus -->
<!-- <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = 'https://tate-young.github.io/2018/06/27/npm-scripts.html';
        this.page.identifier = '/2018/06/27/npm-scripts';
        this.page.title = 'NPM Scripts';
    };

    (function () { // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document,
            s = d.createElement('script');

        s.src = '//tate.disqus.com/embed.js'; // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript> -->


            <!-- <p class="post-info">
			æœ¬æ–‡ç”± <a href="/">liberxue</a> åˆ›ä½œï¼Œé‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">çŸ¥è¯†å…±äº«ç½²å4.0</a> å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯<br>æœ¬ç«™æ–‡ç« é™¤æ³¨æ˜è½¬è½½/å‡ºå¤„å¤–ï¼Œå‡ä¸ºæœ¬ç«™åŸåˆ›æˆ–ç¿»è¯‘ï¼Œè½¬è½½å‰è¯·åŠ¡å¿…ç½²å<br>æœ€åç¼–è¾‘æ—¶é—´ä¸º:2018-06-27 17:57:00</p> -->
        </div>
    </article>

    <!-- <div class="related-post-lists">
	<div class="post-lists">
		<div class="post-lists-body">
					<div class="post-list-item">
				<div class="post-list-item-container">
					<div class="item-label">
						<div class="item-title"><a href="induction.html">å½’çº³çš„éšæƒ³</a></div>
						<div class="item-meta clearfix">
														<div class="item-meta-ico bg-ico-image" style="background: url('../usr/themes/pinghsu/images/bg-ico.png') no-repeat;background-size: 40px auto;"></div>
	                        							<div class="item-meta-cat"><a href="../category/thoughts/index.html">Thoughts</a></div>
						</div>
					</div>
				</div>
			</div>
				</div>
	</div>
</div> -->

    <!-- <footer class="footer bg-white">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
	 <a class="social segmentfault" target="blank" href="https://segmentfault.com/u/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Segmentfault">Segmentfault</a>
    <a class="social github" target="blank" href="https://github.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="GitHub">GitHub</a>
    <a class="social twitter" target="blank" href="http://twitter.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Twitter">Twitter</a>
     <a class="social stackoverflow" target="blank" href="https://stackoverflow.com/users/6902190/liberxue" title="è®¿é—® LiberXue_stackoverflow" data-hover="StackOverflow">StackOverflow</a>
          <a class="social oschina" target="blank" href="https://my.oschina.net/bolanzw" title="è®¿é—® LiberXue_Oschina" data-hover="Oschina">Oschina</a>
     <a class="social rss" target="blank" href="/feed.xml"title="è®¿é—® LiberXue_RSS" data-hover="RSS">RSS</a>
	</div>
		</div>
	</div>
	<div class="footer-meta">
        <div class="footer-container">
            <div class="meta-item meta-copyright">
                <div class="meta-copyright-info">
                    <a href="/" class="info-logo">
                         <img src="http://localhost:2333/style/images/logo-liberxue.png"   title="è®¿é—® LiberXue_blog" data-hover="LiberXue_blog" alt="LiberXue_blog" /> </a>
                    <div class="info-text">
                        <p>Theme is <a href="http://www.liberxue.com/2017/08/03/Jekyllthemes.html" title="è®¿é—® Jekyll liberxueä¸»é¢˜"  data-hover="Jekyll liberxue"target="_blank">Jekyll liberxue</a> by <a href="http://www.liberxue.com/about" target="_blank">liberxue</a></p>
                        <p>Powered by <a href="http://localhost:2333/tags/#Jekyll" title="Jekyll" data-hover="Jekyll" target="_blank" rel="nofollow">Jekyll</a></p>
                        <p>&copy; 2017 <a href="/feed.xml"  title="è®¿é—® liberxue blog RSS" data-hover="liberxue blog RSS">liberxue blog RSS</a></p>
                        <p>æ€»è®¡æ–‡ç« ï¼šç¯‡</p>
                      <p>æœ¬blogå·²å¼€æºç‚¹å‡»Fork</p><iframe src="http://ghbtns.com/github-btn.html?user=liberxue&repo=liberxue.github.io&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
                    </div>
                </div>
            </div>
            <div class="meta-item meta-posts">
                <h3 class="meta-title">ç½®é¡¶æ–‡ç« </h3>
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
            </div>
            <div class="meta-item meta-comments">
                <h3 class="meta-title">æœ€æ–°æ–‡ç« </h3>
  
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
</div>
		</div>
    </div>
</footer> -->
<script src="//cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>
<script async src="/search/js/520.js"></script>
<script async src="/search/js/gtag.js"></script>
<script async src="/search/live2d/autoload.js"></script>
<!-- <script src="/search/js/canvas.js"></script> -->

<script>
    $(function () {
        setTimeout(function () {
            $('code').removeClass('hljs');
            $('code').removeClass('language');
        }, 90);
    });
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    <!--liberxueconnnet-menu-->
    <div id="directory-content" class="directory-content">
        <div id="directory"></div>
    </div>
    <!--liberxueconnnet-menu-->
    <script>
      const directoryContainer = document.getElementById('directory')
      const postTitle = document.getElementsByClassName('post-title')[0]
      var postDirectoryBuild = function () {
        var postChildren = function children(childNodes, reg) {
          var result = [],
              isReg = typeof reg === 'object',
              isStr = typeof reg === 'string',
              node, i, len;
          for (i = 0, len = childNodes.length; i < len; i++) {
            node = childNodes[i];
            if ((node.nodeType === 1 || node.nodeType === 9) &&
              (!reg ||
                  isReg && reg.test(node.tagName.toLowerCase()) ||
                  isStr && node.tagName.toLowerCase() === reg)) {
                result.push(node);
              }
            }
            return result;
          },
          createPostDirectory = function (article, directory, isDirNum) {
            var contentArr = [],
                titleId = [],
                levelArr, root, level,
                currentList, list, li, link, i, len;
            levelArr = (function (article, contentArr, titleId) {
                  var titleElem = postChildren(article.childNodes, /^h\d$/),
                      levelArr = [],
                      lastNum = 1,
                      lastRevNum = 1,
                      count = 0,
                      guid = 1,
                      id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                      lastRevNum, num, elem;
                  while (titleElem.length) {
                      elem = titleElem.shift();
                      contentArr.push(elem.innerHTML);
                      num = +elem.tagName.match(/\d/)[0];
                      if (num > lastNum) {
                          levelArr.push(1);
                          lastRevNum += 1;
                      } else if (num === lastRevNum ||
                          num > lastRevNum && num <= lastNum) {
                          levelArr.push(0);
                          lastRevNum = lastRevNum;
                      } else if (num < lastRevNum) {
                          levelArr.push(num - lastRevNum);
                          lastRevNum = num;
                      }
                      count += levelArr[levelArr.length - 1];
                      lastNum = num;
                      elem.id = elem.id || (id + guid++);
                      titleId.push(elem.id);
                  }
                  if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                  return levelArr;
              })(article, contentArr, titleId);
              currentList = root = document.createElement('ul');
              dirNum = [0];
              for (i = 0, len = levelArr.length; i < len; i++) {
                  level = levelArr[i];
                  if (level === 1) {
                      list = document.createElement('ul');
                      if (!currentList.lastElementChild) {
                          currentList.appendChild(document.createElement('li'));
                      }
                      currentList.lastElementChild.appendChild(list);
                      currentList = list;
                      dirNum.push(0);
                  } else if (level < 0) {
                      level *= 2;
                      while (level++) {
                          if (level % 2) dirNum.pop();
                          currentList = currentList.parentNode;
                      }
                  }
                  dirNum[dirNum.length - 1]++;
                  li = document.createElement('li');
                  link = document.createElement('a');
                  link.name = '#' + titleId[i];
                  link.href = 'Javascript:;'
                  link.className = "post-aside-anchor"
                  link.title = 'è®¿é—®' + titleId[i];
                  link.innerHTML = !isDirNum ? contentArr[i] :
                      dirNum.join('.') + ' ' + contentArr[i];
                  li.appendChild(link);
                  currentList.appendChild(li);
              }
            directory.appendChild(root);
          };
        createPostDirectory(document.getElementById('post-content'), directoryContainer, true);
      };
      postDirectoryBuild();
    </script>
    <script>
      // gtag('config', GA_TRACKING_ID, {
      //   'page_title' : 'Blog',
      //   'page_path': window.location.pathname,
      //   'post_title': 'watttsdfasdf',
      // });

    </script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        lang = hljs.initHighlightingOnLoad();
    </script>
</body>

</html>
