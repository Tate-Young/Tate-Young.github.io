
<!DOCTYPE>
<html lang="zh-cn" data-scribe-reduced-action-queue="true">
<head>
    <meta content='Node 常用模块 - Tate & Snow' name='title' />
    <meta content='Node 常用模块 - Tate & Snow' name='og:title' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <title>Node 常用模块 - Tate & Snow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Node 常用模块 - Tate & Snow</title>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Node 常用模块 - Tate & Snow">
<meta name="twitter:keywords" content="Node 常用模块 - Tate & Snow" property='og:description' />
<meta property="og:type" content="article">
<meta property="og:title" content="Node 常用模块 - Tate & Snow">
<meta name="og:keywords" content="Node 常用模块 - Tate & Snow|Node 常用模块本节涉及的常用模块            Node 模块      描述                  global      全局对象              path      用于处理文件与目录的路径  ..."
  property='og:description' />
<link rel="icon" type="image/png" href="http://localhost:2333/style/favicons/favicon.ico" />
<link href="http://localhost:2333/style/favicons/favicon.ico" rel="shortcut icon" type="image/png">
<link rel="canonical" href="http://localhost:2333/">
<link rel="alternate" type="application/rss+xml" title="Liberxue" href="http://localhost:2333/feed.xml">
<meta charset="UTF-8">
<link rel="manifest" href="/manifest.json">
<link rel="shortcut icon" href="http://localhost:2333/style/favicons/favicon.ico" type="image/x-icon">
<meta name="keywords" content="Node 常用模块本节涉及的常用模块            Node 模块      描述                  global      全局对象              path      用于处理文件与目录的路径  ..." property='og:description'
/>
<meta name="description" content="Tate & Snow's Github blog" />
<link href="https://cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
<link href="http://localhost:2333/style/theme.css" rel="stylesheet"> 
<meta content='http://localhost:2333/2018/04/08/node-property.html' property='og:url' />
<meta content="http://localhost:2333/2018/04/08/node-property.html|Node 常用模块本节涉及的常用模块            Node 模块      描述                  global      全局对象              path      用于处理文件与目录的路径  ..." property='og:description'
/>
<meta content="article" property="og:type" /> 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136311746-1"></script>
<!-- <script async src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
<script>
  window.dataLayer = window.dataLayer || [];
  window.GA_TRACKING_ID = 'UA-136311746-1'
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('set', {
    'country': 'US',
    'currency': 'USD',
    'description': 'fuck',
  });
  gtag('config', GA_TRACKING_ID, {
    'custom_map': {
      'dimension1': 'post_title',
    },
    'post_title': 'test',
  });
</script>
<meta content="" property="fb:app_id" />
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Node 常用模块 | Tate &amp; Snow</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Node 常用模块" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Node 常用模块" />
<meta property="og:description" content="Node 常用模块" />
<link rel="canonical" href="http://localhost:2333/2018/04/08/node-property.html" />
<meta property="og:url" content="http://localhost:2333/2018/04/08/node-property.html" />
<meta property="og:site_name" content="Tate &amp; Snow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-04-08T10:54:00+08:00" />
<script type="application/ld+json">
{"description":"Node 常用模块","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:2333/2018/04/08/node-property.html"},"@type":"BlogPosting","url":"http://localhost:2333/2018/04/08/node-property.html","headline":"Node 常用模块","dateModified":"2018-04-08T10:54:00+08:00","datePublished":"2018-04-08T10:54:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<script>
  (function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

</head>

<body class="dark-theme" gtools_scp_screen_capture_injected="true">
    <header id="header" class="header bg-white">
        <div class="navbar-container">
            <a href="Javascript:;" onclick="onClickLogo()" title="访问 Tate & Snow" class="navbar-logo menu-logo">
                <img src="http://localhost:2333/style/images/tate.png" alt="Tate & Snow"> </a>
            <!-- <a href="/?tate" title="访问 Tate & Snow" class="navbar-logo">Tate & Snow</a>   -->
            <div class="navbar-menu">
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('首页', '/')" title="访问 首页" data-hover="首页">首页</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('前端', '/front')" title="访问 前端" data-hover="前端">前端</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('历史', '/history')" title="访问 历史" data-hover="历史">历史</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('其他', '/other')" title="访问 其他" data-hover="其他">其他</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('标签', '/tags')" title="访问 标签" data-hover="标签">标签</a>
                
                  <a class=" menu-item-about " href="Javascript:;" onclick="onClickMenu('关于', '/README')" title="访问 关于" data-hover="关于">关于</a>
                
            </div>
            <!-- <div class="navbar-menu">
                
                <a href="http://localhost:2333/">首页</a>
                
                <a href="http://localhost:2333/front">前端</a>
                
                <a href="http://localhost:2333/history">历史</a>
                
                <a href="http://localhost:2333/other">其他</a>
                
                <a href="http://localhost:2333/tags">标签</a>
                
                <a href="http://localhost:2333/README">关于</a>
                
            </div> -->
            <div class="navbar-search menu-item-search" onclick="onClickSearch()">
                <span class="icon-search"></span>
                <form id="cb-search-btn" role="search">
                    <span class="search-box">
                        <input type="text" class="input" id="cb-search-content" required="true" placeholder="标题 标签..." maxlength="30" autocomplete="off">
                    </span>
                </form>
            </div>
            <div class="navbar-mobile-menu" onclick="">
                <span class="icon-menu cross">
                    <span class="middle"></span>
                </span>
                <ul>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('首页', 'http://localhost:2333/')">首页</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('前端', 'http://localhost:2333/front')">前端</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('历史', 'http://localhost:2333/history')">历史</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('其他', 'http://localhost:2333/other')">其他</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('标签', 'http://localhost:2333/tags')">标签</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('关于', 'http://localhost:2333/README')">关于</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </header>
    <a href="#header" class="back-to-top" onclick="onClickTop('Node 常用模块')">⤴Top⤴</a>
    <div class="post-header-thumb bg-white}">
        <div class="post-header-thumb-op"></div>
        <div class="post-header-thumb">
            <div class="post-header-thumb-container">
                <h1 class="post-title" itemprop="name headline">
                    Node 常用模块</h1>
                <div class="post-data">
                    <time datetime="2018-04-08 10:54:00" itemprop="datePublished">
                      发布时间：2018-04-08 10:54:00
                      &nbsp;&nbsp;&nbsp;
                      
                        修改时间：2019-10-28 11:17:00
                      
                    </time>
                    <a onclick="onClickCategory('后端')" href="Javascript:;" title="访问 后端" data-hover="博客分类: 后端">博客分类: 后端</a>
                    <!-- <a href="#read"> 阅读次数: comments</a>  -->
                </div>
                
                <div class="post-tags">
                       
                    <a class="menu-item-tags" href="Javascript:;" onclick="onClickTag('Node')" title="访问Node" data-hover="Node">
                        Node
                        <span>(9)</span>
                        
                    </a>
                       
                </div>
            </div>
        </div>
    </div>
    <article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
        <div class="post-header">
            <h1 class="post-title" itemprop="name headline">
                Node 常用模块</h1>
            <div class="post-data">
                <time datetime="2018-04-08 10:54:00" itemprop="datePublished">2018-04-08 10:54:00</time>
            </div>
        </div>
        <div id="post-content" class="post-content" itemprop="articleBody">
            <p class="post-tags">
                   
                <a href="Javascript:;" onclick="onClickTag('Node')" title="访问Node" data-hover="Node">
                    Node
                    <span>(9)</span>
                    </a>
                   
            </p>
            <h1 id="node-常用模块">Node 常用模块</h1>

<h2 id="本节涉及的常用模块">本节涉及的常用模块</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Node 模块</th>
      <th style="text-align: left">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong><a href="#global-对象">global</a></strong></td>
      <td style="text-align: left">全局对象</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="#path-模块">path</a></strong></td>
      <td style="text-align: left">用于处理文件与目录的路径</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="#fs-模块">fs</a></strong></td>
      <td style="text-align: left">对系统文件及目录进行读写操作</td>
    </tr>
  </tbody>
</table>

<h2 id="global-对象">global 对象</h2>

<p>通过 global 对象可以设置全局变量，内置的常用全局变量有:</p>

<h3 id="__dirname--__filename">__dirname / __filename</h3>

<ul>
  <li><strong>__dirname</strong> - 当前模块的文件夹名称。等同于 __filename 的 path.dirname() 的值</li>
  <li><strong>__filename</strong> - 当前模块的文件名称解析后的绝对路径</li>
</ul>

<p>举个栗子，运行位于 /Users/mjr 目录下的 example.js 文件:</p>

<pre><code class="language-JS">console.log(__dirname)
// Prints: /Users/mjr
console.log(path.dirname(__filename))
// Prints: /Users/mjr
console.log(__filename)
// Prints: /Users/mjr/example.js
</code></pre>

<h3 id="exports--moduleexports">exports / module.exports</h3>

<ul>
  <li><strong>exports</strong> - 对于 module.exports 的更简短的引用形式</li>
  <li><strong>module.exports</strong> - 指定一个模块导出的内容</li>
</ul>

<p>两者的区别如下:</p>

<ul>
  <li>exports 是指向 module.exports 的引用</li>
  <li>module.exports 初始值为一个空对象 {}</li>
  <li>require() 返回的是 module.exports 而不是 exports</li>
</ul>

<p><img src="https://dn-cnode.qbox.me/FjN9jHWiy-yuUtghTUlRgB_0cgUC" alt="module.exports" /></p>

<h3 id="process">process</h3>

<p>process 进程有以下几个常用属性:</p>

<ul>
  <li><strong>argv</strong> - 包含命令行参数的数组</li>
  <li><strong>env</strong> - 获取当前系统环境信息的对象</li>
  <li><strong>versions</strong> - 返回一个对象，此对象列出了 Node 和其依赖的版本信息；<strong>version</strong> 则只返回 Node 版本号</li>
  <li><strong>platform</strong> - 返回 Node 程运行其上的操作系统平台</li>
</ul>

<pre><code class="language-JS">// 执行 node index.js name='tate'
console.log(process.argv)
// ['/usr/local/Cellar/node/9.3.0_1/bin/node', '/Users/tate/testS/index.js', 'name=tate']
</code></pre>

<p>process.env 可以配合跨平台插件 <strong><a href="https://github.com/kentcdodds/cross-env">cross-env</a></strong> 进行设置环境变量:</p>

<pre><code class="language-JS">// 执行 cross-env ENV=dev node index.js
console.log(process.env.ENV)
// dev 可根据该变量确定是否为开发环境
</code></pre>

<p>process 进程有以下几个常用的方法:</p>

<ul>
  <li><strong>cwd()</strong> - 返回 Node 进程当前工作的目录</li>
  <li><strong>exit([code])</strong> - 终止进程，可以接受一个参数，表示结束状态码，默认为 0，可以<a href="http://nodejs.cn/api/process.html#process_process_exit_code">参考状态码 exit code</a></li>
  <li><strong>nextTick(callback[, …args])</strong> - 将 callback 添加到 “next tick 队列”。一旦当前事件轮询队列的任务全部完成，在 next tick 队列中的所有 callbacks 会被依次调用，有关 Node 事件循环<a href="http://localhost:2333/2018/04/21/node-event-loop.html">可参考这里</a></li>
</ul>

<p>执行 <code class="highlighter-rouge">process.exit()</code> 终止进程时或 Node 事件循环数组中不再有额外的工作，会触发 exit 事件:</p>

<pre><code class="language-JS">// 'exit' 事件监听器的回调函数，只允许包含同步操作
process.on('exit', (code) =&gt; {
  console.log(`即将退出，退出码：${code}`);
});
</code></pre>

<h2 id="path-模块">path 模块</h2>

<pre><code class="language-JS">const path = require('path');
</code></pre>

<p><strong>path</strong> 用于处理文件与目录的路径，常用的属性及方法有:</p>

<ul>
  <li><strong>basename(p, [ext])</strong> - 返回 path 的文件名，提取出用 ‘/’ 隔开的 path 的最后一部分</li>
  <li><strong>dirname(p)</strong> - 返回 path 的目录名</li>
  <li><strong>extname(p)</strong> - 返回 path 的扩展名</li>
  <li><strong>join([p1], [p2], […])</strong> - 将多个参数拼接成一个 path，拼接时会执行 normalize 方法</li>
  <li><strong>resolve</strong> - 把一个路径或路径片段的序列解析为一个绝对路径，如果处理完全部给定的 path 片段后还未生成一个绝对路径，则当前工作目录会被用上</li>
  <li><strong>normalize(p)</strong> - 会规范化给定的 path，并解析 ‘..’ 和 ‘.’ 片段</li>
  <li><strong>format()</strong> - 从一个对象返回一个路径字符串，与 parse() 相反，对象包含 dir/root/base/name/ext 几个属性</li>
  <li><strong>parse()</strong> - 返回一个对象，对象的属性表示 path 的元素</li>
  <li><strong>sep</strong> - 路径片段分隔符，常用的是通过 <code class="highlighter-rouge">split(path.sep)</code> 分割成数组</li>
</ul>

<p>示例如下:</p>

<h3 id="basename">basename</h3>

<p>basename(p, [ext])，参数 p 是要处理的 path，可选参数 ext 是要过滤的字符:</p>

<pre><code class="language-JS">path.basename('/foo/bar/baz/asdf/quux.html'); // 返回: 'quux.html'
path.basename('/foo/bar/baz/asdf/quux.html', '.html'); // 返回: 'quux'
</code></pre>

<pre><code class="language-JS">path.dirname('/foo/bar/baz/asdf/quux'); // 返回: '/foo/bar/baz/asdf'
path.extname('index.coffee.md'); // 返回: '.md'
</code></pre>

<h3 id="join--resolve">join / resolve</h3>

<p>join([p1], [p2], […]) 将多个参数拼接成一个 path，拼接时会执行 normalize 方法:</p>

<pre><code class="language-JS">path.join('/foo', 'bar', 'baz/asdf', 'quux', '..'); // 返回: '/foo/bar/baz/asdf'

path.normalize('/foo/bar//baz/asdf/quux/..'); // 返回: '/foo/bar/baz/asdf'
</code></pre>

<p>resolve() 把一个路径或路径片段的序列解析为一个绝对路径，方向为从右向左，如果处理完全部给定的 path 片段后还未生成一个绝对路径，则当前工作目录会被用上:</p>

<pre><code class="language-JS">path.resolve('/foo', '/bar', 'baz'); // 'bar/baz' 从右到左解析，直到有完整的绝对路径为止

path.resolve('wwwroot', 'static_files/png/', '../gif/image.gif');
// 如果当前工作目录为 /home/myself/node
// 由于未生成一个绝对路径，则返回 '/home/myself/node/wwwroot/static_files/gif/image.gif'
</code></pre>

<h3 id="format--parse">format / parse</h3>

<pre><code class="language-JS">path.format({
  root: '/ignored', // 忽略
  dir: '/home/user/dir',
  base: 'file.txt'
});
// 返回: '/home/user/dir/file.txt'
</code></pre>

<pre><code class="language-JS">path.parse('/home/user/dir/file.txt');
// 返回:
// { root: '/',
//   dir: '/home/user/dir',
//   base: 'file.txt',
//   ext: '.txt',
//   name: 'file' }
</code></pre>

<pre><code class="language-TXT">┌─────────────────────┬────────────┐
│          dir        │    base    │
├──────┬              ├──────┬─────┤
│ root │              │ name │ ext │
"  /    home/user/dir / file  .txt "
└──────┴──────────────┴──────┴─────┘
</code></pre>

<h3 id="sep">sep</h3>

<p>sep 表示路径片段分隔符，windows 为 \，macOS 为 /:</p>

<pre><code class="language-JS">'foo/bar/baz'.split(path.sep); // 返回: ['foo', 'bar', 'baz']
</code></pre>

<h2 id="fs-模块">fs 模块</h2>

<pre><code class="language-JS">const fs = require('fs');
</code></pre>

<p><strong>fs</strong> 对系统文件及目录进行读写操作，常用的属性及方法有:</p>

<ul>
  <li><strong>open</strong>(path, flags[, mode], callback) - 打开文件</li>
  <li><strong>read</strong>(fd, buffer, offset, length, position, callback) - 读取文件，会将文件内容读取 buffer 对象中</li>
  <li><strong>write</strong>(fd, buffer, offset, length[, position], callback - 写入文件</li>
  <li><strong>close</strong>(fd, callback) - 关闭文件</li>
</ul>

<p>以上是基于底层的操作，更便捷的文件操作如下，不用打开和关闭文件:</p>

<ul>
  <li><strong>readFile</strong>(file[, options], callback) - 读取文件，读取文件流 createReadStream</li>
  <li><strong>writeFile</strong>(file, data[, options], callback) - 写入文件，写入文件流 createWriteStream</li>
  <li><strong>appendFile</strong>(filename, data, [options], callback) - 追加文件，若文件不存在则创建</li>
  <li><strong>access</strong>(path, callback) - 代替 exists，判断文件是否存在，还可以用来判断文件的权限</li>
  <li><strong>unlink</strong>(path, callback) - 删除文件</li>
  <li><strong>rename</strong>(oldPath, newPath, callback) - 重命名文件</li>
  <li><strong>stat</strong>(path, callback(err, stats)) - 文件信息，会将 stats 类的实例返回给其回调函数。可通过 stats 类中的提供方法判断文件的相关属性</li>
  <li><strong>watch</strong>(filename[, options][, listener]) - 监视 filename 的变化，filename 可以是一个文件或一个目录。返回一个 fs.FSWatcher 对象</li>
</ul>

<p>目录操作有如下方法:</p>

<ul>
  <li><strong>mkdir</strong>(path[, mode], callback) - 创建目录</li>
  <li><strong>rmdir</strong>(path, callback) - 删除目录</li>
  <li><strong>readdir</strong>(path[, options], callback) - 读取目录</li>
</ul>

<p>以上皆为异步方法，同步方法为 “方法名 + Sync”，一般情况下不建议使用。示例如下:</p>

<h3 id="open--close">open / close</h3>

<p>open(path, flags[, mode], callback) 中 flags 的取值有:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">flags</th>
      <th style="text-align: left">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">r</td>
      <td style="text-align: left">以读取模式打开文件。如果文件不存在抛出异常</td>
    </tr>
    <tr>
      <td style="text-align: left">r+</td>
      <td style="text-align: left">以读写模式打开文件。如果文件不存在抛出异常</td>
    </tr>
    <tr>
      <td style="text-align: left">rs</td>
      <td style="text-align: left">以同步的方式读取文件</td>
    </tr>
    <tr>
      <td style="text-align: left">rs+</td>
      <td style="text-align: left">以同步的方式读取和写入文件</td>
    </tr>
    <tr>
      <td style="text-align: left">w</td>
      <td style="text-align: left">以写入模式打开文件，如果文件不存在则创建</td>
    </tr>
    <tr>
      <td style="text-align: left">wx</td>
      <td style="text-align: left">类似 ‘w’，但是如果文件路径存在，则文件写入失败</td>
    </tr>
    <tr>
      <td style="text-align: left">w+</td>
      <td style="text-align: left">以读写模式打开文件，如果文件不存在则创建</td>
    </tr>
    <tr>
      <td style="text-align: left">wx+</td>
      <td style="text-align: left">类似 ‘w+’， 但是如果文件路径存在，则文件读写失败</td>
    </tr>
    <tr>
      <td style="text-align: left">a</td>
      <td style="text-align: left">以追加模式打开文件，如果文件不存在则创建</td>
    </tr>
    <tr>
      <td style="text-align: left">ax</td>
      <td style="text-align: left">类似 ‘a’， 但是如果文件路径存在，则文件追加失败</td>
    </tr>
    <tr>
      <td style="text-align: left">a+</td>
      <td style="text-align: left">以读取追加模式打开文件，如果文件不存在则创建</td>
    </tr>
    <tr>
      <td style="text-align: left">ax+</td>
      <td style="text-align: left">类似 ‘a+’， 但是如果文件路径存在，则文件读取追加失败</td>
    </tr>
  </tbody>
</table>

<pre><code class="language-JS">fs.open('input.txt', 'r+', function(err, fd) {
  if (err) {
    /* handle error */
  } else {
    fs.close(fd, function(err) {
      if (err){ console.log(err) }
      console.log("文件关闭成功")
    })
  }
})
</code></pre>

<h3 id="readfile--createfilestream">readFile / createFileStream</h3>

<p>readFile(file[, options], callback) 用于读取文件，options 该参数是一个对象，包含 {encoding, flag}:</p>

<pre><code class="language-JS">fs.readFile(filename, 'utf8', function(err, data) {
  if(err){
    console.log('文件读取失败');
  }else{
    // console.log(data); // 若没设置编码方式，则默认为 buffer 类型: &lt;Buffer 54 61 74 65 20 26 20 53 6e 6f 77 0a&gt;
    console.log(data.toString()); // 'Tate &amp; Snow'
  }
});
</code></pre>

<p>对于大的文件，可采用文件流进行操作，如方法 <strong>createReadStream</strong> 和 <strong>createWriteStream</strong>:</p>

<pre><code class="language-JS">var readStream = fs.createReadStream('input.txt', 'utf8');

readStream
  .on('data', function(chunk) {
    console.log('读取数据: ' + chunk);
  })
  .on('error', function(err) {
    console.log('抛出异常: ' + err.message);
  })
  .on('end', function() { // 数据传输完毕
    console.log('end');
  })
  .on('close', function() { // 已经关闭，不会再有事件抛出
    console.log('已经关闭');
  });
</code></pre>

<pre><code class="language-JS">var writeStream = fs.createWriteStream('input.txt', 'utf8');

writeStream
  .on('close', function() {  // 已经关闭，不会再有事件抛出
    console.log('已经关闭');
  });

writeStream.write('hello');
writeStream.write('world');
writeStream.end('');
</code></pre>

<h3 id="stat">stat</h3>

<p>stat(path, callback) 查看文件信息，会将 stats 类的实例返回给其回调函数。stats 类的方法有:</p>

<ul>
  <li><strong>isFile()</strong> - 如果是文件返回 true，否则返回 false</li>
  <li><strong>isDirectory()</strong> - 如果是目录返回 true，否则返回 false</li>
  <li><strong>isBlockDevice()</strong> - 如果是块设备返回 true，否则返回 false</li>
  <li><strong>isCharacterDevice()</strong> - 如果是字符设备返回 true，否则返回 false</li>
  <li><strong>isSymbolicLink()</strong> - 如果是软链接返回 true，否则返回 false</li>
  <li><strong>isFIFO()</strong> - 如果是 FIFO，返回 true，否则返回 false。FIFO 是 UNIX 中的一种特殊类型的命令管道</li>
  <li><strong>isSocket()</strong> - 如果是 Socket 返回 true，否则返回 false</li>
</ul>

<h3 id="遍历目录">遍历目录</h3>

<p>使用 fs 模块遍历目录的同步和异步写法:</p>

<pre><code class="language-JS">// 同步写法
function travel(dir, callback) {
  fs.readdirSync(dir).forEach(function(file) {
    var pathname = path.join(dir, file);

    if (fs.statSync(pathname).isDirectory()) {
      travel(pathname, callback);
    } else {
      callback(pathname);
    }
  });
}
</code></pre>

<pre><code class="language-JS">// 异步写法
function travel(dir, callback, finish) {
  fs.readdir(dir, function(err, files) {
    (function next(i) {
      if (i &lt; files.length) {
        var pathname = path.join(dir, files[i]);

        fs.stat(pathname, function(err, stats) {
          if (stats.isDirectory()) {
            travel(pathname, callback, function() {
              next(i + 1);
            });
          } else {
            callback(pathname, function () {
              next(i + 1);
            });
          }
        });
      } else {
        finish &amp;&amp; finish();
      }
    }(0));
  });
}
</code></pre>

<h2 id="流-stream">流 stream</h2>

<p><strong>流</strong>是数据的集合，类似于数组或字符串。区别在于流中的数据可能不会同时全部可用，并且不用全部放入内存。这使得流在操作大量数据或是数据从外部来源逐段发送过来的时候变得非常有用。然而，流的作用并不仅限于操作大量数据，它还带给我们组合代码的能力。就像我们可以通过管道连接几个简单的 Linux 命令以组合出强大的功能一样，我们可以利用流在 Node 中做同样的事:</p>

<pre><code class="language-JS">a.pipe(b).pipe(c).pipe(d)

// 等价于:
a.pipe(b)
b.pipe(c)
c.pipe(d)

// 在 Linux 中，等价于：
a | b | c | d
</code></pre>

<p>在 Node 中有四种基本类型的流，所有的流都是 <strong>EventEmitter</strong> 的实例，它们发出可用于读取或写入数据的事件。另一方面我们可以利用 <strong>pipe</strong> 方法以一种更简单的方式使用流中的数据:</p>

<ul>
  <li><strong>可读流</strong> - 对一个可以读取数据的源的抽象。如 <code class="highlighter-rouge">fs.createReadStream</code></li>
  <li><strong>可写流</strong> - 对一个可以写入数据的目标的抽象。如 <code class="highlighter-rouge">fs.createWriteStream</code></li>
  <li><strong>双向流</strong> - 既是可读的，又是可写的。如 TCP socket</li>
  <li><strong>变换流</strong> - 一种特殊的双向流，它会基于写入的数据生成可供读取的数据。如使用 <code class="highlighter-rouge">zlib.createGzip</code> 来压缩数据。你可以把一个变换流想象成一个函数，这个函数的输入部分对应可写流，输出部分对应可读流</li>
</ul>

<p><img src="https://cdn-media-1.freecodecamp.org/images/1*HGXpeiF5-hJrOk_8tT2jFA.png" alt="eventemitter" /></p>

<pre><code class="language-JS">// 使用事件来模拟 pipe 读取、写入数据
// readable.pipe(writable)

readable.on('data', (chunk) =&gt; {
  writable.write(chunk);
});

readable.on('end', () =&gt; {
  writable.end();
});
</code></pre>

<p>我们对数据流的具体使用举个栗子，先通过 fs 模块使用流接口读取和写入比较大的文件:</p>

<pre><code class="language-JS">const fs = require('fs');
const file = fs.createWriteStream('./big.file');

for(let i=0; i&lt;= 1e6; i++) {
  file.write('Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n');
}

file.end();
</code></pre>

<p>然后我们在服务端收到请求后，通过异步方法 <code class="highlighter-rouge">fs.readFile</code> 读取文件内容发送给客户端:</p>

<pre><code class="language-JS">const fs = require('fs');
const server = require('http').createServer();

server.on('request', (req, res) =&gt; {
  fs.readFile('./big.file', (err, data) =&gt; {
    if (err) throw err;

    res.end(data);
  });
});

server.listen(8000);
</code></pre>

<p>当我们在客户端请求时，会发现此刻服务器内存暴增，非常低效。HTTP 响应对象也是一个可写流，这意味着如果我们有一个代表了 <code class="highlighter-rouge">big.file</code> 内容的可读流，就可以将两个流连接起来以实现相同的功能，并且性能上更优:</p>

<pre><code class="language-JS">const fs = require('fs');
const server = require('http').createServer();

server.on('request', (req, res) =&gt; {
  const src = fs.createReadStream('./big.file');
  src.pipe(res);
});

server.listen(8000);
</code></pre>

<blockquote>
  <p>我们还可以通过 <strong>stream</strong> 模块来自定义流接口。更多关于流的分析，请<a href="https://www.freecodecamp.org/news/node-js-streams-everything-you-need-to-know-c9141306be93/">参考这篇文章</a> 👈</p>
</blockquote>

<h2 id="参考链接">参考链接</h2>

<ol>
  <li><a href="https://www.cnblogs.com/xiaohuochai/p/6938104.html">nodeJS 之 fs 文件系统</a> By 小火柴的蓝色理想</li>
  <li><a href="http://nqdeng.github.io/7-days-nodejs/#3.2.4">七天学会 NodeJS</a></li>
  <li><a href="https://github.com/chyingp/nodejs-learning-guide/blob/master/%E6%A8%A1%E5%9D%97/fs.md">nodejs-learning-guide</a> By chyingp</li>
  <li><a href="https://www.jianshu.com/p/dde6a01c4094">5 分钟让你明白“软链接”和“硬链接”的区别</a> By Cyandev</li>
  <li><a href="https://cnodejs.org/topic/5231a630101e574521e45ef8">exports 和 module.exports 的区别</a> By nswbmw</li>
  <li><a href="https://cnodejs.org/topic/5734017ac3e4ef7657ab1215">module.exports 与 exports 的区别解释【极简版】这还看不懂就没救了。。。</a> By lellansin</li>
  <li><a href="https://www.freecodecamp.org/news/node-js-streams-everything-you-need-to-know-c9141306be93/">Node.js Streams: Everything you need to know</a> By Samer Buna</li>
</ol>
 
<div id="gitalk-container"></div>
<script>
    var gitalk = new Gitalk({
      enable: true,
      clientID: '020f142489f80c92b097',
      clientSecret: '1fa083372b44031cf1b8249251515c4e3d54c69d',
      repo: 'tate-young.github.io',
      owner: 'Tate-Young',
      admin: ['Tate-Young'],
      id: location.pathname,      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
<!-- disqus -->
<!-- <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = 'https://tate-young.github.io/2018/04/08/node-property.html';
        this.page.identifier = '/2018/04/08/node-property';
        this.page.title = 'Node 常用模块';
    };

    (function () { // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document,
            s = d.createElement('script');

        s.src = '//tate.disqus.com/embed.js'; // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript> -->


            <!-- <p class="post-info">
			本文由 <a href="/">liberxue</a> 创作，采用 <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">知识共享署名4.0</a> 国际许可协议进行许可<br>本站文章除注明转载/出处外，均为本站原创或翻译，转载前请务必署名<br>最后编辑时间为:2018-04-08 10:54:00</p> -->
        </div>
    </article>

    <!-- <div class="related-post-lists">
	<div class="post-lists">
		<div class="post-lists-body">
					<div class="post-list-item">
				<div class="post-list-item-container">
					<div class="item-label">
						<div class="item-title"><a href="induction.html">归纳的随想</a></div>
						<div class="item-meta clearfix">
														<div class="item-meta-ico bg-ico-image" style="background: url('../usr/themes/pinghsu/images/bg-ico.png') no-repeat;background-size: 40px auto;"></div>
	                        							<div class="item-meta-cat"><a href="../category/thoughts/index.html">Thoughts</a></div>
						</div>
					</div>
				</div>
			</div>
				</div>
	</div>
</div> -->

    <!-- <footer class="footer bg-white">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
	 <a class="social segmentfault" target="blank" href="https://segmentfault.com/u/liberxue" title="访问 LiberXue_Twitter" data-hover="Segmentfault">Segmentfault</a>
    <a class="social github" target="blank" href="https://github.com/liberxue" title="访问 LiberXue_Twitter" data-hover="GitHub">GitHub</a>
    <a class="social twitter" target="blank" href="http://twitter.com/liberxue" title="访问 LiberXue_Twitter" data-hover="Twitter">Twitter</a>
     <a class="social stackoverflow" target="blank" href="https://stackoverflow.com/users/6902190/liberxue" title="访问 LiberXue_stackoverflow" data-hover="StackOverflow">StackOverflow</a>
          <a class="social oschina" target="blank" href="https://my.oschina.net/bolanzw" title="访问 LiberXue_Oschina" data-hover="Oschina">Oschina</a>
     <a class="social rss" target="blank" href="/feed.xml"title="访问 LiberXue_RSS" data-hover="RSS">RSS</a>
	</div>
		</div>
	</div>
	<div class="footer-meta">
        <div class="footer-container">
            <div class="meta-item meta-copyright">
                <div class="meta-copyright-info">
                    <a href="/" class="info-logo">
                         <img src="http://localhost:2333/style/images/logo-liberxue.png"   title="访问 LiberXue_blog" data-hover="LiberXue_blog" alt="LiberXue_blog" /> </a>
                    <div class="info-text">
                        <p>Theme is <a href="http://www.liberxue.com/2017/08/03/Jekyllthemes.html" title="访问 Jekyll liberxue主题"  data-hover="Jekyll liberxue"target="_blank">Jekyll liberxue</a> by <a href="http://www.liberxue.com/about" target="_blank">liberxue</a></p>
                        <p>Powered by <a href="http://localhost:2333/tags/#Jekyll" title="Jekyll" data-hover="Jekyll" target="_blank" rel="nofollow">Jekyll</a></p>
                        <p>&copy; 2017 <a href="/feed.xml"  title="访问 liberxue blog RSS" data-hover="liberxue blog RSS">liberxue blog RSS</a></p>
                        <p>总计文章：篇</p>
                      <p>本blog已开源点击Fork</p><iframe src="http://ghbtns.com/github-btn.html?user=liberxue&repo=liberxue.github.io&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
                    </div>
                </div>
            </div>
            <div class="meta-item meta-posts">
                <h3 class="meta-title">置顶文章</h3>
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
            </div>
            <div class="meta-item meta-comments">
                <h3 class="meta-title">最新文章</h3>
  
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
</div>
		</div>
    </div>
</footer> -->
<script src="//cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>
<script async src="/search/js/520.js"></script>
<script async src="/search/js/gtag.js"></script>
<script async src="/search/live2d/autoload.js"></script>
<!-- <script src="/search/js/canvas.js"></script> -->

<script>
    $(function () {
        setTimeout(function () {
            $('code').removeClass('hljs');
            $('code').removeClass('language');
        }, 90);
    });
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    <!--liberxueconnnet-menu-->
    <div id="directory-content" class="directory-content">
        <div id="directory"></div>
    </div>
    <!--liberxueconnnet-menu-->
    <script>
      const directoryContainer = document.getElementById('directory')
      const postTitle = document.getElementsByClassName('post-title')[0]
      var postDirectoryBuild = function () {
        var postChildren = function children(childNodes, reg) {
          var result = [],
              isReg = typeof reg === 'object',
              isStr = typeof reg === 'string',
              node, i, len;
          for (i = 0, len = childNodes.length; i < len; i++) {
            node = childNodes[i];
            if ((node.nodeType === 1 || node.nodeType === 9) &&
              (!reg ||
                  isReg && reg.test(node.tagName.toLowerCase()) ||
                  isStr && node.tagName.toLowerCase() === reg)) {
                result.push(node);
              }
            }
            return result;
          },
          createPostDirectory = function (article, directory, isDirNum) {
            var contentArr = [],
                titleId = [],
                levelArr, root, level,
                currentList, list, li, link, i, len;
            levelArr = (function (article, contentArr, titleId) {
                  var titleElem = postChildren(article.childNodes, /^h\d$/),
                      levelArr = [],
                      lastNum = 1,
                      lastRevNum = 1,
                      count = 0,
                      guid = 1,
                      id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                      lastRevNum, num, elem;
                  while (titleElem.length) {
                      elem = titleElem.shift();
                      contentArr.push(elem.innerHTML);
                      num = +elem.tagName.match(/\d/)[0];
                      if (num > lastNum) {
                          levelArr.push(1);
                          lastRevNum += 1;
                      } else if (num === lastRevNum ||
                          num > lastRevNum && num <= lastNum) {
                          levelArr.push(0);
                          lastRevNum = lastRevNum;
                      } else if (num < lastRevNum) {
                          levelArr.push(num - lastRevNum);
                          lastRevNum = num;
                      }
                      count += levelArr[levelArr.length - 1];
                      lastNum = num;
                      elem.id = elem.id || (id + guid++);
                      titleId.push(elem.id);
                  }
                  if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                  return levelArr;
              })(article, contentArr, titleId);
              currentList = root = document.createElement('ul');
              dirNum = [0];
              for (i = 0, len = levelArr.length; i < len; i++) {
                  level = levelArr[i];
                  if (level === 1) {
                      list = document.createElement('ul');
                      if (!currentList.lastElementChild) {
                          currentList.appendChild(document.createElement('li'));
                      }
                      currentList.lastElementChild.appendChild(list);
                      currentList = list;
                      dirNum.push(0);
                  } else if (level < 0) {
                      level *= 2;
                      while (level++) {
                          if (level % 2) dirNum.pop();
                          currentList = currentList.parentNode;
                      }
                  }
                  dirNum[dirNum.length - 1]++;
                  li = document.createElement('li');
                  link = document.createElement('a');
                  link.name = '#' + titleId[i];
                  link.href = 'Javascript:;'
                  link.className = "post-aside-anchor"
                  link.title = '访问' + titleId[i];
                  link.innerHTML = !isDirNum ? contentArr[i] :
                      dirNum.join('.') + ' ' + contentArr[i];
                  li.appendChild(link);
                  currentList.appendChild(li);
              }
            directory.appendChild(root);
          };
        createPostDirectory(document.getElementById('post-content'), directoryContainer, true);
      };
      postDirectoryBuild();
    </script>
    <script>
      // gtag('config', GA_TRACKING_ID, {
      //   'page_title' : 'Blog',
      //   'page_path': window.location.pathname,
      //   'post_title': 'watttsdfasdf',
      // });

    </script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        lang = hljs.initHighlightingOnLoad();
    </script>
</body>

</html>
