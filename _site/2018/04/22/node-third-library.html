
<!DOCTYPE>
<html lang="zh-cn" data-scribe-reduced-action-queue="true">

<head>
    <meta content='Node 常用库 - Tate & Snow' name='title' />
    <meta content='Node 常用库 - Tate & Snow' name='og:title' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <title>Node 常用库 - Tate & Snow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Node 常用库 - Tate & Snow</title>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Node 常用库 - Tate & Snow">
<meta name="twitter:keywords" content="Node 常用库 - Tate & Snow" property='og:description' />
<meta property="og:type" content="article">
<meta property="og:title" content="Node 常用库 - Tate & Snow">
<meta name="og:keywords" content="Node 常用库 - Tate & Snow|Node 常用库常用库统计本文主要收集 Node 中好用的库，也有包含 Express 框架的中间件等，没有局限性:            Node      描述      栗子                  cheerio  ..."
  property='og:description' />
<link rel="icon" type="image/png" href="http://localhost:4000/style/favicons/favicon.ico" />
<link href="http://localhost:4000/style/favicons/favicon.ico" rel="shortcut icon" type="image/png">
<link rel="canonical" href="http://localhost:4000/">
<link rel="alternate" type="application/rss+xml" title="Liberxue" href="http://localhost:4000/feed.xml">
<meta charset="UTF-8">
<link rel="manifest" href="/manifest.json">
<link rel="shortcut icon" href="http://localhost:4000/style/favicons/favicon.ico" type="image/x-icon">
<meta name="keywords" content="Node 常用库常用库统计本文主要收集 Node 中好用的库，也有包含 Express 框架的中间件等，没有局限性:            Node      描述      栗子                  cheerio  ..." property='og:description'
/>
<meta name="description" content="nothing is more practicla than a good theory" />
<link href="https://cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
<link href="http://localhost:4000/style/theme.css" rel="stylesheet"> 
<meta content='http://localhost:4000/2018/04/22/node-third-library.html' property='og:url' />
<meta content="http://localhost:4000/2018/04/22/node-third-library.html|Node 常用库常用库统计本文主要收集 Node 中好用的库，也有包含 Express 框架的中间件等，没有局限性:            Node      描述      栗子                  cheerio  ..." property='og:description'
/>
<meta content="article" property="og:type" />  
<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'UA-101222464-1', 'auto');
  ga('send', 'pageview');
</script>
 
</head>

<body class="" gtools_scp_screen_capture_injected="true">
    <header id="header" class="header bg-white">
        <div class="navbar-container">
            <a href="/?tate" title="访问 Tate & Snow" class="navbar-logo">
                <img src="https://i.loli.net/2018/03/13/5aa74f5b4c2c7.png" alt="Tate & Snow"> </a>
            <!-- <a href="/?tate" title="访问 Tate & Snow" class="navbar-logo">Tate & Snow</a>   -->
            <div class="navbar-menu">
                
                <a href="/?tate" title="访问 首页" data-hover="首页">首页</a>
                
                <a href="/front?tate" title="访问 前端" data-hover="前端">前端</a>
                
                <a href="/tool?tate" title="访问 框架" data-hover="框架">框架</a>
                
                <a href="/back?tate" title="访问 后端" data-hover="后端">后端</a>
                
                <a href="/tags?tate" title="访问 标签" data-hover="标签">标签</a>
                
                <a href="/README?tate" title="访问 关于" data-hover="关于">关于</a>
                
            </div>
            <!-- <div class="navbar-menu">
                
                <a href="http://localhost:4000/">首页</a>
                
                <a href="http://localhost:4000/front">前端</a>
                
                <a href="http://localhost:4000/tool">框架</a>
                
                <a href="http://localhost:4000/back">后端</a>
                
                <a href="http://localhost:4000/tags">标签</a>
                
                <a href="http://localhost:4000/README">关于</a>
                
            </div> -->
            <div class="navbar-search" onclick="">
                <span class="icon-search"></span>
                <form id="cb-search-btn" role="search">
                    <span class="search-box">
                        <input type="text" class="input" id="cb-search-content" required="true" placeholder="标题 标签..." maxlength="30" autocomplete="off">
                    </span>
                </form>
            </div>
            <div class="navbar-mobile-menu" onclick="">
                <span class="icon-menu cross">
                    <span class="middle"></span>
                </span>
                <ul>
                    
                    <li>
                        <a href="http://localhost:4000/">首页</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/front">前端</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/tool">框架</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/back">后端</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/tags">标签</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/README">关于</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </header>
    <a href="#header" class="back-to-top">⤴Top⤴</a>
    <div class="post-header-thumb bg-white}">
        <div class="post-header-thumb-op"></div>
        <div class="post-header-thumb">
            <div class="post-header-thumb-container">
                <h1 class="post-title" itemprop="name headline">
                    Node 常用库</h1>
                <div class="post-data">
                    <time datetime="2018-04-22 15:14:00" itemprop="datePublished">发布时间：2018-04-22 15:14:00</time>
                    <a href="/tags#后端" title="访问 后端" data-hover="博客分类: 后端">博客分类: 后端</a>
                    <!-- <a href="#read"> 阅读次数: comments</a>  -->
                </div>
                <div class="post-tags">
                       
                    <a href="/tags#Node" title="访问Node" data-hover="Node">
                        Node
                        <span>(6)</span>
                        
                    </a>
                       
                </div>
            </div>
        </div>
    </div>
    <article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
        <div class="post-header">
            <h1 class="post-title" itemprop="name headline">
                Node 常用库</h1>
            <div class="post-data">
                <time datetime="2018-04-22 15:14:00" itemprop="datePublished">2018-04-22 15:14:00</time>
            </div>
        </div>
        <div id="post-content" class="post-content" itemprop="articleBody">
            <p class="post-tags">
                   
                <a href="/tags#Node" title="访问Node" data-hover="Node">
                    Node
                    <span>(6)</span>
                    </a>
                   
            </p>
            <h1 id="node-常用库">Node 常用库</h1>

<h2 id="常用库统计">常用库统计</h2>

<p>本文主要收集 Node 中好用的库，也有包含 Express 框架的中间件等，没有局限性:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Node</th>
      <th style="text-align: left">描述</th>
      <th style="text-align: left">栗子</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/cheeriojs/cheerio">cheerio</a></strong></td>
      <td style="text-align: left">以 jQuery 为核心，解析和操作 DOM 模型，如实现网络爬虫</td>
      <td style="text-align: left"><code>require('cheerio')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/request/request">request</a></strong></td>
      <td style="text-align: left">精简的 HTTP 请求客户端</td>
      <td style="text-align: left"><code>require('request')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/markedjs/marked">marked</a></strong></td>
      <td style="text-align: left">转换 Markdown 为 Html 显示</td>
      <td style="text-align: left"><code>require('marked')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/chalk/chalk">chalk</a></strong></td>
      <td style="text-align: left">修改终端输出信息的样式</td>
      <td style="text-align: left"><code>require('chalk')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/shelljs/shelljs">shelljs</a></strong></td>
      <td style="text-align: left">执行 shell 命令</td>
      <td style="text-align: left"><code>require('shelljs')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/caolan/async">async</a></strong></td>
      <td style="text-align: left">Async utilities</td>
      <td style="text-align: left"><code>require('async')</code></td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Express</th>
      <th style="text-align: left">描述</th>
      <th style="text-align: left">栗子</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/expressjs/session">express-session</a></strong></td>
      <td style="text-align: left">session 中间件</td>
      <td style="text-align: left"><code>require('express-session')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/jdesboeufs/connect-mongo">connect-mongo</a></strong></td>
      <td style="text-align: left">通过 Mongodb 存储 session，基于 express-session</td>
      <td style="text-align: left"><code>require('connect-mongo')(session)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/jaredhanson/connect-flash">connect-flash</a></strong></td>
      <td style="text-align: left">页面通知中间件，基于 session 实现</td>
      <td style="text-align: left"><code>require('connect-flash')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/utatti/express-formidable">express-formidable</a></strong></td>
      <td style="text-align: left">Formidable 中间件，解析表单数据</td>
      <td style="text-align: left"><code>require('express-formidable')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/Soarez/express-ejs-layouts">express-ejs-layouts</a></strong></td>
      <td style="text-align: left">Layout support for ejs</td>
      <td style="text-align: left"><code>require('express-ejs-layouts')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/expressjs/cookie-parser">cookie-parser</a></strong></td>
      <td style="text-align: left">解析 cookie，通过 <code>req.cookies</code> 访问</td>
      <td style="text-align: left"><code>require('cookie-parser')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/expressjs/body-parser">body-parser</a></strong></td>
      <td style="text-align: left">解析 POST 请求的请求体，通过 <code>req.body</code> 访问</td>
      <td style="text-align: left"><code>require('body-parser')</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="https://github.com/expressjs/compression">compression</a></strong></td>
      <td style="text-align: left">会尝试压缩所有经过此中间件的响应体</td>
      <td style="text-align: left"><code>require('compression')</code></td>
    </tr>
  </tbody>
</table>

<h2 id="node-第三方库">Node 第三方库</h2>

<h3 id="cheerio">cheerio</h3>

<p><strong>cheerio</strong> 以 jQuery 为核心，可以解析和操作 DOM 模型，如实现网络爬虫，可以<a href="http://www.cnblogs.com/xiaohuochai/p/6960738.html">参考这里的实现</a>。</p>

<pre><code class="language-JS">const cheerio = require('cheerio')
const $ = cheerio.load('&lt;h2 class="title"&gt;Hello world&lt;/h2&gt;')

$('h2.title').text('Hello there!')
$('h2').addClass('welcome')

$.html() // =&gt; &lt;h2 class="title welcome"&gt;Hello there!&lt;/h2&gt;
</code></pre>

<h3 id="request">request</h3>

<p><strong>request</strong> 是一个精简的 HTTP 客户端，支持 HTTPS 协议和重定向。</p>

<pre><code class="language-JS">const request = require('request');
request('http://www.google.com', function (error, response, body) {
  console.log('error:', error); // Print the error if one occurred
  console.log('statusCode:', response &amp;&amp; response.statusCode); // Print the response status code if a response was received
  console.log('body:', body); // Print the HTML for the Google homepage.
});
</code></pre>

<p>任何响应都可以输出到文件流:</p>

<pre><code class="language-JS">request('http://google.com/doodle.png').pipe(fs.createWriteStream('doodle.png'))
</code></pre>

<pre><code class="language-JS">http.createServer(function (req, resp) {
  if (req.url === '/doodle.png') {
    if (req.method === 'PUT') {
      req.pipe(request.put('http://mysite.com/doodle.png'))
    } else if (req.method === 'GET' || req.method === 'HEAD') {
      request.get('http://mysite.com/doodle.png').pipe(resp)
    }
  }
})
</code></pre>

<p>举个 post 请求提交 formData 的栗子:</p>

<pre><code class="language-JS">request.post({url:'http://service.com/upload', formData: formData}, optionalCallback);

function optionalCallback(err, httpResponse, body) {
  if (err) {
    return console.error('upload failed:', err);
  }
  console.log('Upload successful!  Server responded with:', body);
};
</code></pre>

<h3 id="marked">marked</h3>

<p><strong>marked</strong> 可以将 Markdown 语法转换为 html 并显示。</p>

<pre><code class="language-JS">document.getElementById('content').innerHTML = marked('# Marked in the browser\n\nRendered by **marked**.');
</code></pre>

<h3 id="chalk">chalk</h3>

<p><strong>chalk</strong> 可以修改终端输出信息的样式:</p>

<pre><code class="language-JS">chalk.&lt;style&gt;[.&lt;style&gt;...](string, [string...])
</code></pre>

<p><img src="https://camo.githubusercontent.com/71d70de9a74293b29dbbcca7ac6cd309948a0f3e/68747470733a2f2f63646e2e7261776769742e636f6d2f6368616c6b2f616e73692d7374796c65732f383236313639376339356266333462366337373637653263626539393431613835316435393338352f73637265656e73686f742e737667" alt="chalk" /></p>

<pre><code class="language-JS">const chalk = require('chalk');
const log = console.log;

// Combine styled and normal strings
log(chalk.blue('Hello') + ' World' + chalk.red('!'));

// Compose multiple styles using the chainable API
log(chalk.blue.bgRed.bold('Hello world!'));

// Pass in multiple arguments
log(chalk.blue('Hello', 'World!', 'Foo', 'bar', 'biz', 'baz'));

// Nest styles
log(chalk.red('Hello', chalk.underline.bgBlue('world') + '!'));
</code></pre>

<p>除了内置的颜色 API 以外，还支持其他颜色自定义的 API，常用的有:</p>

<ul>
  <li><strong>rgb</strong> - Example: chalk.rgb(255, 136, 0).bold(‘Orange!’)</li>
  <li><strong>hex</strong> - Example: chalk.hex(‘#FF8800’).bold(‘Orange!’)</li>
  <li><strong>keyword</strong> (CSS keywords) - Example: chalk.keyword(‘orange’).bold(‘Orange!’)</li>
  <li><strong>hsl</strong> - Example: chalk.hsl(32, 100, 50).bold(‘Orange!’)</li>
</ul>

<h3 id="shelljs">shelljs</h3>

<p><strong>shelljs</strong> 可以在 Node 中调用 shell 命令。</p>

<pre><code class="language-JS">var shell = require('shelljs');

if (!shell.which('git')) {
  shell.echo('Sorry, this script requires git');
  shell.exit(1); // Exits the current process with the given exit code.
}

// Copy files to release dir
shell.rm('-rf', 'out/Release');
shell.cp('-R', 'stuff/', 'out/Release');

// Replace macros in each .js file
// sed([options,] search_regex, replacement, file [, file ...])
// or sed([options,] search_regex, replacement, file_array)

shell.cd('lib');
shell.ls('*.js').forEach(function (file) {
  shell.sed('-i', 'BUILD_VERSION', 'v0.1.2', file);
  shell.sed('-i', /^.*REMOVE_THIS_LINE.*$/, '', file);
  shell.sed('-i', /.*REPLACE_LINE_WITH_MACRO.*\n/, shell.cat('macro.js'), file);
});
shell.cd('..');

// Run external tool synchronously
if (shell.exec('git commit -am "Auto-commit"').code !== 0) {
  shell.echo('Error: Git commit failed');
  shell.exit(1);
}
</code></pre>

<h3 id="async">async</h3>

<p><strong>async</strong> 库的所有方法可以从<a href="https://caolan.github.io/async/docs.html#auto">官方这里查看</a>，这里介绍三个比较常用的方法:</p>

<ul>
  <li>waterfall - 异步执行</li>
  <li>parallel - 同步执行</li>
  <li>auto - 可同步可异步</li>
</ul>

<p>1、waterfall</p>

<p>Runs the tasks array of functions in series, each passing their results to the next in the array. However, if any of the tasks pass an error to their own callback, the next function is not executed, and the main callback is immediately called with the error.</p>

<pre><code class="language-JS">import waterfall from 'async/waterfall';

async.waterfall([
  myFirstFunction,
  mySecondFunction,
  myLastFunction,
], function (err, result) {
  // result now equals 'done'
});
function myFirstFunction (callback) {
  callback(null, 'one', 'two');
}
function mySecondFunction (arg1, arg2, callback) {
  // arg1 now equals 'one' and arg2 now equals 'two'
  callback(null, 'three');
}
function myLastFunction (arg1, callback) {
  // arg1 now equals 'three'
  callback(null, 'done');
}
</code></pre>

<p>2、parallel</p>

<p>Run the tasks collection of functions in parallel, without waiting until the previous function has completed. If any of the functions pass an error to its callback, the main callback is immediately called with the value of the error. Once the tasks have completed, the results are passed to the final callback as an array</p>

<pre><code class="language-JS">import parallel from 'async/parallel';

async.parallel([
  function (callback) {
    setTimeout(function() {
      callback(null, 'one');
    }, 200);
  },
  function (callback) {
    setTimeout(function() {
      callback(null, 'two');
    }, 100);
  }
],
// optional callback
function(err, results) {
    // the results array will equal ['one','two'] even though the second function had a shorter timeout.
});

// an example using an object instead of an array
async.parallel({
  one: function (callback) {
    setTimeout(function() {
      callback(null, 1);
    }, 200);
  },
  two: function (callback) {
    setTimeout(function() {
      callback(null, 2);
    }, 100);
  }
}, function (err, results) {
  // results is now equals to: {one: 1, two: 2}
});
</code></pre>

<p>3、auto</p>

<p>能够同时满足上面两种需求:</p>

<pre><code class="language-JS">import auto from 'async/auto';

async.auto({
  get_data: function(callback) {
    console.log('in get_data');
    // async code to get some data
    callback(null, 'data', 'converted to array');
  },
  make_folder: function(callback) {
    console.log('in make_folder');
    // async code to create a directory to store a file in,this is run at the same time as getting the data
    callback(null, 'folder');
  },
  write_file: ['get_data', 'make_folder', function(results, callback) {
    console.log('in write_file', JSON.stringify(results));
    // once there is some data and the directory exists,write the data to a file in the directory
    callback(null, 'filename');
  }],
  email_link: ['write_file', function(results, callback) {
    console.log('in email_link', JSON.stringify(results));
    // once the file is written let's email a link to it...,results.write_file contains the filename returned by write_file.
    callback(null, {'file':results.write_file, 'email':'user@example.com'});
  }]
}, function(err, results) {
  console.log('err = ', err);
  console.log('results = ', results);
});
</code></pre>

<h2 id="express-中间件">Express 中间件</h2>

<h3 id="express-session">express-session</h3>

<p><strong>express-session</strong> 用来操作 session，保存会话信息，常用于登录注册、购物车等。</p>

<pre><code class="language-JS">// session 中间件
app.use(session({
  name: config.session.key, // 设置保存 session id 的 cookie 名称
  secret: config.session.secret, // 通过设置 secret 来计算 hash 值并放在 cookie 中，使产生的 signedCookie 防篡改
  resave: true, // 强制更新 session
  saveUninitialized: false, // 设置为 false，强制创建一个 session，即使用户未登录
  cookie: { // 默认值 { path: '/', httpOnly: true, secure: false, maxAge: null }
    maxAge: config.session.maxAge
  },
  store: new MongoStore({ // 将 session 存储到 mongodb
    url: config.mongodb // mongodb 地址
  })
}))
</code></pre>

<p>可以通过 <strong>req.session</strong> 来访问或存储 session:</p>

<pre><code class="language-JS">// Use the session middleware
app.use(session({ secret: 'keyboard cat', cookie: { maxAge: 60000 }}))

// Access the session as req.session
app.get('/', function (req, res, next) {
  if (req.session.views) {
    req.session.views++
    res.setHeader('Content-Type', 'text/html')
    res.write('&lt;p&gt;views: ' + req.session.views + '&lt;/p&gt;')
    res.write('&lt;p&gt;expires in: ' + (req.session.cookie.maxAge / 1000) + 's&lt;/p&gt;')
    res.end()
  } else {
    req.session.views = 1
    res.end('welcome to the session demo. refresh!')
  }
})
</code></pre>

<p>req.session 还有其他几个属性和方法:</p>

<ul>
  <li><strong>id</strong> - session id，与 session 唯一绑定，也可通过 <code>req.sessionID</code> 访问，不可修改</li>
  <li><strong>cookie</strong> - 访问 session id 绑定的 cookie 信息</li>
  <li><strong>regenerate()</strong> - 重新生成一个 session</li>
  <li><strong>destroy()</strong> - 销毁一个 session</li>
  <li><strong>reload()</strong> - 刷新一个 session</li>
  <li><strong>save()</strong> - 保存一个 session，一般在 session 改变后自动调用，而不用手动去执行</li>
</ul>

<h3 id="connect-mongo">connect-mongo</h3>

<p><strong>connect-mongo</strong> 是基于 express-session 实现的，可以通过 Mongodb 来存储 session。</p>

<pre><code class="language-JS">const session = require('express-session');
const MongoStore = require('connect-mongo')(session);

app.use(session({
  secret: 'tate',
  store: new MongoStore(options)
}));
</code></pre>

<p>options 可以创建一个新的连接，也可以复用现成的连接:</p>

<pre><code class="language-JS">// 复用现成的连接
const mongoose = require('mongoose');

// Basic usage
mongoose.connect(connectionOptions);

app.use(session({
  store: new MongoStore({ mongooseConnection: mongoose.connection })
}));

// Advanced usage
const connection = mongoose.createConnection(connectionOptions);

app.use(session({
  store: new MongoStore({ mongooseConnection: connection })
}));
</code></pre>

<pre><code class="language-JS">// 创建一个新的连接
app.use(session({
  store: new MongoStore({
    url: 'mongodb://localhost/test-app',
    ttl: 14 * 24 * 60 * 60 // = 14 days. Default 设置 session 过期时间
  })
}));
</code></pre>

<h3 id="connect-flash">connect-flash</h3>

<p><strong>connect-flash</strong> 是基于 session 实现的信息通知中间件，必须在设置 session 后再运行。</p>

<pre><code class="language-JS">const flash = require('connect-flash')

// flash 中间件，用来显示通知
app.use(flash())
</code></pre>

<p>可以通过 <strong>req.flash()</strong> 来设置通知:</p>

<pre><code class="language-JS">app.get('/flash', function (req, res) {
  // Set a flash message by passing the key, followed by the value, to req.flash().
  req.flash('info', 'Flash is back!')
  res.redirect('/');
})

app.get('/', function (req, res) {
  // Get an array of flash messages by passing the key to req.flash()
  res.render('index', { messages: req.flash('info') });
})
</code></pre>

<h3 id="express-formidable">express-formidable</h3>

<p><strong>express-formidable</strong> 是 Express 与 <strong><a href="https://github.com/felixge/node-formidable">Formidable</a></strong> 的桥梁，用来解析表单数据。</p>

<pre><code class="language-JS">const express = require('express');
const formidable = require('express-formidable');

var app = express();

app.use(formidable(opts));

app.post('/upload', (req, res) =&gt; {
  req.fields; // contains non-file fields
  req.files; // contains files
});
</code></pre>

<p>这里的 opts 可以参考 Formidable API，以下列出常用的几个:</p>

<ul>
  <li><strong>encoding</strong> - 设置编码形式</li>
  <li><strong>uploadDir</strong> - 设置需要上传文件的存放路径，默认是 <code>os.tmpdir()</code></li>
  <li><strong>keepExtensions</strong> - 布尔类型，是否保持原始文件的后缀名</li>
  <li><strong>multiples</strong> - 布尔类型，设置 true 时，当调用 form.parse，files 参数会包含上传文件的数组</li>
</ul>

<pre><code class="language-JS">app.use(formidable({
  encoding: 'utf-8',
  uploadDir: '/my/dir',
  multiples: true, // req.files to be arrays of files
});
</code></pre>

<h3 id="express-ejs-layouts">express-ejs-layouts</h3>

<p>引用官方 demo:</p>

<pre><code class="language-JS">var expressLayouts = require('express-ejs-layouts');

app.set('view engine', 'ejs');
app.use(expressLayouts);
app.get('/', function (req, res) {
  res.locals = {
    title: 'expressLayouts',
    message: 'Tate &amp; Snow'
  };
  res.render('view');
});
</code></pre>

<pre><code class="language-HTML">&lt;!-- layout.ejs --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;

  &lt;% /* Place any styles in the page in this section. */ %&gt;
  &lt;%- style %&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;header&gt;
    &lt;% /*
    Define an required placeholder for the header.
    If a page doesn't define a header, there will be an error when rendering.
    */ %&gt;
    &lt;%- header %&gt;
  &lt;/header&gt;

  &lt;%- body %&gt;

  &lt;footer&gt;
    &lt;% /*
    Define an optional placeholder for the footer.
    If a page doesn't define a footer, this section will simply be empty.
    */ %&gt;
    &lt;%- defineContent('footer') %&gt;
  &lt;/footer&gt;

  &lt;% /* Place any scripts contained in views at the end of the page. */ %&gt;
  &lt;%- script %&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<pre><code class="language-HTML">&lt;!-- view.ejs --&gt;
&lt;%- contentFor('header') %&gt;
&lt;h1 class="page-title"&gt;&lt;%= title %&gt;&lt;/h1&gt;

&lt;%- contentFor('footer') %&gt;
&lt;h1&gt;This is the footer&lt;/h1&gt;

&lt;% /*
Content for the `body` section should either be the first thing defined
in the view, or it has to be declared just like any other section.
*/ %&gt;
&lt;%- contentFor('body') %&gt;

This is part of the body.

&lt;style&gt;
  .page-message { color: blue }
&lt;/style&gt;

&lt;% /*
Like stylesheets, scripts can also be extracted.
This script block will end up at the end of the HTML document.
*/ %&gt;
&lt;script&gt;
  // Script content!
&lt;/script&gt;

&lt;h1 class="page-message"&gt;&lt;%= message %&gt;&lt;/h1&gt;
</code></pre>

<p>渲染后页面显示为:</p>

<pre><code class="language-TEXT">expressLayouts
This is part of the body.
Tate &amp; Snow
This is the footer
</code></pre>

<p>还可以设置默认 layout 模板:</p>

<pre><code class="language-JS">app.set('layout', 'layouts/layout');

// 通过 layout 属性使用指定的模板进行渲染
app.get('/', function(req, res) {
  res.render('the-view', { layout: 'specific-layout' });
);
</code></pre>

<h3 id="cookie-parser">cookie-parser</h3>

<p>解析 HTTP 请求中的 cookie。</p>

<pre><code class="language-JS">var cookieParser = require('cookie-parser')

// 不使用签名
app.use(cookiePareser())

// 使用签名，需要指定一个 secret 字符串，否者会报错
// app.use(cookiePareser('Tate'))

app.get('/', function (req, res) {
  // Cookies that have not been signed
  console.log('Cookies: ', req.cookies)

  // Cookies that have been signed
  console.log('Signed Cookies: ', req.signedCookies)
})
</code></pre>

<h3 id="body-parser">body-parser</h3>

<p>解析 HTTP POST 请求中的请求体，通过 <code>req.body</code> 访问。</p>

<pre><code class="language-JS">// 常用的设置
app.use(bodyParser.json()) // 解析 application/json
app.use(bodyParser.urlencoded({ extended: false })) // 解析 application/x-www-form-urlencoded
</code></pre>

<h3 id="compression">compression</h3>

<p>compression 会尝试压缩所有经过此中间件的响应体。支持两种压缩模式: deflate 和 gzip。</p>

<pre><code class="language-JS">var compression = require('compression')
app.use(compression()) // compress all responses，可以带 options 参数
</code></pre>

<p>还可以通过 filter 来过滤哪些不需要压缩的请求:</p>

<pre><code class="language-JS">app.use(compression({filter: shouldCompress}))

function shouldCompress (req, res) {
  if (req.headers['x-no-compression']) {
    // don't compress responses with this request header
    return false
  }

  // fallback to standard filter function
  return compression.filter(req, res)
}
</code></pre>

<h2 id="参考链接">参考链接</h2>

<ol>
  <li><a href="https://github.com/nswbmw/N-blog/blob/master/book/4.2%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C.md">Github - N-Blog</a> By nswbmw</li>
  <li><a href="http://www.cnblogs.com/xiaohuochai/p/6960738.html">nodeJS 实现简单网页爬虫功能</a> By 小火柴的蓝色理想</li>
  <li><a href="https://www.jianshu.com/p/25ffa01466f9">Express 中间件—-cookie-parser(六)</a> By HowardHuang</li>
  <li><a href="https://blog.csdn.net/yanyang1116/article/details/54847560">body-parser Node.js(Express) HTTP 请求体解析中间件</a> By yanyang1116</li>
  <li><a href="https://caolan.github.io/async/docs.html">async 官方文档</a></li>
</ol>
 
<div id="gitalk-container"></div>
<script>
    var gitalk = new Gitalk({
      enable: true,
      clientID: '020f142489f80c92b097',
      clientSecret: '1fa083372b44031cf1b8249251515c4e3d54c69d',
      repo: 'tate-young.github.io',
      owner: 'Tate-Young',
      admin: ['Tate-Young'],
      id: location.pathname,      // Ensure uniqueness and length less than 50
      distractionFreeMode: true  // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
<!-- disqus -->
<!-- <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = 'https://tate-young.github.io/2018/04/22/node-third-library.html';
        this.page.identifier = '/2018/04/22/node-third-library';
        this.page.title = 'Node 常用库';
    };

    (function () { // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document,
            s = d.createElement('script');

        s.src = '//tate.disqus.com/embed.js'; // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript> -->


            <!-- <p class="post-info">
			本文由 <a href="/">liberxue</a> 创作，采用 <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">知识共享署名4.0</a> 国际许可协议进行许可<br>本站文章除注明转载/出处外，均为本站原创或翻译，转载前请务必署名<br>最后编辑时间为:2018-04-22 15:14:00</p> -->
        </div>
    </article>

    <!-- <div class="related-post-lists">
	<div class="post-lists">
		<div class="post-lists-body">
					<div class="post-list-item">
				<div class="post-list-item-container">
					<div class="item-label">
						<div class="item-title"><a href="induction.html">归纳的随想</a></div>
						<div class="item-meta clearfix">
														<div class="item-meta-ico bg-ico-image" style="background: url('../usr/themes/pinghsu/images/bg-ico.png') no-repeat;background-size: 40px auto;"></div>
	                        							<div class="item-meta-cat"><a href="../category/thoughts/index.html">Thoughts</a></div>
						</div>
					</div>
				</div>
			</div>
				</div>
	</div>
</div> -->

    <!-- <footer class="footer bg-white">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
	 <a class="social segmentfault" target="blank" href="https://segmentfault.com/u/liberxue" title="访问 LiberXue_Twitter" data-hover="Segmentfault">Segmentfault</a>
    <a class="social github" target="blank" href="https://github.com/liberxue" title="访问 LiberXue_Twitter" data-hover="GitHub">GitHub</a>
    <a class="social twitter" target="blank" href="http://twitter.com/liberxue" title="访问 LiberXue_Twitter" data-hover="Twitter">Twitter</a>
     <a class="social stackoverflow" target="blank" href="https://stackoverflow.com/users/6902190/liberxue" title="访问 LiberXue_stackoverflow" data-hover="StackOverflow">StackOverflow</a>
          <a class="social oschina" target="blank" href="https://my.oschina.net/bolanzw" title="访问 LiberXue_Oschina" data-hover="Oschina">Oschina</a>
     <a class="social rss" target="blank" href="/feed.xml"title="访问 LiberXue_RSS" data-hover="RSS">RSS</a>
	</div>
		</div>
	</div>
	<div class="footer-meta">
        <div class="footer-container">
            <div class="meta-item meta-copyright">
                <div class="meta-copyright-info">
                    <a href="/" class="info-logo">
                         <img src="http://localhost:4000/style/images/logo-liberxue.png"   title="访问 LiberXue_blog" data-hover="LiberXue_blog" alt="LiberXue_blog" /> </a>
                    <div class="info-text">
                        <p>Theme is <a href="http://www.liberxue.com/2017/08/03/Jekyllthemes.html" title="访问 Jekyll liberxue主题"  data-hover="Jekyll liberxue"target="_blank">Jekyll liberxue</a> by <a href="http://www.liberxue.com/about" target="_blank">liberxue</a></p>
                        <p>Powered by <a href="http://localhost:4000/tags/#Jekyll" title="Jekyll" data-hover="Jekyll" target="_blank" rel="nofollow">Jekyll</a></p>
                        <p>&copy; 2017 <a href="/feed.xml"  title="访问 liberxue blog RSS" data-hover="liberxue blog RSS">liberxue blog RSS</a></p>
                        <p>总计文章：篇</p>
                      <p>本blog已开源点击Fork</p><iframe src="http://ghbtns.com/github-btn.html?user=liberxue&repo=liberxue.github.io&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
                    </div>
                </div>
            </div>
            <div class="meta-item meta-posts">
                <h3 class="meta-title">置顶文章</h3>
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
            </div>
            <div class="meta-item meta-comments">
                <h3 class="meta-title">最新文章</h3>
          
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
    
</div>
		</div>
    </div>
</footer> -->
<script src="//cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>
<script src="/search/js/cb-search.js"></script>
<!-- <script src="/search/js/canvas.js"></script> -->

<script>
    $(function () {
        setTimeout(function () {
            $('code').removeClass('hljs');
            $('code').removeClass('language');
        }, 90);
    });
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
    <!--liberxueconnnet-menu-->
    <div id="directory-content" class="directory-content">
        <div id="directory"></div>
    </div>
    <!--liberxueconnnet-menu-->
    <script>
        var postDirectoryBuild = function () {
            var postChildren = function children(childNodes, reg) {
                    var result = [],
                        isReg = typeof reg === 'object',
                        isStr = typeof reg === 'string',
                        node, i, len;
                    for (i = 0, len = childNodes.length; i < len; i++) {
                        node = childNodes[i];
                        if ((node.nodeType === 1 || node.nodeType === 9) &&
                            (!reg ||
                                isReg && reg.test(node.tagName.toLowerCase()) ||
                                isStr && node.tagName.toLowerCase() === reg)) {
                            result.push(node);
                        }
                    }
                    return result;
                },
                createPostDirectory = function (article, directory, isDirNum) {
                    var contentArr = [],
                        titleId = [],
                        levelArr, root, level,
                        currentList, list, li, link, i, len;
                    levelArr = (function (article, contentArr, titleId) {
                        var titleElem = postChildren(article.childNodes, /^h\d$/),
                            levelArr = [],
                            lastNum = 1,
                            lastRevNum = 1,
                            count = 0,
                            guid = 1,
                            id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                            lastRevNum, num, elem;
                        while (titleElem.length) {
                            elem = titleElem.shift();
                            contentArr.push(elem.innerHTML);
                            num = +elem.tagName.match(/\d/)[0];
                            if (num > lastNum) {
                                levelArr.push(1);
                                lastRevNum += 1;
                            } else if (num === lastRevNum ||
                                num > lastRevNum && num <= lastNum) {
                                levelArr.push(0);
                                lastRevNum = lastRevNum;
                            } else if (num < lastRevNum) {
                                levelArr.push(num - lastRevNum);
                                lastRevNum = num;
                            }
                            count += levelArr[levelArr.length - 1];
                            lastNum = num;
                            elem.id = elem.id || (id + guid++);
                            titleId.push(elem.id);
                        }
                        if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                        return levelArr;
                    })(article, contentArr, titleId);
                    currentList = root = document.createElement('ul');
                    dirNum = [0];
                    for (i = 0, len = levelArr.length; i < len; i++) {
                        level = levelArr[i];
                        if (level === 1) {
                            list = document.createElement('ul');
                            if (!currentList.lastElementChild) {
                                currentList.appendChild(document.createElement('li'));
                            }
                            currentList.lastElementChild.appendChild(list);
                            currentList = list;
                            dirNum.push(0);
                        } else if (level < 0) {
                            level *= 2;
                            while (level++) {
                                if (level % 2) dirNum.pop();
                                currentList = currentList.parentNode;
                            }
                        }
                        dirNum[dirNum.length - 1]++;
                        li = document.createElement('li');
                        link = document.createElement('a');
                        link.href = '#' + titleId[i];
                        link.title = '访问' + titleId[i];
                        link.title = '访问' + titleId[i];
                        link.innerHTML = !isDirNum ? contentArr[i] :
                            dirNum.join('.') + ' ' + contentArr[i];
                        li.appendChild(link);
                        currentList.appendChild(li);
                    }
                    directory.appendChild(root);
                };
            createPostDirectory(document.getElementById('post-content'), document.getElementById('directory'), true);
        };
        postDirectoryBuild();
    </script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        lang = hljs.initHighlightingOnLoad();
    </script>
</body>

</html>
