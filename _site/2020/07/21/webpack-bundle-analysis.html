
<!DOCTYPE>
<html lang="zh-cn" data-scribe-reduced-action-queue="true">
<head>
    <meta content='Webpack Bundle Analysis - Tate & Snow' name='title' />
    <meta content='Webpack Bundle Analysis - Tate & Snow' name='og:title' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <title>Webpack Bundle Analysis - Tate & Snow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Webpack Bundle Analysis - Tate & Snow</title>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Webpack Bundle Analysis - Tate & Snow">
<meta name="twitter:keywords" content="Webpack Bundle Analysis - Tate & Snow" property='og:description' />
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack Bundle Analysis - Tate & Snow">
<meta name="og:keywords" content="Webpack Bundle Analysis - Tate & Snow|Webpack Bundle Analysiså¾ˆå¤šæ—¶å€™ï¼Œä¸ºäº†å‡å°‘å‹ç¼©åŒ…çš„ä½“ç§¯ï¼ŒåŠ å¿«ç½‘ç«™çš„å“åº”é€Ÿåº¦ï¼Œæˆ‘ä»¬å¿…é¡»è¦å¯¹è¿™äº›å‹ç¼©åŒ…è¿›è¡Œåˆ†æï¼Œæœ€å¤§ç¨‹åº¦ä¸Šå»å‡å°‘å®ƒçš„ä½“ç§¯ã€‚ç°é˜¶æ®µæœ‰å¾ˆå¤šå¥½ç”¨çš„å·¥å…·ï¼Œä¸‹é¢æ•´ç†ä¸‹:  webapck analyse - w..."
  property='og:description' />
<link rel="icon" type="image/png" href="http://localhost:2333/style/favicons/favicon.ico" />
<link href="http://localhost:2333/style/favicons/favicon.ico" rel="shortcut icon" type="image/png">
<link rel="canonical" href="http://localhost:2333/">
<link rel="alternate" type="application/rss+xml" title="Liberxue" href="http://localhost:2333/feed.xml">
<meta charset="UTF-8">
<link rel="manifest" href="/manifest.json">
<link rel="shortcut icon" href="http://localhost:2333/style/favicons/favicon.ico" type="image/x-icon">
<meta name="keywords" content="Webpack Bundle Analysiså¾ˆå¤šæ—¶å€™ï¼Œä¸ºäº†å‡å°‘å‹ç¼©åŒ…çš„ä½“ç§¯ï¼ŒåŠ å¿«ç½‘ç«™çš„å“åº”é€Ÿåº¦ï¼Œæˆ‘ä»¬å¿…é¡»è¦å¯¹è¿™äº›å‹ç¼©åŒ…è¿›è¡Œåˆ†æï¼Œæœ€å¤§ç¨‹åº¦ä¸Šå»å‡å°‘å®ƒçš„ä½“ç§¯ã€‚ç°é˜¶æ®µæœ‰å¾ˆå¤šå¥½ç”¨çš„å·¥å…·ï¼Œä¸‹é¢æ•´ç†ä¸‹:  webapck analyse - w..." property='og:description'
/>
<meta name="description" content="Tate & Snow's Github blog" />
<link href="https://cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
<link href="http://localhost:2333/style/theme.css" rel="stylesheet"> 
<meta content='http://localhost:2333/2020/07/21/webpack-bundle-analysis.html' property='og:url' />
<meta content="http://localhost:2333/2020/07/21/webpack-bundle-analysis.html|Webpack Bundle Analysiså¾ˆå¤šæ—¶å€™ï¼Œä¸ºäº†å‡å°‘å‹ç¼©åŒ…çš„ä½“ç§¯ï¼ŒåŠ å¿«ç½‘ç«™çš„å“åº”é€Ÿåº¦ï¼Œæˆ‘ä»¬å¿…é¡»è¦å¯¹è¿™äº›å‹ç¼©åŒ…è¿›è¡Œåˆ†æï¼Œæœ€å¤§ç¨‹åº¦ä¸Šå»å‡å°‘å®ƒçš„ä½“ç§¯ã€‚ç°é˜¶æ®µæœ‰å¾ˆå¤šå¥½ç”¨çš„å·¥å…·ï¼Œä¸‹é¢æ•´ç†ä¸‹:  webapck analyse - w..." property='og:description'
/>
<meta content="article" property="og:type" /> 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136311746-1"></script>
<!-- <script async src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
<script>
  window.dataLayer = window.dataLayer || [];
  window.GA_TRACKING_ID = 'UA-136311746-1'
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('set', {
    'country': 'US',
    'currency': 'USD',
    'description': 'fuck',
  });
  gtag('config', GA_TRACKING_ID, {
    'custom_map': {
      'dimension1': 'post_title',
    },
    'post_title': 'test',
  });
</script>
<meta content="" property="fb:app_id" />
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Webpack Bundle Analysis | Tate &amp; Snow</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Webpack Bundle Analysis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Webpack Bundle Analysis" />
<meta property="og:description" content="Webpack Bundle Analysis" />
<link rel="canonical" href="http://localhost:2333/2020/07/21/webpack-bundle-analysis.html" />
<meta property="og:url" content="http://localhost:2333/2020/07/21/webpack-bundle-analysis.html" />
<meta property="og:site_name" content="Tate &amp; Snow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-21T12:05:00+08:00" />
<script type="application/ld+json">
{"description":"Webpack Bundle Analysis","@type":"BlogPosting","url":"http://localhost:2333/2020/07/21/webpack-bundle-analysis.html","headline":"Webpack Bundle Analysis","dateModified":"2020-07-21T12:05:00+08:00","datePublished":"2020-07-21T12:05:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:2333/2020/07/21/webpack-bundle-analysis.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<script>
  (function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

</head>

<body class="dark-theme" gtools_scp_screen_capture_injected="true">
    <header id="header" class="header bg-white">
        <div class="navbar-container">
            <a href="Javascript:;" onclick="onClickLogo()" title="è®¿é—® Tate & Snow" class="navbar-logo menu-logo">
                <img src="http://localhost:2333/style/images/tate.png" alt="Tate & Snow"> </a>
            <!-- <a href="/?tate" title="è®¿é—® Tate & Snow" class="navbar-logo">Tate & Snow</a>   -->
            <div class="navbar-menu">
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', '/')" title="è®¿é—® é¦–é¡µ" data-hover="é¦–é¡µ">é¦–é¡µ</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å‰ç«¯', '/front')" title="è®¿é—® å‰ç«¯" data-hover="å‰ç«¯">å‰ç«¯</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å†å²', '/history')" title="è®¿é—® å†å²" data-hover="å†å²">å†å²</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å…¶ä»–', '/other')" title="è®¿é—® å…¶ä»–" data-hover="å…¶ä»–">å…¶ä»–</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', '/tags')" title="è®¿é—® æ ‡ç­¾" data-hover="æ ‡ç­¾">æ ‡ç­¾</a>
                
                  <a class=" menu-item-about " href="Javascript:;" onclick="onClickMenu('å…³äº', '/README')" title="è®¿é—® å…³äº" data-hover="å…³äº">å…³äº</a>
                
            </div>
            <!-- <div class="navbar-menu">
                
                <a href="http://localhost:2333/">é¦–é¡µ</a>
                
                <a href="http://localhost:2333/front">å‰ç«¯</a>
                
                <a href="http://localhost:2333/history">å†å²</a>
                
                <a href="http://localhost:2333/other">å…¶ä»–</a>
                
                <a href="http://localhost:2333/tags">æ ‡ç­¾</a>
                
                <a href="http://localhost:2333/README">å…³äº</a>
                
            </div> -->
            <div class="navbar-search menu-item-search" onclick="onClickSearch()">
                <span class="icon-search"></span>
                <form id="cb-search-btn" role="search">
                    <span class="search-box">
                        <input type="text" class="input" id="cb-search-content" required="true" placeholder="æ ‡é¢˜ æ ‡ç­¾..." maxlength="30" autocomplete="off">
                    </span>
                </form>
            </div>
            <div class="navbar-mobile-menu" onclick="">
                <span class="icon-menu cross">
                    <span class="middle"></span>
                </span>
                <ul>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', 'http://localhost:2333/')">é¦–é¡µ</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å‰ç«¯', 'http://localhost:2333/front')">å‰ç«¯</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å†å²', 'http://localhost:2333/history')">å†å²</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…¶ä»–', 'http://localhost:2333/other')">å…¶ä»–</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', 'http://localhost:2333/tags')">æ ‡ç­¾</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…³äº', 'http://localhost:2333/README')">å…³äº</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </header>
    <a href="#header" class="back-to-top" onclick="onClickTop('Webpack Bundle Analysis')">â¤´Topâ¤´</a>
    <div class="post-header-thumb bg-white}">
        <div class="post-header-thumb-op"></div>
        <div class="post-header-thumb">
            <div class="post-header-thumb-container">
                <h1 class="post-title" itemprop="name headline">
                    Webpack Bundle Analysis</h1>
                <div class="post-data">
                    <time datetime="2020-07-21 12:05:00" itemprop="datePublished">
                      å‘å¸ƒæ—¶é—´ï¼š2020-07-21 12:05:00
                      &nbsp;&nbsp;&nbsp;
                      
                        ä¿®æ”¹æ—¶é—´ï¼š2020-07-22 18:03:00
                      
                    </time>
                    <a onclick="onClickCategory('å‰ç«¯')" href="Javascript:;" title="è®¿é—® å‰ç«¯" data-hover="åšå®¢åˆ†ç±»: å‰ç«¯">åšå®¢åˆ†ç±»: å‰ç«¯</a>
                    <!-- <a href="#read"> é˜…è¯»æ¬¡æ•°: comments</a>  -->
                </div>
                <div class="post-tags">
                       
                    <a class="menu-item-tags" href="Javascript:;" onclick="onClickTag('webpack')" title="è®¿é—®webpack" data-hover="webpack">
                        webpack
                        <span>(1)</span>
                        
                    </a>
                       
                </div>
            </div>
        </div>
    </div>
    <article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
        <div class="post-header">
            <h1 class="post-title" itemprop="name headline">
                Webpack Bundle Analysis</h1>
            <div class="post-data">
                <time datetime="2020-07-21 12:05:00" itemprop="datePublished">2020-07-21 12:05:00</time>
            </div>
        </div>
        <div id="post-content" class="post-content" itemprop="articleBody">
            <p class="post-tags">
                   
                <a href="Javascript:;" onclick="onClickTag('webpack')" title="è®¿é—®webpack" data-hover="webpack">
                    webpack
                    <span>(1)</span>
                    </a>
                   
            </p>
            <h1 id="webpack-bundle-analysis">Webpack Bundle Analysis</h1>

<p>å¾ˆå¤šæ—¶å€™ï¼Œä¸ºäº†å‡å°‘å‹ç¼©åŒ…çš„ä½“ç§¯ï¼ŒåŠ å¿«ç½‘ç«™çš„å“åº”é€Ÿåº¦ï¼Œæˆ‘ä»¬å¿…é¡»è¦å¯¹è¿™äº›å‹ç¼©åŒ…è¿›è¡Œåˆ†æï¼Œæœ€å¤§ç¨‹åº¦ä¸Šå»å‡å°‘å®ƒçš„ä½“ç§¯ã€‚ç°é˜¶æ®µæœ‰å¾ˆå¤šå¥½ç”¨çš„å·¥å…·ï¼Œä¸‹é¢æ•´ç†ä¸‹:</p>

<ol>
  <li><a href="http://webpack.github.io/analyse/"><strong>webapck analyse</strong></a> - webpack official</li>
  <li><a href="https://alexkuz.github.io/webpack-chart/"><strong>webpack-chart</strong></a> - Interactive pie chart for webpack stats.</li>
  <li><a href="https://chrisbateman.github.io/webpack-visualizer/"><strong>webpack-visualizer</strong></a> - Visualize and analyze your bundles to see which modules are taking up space and which might be duplicates.</li>
  <li><strong>webpack-bundle-analyzer</strong> - A plugin and CLI utility that represents bundle content as a convenient interactive zoomable treemap.</li>
  <li><a href="https://webpack.jakoblind.no/optimize/">webpack bundle optimize helper</a> - This tool will analyze your bundle and give you actionable suggestions on what to improve to reduce your bundle size.</li>
  <li><a href="https://github.com/relative-ci/bundle-stats">bundle-stats</a> - Generate a bundle report(bundle size, assets, modules) and compare the results between different builds.</li>
</ol>

<blockquote>
  <p>éƒ¨åˆ†åœ¨çº¿åˆ†æå·¥å…·ï¼Œéœ€è¦å…ˆåœ¨é¡¹ç›®ä¸­è¿è¡Œ <code class="highlighter-rouge">webpack --profile --json &gt; stats.json</code>ï¼Œç„¶åå°†ç”Ÿæˆçš„ json æ–‡ä»¶ä¸Šä¼ å³å¯ ğŸ‘ˆ</p>
</blockquote>

<h2 id="webpack-bundle-analyzer">webpack-bundle-analyzer</h2>

<p><a href="https://github.com/webpack-contrib/webpack-bundle-analyzer"><strong>webpack-bundle-analyzer</strong></a> æ˜¯ä¸€æ¬¾æ‰“åŒ…æ–‡ä»¶ä½“ç§¯å¯è§†åŒ–ä¸”å¯äº¤äº’çš„ webpack æ’ä»¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é’ˆå¯¹ä½“ç§¯è¾ƒå¤§çš„å‹ç¼©æ–‡ä»¶è¿›è¡Œä¼˜åŒ–æ“ä½œã€‚é¦–å…ˆçœ‹ä¸‹æ€ä¹ˆé…ç½®:</p>

<p>1ã€å®‰è£…</p>

<pre><code class="language-SHELL">ya -D webpack-bundle-analyzer
</code></pre>

<p>2ã€åœ¨ <code class="highlighter-rouge">webpack.config.js</code>(æˆ–å…¶ä»–æ–‡ä»¶ï¼Œåªæ˜¯ä¸¾ä¾‹) ä¸­é…ç½®</p>

<pre><code class="language-JS">// 1ã€å¯¼å…¥
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin
// ...
module.exports = {
  plugins: [
    new BundleAnalyzerPlugin()  // ä½¿ç”¨é»˜è®¤é…ç½®
    // é»˜è®¤é…ç½®çš„å…·ä½“é…ç½®é¡¹
    // new BundleAnalyzerPlugin({
    //   analyzerMode: 'server',
    //   analyzerHost: '127.0.0.1',
    //   analyzerPort: '8888',
    //   reportFilename: 'report.html',
    //   defaultSizes: 'parsed',
    //   openAnalyzer: true,
    //   generateStatsFile: false,
    //   statsFilename: 'stats.json',
    //   statsOptions: null,
    //   excludeAssets: null,
    //   logLevel: info
    // })
  ]
}
</code></pre>

<p>3ã€åœ¨ <code class="highlighter-rouge">package.json</code> çš„è„šæœ¬ä¸­æ’å…¥å‘½ä»¤</p>

<pre><code class="language-JSON">{
  "scripts": {
    "analyse": "NODE_ENV=production npm_config_report=true npm run build"
  }
}
</code></pre>

<p>4ã€ç›´æ¥è¿è¡Œ <code class="highlighter-rouge">npm run analyse</code>ï¼Œè‡ªåŠ¨ä¼šåœ¨çª—å£æ‰“å¼€ <code class="highlighter-rouge">http://127.0.0.1:8888</code> è®¿é—®åˆ†æç»“æœï¼Œå¹¶ä¸”è¿˜èƒ½çœ‹åˆ°ä¸ä¸Šæ¬¡ç›¸æ¯”å‹ç¼©åŒ…çš„å¤§å°å¢å‡æƒ…å†µ:</p>

<pre><code class="language-TEXT">39.77 KB (-23.25 KB)  build/static/js/2.258f3e7a.chunk.js
</code></pre>

<p><img src="https://cloud.githubusercontent.com/assets/302213/20628702/93f72404-b338-11e6-92d4-9a365550a701.gif" alt="webpack-bundle-analyzer" /></p>

<h2 id="å‡å°‘-lodash-ä½“ç§¯">å‡å°‘ lodash ä½“ç§¯</h2>

<p>æˆ‘ä»¬ä»¥ lodash ä¸ºç¤ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨ä¸‹é¢è¿™ç§å¯¼å…¥æ–¹å¼ï¼Œåˆ™ä¼šå¼•å…¥ lodash æ•´ä¸ªæ–‡ä»¶ï¼Œè¿™æ˜¾ç¤ºæ˜¯ä¸åˆç†çš„:</p>

<pre><code class="language-JS">import { set } from 'lodash'
</code></pre>

<p><img src="http://localhost:2333/style/images/smms/webpack-bundle-analyzer-lodash-1.png" alt="lodash1" /></p>

<h3 id="å•ç‹¬å¼•å…¥">å•ç‹¬å¼•å…¥</h3>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸å‹ç¼©çš„æƒ…å†µä¸‹æœ‰ 528.6kbï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ€ä¹ˆè§£å†³å‘¢ï¼Œå¼•å…¥çš„æ—¶å€™éœ€è¦è¿™ä¹ˆåš:</p>

<pre><code class="language-JS">import set from 'lodash/set'
</code></pre>

<p><img src="http://localhost:2333/style/images/smms/webpack-bundle-analyzer-lodash-2.png" alt="lodash2" /></p>

<p>æˆ‘ä»¬å†æ¥å¯¹æ¯”ä¸‹ä½“ç§¯å¤§å°ï¼Œä¸€ç›®äº†ç„¶ï¼Œç›´æ¥ç¼©å°åˆ°äº† 7.99kbï¼Œå› ä¸ºæˆ‘ä»¬åªå¼•ç”¨äº† set è¿™ä¸€ä¸ªæ–¹æ³•ã€‚ä½†æ˜¯è¿™æ ·åšæœ‰ä¸ªä¸æ–¹ä¾¿çš„åœ°æ–¹ï¼Œå°±æ˜¯å¦‚æœå¼•å…¥å¾ˆå¤šä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæ¯ä¸ªéƒ½è¦å•ç‹¬å»å¯¼å…¥ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä¸¤å…¨å…¶ç¾å‘¢ï¼Ÿé‚£å°±å¯ä»¥ç”¨è¿™æ¬¡è¦ä»‹ç»çš„è¿™ä¸ªæ’ä»¶ã€‚ ğŸ‘‡</p>

<h3 id="lodash-webpack-plugin">lodash-webpack-plugin</h3>

<p>1ã€å®‰è£…</p>

<pre><code class="language-SHELL">npm i --save-dev lodash-webpack-plugin babel-core babel-loader babel-plugin-lodash babel-preset-env webpack
</code></pre>

<p>2ã€åœ¨ <code class="highlighter-rouge">webpack.config.js</code>(æˆ–å…¶ä»–æ–‡ä»¶ï¼Œåªæ˜¯ä¸¾ä¾‹) ä¸­é…ç½®</p>

<pre><code class="language-JS">// 1ã€å¯¼å…¥
var LodashModuleReplacementPlugin = require('lodash-webpack-plugin')
// ...
module.exports = {
  'module': {
    'rules': [{
      'use': 'babel-loader',
      'test': /\.js$/,
      'exclude': /node_modules/,
      'options': {
        'plugins': ['lodash'], // 2ã€æ’ä»¶
        'presets': [['env', { 'modules': false, 'targets': { 'node': 4 } }]]
      }
    }]
  },
  'plugins': [
    new LodashModuleReplacementPlugin() // 3ã€æ’ä»¶
  ]
}
</code></pre>

<p>OKï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä¿®æ”¹ä¸ºæœ€å¼€å§‹çš„å¯¼å…¥æ–¹å¼ï¼Œå³ <code class="highlighter-rouge">import { set } from 'lodash'</code>ï¼Œå¯ä»¥çœ‹åˆ°ä½“ç§¯ä¹Ÿå‡å°åˆ°äº† 7.99kbï¼Œå’Œå•ç‹¬å¼•å…¥ä¸€æ ·ã€‚</p>

<h3 id="lodash-es">lodash-es</h3>

<p><strong>lodash-es</strong> æ˜¯å…·å¤‡ ES6 æ¨¡å—åŒ–çš„ç‰ˆæœ¬ï¼Œé‚£æˆ‘ä»¬ä¸å°±å¯ä»¥åˆ©ç”¨ <strong>Tree Shaking</strong> æ¥å‰”é™¤ä¸éœ€è¦çš„å¼•ç”¨ä¹ˆï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥è¿™æ ·å†™å°±è¡Œäº†ï¼ŒçœŸé¦™:</p>

<pre><code class="language-JS">import { isEmpty, isObject, cloneDeep } from 'lodash-es'
</code></pre>

<p><img src="http://localhost:2333/style/images/smms/webpack-bundle-analyzer-lodash-3.png" alt="lodash3" /></p>

<h2 id="ä»£ç åˆ†ç¦»-code-splitting">ä»£ç åˆ†ç¦» Code Splitting</h2>

<p>webpack èƒ½å¤ŸæŠŠä»£ç åˆ†ç¦»åˆ°ä¸åŒçš„ bundle ä¸­ï¼Œå³ <strong>ä»£ç åˆ†ç¦»(Code Splitting)</strong>ï¼Œç„¶åå¯ä»¥æŒ‰éœ€åŠ è½½æˆ–å¹¶è¡ŒåŠ è½½è¿™äº›æ–‡ä»¶ã€‚ä»£ç åˆ†ç¦»å¯ä»¥ç”¨äºè·å–æ›´å°çš„ bundleï¼Œä»¥åŠæ§åˆ¶èµ„æºåŠ è½½ä¼˜å…ˆçº§ï¼Œå¦‚æœä½¿ç”¨åˆç†ï¼Œä¼šæå¤§å½±å“åŠ è½½æ—¶é—´ã€‚å¸¸ç”¨çš„ä»£ç åˆ†ç¦»æ–¹æ³•æœ‰ä¸‰ç§:</p>

<ul>
  <li>å…¥å£èµ·ç‚¹(entry point) - ä½¿ç”¨ entry é…ç½®æ‰‹åŠ¨åœ°åˆ†ç¦»ä»£ç </li>
  <li>é˜²æ­¢é‡å¤(prevent duplication) - ä½¿ç”¨ <strong>SplitChunksPlugin</strong> å»é‡å’Œåˆ†ç¦» chunk</li>
  <li>åŠ¨æ€å¯¼å…¥(dynamic imports) - é€šè¿‡æ¨¡å—çš„å†…è”å‡½æ•°è°ƒç”¨æ¥åˆ†ç¦»ä»£ç </li>
</ul>

<h3 id="å…¥å£èµ·ç‚¹-entry-point">å…¥å£èµ·ç‚¹ entry point</h3>

<p>è¿™æ˜¯æœ€ç®€å•ç›´è§‚çš„åˆ†ç¦»ä»£ç çš„æ–¹å¼ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼æ‰‹åŠ¨é…ç½®è¾ƒå¤šï¼Œç›®å‰æœ‰ä¸€äº›éšæ‚£ã€‚å…ˆæ¥çœ‹çœ‹å¦‚ä½•ä» main bundle ä¸­åˆ†ç¦» another module(å¦ä¸€ä¸ªæ¨¡å—):</p>

<pre><code class="language-JS">// webpack.config.js
const path = require('path');

module.exports = {
  mode: 'development',
  entry: {
    index: './src/index.js',
+   another: './src/another-module.js', // æ–°å¢
  },
  output: {
    filename: '[name].bundle.js',
    path: path.resolve(__dirname, 'dist'),
  },
};
</code></pre>

<p>åˆ™ä¼šç”Ÿæˆå¦‚ä¸‹æ„å»ºç»“æœ:</p>

<pre><code class="language-TEXT">            Asset     Size   Chunks             Chunk Names
another.bundle.js  550 KiB  another  [emitted]  another
  index.bundle.js  550 KiB    index  [emitted]  index
Entrypoint index = index.bundle.js
Entrypoint another = another.bundle.js
</code></pre>

<p>è¿™ç§åˆ†ç¦»æ–¹å¼å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚:</p>

<ol>
  <li>å¦‚æœå…¥å£ chunk ä¹‹é—´åŒ…å«ä¸€äº›é‡å¤çš„æ¨¡å—ï¼Œé‚£äº›é‡å¤æ¨¡å—éƒ½ä¼šè¢«å¼•å…¥åˆ°å„ä¸ª bundle ä¸­ã€‚æ¯”å¦‚ä¸¤è€…éƒ½å¼•å…¥ lodash</li>
  <li>è¿™ç§æ–¹æ³•ä¸å¤Ÿçµæ´»ï¼Œå¹¶ä¸”ä¸èƒ½åŠ¨æ€åœ°å°†æ ¸å¿ƒåº”ç”¨ç¨‹åºé€»è¾‘ä¸­çš„ä»£ç æ‹†åˆ†å‡ºæ¥ã€‚</li>
</ol>

<h3 id="é˜²æ­¢é‡å¤-prevent-duplication">é˜²æ­¢é‡å¤ prevent duplication</h3>

<p>åœ¨å…¥å£ä¾èµ–é…ç½® <code class="highlighter-rouge">dependOn option</code> é€‰é¡¹ï¼Œè¿™æ ·å¯ä»¥åœ¨å¤šä¸ª chunk ä¹‹é—´å…±äº«æ¨¡å—:</p>

<pre><code class="language-JS">  const path = require('path');

  module.exports = {
    mode: 'development',
    entry: {
-     index: './src/index.js',
-     another: './src/another-module.js',
+     index: { import: './src/index.js', dependOn: 'shared' },
+     another: { import: './src/another-module.js', dependOn: 'shared' },
+     shared: 'lodash', // å…¬å…±çš„ä¾èµ–æ¨¡å—
      // 'react-vendors': ['react', 'react-dom', 'prop-types']
    },
    output: {
      filename: '[name].bundle.js',
      path: path.resolve(__dirname, 'dist'),
    },
  };
</code></pre>

<p>SplitChunksPlugin æ’ä»¶å¯ä»¥å°†å…¬å…±çš„ä¾èµ–æ¨¡å—æå–åˆ°å·²æœ‰çš„å…¥å£ chunk ä¸­ï¼Œæˆ–è€…æå–åˆ°ä¸€ä¸ªæ–°ç”Ÿæˆçš„ chunkã€‚è®©æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œå°†ä¹‹å‰çš„ç¤ºä¾‹ä¸­é‡å¤çš„ lodash æ¨¡å—å»é™¤:</p>

<pre><code class="language-JS">const path = require('path');

  module.exports = {
    mode: 'development',
    entry: {
      index: './src/index.js',
      another: './src/another-module.js',
    },
    output: {
      filename: '[name].bundle.js',
      path: path.resolve(__dirname, 'dist'),
    },
+   optimization: {
+     splitChunks: {
+       chunks: 'all',
+     },
+   },
  };
</code></pre>

<p>ç°åœ¨åº”è¯¥å¯ä»¥çœ‹å‡ºï¼Œindex.bundle.js å’Œ another.bundle.js ä¸­å·²ç»ç§»é™¤äº†é‡å¤çš„ä¾èµ–æ¨¡å—ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ’ä»¶å°† lodash åˆ†ç¦»åˆ°å•ç‹¬çš„ chunkï¼Œå¹¶ä¸”å°†å…¶ä» main bundle ä¸­ç§»é™¤ï¼Œå‡è½»äº†å¤§å°:</p>

<pre><code class="language-TEXT">                          Asset      Size                 Chunks             Chunk Names
              another.bundle.js  5.95 KiB                another  [emitted]  another
                index.bundle.js  5.89 KiB                  index  [emitted]  index
vendors~another~index.bundle.js   547 KiB  vendors~another~index  [emitted]  vendors~another~index
Entrypoint index = vendors~another~index.bundle.js index.bundle.js
Entrypoint another = vendors~another~index.bundle.js another.bundle.js
</code></pre>

<h3 id="åŠ¨æ€å¯¼å…¥-dynamic-imports">åŠ¨æ€å¯¼å…¥ dynamic imports</h3>

<h4 id="magic-comments">magic comments</h4>

<p>è¿˜æ˜¯é’ˆå¯¹ä¸Šè¿°çš„åœºæ™¯ï¼Œè¦åˆ†ç¦»å‡º lodash å•ç‹¬æ‰“åŒ…ï¼Œåˆ™éœ€è¦ä½¿ç”¨åˆ° ES6 çš„ import å®ç°åŠ¨æ€åŠ è½½:</p>

<pre><code class="language-JS">async function getComponent() {
  const element = document.createElement('div');
  // å°†ä¼šæ‰“åŒ…ä¸º lodash.bundle.js
  const { default: _ } = await import(/* webpackChunkName: "lodash" */ 'lodash');

  element.innerHTML = _.join(['Hello', 'webpack'], ' ');

  return element;
}

getComponent().then(component =&gt; {
  document.body.appendChild(component);
});
</code></pre>

<p>ä¸Šé¢çš„å†…è”æ³¨é‡Šï¼Œå³ <a href="https://webpack.js.org/api/module-methods/#magic-comments"><strong>magic comments</strong></a>ï¼Œå¯ä»¥è¿›è¡Œè¯¸å¦‚ç»™ chunk å‘½åæˆ–é€‰æ‹©ä¸åŒæ¨¡å¼çš„æ“ä½œ:</p>

<pre><code class="language-JS">// Single target
import(
  /* webpackChunkName: "my-chunk-name" */
  /* webpackMode: "lazy" */
  /* webpackExports: ["default", "named"] */
  'module'
);

// Multiple possible targets
import(
  /* webpackInclude: /\.json$/ */
  /* webpackExclude: /\.noimport\.json$/ */
  /* webpackChunkName: "my-chunk-name" */
  /* webpackMode: "lazy" */
  /* webpackPrefetch: true é¢„è·å–å°†æ¥æŸäº›å¯¼èˆªä¸‹å¯èƒ½éœ€è¦çš„èµ„æº*/
  /* webpackPreload: true é¢„åŠ è½½å½“å‰å¯¼èˆªä¸‹æ‰€éœ€è¦çš„èµ„æº*/
  `./locale/${language}`
);

// webpackIgnoreï¼šè®¾ç½®ä¸º true æ—¶ï¼Œç¦ç”¨åŠ¨æ€å¯¼å…¥è§£æï¼Œä¸è¿›è¡Œä»£ç åˆ†å‰²
import(/* webpackIgnore: true */ 'ignored-module.js');
</code></pre>

<h4 id="prefetch--preload">prefetch / preload</h4>

<p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ª HomePage ç»„ä»¶ï¼Œå…¶å†…éƒ¨æ¸²æŸ“ä¸€ä¸ª LoginButton ç»„ä»¶ï¼Œç„¶ååœ¨ç‚¹å‡»åæŒ‰éœ€åŠ è½½ LoginModal ç»„ä»¶:</p>

<pre><code class="language-JS">import(/* webpackPrefetch: true */ 'LoginModal')
</code></pre>

<p>è¿™ä¼šç”Ÿæˆ <code class="highlighter-rouge">/&lt;link rel="prefetch" href="login-modal-chunk.js"/&gt;</code> å¹¶è¿½åŠ åˆ°é¡µé¢å¤´éƒ¨ï¼ŒæŒ‡ç¤ºç€æµè§ˆå™¨åœ¨é—²ç½®æ—¶é—´é¢„å– <code class="highlighter-rouge">login-modal-chunk.js</code> æ–‡ä»¶ï¼Œä¸ prefetch æŒ‡ä»¤ç›¸æ¯”ï¼Œpreload æŒ‡ä»¤æœ‰è®¸å¤šä¸åŒä¹‹å¤„ï¼Œæµè§ˆå™¨æ”¯æŒç¨‹åº¦ä¹Ÿå¯èƒ½ä¸åŒ:</p>

<ol>
  <li><code class="highlighter-rouge">preload chunk</code> ä¼šåœ¨çˆ¶ chunk åŠ è½½æ—¶ï¼Œä»¥å¹¶è¡Œæ–¹å¼å¼€å§‹åŠ è½½ã€‚<code class="highlighter-rouge">prefetch chunk</code> ä¼šåœ¨çˆ¶ chunk åŠ è½½ç»“æŸåå¼€å§‹åŠ è½½ã€‚</li>
  <li><code class="highlighter-rouge">preload chunk</code> å…·æœ‰ä¸­ç­‰ä¼˜å…ˆçº§ï¼Œå¹¶ç«‹å³ä¸‹è½½ã€‚<code class="highlighter-rouge">prefetch chunk</code> åœ¨æµè§ˆå™¨é—²ç½®æ—¶ä¸‹è½½ã€‚</li>
  <li><code class="highlighter-rouge">preload chunk</code> ä¼šåœ¨çˆ¶ chunk ä¸­ç«‹å³è¯·æ±‚ï¼Œç”¨äºå½“ä¸‹æ—¶åˆ»ã€‚<code class="highlighter-rouge">prefetch chunk</code> ä¼šç”¨äºæœªæ¥çš„æŸä¸ªæ—¶åˆ»ã€‚</li>
</ol>

<h4 id="react-loadable-å®è·µ">react-loadable å®è·µ</h4>

<p>æ¯”å¦‚ react å¯ä»¥ä½¿ç”¨ <strong>react-loadable</strong>ï¼Œè¿™ä¸ªä¹‹å‰å·²ç»ä»‹ç»è¿‡äº†:</p>

<pre><code class="language-JSX">import Loadable from 'react-loadable'
import Loading from './Loading'

const components = {
  ListComponent: Loadable({
    loader: () =&gt; import('../list/ListComponent'),
    loading: Loading,
  }),
  LayoutComponent: Loadable({
    loader: () =&gt; import('../layout/LayoutComponent'),
    loading: Loading,
  }),
}

export default components
</code></pre>

<p>é‚£ä¹ˆ vue æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿå®˜æ–¹ç»™äº†ä¸€æ®µå¼‚æ­¥ç»„ä»¶çš„ä»£ç :</p>

<pre><code class="language-JS">const AsyncComponent = () =&gt; ({
  // The component to load (should be a Promise)
  component: import('./MyComponent.vue'),
  // A component to use while the async component is loading
  loading: LoadingComponent,
  // A component to use if the load fails
  error: ErrorComponent,
  // Delay before showing the loading component. Default: 200ms.
  delay: 200,
  // The error component will be displayed if a timeout is
  // provided and exceeded. Default: Infinity.
  timeout: 3000
})
</code></pre>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code class="highlighter-rouge">loadable.js</code> çš„é«˜é˜¶ç»„ä»¶ï¼Œåˆ©ç”¨ render å‡½æ•°ç”Ÿæˆç»„ä»¶å¹¶è¿”å›å³å¯:</p>

<pre><code class="language-JS">import LoadingComponent from './loading.vue'

export default (component) =&gt; {
  const asyncComponent = () =&gt; ({
    component: component(),
    loading: LoadingComponent,
    delay: 200,
    timeout: 3000
  })
  return {
    render(h) {
      return h(asyncComponent, {});
    }
  }
}
</code></pre>

<p>åœ¨è·¯ç”±(Vue Router 2.4.0+)ä¸­ä½¿ç”¨è¯¥ç»„ä»¶:</p>

<pre><code class="language-JS">
import loadable from './loadable'

const routes = [{
  path: '/about',
  name: 'about',
  // component: () =&gt; import(/* webpackChunkName: "about" */ './views/About.vue')
  component: loadable( () =&gt; import(/* webpackChunkName: "about" */ './views/About.vue')
}]
</code></pre>

<h2 id="tree-shaking">Tree Shaking</h2>

<h3 id="side-effect-free">side-effect-free</h3>

<p>æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·ä¸€ç§åœºæ™¯ï¼Œæœ‰ä¸ª utils æ–‡ä»¶å®šä¹‰äº†å¾ˆå¤šæ–¹æ³•ï¼Œä½†æ˜¯å¤–éƒ¨æ–‡ä»¶åªå¼•ç”¨äº†å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œè€Œæ‰“åŒ…çš„æ—¶å€™ï¼Œutils å…¨éƒ¨æ‰“è¿›å»äº†ï¼Œä½†å…¶å®æˆ‘ä»¬åªéœ€è¦å…¶ä¸­ç”¨åˆ°çš„ä¸€éƒ¨åˆ†è€Œå·²ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°è¿™é‡Œè¦ä»‹ç»çš„ <strong>Tree Shaking</strong>ï¼Œå®ƒé€šå¸¸ç”¨äºæè¿°ç§»é™¤ JavaScript ä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç (dead-code)ï¼Œè¿™ä¸ªæœ¯è¯­å’Œæ¦‚å¿µå®é™…ä¸Šæ˜¯ç”± ES2015 æ¨¡å—æ‰“åŒ…å·¥å…· <strong>rollup</strong> æ™®åŠèµ·æ¥çš„ã€‚</p>

<p>dead-code ä¸€èˆ¬å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹å¾:</p>

<ol>
  <li>ä»£ç ä¸ä¼šè¢«æ‰§è¡Œï¼Œä¸å¯åˆ°è¾¾</li>
  <li>ä»£ç æ‰§è¡Œçš„ç»“æœä¸ä¼šè¢«ç”¨åˆ°</li>
  <li>ä»£ç åªä¼šå½±å“æ­»å˜é‡ï¼ˆåªå†™ä¸è¯»ï¼‰</li>
</ol>

<p>æˆ‘ä»¬ç¬¬ä¸€æ­¥è¦åšçš„æ˜¯å°†æ–‡ä»¶æ ‡è®°ä¸º <strong>side-effect-free(æ— å‰¯ä½œç”¨)</strong>ï¼Œç”¨æ¥æç¤º <code class="highlighter-rouge">webpack compiler</code> å“ªäº›ä»£ç æ˜¯â€œçº¯ç²¹éƒ¨åˆ†â€ã€‚å¦‚æœæ‰€æœ‰ä»£ç éƒ½ä¸åŒ…å« side effectï¼Œæˆ‘ä»¬å°±å¯ä»¥ç®€å•åœ°å°†è¯¥å±æ€§æ ‡è®°ä¸º falseï¼Œæ¥å‘ŠçŸ¥ webpackï¼Œå®ƒå¯ä»¥å®‰å…¨åœ°åˆ é™¤æœªç”¨åˆ°çš„ export:</p>

<pre><code class="language-JSON">// package.json
{
  "name": "your-project",
  "sideEffects": false
}
</code></pre>

<p>å¦‚æœä½ çš„ä»£ç ç¡®å®æœ‰ä¸€äº›å‰¯ä½œç”¨ï¼Œå¯ä»¥æ”¹ä¸ºæä¾›ä¸€ä¸ªæ•°ç»„:</p>

<pre><code class="language-JSON">// æ•°ç»„æ–¹å¼æ”¯æŒç›¸å¯¹è·¯å¾„ã€ç»å¯¹è·¯å¾„å’Œ glob æ¨¡å¼åŒ¹é…ç›¸å…³æ–‡ä»¶
{
  "name": "your-project",
  "sideEffects": [
    "./src/some-side-effectful-file.js",
     "*.css"
  ]
}
</code></pre>

<blockquote>
  <p>æ³¨æ„ï¼Œæ‰€æœ‰å¯¼å…¥æ–‡ä»¶éƒ½ä¼šå—åˆ° tree shaking çš„å½±å“ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç±»ä¼¼ css-loader å¹¶ import ä¸€ä¸ª CSS æ–‡ä»¶ï¼Œåˆ™éœ€è¦å°†å…¶æ·»åŠ åˆ° side effect åˆ—è¡¨ä¸­ï¼Œä»¥å…åœ¨ç”Ÿäº§æ¨¡å¼ä¸­æ— æ„ä¸­å°†å®ƒåˆ é™¤ã€‚</p>
</blockquote>

<p>è¿™é‡Œæ‰€æåˆ°çš„å‰¯ä½œç”¨å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå‡½æ•°ä¼šä¼šå¯¹å‡½æ•°å¤–éƒ¨å˜é‡äº§ç”Ÿå½±å“çš„è¡Œä¸º:</p>

<pre><code class="language-JS">function go(url) {
  window.location.href = url
}

</code></pre>

<p>æˆ‘ä»¬æ¥çœ‹è¿™æ ·ä¸€ä¸ªæ —å­:</p>

<pre><code class="language-JS">// App.js
import { cube } from './utils.js';
cube(2); // åªæœ‰ cube è¢«è°ƒç”¨

// utils.js
export function square(x) { // ä¼šè¢« shake æ‰
  console.log('square');
  return x * x;
}

export function cube(x) {
  console.log('cube');
  return x * x * x;
}
</code></pre>

<blockquote>
  <p>ä¸Šè¿°çš„éƒ½æ˜¯é’ˆå¯¹ js çš„ä¼˜åŒ–ï¼Œä¹Ÿæœ‰é’ˆå¯¹ css è¿›è¡Œä¼˜åŒ–çš„ï¼Œå¯ä»¥å‚è€ƒä¸‹ç¬¬ä¸‰æ–¹çš„æ’ä»¶ <a href="https://github.com/lin-xi/webpack-css-treeshaking-plugin"><strong>webpack-css-treeshaking-plugin</strong></a>ï¼Œå…¶æ ¸å¿ƒç†å¿µæ˜¯:</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/lin-xi/webpack-css-treeshaking-plugin/master/architechture.png" alt="webpack-css-treeshaking-plugin" /></p>

<h3 id="pure-æ³¨é‡Š">PURE æ³¨é‡Š</h3>

<p>ç”±äº JS è¯­æ³•çš„å¤æ‚ç¨‹åº¦ï¼Œwebpack æ²¡æœ‰æ‰“ç®—ç»™ JS å®ç°æ•°æ®æµåˆ†æï¼Œæ‰€ä»¥æ’ä»¶æ˜¯æ— æ³•çŸ¥é“ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ˜¯å¦å…·æœ‰å‰¯ä½œç”¨çš„ã€‚æ‰€ä»¥å¯¹äºä¸€äº›å¯¼å‡ºæ¨¡å—ï¼Œå¦‚æœæ˜¯çº¯çš„å‡½æ•°è°ƒç”¨ï¼Œåˆ™éœ€è¦åŠ ä¸Š <code class="highlighter-rouge">/*@__PURE__*/</code> æ³¨é‡Šæ¥è¡¨æ˜è¿™ä¸ªå‡½æ•°æ˜¯ pure çš„ï¼Œè¿™æ˜¯ Uglify ä½¿ç”¨çš„æ–¹æ³•ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸å…³çš„ babel æ’ä»¶è¿›è¡Œæ‰¹é‡æ·»åŠ ã€‚</p>

<h3 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h3>

<blockquote>
  <p>Tree Shaking åªæ˜¯å°½å¯èƒ½ä¼˜åŒ–æˆ‘ä»¬çš„é¡¹ç›®ï¼Œä½†æ˜¯å‰ææ˜¯ä¸å½±å“åŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œæ•ˆæœå¯èƒ½ä¸æ˜¯é‚£ä¹ˆå¥½ã€‚</p>
</blockquote>

<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒTree Shaking å¯¹äº IIFE(ç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼)æ˜¯æ— æ•ˆçš„ï¼Œä¸ä¼šåˆ é™¤ã€‚è¿˜æœ‰ä¸€ç§åœºæ™¯:</p>

<pre><code class="language-JS">// App.js
import { Add } from './utils'
Add(1 + 2);

// utils.js
import { isArray } from 'lodash-es';

// array æ–¹æ³•å¼•ç”¨äº† isArrayï¼Œä½†æ˜¯æ–¹æ³•æœ¬èº«æ²¡æœ‰è¢«å¼•ç”¨
export function array(array) {
  console.log('isArray');
  return isArray(array);
}

export function Add(a, b) {
  console.log('Add');
  return a + b
}
</code></pre>

<p>ä¸Šè¿°è¿™ç§åœºæ™¯ webpack æ— æ³•è¯†åˆ«å‡ºï¼Œä½†å¯ä»¥ä½¿ç”¨ <a href="https://github.com/vincentdchan/webpack-deep-scope-analysis-plugin"><strong>webpack-deep-scope-analysis-plugin</strong></a> æ’ä»¶è§£å†³ã€‚</p>

<h2 id="terser-webpack-plugin">terser-webpack-plugin</h2>

<p>å¯¹äºä¸åŒç¯å¢ƒï¼Œæˆ‘ä»¬æ‰“åŒ…æ—¶çš„ç­–ç•¥ä¹Ÿä¸åŒï¼Œæ¯”å¦‚æµ‹è¯•ç¯å¢ƒä¸éœ€è¦å‹ç¼©ï¼Œéœ€è¦ä¸Šä¼  <code class="highlighter-rouge">sourcemap</code> ä»¥ä¾›è°ƒè¯•ç­‰ï¼Œå¯ä»¥ç®€å•çš„çœ‹ä¸ª <a href="https://github.com/webpack-contrib/terser-webpack-plugin"><strong>terser-webpack-plugin</strong></a> çš„ç¤ºä¾‹:</p>

<pre><code class="language-JS">module.exports = {
  optimization: {
    minimize: isEnvProduction,
    minimizer: [
      new TerserPlugin({
        terserOptions: {
          parse: {
            // We want terser to parse ecma 8 code. However, we don't want it
            // to apply any minification steps that turns valid ecma 5 code
            // into invalid ecma 5 code. This is why the 'compress' and 'output'
            // sections only apply transformations that are ecma 5 safe
            // https://github.com/facebook/create-react-app/pull/4234
            ecma: 8,
          },
          compress: {
            ecma: 5,
            warnings: false,
            // Disabled because of an issue with Uglify breaking seemingly valid code:
            // https://github.com/facebook/create-react-app/issues/2376
            // Pending further investigation:
            // https://github.com/mishoo/UglifyJS2/issues/2011
            comparisons: false,
            // Disabled because of an issue with Terser breaking valid code:
            // https://github.com/facebook/create-react-app/issues/5250
            // Pending further investigation:
            // https://github.com/terser-js/terser/issues/120
            inline: 2,
          },
          mangle: {
            safari10: true,
          },
          // Added for profiling in devtools
          keep_classnames: isEnvProductionProfile,
          keep_fnames: isEnvProductionProfile,
          output: {
            ecma: 5,
            comments: false,
            // Turned on because emoji and regex is not minified properly using default
            // https://github.com/facebook/create-react-app/issues/2488
            ascii_only: true,
          },
        },
        // Use multi-process parallel running to improve the build speed
        // Default number of concurrent runs: os.cpus().length - 1
        // Disabled on WSL (Windows Subsystem for Linux) due to an issue with Terser
        // https://github.com/webpack-contrib/terser-webpack-plugin/issues/21
        parallel: !isWsl,
        // Enable file caching
        cache: true,
        sourceMap: shouldUseSourceMap,
      }),
    ],
  },
};
</code></pre>

<h2 id="dllplugin--dllreferenceplugin">DllPlugin / DllReferencePlugin</h2>

<p><a href="https://www.webpackjs.com/plugins/dll-plugin/"><strong>DLLPlugin / DLLReferencePlugin</strong></a> å°†ç‰¹å®šçš„ç¬¬ä¸‰æ–¹æ¨¡å—æå‰æ„å»ºï¼Œç„¶åé€šè¿‡é¡µé¢å¼•å…¥ã€‚è¿™ä¸ä»…èƒ½å¤Ÿä½¿å¾— vendor æ–‡ä»¶å¯ä»¥å¤§å¹…åº¦å‡å°ï¼ŒåŒæ—¶ä¹Ÿæå¤§çš„æé«˜äº†æ„ä»¶é€Ÿåº¦ã€‚DllPlugin è¿™ä¸ªæ’ä»¶ä¼šç”Ÿæˆä¸€ä¸ªåä¸º <code class="highlighter-rouge">manifest.json</code> çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥è®© DLLReferencePlugin æ˜ å°„åˆ°ç›¸å…³çš„ä¾èµ–ä¸Šå»çš„ã€‚</p>

<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äº reactï¼Œreact-dom ç­‰è¿™äº›ä¸ä¼šä¿®æ”¹çš„ä¾èµ–ï¼Œå¯ä»¥è®©å®ƒå’Œä¸šåŠ¡ä»£ç åˆ†å¼€æ‰“åŒ…ã€‚é¦–å…ˆæˆ‘ä»¬å°†è¿™äº›å…¬ç”¨çš„æ¨¡å—å•ç‹¬æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åï¼Œé€šè¿‡ç”Ÿæˆçš„ <code class="highlighter-rouge">manifest.json</code> æ–‡ä»¶å¯¹åº”ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º <code class="highlighter-rouge">webpack.config.vendor.js</code> æ–‡ä»¶:</p>

<pre><code class="language-JS">// webpack.config.vendor.js
const webpack = require('webpack');
const path = require('path');

const vendor = ['react', 'react-dom', 'lodash-es', ...]

module.exports = {
  entry: {
    vendor,
  },
  output: {
    path: path.join(__dirname, 'dll', 'dist-[hash]'),
    filename: '[name].js',
    library: '[name]',
  },
  plugins: [
    new webpack.DllPlugin({
      context: __dirname,
      path: path.join(__dirname, 'dll', '[name]-manifest.json'),
      name: '[name]_[hash]',
    }),
  ]
};
</code></pre>

<p>æ¥ä¸‹æ¥ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code class="highlighter-rouge">package.json</code> è„šæœ¬ä¸­æ’å…¥å‘½ä»¤ï¼Œç„¶åæ‰§è¡Œåœ¨å¯¹åº”ç›®å½•æ‰“åŒ…å‡ºé™æ€å…¬å…±æ–‡ä»¶:</p>

<pre><code class="language-JSON">{
  "scripts": {
    "build:dll": "webpack -p --progress --config path/webpack.config.vendor.js"
  }
}
</code></pre>

<p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ„å»ºåº”ç”¨çš„é…ç½®æ–‡ä»¶ä¸­ï¼ŒåŠ å…¥æˆ‘ä»¬çš„ DllPlugin çš„é…ç½®ï¼Œè¿™é¡¹å·¥ä½œåˆ™æ˜¯ç”± DllRefrencePlugin å®Œæˆçš„:</p>

<pre><code class="language-JS">// webpack.config.js
const manifest = require('./dll/vendor-manifest.json');
// ...
module.exports = {
  // ...
  plugins: [
    new webpack.DllReferencePlugin({
      context: __dirname, // æ³¨æ„âš ï¸ï¼Œå¿…é¡»è·Ÿ DllPlugin é‡Œé¢è®¾ç½®çš„ context ä¸Šä¸‹æ–‡ä¸€è‡´
      manifest, // æŒ‡å‘ä¸Šä¸€æ­¥ç”Ÿæˆçš„ manifest.json æ–‡ä»¶
    }),
  ]
};
</code></pre>

<p>æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬æŠŠç”Ÿæˆçš„ <code class="highlighter-rouge">vendor.js</code> åµŒå…¥åˆ° html ä¸­å³å¯ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­å¼•ç”¨æ¨¡å—çš„æ–¹å¼è¿˜æ˜¯ä¿æŒä¸å˜:</p>

<pre><code class="language-HTML">&lt;!-- index.html --&gt;
&lt;script type="text/javascript" src="/config/dll/vendor.js"&gt;&lt;/script&gt;

</code></pre>

<p>å†æ¬¡æ‰§è¡Œ <code class="highlighter-rouge">npm run build</code>ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŒ…ä½“ç§¯å°äº†å¾ˆå¤šï¼Œæ„å»ºé€Ÿåº¦ä¹Ÿæå‡äº†ï¼Œå½“ç„¶æˆ‘ä»¬æ˜¯æŠŠä»–ä»¬æŠ½å–å‡ºæ¥ç›´æ¥åµŒå…¥åˆ° html ä¸­äº†ã€‚åœ¨æ¥ä¸‹æ¥çš„æœ¬åœ°å¼€å‘å’Œçº¿ä¸Šæ„å»ºè¿‡ç¨‹ï¼Œé™¤éæˆ‘ä»¬è¦æ›´æ–°å…¶ä¸­çš„èµ„æºç‰ˆæœ¬ï¼Œå¦åˆ™ä¸ç”¨å†é‡å¤é™æ€å…¬å…±èµ„æºçš„æ„å»ºï¼Œæå¤§åœ°ç¼©å‡æˆ‘ä»¬çš„æ„å»ºæ—¶é—´:</p>

<pre><code class="language-TEXT">2.63 KB (-38.99 KB)  build/static/js/2.872399e7.chunk.js
</code></pre>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>

<ol>
  <li><a href="https://juejin.im/post/5a4dc842518825698e7279a9">Tree-Shaking æ€§èƒ½ä¼˜åŒ–å®è·µ - åŸç†ç¯‡</a></li>
  <li><a href="https://juejin.im/post/5a5652d8f265da3e497ff3de">ä½ çš„ Tree-Shaking å¹¶æ²¡ä»€ä¹ˆåµç”¨</a> - ç›¸å­¦é•¿</li>
  <li><a href="https://diverse.space/2018/05/better-tree-shaking-with-scope-analysis">webpack å¦‚ä½•é€šè¿‡ä½œç”¨åŸŸåˆ†ææ¶ˆé™¤æ— ç”¨ä»£ç </a> - Vincent Chan</li>
</ol>
 
<div id="gitalk-container"></div>
<script>
    var gitalk = new Gitalk({
      enable: true,
      clientID: '020f142489f80c92b097',
      clientSecret: '1fa083372b44031cf1b8249251515c4e3d54c69d',
      repo: 'tate-young.github.io',
      owner: 'Tate-Young',
      admin: ['Tate-Young'],
      id: location.pathname,      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
<!-- disqus -->
<!-- <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = 'https://tate-young.github.io/2020/07/21/webpack-bundle-analysis.html';
        this.page.identifier = '/2020/07/21/webpack-bundle-analysis';
        this.page.title = 'Webpack Bundle Analysis';
    };

    (function () { // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document,
            s = d.createElement('script');

        s.src = '//tate.disqus.com/embed.js'; // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript> -->


            <!-- <p class="post-info">
			æœ¬æ–‡ç”± <a href="/">liberxue</a> åˆ›ä½œï¼Œé‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">çŸ¥è¯†å…±äº«ç½²å4.0</a> å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯<br>æœ¬ç«™æ–‡ç« é™¤æ³¨æ˜è½¬è½½/å‡ºå¤„å¤–ï¼Œå‡ä¸ºæœ¬ç«™åŸåˆ›æˆ–ç¿»è¯‘ï¼Œè½¬è½½å‰è¯·åŠ¡å¿…ç½²å<br>æœ€åç¼–è¾‘æ—¶é—´ä¸º:2020-07-21 12:05:00</p> -->
        </div>
    </article>

    <!-- <div class="related-post-lists">
	<div class="post-lists">
		<div class="post-lists-body">
					<div class="post-list-item">
				<div class="post-list-item-container">
					<div class="item-label">
						<div class="item-title"><a href="induction.html">å½’çº³çš„éšæƒ³</a></div>
						<div class="item-meta clearfix">
														<div class="item-meta-ico bg-ico-image" style="background: url('../usr/themes/pinghsu/images/bg-ico.png') no-repeat;background-size: 40px auto;"></div>
	                        							<div class="item-meta-cat"><a href="../category/thoughts/index.html">Thoughts</a></div>
						</div>
					</div>
				</div>
			</div>
				</div>
	</div>
</div> -->

    <!-- <footer class="footer bg-white">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
	 <a class="social segmentfault" target="blank" href="https://segmentfault.com/u/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Segmentfault">Segmentfault</a>
    <a class="social github" target="blank" href="https://github.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="GitHub">GitHub</a>
    <a class="social twitter" target="blank" href="http://twitter.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Twitter">Twitter</a>
     <a class="social stackoverflow" target="blank" href="https://stackoverflow.com/users/6902190/liberxue" title="è®¿é—® LiberXue_stackoverflow" data-hover="StackOverflow">StackOverflow</a>
          <a class="social oschina" target="blank" href="https://my.oschina.net/bolanzw" title="è®¿é—® LiberXue_Oschina" data-hover="Oschina">Oschina</a>
     <a class="social rss" target="blank" href="/feed.xml"title="è®¿é—® LiberXue_RSS" data-hover="RSS">RSS</a>
	</div>
		</div>
	</div>
	<div class="footer-meta">
        <div class="footer-container">
            <div class="meta-item meta-copyright">
                <div class="meta-copyright-info">
                    <a href="/" class="info-logo">
                         <img src="http://localhost:2333/style/images/logo-liberxue.png"   title="è®¿é—® LiberXue_blog" data-hover="LiberXue_blog" alt="LiberXue_blog" /> </a>
                    <div class="info-text">
                        <p>Theme is <a href="http://www.liberxue.com/2017/08/03/Jekyllthemes.html" title="è®¿é—® Jekyll liberxueä¸»é¢˜"  data-hover="Jekyll liberxue"target="_blank">Jekyll liberxue</a> by <a href="http://www.liberxue.com/about" target="_blank">liberxue</a></p>
                        <p>Powered by <a href="http://localhost:2333/tags/#Jekyll" title="Jekyll" data-hover="Jekyll" target="_blank" rel="nofollow">Jekyll</a></p>
                        <p>&copy; 2017 <a href="/feed.xml"  title="è®¿é—® liberxue blog RSS" data-hover="liberxue blog RSS">liberxue blog RSS</a></p>
                        <p>æ€»è®¡æ–‡ç« ï¼šç¯‡</p>
                      <p>æœ¬blogå·²å¼€æºç‚¹å‡»Fork</p><iframe src="http://ghbtns.com/github-btn.html?user=liberxue&repo=liberxue.github.io&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
                    </div>
                </div>
            </div>
            <div class="meta-item meta-posts">
                <h3 class="meta-title">ç½®é¡¶æ–‡ç« </h3>
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
            </div>
            <div class="meta-item meta-comments">
                <h3 class="meta-title">æœ€æ–°æ–‡ç« </h3>
  
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
</div>
		</div>
    </div>
</footer> -->
<script src="//cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>
<script async src="/search/js/520.js"></script>
<script async src="/search/js/gtag.js"></script>
<script async src="/search/live2d/autoload.js"></script>
<!-- <script src="/search/js/canvas.js"></script> -->

<script>
    $(function () {
        setTimeout(function () {
            $('code').removeClass('hljs');
            $('code').removeClass('language');
        }, 90);
    });
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    <!--liberxueconnnet-menu-->
    <div id="directory-content" class="directory-content">
        <div id="directory"></div>
    </div>
    <!--liberxueconnnet-menu-->
    <script>
      const directoryContainer = document.getElementById('directory')
      const postTitle = document.getElementsByClassName('post-title')[0]
      var postDirectoryBuild = function () {
        var postChildren = function children(childNodes, reg) {
          var result = [],
              isReg = typeof reg === 'object',
              isStr = typeof reg === 'string',
              node, i, len;
          for (i = 0, len = childNodes.length; i < len; i++) {
            node = childNodes[i];
            if ((node.nodeType === 1 || node.nodeType === 9) &&
              (!reg ||
                  isReg && reg.test(node.tagName.toLowerCase()) ||
                  isStr && node.tagName.toLowerCase() === reg)) {
                result.push(node);
              }
            }
            return result;
          },
          createPostDirectory = function (article, directory, isDirNum) {
            var contentArr = [],
                titleId = [],
                levelArr, root, level,
                currentList, list, li, link, i, len;
            levelArr = (function (article, contentArr, titleId) {
                  var titleElem = postChildren(article.childNodes, /^h\d$/),
                      levelArr = [],
                      lastNum = 1,
                      lastRevNum = 1,
                      count = 0,
                      guid = 1,
                      id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                      lastRevNum, num, elem;
                  while (titleElem.length) {
                      elem = titleElem.shift();
                      contentArr.push(elem.innerHTML);
                      num = +elem.tagName.match(/\d/)[0];
                      if (num > lastNum) {
                          levelArr.push(1);
                          lastRevNum += 1;
                      } else if (num === lastRevNum ||
                          num > lastRevNum && num <= lastNum) {
                          levelArr.push(0);
                          lastRevNum = lastRevNum;
                      } else if (num < lastRevNum) {
                          levelArr.push(num - lastRevNum);
                          lastRevNum = num;
                      }
                      count += levelArr[levelArr.length - 1];
                      lastNum = num;
                      elem.id = elem.id || (id + guid++);
                      titleId.push(elem.id);
                  }
                  if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                  return levelArr;
              })(article, contentArr, titleId);
              currentList = root = document.createElement('ul');
              dirNum = [0];
              for (i = 0, len = levelArr.length; i < len; i++) {
                  level = levelArr[i];
                  if (level === 1) {
                      list = document.createElement('ul');
                      if (!currentList.lastElementChild) {
                          currentList.appendChild(document.createElement('li'));
                      }
                      currentList.lastElementChild.appendChild(list);
                      currentList = list;
                      dirNum.push(0);
                  } else if (level < 0) {
                      level *= 2;
                      while (level++) {
                          if (level % 2) dirNum.pop();
                          currentList = currentList.parentNode;
                      }
                  }
                  dirNum[dirNum.length - 1]++;
                  li = document.createElement('li');
                  link = document.createElement('a');
                  link.name = '#' + titleId[i];
                  link.href = 'Javascript:;'
                  link.className = "post-aside-anchor"
                  link.title = 'è®¿é—®' + titleId[i];
                  link.innerHTML = !isDirNum ? contentArr[i] :
                      dirNum.join('.') + ' ' + contentArr[i];
                  li.appendChild(link);
                  currentList.appendChild(li);
              }
            directory.appendChild(root);
          };
        createPostDirectory(document.getElementById('post-content'), directoryContainer, true);
      };
      postDirectoryBuild();
    </script>
    <script>
      // gtag('config', GA_TRACKING_ID, {
      //   'page_title' : 'Blog',
      //   'page_path': window.location.pathname,
      //   'post_title': 'watttsdfasdf',
      // });

    </script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        lang = hljs.initHighlightingOnLoad();
    </script>
</body>

</html>
