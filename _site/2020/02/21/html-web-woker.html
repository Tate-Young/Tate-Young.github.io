
<!DOCTYPE>
<html lang="zh-cn" data-scribe-reduced-action-queue="true">
<head>
    <meta content='Web Worker - Tate & Snow' name='title' />
    <meta content='Web Worker - Tate & Snow' name='og:title' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <title>Web Worker - Tate & Snow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Web Worker - Tate & Snow</title>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Web Worker - Tate & Snow">
<meta name="twitter:keywords" content="Web Worker - Tate & Snow" property='og:description' />
<meta property="og:type" content="article">
<meta property="og:title" content="Web Worker - Tate & Snow">
<meta name="og:keywords" content="Web Worker - Tate & Snow|Web Workerä»€ä¹ˆæ˜¯ Web Workeræˆ‘ä»¬éƒ½çŸ¥é“ JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä»£ç åŒæ­¥æ‰§è¡Œæ—¶ï¼Œåç»­ä»£ç å¿…é¡»ç­‰åˆ°å‰é¢ä»£ç æ‰§è¡Œå®Œäº†æ‰èƒ½æ‰§è¡Œã€‚ä½†æ˜¯å¦‚æœå‰é¢ä»£ç è€—æ—¶è¾ƒé•¿æ€ä¹ˆåŠï¼Œä¸èƒ½å¹²ç­‰ç€ï¼Œæœ‰äº›åœºæ™¯æˆ‘ä»¬å¯ä»¥ç”¨å¼‚æ­¥æ¥å¤„ç†ï¼Œ..."
  property='og:description' />
<link rel="icon" type="image/png" href="http://localhost:2333/style/favicons/favicon.ico" />
<link href="http://localhost:2333/style/favicons/favicon.ico" rel="shortcut icon" type="image/png">
<link rel="canonical" href="http://localhost:2333/">
<link rel="alternate" type="application/rss+xml" title="Liberxue" href="http://localhost:2333/feed.xml">
<meta charset="UTF-8">
<link rel="manifest" href="/manifest.json">
<link rel="shortcut icon" href="http://localhost:2333/style/favicons/favicon.ico" type="image/x-icon">
<meta name="keywords" content="Web Workerä»€ä¹ˆæ˜¯ Web Workeræˆ‘ä»¬éƒ½çŸ¥é“ JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä»£ç åŒæ­¥æ‰§è¡Œæ—¶ï¼Œåç»­ä»£ç å¿…é¡»ç­‰åˆ°å‰é¢ä»£ç æ‰§è¡Œå®Œäº†æ‰èƒ½æ‰§è¡Œã€‚ä½†æ˜¯å¦‚æœå‰é¢ä»£ç è€—æ—¶è¾ƒé•¿æ€ä¹ˆåŠï¼Œä¸èƒ½å¹²ç­‰ç€ï¼Œæœ‰äº›åœºæ™¯æˆ‘ä»¬å¯ä»¥ç”¨å¼‚æ­¥æ¥å¤„ç†ï¼Œ..." property='og:description'
/>
<meta name="description" content="Tate & Snow's Github blog" />
<link href="https://cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
<link href="http://localhost:2333/style/theme.css" rel="stylesheet"> 
<meta content='http://localhost:2333/2020/02/21/html-web-woker.html' property='og:url' />
<meta content="http://localhost:2333/2020/02/21/html-web-woker.html|Web Workerä»€ä¹ˆæ˜¯ Web Workeræˆ‘ä»¬éƒ½çŸ¥é“ JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä»£ç åŒæ­¥æ‰§è¡Œæ—¶ï¼Œåç»­ä»£ç å¿…é¡»ç­‰åˆ°å‰é¢ä»£ç æ‰§è¡Œå®Œäº†æ‰èƒ½æ‰§è¡Œã€‚ä½†æ˜¯å¦‚æœå‰é¢ä»£ç è€—æ—¶è¾ƒé•¿æ€ä¹ˆåŠï¼Œä¸èƒ½å¹²ç­‰ç€ï¼Œæœ‰äº›åœºæ™¯æˆ‘ä»¬å¯ä»¥ç”¨å¼‚æ­¥æ¥å¤„ç†ï¼Œ..." property='og:description'
/>
<meta content="article" property="og:type" /> 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136311746-1"></script>
<!-- <script async src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
<script>
  window.dataLayer = window.dataLayer || [];
  window.GA_TRACKING_ID = 'UA-136311746-1'
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('set', {
    'country': 'US',
    'currency': 'USD',
    'description': 'fuck',
  });
  gtag('config', GA_TRACKING_ID, {
    'custom_map': {
      'dimension1': 'post_title',
    },
    'post_title': 'test',
  });
</script>
<meta content="" property="fb:app_id" />
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Web Worker | Tate &amp; Snow</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Web Worker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Web Worker" />
<meta property="og:description" content="Web Worker" />
<link rel="canonical" href="http://localhost:2333/2020/02/21/html-web-woker.html" />
<meta property="og:url" content="http://localhost:2333/2020/02/21/html-web-woker.html" />
<meta property="og:site_name" content="Tate &amp; Snow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-21T17:59:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:2333/2020/02/21/html-web-woker.html"},"url":"http://localhost:2333/2020/02/21/html-web-woker.html","headline":"Web Worker","dateModified":"2020-02-21T17:59:00+08:00","datePublished":"2020-02-21T17:59:00+08:00","description":"Web Worker","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<script>
  (function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

</head>

<body class="dark-theme" gtools_scp_screen_capture_injected="true">
    <header id="header" class="header bg-white">
        <div class="navbar-container">
            <a href="Javascript:;" onclick="onClickLogo()" title="è®¿é—® Tate & Snow" class="navbar-logo menu-logo">
                <img src="https://i.loli.net/2018/03/13/5aa74f5b4c2c7.png" alt="Tate & Snow"> </a>
            <!-- <a href="/?tate" title="è®¿é—® Tate & Snow" class="navbar-logo">Tate & Snow</a>   -->
            <div class="navbar-menu">
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', '/')" title="è®¿é—® é¦–é¡µ" data-hover="é¦–é¡µ">é¦–é¡µ</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å‰ç«¯', '/front')" title="è®¿é—® å‰ç«¯" data-hover="å‰ç«¯">å‰ç«¯</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å†å²', '/history')" title="è®¿é—® å†å²" data-hover="å†å²">å†å²</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('å…¶ä»–', '/other')" title="è®¿é—® å…¶ä»–" data-hover="å…¶ä»–">å…¶ä»–</a>
                
                  <a class=" menu-item-categories " href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', '/tags')" title="è®¿é—® æ ‡ç­¾" data-hover="æ ‡ç­¾">æ ‡ç­¾</a>
                
                  <a class=" menu-item-about " href="Javascript:;" onclick="onClickMenu('å…³äº', '/README')" title="è®¿é—® å…³äº" data-hover="å…³äº">å…³äº</a>
                
            </div>
            <!-- <div class="navbar-menu">
                
                <a href="http://localhost:2333/">é¦–é¡µ</a>
                
                <a href="http://localhost:2333/front">å‰ç«¯</a>
                
                <a href="http://localhost:2333/history">å†å²</a>
                
                <a href="http://localhost:2333/other">å…¶ä»–</a>
                
                <a href="http://localhost:2333/tags">æ ‡ç­¾</a>
                
                <a href="http://localhost:2333/README">å…³äº</a>
                
            </div> -->
            <div class="navbar-search menu-item-search" onclick="onClickSearch()">
                <span class="icon-search"></span>
                <form id="cb-search-btn" role="search">
                    <span class="search-box">
                        <input type="text" class="input" id="cb-search-content" required="true" placeholder="æ ‡é¢˜ æ ‡ç­¾..." maxlength="30" autocomplete="off">
                    </span>
                </form>
            </div>
            <div class="navbar-mobile-menu" onclick="">
                <span class="icon-menu cross">
                    <span class="middle"></span>
                </span>
                <ul>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('é¦–é¡µ', 'http://localhost:2333/')">é¦–é¡µ</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å‰ç«¯', 'http://localhost:2333/front')">å‰ç«¯</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å†å²', 'http://localhost:2333/history')">å†å²</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…¶ä»–', 'http://localhost:2333/other')">å…¶ä»–</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('æ ‡ç­¾', 'http://localhost:2333/tags')">æ ‡ç­¾</a>
                    </li>
                    
                    <li>
                        <a class="menu-item-categories" href="Javascript:;" onclick="onClickMenu('å…³äº', 'http://localhost:2333/README')">å…³äº</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </header>
    <a href="#header" class="back-to-top" onclick="onClickTop('Web Worker')">â¤´Topâ¤´</a>
    <div class="post-header-thumb bg-white}">
        <div class="post-header-thumb-op"></div>
        <div class="post-header-thumb">
            <div class="post-header-thumb-container">
                <h1 class="post-title" itemprop="name headline">
                    Web Worker</h1>
                <div class="post-data">
                    <time datetime="2020-02-21 17:59:00" itemprop="datePublished">
                      å‘å¸ƒæ—¶é—´ï¼š2020-02-21 17:59:00
                      &nbsp;&nbsp;&nbsp;
                      
                    </time>
                    <a onclick="onClickCategory('å‰ç«¯')" href="Javascript:;" title="è®¿é—® å‰ç«¯" data-hover="åšå®¢åˆ†ç±»: å‰ç«¯">åšå®¢åˆ†ç±»: å‰ç«¯</a>
                    <!-- <a href="#read"> é˜…è¯»æ¬¡æ•°: comments</a>  -->
                </div>
                <div class="post-tags">
                       
                    <a class="menu-item-tags" href="Javascript:;" onclick="onClickTag('HTML')" title="è®¿é—®HTML" data-hover="HTML">
                        HTML
                        <span>(1)</span>
                        
                    </a>
                    
                    <a class="menu-item-tags" href="Javascript:;" onclick="onClickTag('JavaScript')" title="è®¿é—®JavaScript" data-hover="JavaScript">
                        JavaScript
                        <span>(27)</span>
                        
                    </a>
                       
                </div>
            </div>
        </div>
    </div>
    <article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
        <div class="post-header">
            <h1 class="post-title" itemprop="name headline">
                Web Worker</h1>
            <div class="post-data">
                <time datetime="2020-02-21 17:59:00" itemprop="datePublished">2020-02-21 17:59:00</time>
            </div>
        </div>
        <div id="post-content" class="post-content" itemprop="articleBody">
            <p class="post-tags">
                   
                <a href="Javascript:;" onclick="onClickTag('HTML')" title="è®¿é—®HTML" data-hover="HTML">
                    HTML
                    <span>(1)</span>
                    </a>
                
                <a href="Javascript:;" onclick="onClickTag('JavaScript')" title="è®¿é—®JavaScript" data-hover="JavaScript">
                    JavaScript
                    <span>(27)</span>
                    </a>
                   
            </p>
            <h1 id="web-worker">Web Worker</h1>

<h2 id="ä»€ä¹ˆæ˜¯-web-worker">ä»€ä¹ˆæ˜¯ Web Worker</h2>

<p>æˆ‘ä»¬éƒ½çŸ¥é“ JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä»£ç åŒæ­¥æ‰§è¡Œæ—¶ï¼Œåç»­ä»£ç å¿…é¡»ç­‰åˆ°å‰é¢ä»£ç æ‰§è¡Œå®Œäº†æ‰èƒ½æ‰§è¡Œã€‚ä½†æ˜¯å¦‚æœå‰é¢ä»£ç è€—æ—¶è¾ƒé•¿æ€ä¹ˆåŠï¼Œä¸èƒ½å¹²ç­‰ç€ï¼Œæœ‰äº›åœºæ™¯æˆ‘ä»¬å¯ä»¥ç”¨å¼‚æ­¥æ¥å¤„ç†ï¼Œæ¯”å¦‚ ajax è¯·æ±‚æœåŠ¡å™¨æ•°æ®ï¼Œä½†æ˜¯è¿™ä»ç„¶æ²¡æœ‰æ”¹å˜ä»£ç å•çº¿ç¨‹æ‰§è¡Œçš„æœ¬è´¨ï¼Œæˆ‘ä»¬ä¾æ—§ä¸èƒ½æŠŠè€—æ—¶çš„å¤æ‚è¿ç®—æ”¾åœ¨é¡µé¢ä¸Šæ‰§è¡Œï¼Œä¸ç„¶ä¼šé€ æˆæ— å“åº”ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚å› æ­¤ä¸ºäº†å®ç°å¤šçº¿ç¨‹ï¼Œå°±å¿…é¡»ç”¨åˆ° <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker"><strong>Web Worker</strong></a>ã€‚</p>

<p>HTML5 æå‡ºäº† Web Worker æ ‡å‡†ï¼Œè¡¨ç¤º JavaScript å…è®¸æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å­çº¿ç¨‹å®Œå…¨å—ä¸»çº¿ç¨‹çš„æ§åˆ¶ï¼Œä¸”å­çº¿ç¨‹<strong>ä¸èƒ½æ“ä½œ DOMã€‚ç”±äºä½äºå¤–éƒ¨æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è®¿é—® Windowã€Document ç­‰å¯¹è±¡</strong>ã€‚å¹¶ä¸”è§„èŒƒå‡º Web Worker çš„ä¸‰å¤§ä¸»è¦ç‰¹å¾:</p>

<ol>
  <li>èƒ½å¤Ÿé•¿æ—¶é—´è¿è¡Œå’Œå“åº”</li>
  <li>ç†æƒ³çš„å¯åŠ¨æ€§èƒ½</li>
  <li>ç†æƒ³çš„å†…å­˜æ¶ˆè€—</li>
</ol>

<p>HTML5 ä¸­çš„å¤šçº¿ç¨‹æ˜¯è¿™æ ·ä¸€ç§æœºåˆ¶ï¼Œå®ƒå…è®¸åœ¨ Web ç¨‹åºä¸­å¹¶å‘æ‰§è¡Œå¤šä¸ª JavaScript è„šæœ¬ï¼Œæ¯ä¸ªè„šæœ¬æ‰§è¡Œæµéƒ½ç§°ä¸ºä¸€ä¸ªçº¿ç¨‹ï¼Œå½¼æ­¤é—´äº’ç›¸ç‹¬ç«‹ï¼Œå¹¶ä¸”æœ‰æµè§ˆå™¨ä¸­çš„ JavaScript å¼•æ“è´Ÿè´£ç®¡ç†ã€‚å®ƒæ˜¯è¿è¡Œåœ¨åå°çš„ JavaScriptï¼Œç‹¬ç«‹äºå…¶ä»–è„šæœ¬ï¼Œä¸€èˆ¬ä¸ä¼šå½±å“é¡µé¢çš„æ€§èƒ½ã€‚å› æ­¤æˆ‘ä»¬å¸¸å¸¸å¯ä»¥æŠŠä¸€äº›è€—æ—¶å’Œå¤æ‚è®¡ç®—çš„æ“ä½œæ”¾åˆ°åå°å»æ‰§è¡Œï¼Œæ¥ä¸‹æ¥ä¾¿å¯ä»¥ç»§ç»­åšä»»ä½•ä½ æƒ³åšçš„äº‹æƒ…ï¼šç‚¹å‡»ã€é€‰å–å†…å®¹ç­‰ç­‰ã€‚</p>

<p>HTML5 ä¸­çš„ Web Worker å¯ä»¥åˆ†ä¸ºä¸¤ç§ä¸åŒçº¿ç¨‹ç±»å‹ï¼Œä¸€ä¸ªæ˜¯<strong>ä¸“ç”¨çº¿ç¨‹(Dedicated Worker)</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>å…±äº«çº¿ç¨‹(Shared Worker)</strong>ã€‚ä¸¤ç§ç±»å‹çš„çº¿ç¨‹å„æœ‰ä¸åŒçš„ç”¨é€”ï¼Œä¸‹é¢åˆ†åˆ«æ¥ä»‹ç»ä¸‹ã€‚</p>

<blockquote>
  <p>æœ¬ç¯‡çš„æ•°æ®é€šä¿¡å’Œå®ä¾‹æ‘˜è‡ªé˜®ä¸€å³°çš„ <a href="http://www.ruanyifeng.com/blog/2018/07/web-worker.html">Web Worker ä½¿ç”¨æ•™ç¨‹</a> ğŸ‘ˆ</p>
</blockquote>

<p><img src="https://bitsofco.de/content/images/2018/11/web-worker.jpg" alt="Web Worker" /></p>

<h2 id="ä¸“ç”¨çº¿ç¨‹">ä¸“ç”¨çº¿ç¨‹</h2>

<h3 id="åˆ›å»ºçº¿ç¨‹">åˆ›å»ºçº¿ç¨‹</h3>

<p>åˆ›å»ºå­çº¿ç¨‹çš„æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥é€šè¿‡æ„é€ å‡½æ•° Worker åˆ›å»ºå®ä¾‹å³å¯ï¼Œå®ƒåªæ‰§è¡Œ URL æŒ‡å®šçš„è„šæœ¬ã€‚Worker ä¸æŒ‡å®š URL æ—¶ï¼Œè€Œç”±ä½¿ç”¨ Blob åˆ›å»º:</p>

<pre><code class="language-JS">// æ ¹æ®æŒ‡å®šçš„ worker.js æ¥åˆ›å»º Web Worker å®ä¾‹ï¼Œä»è€Œå¼€è¾Ÿå­çº¿ç¨‹
const worker = new Worker("/javascripts/worker.js")
</code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>å‚æ•° URL ä¸èƒ½æ˜¯æœ¬åœ°çš„æ–‡ä»¶ï¼Œåªèƒ½æ˜¯é€šè¿‡ç½‘ç»œæ¥ä¸‹è½½çš„æ–‡ä»¶å¹¶ä¸”æ˜¯åŒæº</strong>ï¼Œå¦‚æœä¸‹è½½å¤±è´¥ã€‚åˆ™ä¸ä¼šåˆ›å»ºå­çº¿ç¨‹ã€‚æ¯”å¦‚ä¸Šè¿°çš„ <code class="highlighter-rouge">"/javascripts/worker.js"</code> å°±æ˜¯ Express é¡¹ç›®å¯åŠ¨åæ‰€è®¿é—®çš„èµ„æºæ–‡ä»¶è·¯å¾„ã€‚</p>

<pre><code class="language-TEXT"># å¼•ç”¨æœ¬åœ°æ–‡ä»¶æŠ¥é”™
Uncaught DOMException: Failed to construct 'Worker': Script at 'file:///Users/xxx/worker.js' cannot be accessed from origin 'null'.
</code></pre>

<h3 id="çº¿ç¨‹é€šä¿¡">çº¿ç¨‹é€šä¿¡</h3>

<p>åœ¨åˆ›å»ºäº†å­çº¿ç¨‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ä¸­äº’ç›¸é€šä¿¡ã€‚ä¸»çº¿ç¨‹å’Œ Worker çº¿ç¨‹æä¾›ä»¥ä¸‹å¸¸ç”¨çš„æ–¹æ³•å’Œäº‹ä»¶å¥æŸ„:</p>

<ul>
  <li>ä¸»çº¿ç¨‹
    <ul>
      <li><strong>Worker.postMessage</strong> - å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°æœ€è¿‘çš„å¤–å±‚å¯¹è±¡ï¼Œæ¶ˆæ¯å¯ç”±ä»»ä½• JavaScript å¯¹è±¡ç»„æˆ</li>
      <li><strong>Worker.terminate</strong> - ç«‹å³åœ¨ä¸»çº¿ç¨‹ç»ˆæ­¢ workerã€‚å¦å¤–å…³é—­é¡µé¢ä¹Ÿå¯ä»¥ç»ˆæ­¢ã€‚åœ¨å­çº¿ç¨‹ä¸­å…³é—­åˆ™éœ€è¦ä½¿ç”¨ <strong>close</strong> æ–¹æ³•</li>
      <li><strong>Worker.onmessage</strong> - å½“ MessageEvent ç±»å‹çš„äº‹ä»¶å†’æ³¡åˆ° worker æ—¶ï¼Œäº‹ä»¶ç›‘å¬å‡½æ•° EventListener è¢«è°ƒç”¨ï¼Œæ¶ˆæ¯ä¿å­˜åœ¨äº‹ä»¶å¯¹è±¡çš„ data å±æ€§ä¸­</li>
      <li><strong>Worker.onmessageerror</strong> - æŒ‡å®š messageerror äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚å‘é€çš„æ•°æ®æ— æ³•åºåˆ—åŒ–æˆå­—ç¬¦ä¸²æ—¶ï¼Œä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶</li>
      <li><strong>Worker.onerror</strong> - å½“ ErrorEvent ç±»å‹çš„äº‹ä»¶å†’æ³¡åˆ° worker æ—¶ï¼Œäº‹ä»¶ç›‘å¬å‡½æ•° EventListener è¢«è°ƒç”¨</li>
    </ul>
  </li>
  <li>Worker çº¿ç¨‹
    <ul>
      <li><strong>self.name</strong> - æŒ‡å®š Worker çš„åç§°ï¼Œç”¨æ¥åŒºåˆ†å¤šä¸ª Worker çº¿ç¨‹</li>
      <li><strong>self.postMessage</strong> - å‘äº§ç”Ÿè¿™ä¸ª Worker çº¿ç¨‹çš„çº¿ç¨‹å‘é€æ¶ˆæ¯</li>
      <li><strong>self.close</strong> - å…³é—­ Worker çº¿ç¨‹</li>
      <li><strong>self.onmessage</strong> - æŒ‡å®š message äº‹ä»¶çš„ç›‘å¬å‡½æ•°</li>
      <li><strong>self.onmessageerror</strong> - æŒ‡å®š messageerror äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚å‘é€çš„æ•°æ®æ— æ³•åºåˆ—åŒ–æˆå­—ç¬¦ä¸²æ—¶ï¼Œä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨ <strong>addEventListener</strong> æ–¹æ³•ï¼Œå®ƒæœ€ç»ˆçš„å®ç°æ–¹å¼å’Œä½œç”¨å’Œ onmessage ç›¸åŒ</p>
</blockquote>

<blockquote>
  <p>Worker çº¿ç¨‹ä¸€æ—¦æ–°å»ºæˆåŠŸï¼Œå°±ä¼šå§‹ç»ˆè¿è¡Œï¼Œä¸ä¼šè¢«ä¸»çº¿ç¨‹ä¸Šçš„æ´»åŠ¨(æ¯”å¦‚ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ã€æäº¤è¡¨å•)æ‰“æ–­ã€‚è¿™æ ·æœ‰åˆ©äºéšæ—¶å“åº”ä¸»çº¿ç¨‹çš„é€šä¿¡ï¼Œä½†æ˜¯ä¹Ÿé€ æˆäº†ä¸€å®šçš„èµ„æºæµªè´¹ï¼Œæ‰€ä»¥ä¸å†ä½¿ç”¨æ—¶åº”è¯¥è°ƒç”¨ <strong>terminate</strong> æˆ– <strong>close</strong> æ–¹æ³•è¿›è¡Œå…³é—­ï¼Œä»è€Œé‡Šæ”¾èµ„æº</p>
</blockquote>

<p>æˆ‘ä»¬æ¥çœ‹ä¸‹æœ€ç®€å•çš„ç¤ºä¾‹:</p>

<pre><code class="language-JS">// main.js
// create worker
const worker = new Worker("/javascripts/worker.js")

// Send message to worker
worker.postMessage("è¿™æ˜¯ä¸»çº¿ç¨‹å‘é€çš„ä¿¡æ¯")

// Receive message from worker
worker.onmessage = (e) =&gt; {
  console.log(e.data)
}

// worker,onerror = ...
</code></pre>

<pre><code class="language-JS">// worker.js
name = 'Tate' // æŒ‡å®š Worker çš„åç§°ï¼Œç”¨æ¥åŒºåˆ†å¤šä¸ª Worker çº¿ç¨‹

// Receive message from main file
onmessage = (e) =&gt; {
  console.log(e.data)
  // Send message to main file
  postMessage("è¿™æ˜¯ worker å‘é€çš„ä¿¡æ¯")
}

// self.close() // å…³é—­è¯¥å­çº¿ç¨‹

// self å’Œ this ä»£è¡¨å­çº¿ç¨‹è‡ªèº«ï¼Œå³å­çº¿ç¨‹çš„å…¨å±€å¯¹è±¡
console.log('this or self', self, this)
console.log('location', location)
</code></pre>

<p>å½“æˆ‘ä»¬è¿è¡Œé¡¹ç›®æ—¶ï¼Œä¾¿èƒ½çœ‹åˆ°å¯¹åº”çš„æ‰“å°ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åå°æˆ‘ä»¬ä»ç„¶å¯ä»¥è®¿é—®å¦‚ä¸‹ API å’Œå¤„ç†äº‹ä»¶ç›‘å¬:</p>

<pre><code class="language-TEXT"># this or self
name: "Tate"
onmessage: (e) =&gt; {â€¦}
onmessageerror: null
self: DedicatedWorkerGlobalScope {name: "", onmessageerror: null, onmessage: Æ’, postMessage: Æ’, close: Æ’, â€¦}
location: WorkerLocation {href: "http://localhost:3000/javascripts/worker.js", origin: "http://localhost:3000", protocol: "http:", host: "localhost:3000", hostname: "localhost", â€¦}
onerror: null
onlanguagechange: null
navigator: WorkerNavigator {hardwareConcurrency: 12, appCodeName: "Mozilla", appName: "Netscape", appVersion: "5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKiâ€¦L, like Gecko) Chrome/79.0.3945.130 Safari/537.36", platform: "MacIntel", â€¦}
onrejectionhandled: null
onunhandledrejection: null
isSecureContext: true
origin: "http://localhost:3000"
</code></pre>

<pre><code class="language-TEXT"># location
href: "http://localhost:3000/javascripts/worker.js"
origin: "http://localhost:3000"
protocol: "http:"
host: "localhost:3000"
hostname: "localhost"
port: "3000"
pathname: "/javascripts/worker.js"
search: ""
hash: ""
</code></pre>

<h3 id="æ•°æ®é€šä¿¡">æ•°æ®é€šä¿¡</h3>

<p>ä¸»çº¿ç¨‹ä¸ Worker ä¹‹é—´çš„é€šä¿¡å†…å®¹ï¼Œå¯ä»¥æ˜¯æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>è¿™ç§é€šä¿¡æ˜¯æ‹·è´å…³ç³»ï¼Œå³æ˜¯ä¼ å€¼è€Œä¸æ˜¯ä¼ å€</strong>ï¼ŒWorker å¯¹é€šä¿¡å†…å®¹çš„ä¿®æ”¹ï¼Œä¸ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹ã€‚äº‹å®ä¸Šï¼Œæµè§ˆå™¨å†…éƒ¨çš„è¿è¡Œæœºåˆ¶æ˜¯ï¼Œå…ˆå°†é€šä¿¡å†…å®¹ä¸²è¡ŒåŒ–ï¼Œç„¶åæŠŠä¸²è¡ŒåŒ–åçš„å­—ç¬¦ä¸²å‘ç»™ Workerï¼Œåè€…å†å°†å®ƒè¿˜åŸã€‚ä¸»çº¿ç¨‹ä¸ Worker ä¹‹é—´ä¹Ÿå¯ä»¥äº¤æ¢äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯”å¦‚ Fileã€Blobã€ArrayBuffer ç­‰ç±»å‹ï¼Œä¹Ÿå¯ä»¥åœ¨çº¿ç¨‹ä¹‹é—´å‘é€:</p>

<pre><code class="language-JS">// ä¸»çº¿ç¨‹
var uInt8Array = new Uint8Array(new ArrayBuffer(10))

for (var i = 0 i &lt; uInt8Array.length ++i) {
  uInt8Array[i] = i * 2 // [0, 2, 4, 6, 8,...]
}

worker.postMessage(uInt8Array)

// Worker çº¿ç¨‹
self.onmessage = function (e) {
  var uInt8Array = e.data
  postMessage('Inside worker.js: uInt8Array.toString() = ' + uInt8Array.toString())
  postMessage('Inside worker.js: uInt8Array.byteLength = ' + uInt8Array.byteLength)
}
</code></pre>

<p>ä½†æ˜¯ï¼Œæ‹·è´æ–¹å¼å‘é€äºŒè¿›åˆ¶æ•°æ®ï¼Œä¼šé€ æˆæ€§èƒ½é—®é¢˜ã€‚æ¯”å¦‚ï¼Œä¸»çº¿ç¨‹å‘ Worker å‘é€ä¸€ä¸ª 500MB æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹æµè§ˆå™¨ä¼šç”Ÿæˆä¸€ä¸ªåŸæ–‡ä»¶çš„æ‹·è´ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJavaScript å…è®¸ä¸»çº¿ç¨‹æŠŠäºŒè¿›åˆ¶æ•°æ®ç›´æ¥è½¬ç§»ç»™å­çº¿ç¨‹ï¼Œä½†æ˜¯ä¸€æ—¦è½¬ç§»ï¼Œä¸»çº¿ç¨‹å°±æ— æ³•å†ä½¿ç”¨è¿™äº›äºŒè¿›åˆ¶æ•°æ®äº†ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹æ•°æ®çš„éº»çƒ¦å±€é¢ã€‚è¿™ç§è½¬ç§»æ•°æ®çš„æ–¹æ³•ï¼Œå«åš <a href="http://w3c.github.io/html/infrastructure.html#transferable-objects"><strong>Transferable Objects</strong></a>ã€‚è¿™ä½¿å¾—ä¸»çº¿ç¨‹å¯ä»¥å¿«é€ŸæŠŠæ•°æ®äº¤ç»™ Workerï¼Œå¯¹äºå½±åƒå¤„ç†ã€å£°éŸ³å¤„ç†ã€3D è¿ç®—ç­‰å°±éå¸¸æ–¹ä¾¿äº†ï¼Œä¸ä¼šäº§ç”Ÿæ€§èƒ½è´Ÿæ‹…ã€‚å¦‚æœè¦ç›´æ¥è½¬ç§»æ•°æ®çš„æ§åˆ¶æƒï¼Œå°±è¦ä½¿ç”¨ä¸‹é¢çš„å†™æ³•:</p>

<pre><code class="language-JS">// Transferable Objects æ ¼å¼
worker.postMessage(arrayBuffer, [arrayBuffer])

// ä¾‹å­
var ab = new ArrayBuffer(1)
worker.postMessage(ab, [ab])

// é«˜æ•ˆçš„å‘é€ ArrayBuffer æ•°æ®ä»£ç 
worker.postMessage({
 operation: 'list_all_users',
 // ArrayBuffer object
 input: buffer,
 threshold: 0.8,
}, [buffer]);
</code></pre>

<h3 id="importscripts">importScripts</h3>

<p>Worker å†…éƒ¨è¿˜å¯ä»¥ä½¿ç”¨ <strong>importScripts</strong> æ–¹æ³•æ¥åŠ è½½å…¶ä»–çš„è„šæœ¬æ–‡ä»¶:</p>

<pre><code class="language-JS">/**
 * éœ€è¦æ³¨æ„çš„æ˜¯ importScripts æ˜¯åŒæ­¥æ–¹æ³•
 * ä½¿ç”¨ importScripts æ–¹æ³•å¼•å…¥å¤–éƒ¨èµ„æºè„šæœ¬ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†æ•°å­¦å…¬å¼è®¡ç®—å·¥å…·åº“ math_utilities.js
 * å½“ JavaScript å¼•æ“å¯¹è¿™ä¸ªèµ„æºæ–‡ä»¶åŠ è½½å®Œæ¯•åï¼Œç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚åŒæ—¶ï¼Œä¸‹é¢çš„çš„ä»£ç å¯ä»¥è®¿é—®å’Œè°ƒç”¨åœ¨èµ„æºæ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡å’Œæ–¹æ³•ã€‚
 **/
importScripts('math_utilities.js')

// å¼•å…¥å¤šä¸ªè„šæœ¬æ–‡ä»¶
importScripts('script1.js', 'script2.js')
</code></pre>

<h2 id="å…±äº«çº¿ç¨‹">å…±äº«çº¿ç¨‹</h2>

<p>å…±äº«çº¿ç¨‹æ˜¯ä¸ºäº†é¿å…çº¿ç¨‹çš„é‡å¤åˆ›å»ºå’Œé”€æ¯è¿‡ç¨‹ï¼Œé™ä½äº†ç³»ç»Ÿæ€§èƒ½çš„æ¶ˆè€—ï¼Œå…±äº«çº¿ç¨‹ SharedWorker å¯ä»¥åŒæ—¶æœ‰å¤šä¸ªé¡µé¢çš„çº¿ç¨‹é“¾æ¥ã€‚ä½¿ç”¨ SharedWorker åˆ›å»ºå…±äº«çº¿ç¨‹ï¼Œä¹Ÿéœ€è¦æä¾›ä¸€ä¸ªè„šæœ¬æ–‡ä»¶çš„ URL åœ°å€æˆ– Blobï¼Œè¯¥è„šæœ¬æ–‡ä»¶ä¸­åŒ…å«äº†æˆ‘ä»¬åœ¨çº¿ç¨‹ä¸­éœ€è¦æ‰§è¡Œçš„ä»£ç :</p>

<pre><code class="language-JS">// ç¬¬äºŒä¸ªå‚æ•° mysharedworker ä»£è¡¨äº†å…±äº«çº¿ç¨‹çš„åç§°
const worker = new SharedWorker('sharedworker.js', 'mysharedworker')
</code></pre>

<p>å…±äº«çº¿ç¨‹ä¹Ÿä½¿ç”¨äº† message äº‹ä»¶ç›‘å¬çº¿ç¨‹æ¶ˆæ¯ï¼Œä½†ä½¿ç”¨ SharedWorker å¯¹è±¡çš„ <code class="highlighter-rouge">port</code> å±æ€§ä¸çº¿ç¨‹è¿›è¡Œé€šä¿¡:</p>

<pre><code class="language-JS">// ä»ç«¯å£æ¥æ”¶æ•°æ®, åŒ…æ‹¬æ–‡æœ¬æ•°æ®ä»¥åŠç»“æ„åŒ–æ•°æ®
worker.port.onmessage = function (event) { define your logic here... }
// å‘ç«¯å£å‘é€æ™®é€šæ–‡æœ¬æ•°æ®
worker.port.postMessage('put your message here â€¦ ')
// å‘ç«¯å£å‘é€ç»“æ„åŒ–æ•°æ®
worker.port.postMessage({ username: 'usertext'; live_city: ['data-one', 'data-two', 'data-three','data-four']})
</code></pre>

<h2 id="å®ä¾‹worker-çº¿ç¨‹å¤æ‚è®¡ç®—">å®ä¾‹ï¼šWorker çº¿ç¨‹å¤æ‚è®¡ç®—</h2>

<p>æˆ‘ä»¬çŸ¥é“å½“æœ‰å¤æ‚è€—æ—¶è®¡ç®—çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šå½±å“åç»­ä»£ç çš„æ‰§è¡Œï¼Œè€Œä¸”ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œå› æ­¤åœ¨åå°å»è®¡ç®—ä¸å¤±ä¸ºä¸€ä¸ªå¥½çš„æ–¹æ³•:</p>

<pre><code class="language-JS">// main.js
const worker = new Worker("/javascripts/worker.js")

worker.postMessage({
  first: 3477340803423744400,
  second: 34237444003423744400,
})

worker.onmessage = function (event) {
  // æ˜¾ç¤ºè®¡ç®—ä¹‹åæ‹¿åˆ°çš„æ•°å€¼
  document.getElementById('computation_result').textContent = event.data
}
</code></pre>

<pre><code class="language-JS">// worker.js
// calculate the greatest common divisor
const divisor = (a, b) =&gt; a % b == 0 ? b : divisor(b, a % b)

// calculate the least common multiple
const multiple = (a,  b) =&gt; a * b / divisor(a, b) || 0

/*
* calculate the least common multiple
* and the greatest common divisor
*/
const calculate = (first, second) =&gt; {
  // do the calculation work
  const common_divisor = divisor(first, second)
  const common_multiple = multiple(first, second)
  postMessage(`Work done!The least common multiple is ${common_divisor} and the greatest common divisor is ${common_multiple}`)
}

/**
 * This worker is used to calculate
 * the least common multiple
 * and the greatest common divisor
 */
onmessage = function (event) {
  const { data: { first, second } = {} } = event
  calculate(first, second)
}
</code></pre>

<h2 id="å®ä¾‹worker-çº¿ç¨‹å®Œæˆè½®è¯¢">å®ä¾‹ï¼šWorker çº¿ç¨‹å®Œæˆè½®è¯¢</h2>

<p>æœ‰æ—¶ï¼Œæµè§ˆå™¨éœ€è¦è½®è¯¢æœåŠ¡å™¨çŠ¶æ€ï¼Œä»¥ä¾¿ç¬¬ä¸€æ—¶é—´å¾—çŸ¥çŠ¶æ€æ”¹å˜ã€‚è¿™ä¸ªå·¥ä½œå¯ä»¥æ”¾åœ¨ Worker é‡Œé¢ã€‚Worker æ¯ç§’é’Ÿè½®è¯¢ä¸€æ¬¡æ•°æ®ï¼Œç„¶åè·Ÿç¼“å­˜åšæ¯”è¾ƒã€‚å¦‚æœä¸ä¸€è‡´ï¼Œå°±è¯´æ˜æœåŠ¡ç«¯æœ‰äº†æ–°çš„å˜åŒ–ï¼Œå› æ­¤å°±è¦é€šçŸ¥ä¸»çº¿ç¨‹:</p>

<pre><code class="language-JS">function createWorker(f) {
  var blob = new Blob(['(' + f.toString() +')()'])
  var url = window.URL.createObjectURL(blob)
  var worker = new Worker(url)
  return worker
}

var pollingWorker = createWorker(function (e) {
  var cache

  function compare(new, old) { ... }

  setInterval(function () {
    fetch('/my-api-endpoint').then(function (res) {
      var data = res.json()

      if (!compare(data, cache)) {
        cache = data
        self.postMessage(data)
      }
    })
  }, 1000)
})

pollingWorker.onmessage = function () {
  // render data
}

pollingWorker.postMessage('init')
</code></pre>

<h2 id="å®ä¾‹å…±äº«çº¿ç¨‹å¤„ç†å¤šç”¨æˆ·å¹¶å‘è¿æ¥">å®ä¾‹ï¼šå…±äº«çº¿ç¨‹å¤„ç†å¤šç”¨æˆ·å¹¶å‘è¿æ¥</h2>

<p>ç”±äºçº¿ç¨‹çš„æ„å»ºä»¥åŠé”€æ¯éƒ½è¦æ¶ˆè€—å¾ˆå¤šçš„ç³»ç»Ÿæ€§èƒ½ï¼Œä¾‹å¦‚ CPU çš„å¤„ç†å™¨è°ƒåº¦ï¼Œå†…å­˜çš„å ç”¨å›æ”¶ç­‰ï¼Œåœ¨ä¸€èˆ¬çš„ç¼–ç¨‹è¯­è¨€ä¸­éƒ½ä¼šæœ‰<strong>çº¿ç¨‹æ± </strong>çš„æ¦‚å¿µï¼Œçº¿ç¨‹æ± æ˜¯ä¸€ç§å¯¹å¤šçº¿ç¨‹å¹¶å‘å¤„ç†çš„å½¢å¼ï¼Œåœ¨å¤„ç†è¿‡ç¨‹ä¸­ç³»ç»Ÿå°†æ‰€æœ‰çš„ä»»åŠ¡æ·»åŠ åˆ°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œç„¶ååœ¨æ„å»ºå¥½çº¿ç¨‹æ± ä»¥åè‡ªåŠ¨å¯åŠ¨è¿™äº›ä»»åŠ¡ã€‚å¤„ç†å®Œä»»åŠ¡åå†æŠŠçº¿ç¨‹æ”¶å›åˆ°çº¿ç¨‹æ± ä¸­ï¼Œç”¨äºä¸‹ä¸€æ¬¡ä»»åŠ¡è°ƒç”¨ã€‚çº¿ç¨‹æ± ä¹Ÿæ˜¯å…±äº«çº¿ç¨‹çš„ä¸€ç§åº”ç”¨ã€‚</p>

<p>åœ¨ HTML5 ä¸­ä¹Ÿå¼•å…¥äº†å…±äº«çº¿ç¨‹æŠ€æœ¯ï¼Œä½†æ˜¯ç”±äºæ¯ä¸ªå…±äº«çº¿ç¨‹å¯ä»¥æœ‰å¤šä¸ªè¿æ¥ï¼ŒHTML5 å¯¹å…±äº«çº¿ç¨‹æä¾›äº†å’Œæ™®é€šå·¥ä½œçº¿ç¨‹ç¨å¾®æœ‰äº›åŒºåˆ«çš„ API æ¥å£ã€‚ä¸‹é¢æˆ‘ä»¬ç»™å‡ºä¸€ä¸ªä¾‹å­ï¼šåˆ›å»ºä¸€ä¸ªå…±äº«çº¿ç¨‹ç”¨äºæ¥æ”¶ä»ä¸åŒè¿æ¥å‘é€è¿‡æ¥çš„æŒ‡ä»¤ï¼Œç„¶åå®ç°è‡ªå·±çš„æŒ‡ä»¤å¤„ç†é€»è¾‘ï¼ŒæŒ‡ä»¤å¤„ç†å®Œæˆåå°†ç»“æœè¿”å›åˆ°å„ä¸ªä¸åŒçš„è¿æ¥ç”¨æˆ·:</p>

<pre><code class="language-HTML">&lt;body&gt;
  &lt;output id='response_from_worker'&gt;
  send instructions to shared worker:
  &lt;input type="text" autofocus oninput="postMessageToSharedWorker(this);return false;"&gt;
&lt;/body&gt;
&lt;script&gt;
 var worker = new SharedWorker('sharedworker.js')
 var log = document.getElementById('response_from_worker')
 worker.port.addEventListener('message', function(e) {
  // log the response data in web page
  log.textContent = e.data
  }, false)
 worker.port.start() // å¯åŠ¨ç«¯å£ï¼Œç”¨äº addEventListener æ¥ç›‘å¬ message
 worker.port.postMessage('ping from user web page..')
  
 // following method will send user input to sharedworker
 function postMessageToSharedWorker(input) {
  //define a json object to construct the request
  var instructions = { instruction: input.value }
  worker.port.postMessage(instructions)
 }
&lt;/script&gt;
</code></pre>

<p>æ¥ä¸‹æ¥æ˜¯ç”¨äºå¤„ç†ç”¨æˆ·æŒ‡ä»¤çš„å…±äº«çº¿ç¨‹ä»£ç ï¼Œåˆ›å»ºä¸€ä¸ªå…±äº«çº¿ç¨‹ç”¨äºæ¥æ”¶ä»ä¸åŒè¿æ¥å‘é€è¿‡æ¥çš„æŒ‡ä»¤ï¼ŒæŒ‡ä»¤å¤„ç†å®Œæˆåå°†ç»“æœè¿”å›åˆ°å„ä¸ªä¸åŒçš„è¿æ¥ç”¨æˆ·ã€‚:</p>

<pre><code class="language-JS">/*
* define a connect count to trace connecting
* this variable will be shared within all connections
*/
var connect_number = 0

onconnect = function(e) {
  connect_number = connect_number + 1;
  // get the first port here
  var port = e.ports[0]
  // æ¯æ¬¡åˆ·æ–°é¡µé¢ï¼Œå…±äº«çº¿ç¨‹é‡æ–°å®ä¾‹åŒ–çš„æ—¶å€™ä¼šè¿›è¡Œè¿æ¥ï¼Œæ­¤æ—¶è¿æ¥æ•°åŠ  1
  port.postMessage('A new connection! The current connection number is ' + connect_number)
  port.onmessage = function(e) {
  // get instructions from requester
  var instruction = e.data.instruction
  var results = execute_instruction(instruction)
  port.postMessage('Request: ' + instruction + ' Response ' + results + ' from shared worker...')
 }
}

/*
* this function will be used to execute the instructions send from requester
* @param instruction
* @return
*/
function execute_instruction(instruction) {
  var result_value
  // implement your logic here
  // execute the instruction...
  return result_value
}
</code></pre>

<p>åœ¨ä¸Šé¢çš„å…±äº«çº¿ç¨‹ä¾‹å­ä¸­ï¼Œåœ¨ä¸»é¡µé¢å³å„ä¸ªç”¨æˆ·è¿æ¥é¡µé¢æ„é€ å‡ºä¸€ä¸ªå…±äº«çº¿ç¨‹å¯¹è±¡ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³• <code class="highlighter-rouge">postMessageToSharedWorker</code> å‘å…±äº«çº¿ç¨‹å‘é€æ¥ä¹‹ç”¨æˆ·çš„æŒ‡ä»¤ã€‚åŒæ—¶ï¼Œåœ¨å…±äº«çº¿ç¨‹çš„å®ç°ä»£ç ç‰‡æ®µä¸­å®šä¹‰ <code class="highlighter-rouge">connect_number</code> ç”¨æ¥è®°å½•è¿æ¥åˆ°è¿™ä¸ªå…±äº«çº¿ç¨‹çš„æ€»æ•°ã€‚ä¹‹åï¼Œç”¨ <code class="highlighter-rouge">onconnect</code> äº‹ä»¶å¤„ç†å™¨æ¥å—æ¥è‡ªä¸åŒç”¨æˆ·çš„è¿æ¥ï¼Œè§£æå®ƒä»¬ä¼ é€’è¿‡æ¥çš„æŒ‡ä»¤ã€‚æœ€åï¼Œå®šä¹‰ä¸€ä¸ªäº†æ–¹æ³• <code class="highlighter-rouge">execute_instruction</code> ç”¨äºæ‰§è¡Œç”¨æˆ·çš„æŒ‡ä»¤ï¼ŒæŒ‡ä»¤æ‰§è¡Œå®Œæˆåå°†ç»“æœè¿”å›ç»™å„ä¸ªç”¨æˆ·ã€‚</p>

<p>è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰è·Ÿå‰é¢çš„ä¾‹å­ä¸€æ ·ä½¿ç”¨åˆ°äº†å·¥ä½œçº¿ç¨‹çš„ <code class="highlighter-rouge">onmessage</code> äº‹ä»¶å¤„ç†å™¨ï¼Œè€Œæ˜¯ä½¿ç”¨äº†å¦å¤–ä¸€ç§æ–¹å¼ <code class="highlighter-rouge">addEventListener</code>ã€‚å®é™…ä¸Šï¼Œè¿™ä¸¤ç§çš„å®ç°åŸç†åŸºæœ¬ä¸€è‡´ï¼Œåªæœ‰æœ‰äº›ç¨å¾®çš„å·®åˆ«ï¼Œå¦‚æœä½¿ç”¨åˆ°äº† <code class="highlighter-rouge">addEventListener</code> æ¥æ¥å—æ¥è‡ªå…±äº«çº¿ç¨‹çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±è¦ä½¿ç”¨ <code class="highlighter-rouge">worker.port.start()</code> æ–¹æ³•æ¥å¯åŠ¨è¿™ä¸ªç«¯å£ã€‚ä¹‹åå°±å¯ä»¥åƒå·¥ä½œçº¿ç¨‹çš„ä½¿ç”¨æ–¹å¼ä¸€æ ·æ­£å¸¸çš„æ¥æ”¶å’Œå‘é€æ¶ˆæ¯ã€‚</p>

<blockquote>
  <p>æ›´å¤šåœºæ™¯å’Œç¤ºä¾‹å¯ä»¥å‚è€ƒ IBM çš„è¿™ç¯‡<a href="https://www.ibm.com/developerworks/cn/web/1112_sunch_webworker/">å¤šçº¿ç¨‹ç¼–ç¨‹</a> ğŸ‘ˆ</p>
</blockquote>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>

<ol>
  <li><a href="https://www.ibm.com/developerworks/cn/web/1112_sunch_webworker/">IBM - æ·±å…¥ HTML5 Web Worker åº”ç”¨å®è·µï¼šå¤šçº¿ç¨‹ç¼–ç¨‹</a></li>
  <li><a href="http://www.ruanyifeng.com/blog/2018/07/web-worker.html">Web Worker ä½¿ç”¨æ•™ç¨‹</a> By é˜®ä¸€å³°</li>
  <li><a href="https://bitsofco.de/web-workers-vs-service-workers-vs-worklets/">bitsofcode - Web workers vs Service workers vs Worklets</a></li>
</ol>
 
<div id="gitalk-container"></div>
<script>
    var gitalk = new Gitalk({
      enable: true,
      clientID: '020f142489f80c92b097',
      clientSecret: '1fa083372b44031cf1b8249251515c4e3d54c69d',
      repo: 'tate-young.github.io',
      owner: 'Tate-Young',
      admin: ['Tate-Young'],
      id: location.pathname,      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
<!-- disqus -->
<!-- <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = 'https://tate-young.github.io/2020/02/21/html-web-woker.html';
        this.page.identifier = '/2020/02/21/html-web-woker';
        this.page.title = 'Web Worker';
    };

    (function () { // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document,
            s = d.createElement('script');

        s.src = '//tate.disqus.com/embed.js'; // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript> -->


            <!-- <p class="post-info">
			æœ¬æ–‡ç”± <a href="/">liberxue</a> åˆ›ä½œï¼Œé‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">çŸ¥è¯†å…±äº«ç½²å4.0</a> å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯<br>æœ¬ç«™æ–‡ç« é™¤æ³¨æ˜è½¬è½½/å‡ºå¤„å¤–ï¼Œå‡ä¸ºæœ¬ç«™åŸåˆ›æˆ–ç¿»è¯‘ï¼Œè½¬è½½å‰è¯·åŠ¡å¿…ç½²å<br>æœ€åç¼–è¾‘æ—¶é—´ä¸º:2020-02-21 17:59:00</p> -->
        </div>
    </article>

    <!-- <div class="related-post-lists">
	<div class="post-lists">
		<div class="post-lists-body">
					<div class="post-list-item">
				<div class="post-list-item-container">
					<div class="item-label">
						<div class="item-title"><a href="induction.html">å½’çº³çš„éšæƒ³</a></div>
						<div class="item-meta clearfix">
														<div class="item-meta-ico bg-ico-image" style="background: url('../usr/themes/pinghsu/images/bg-ico.png') no-repeat;background-size: 40px auto;"></div>
	                        							<div class="item-meta-cat"><a href="../category/thoughts/index.html">Thoughts</a></div>
						</div>
					</div>
				</div>
			</div>
				</div>
	</div>
</div> -->

    <!-- <footer class="footer bg-white">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
	 <a class="social segmentfault" target="blank" href="https://segmentfault.com/u/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Segmentfault">Segmentfault</a>
    <a class="social github" target="blank" href="https://github.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="GitHub">GitHub</a>
    <a class="social twitter" target="blank" href="http://twitter.com/liberxue" title="è®¿é—® LiberXue_Twitter" data-hover="Twitter">Twitter</a>
     <a class="social stackoverflow" target="blank" href="https://stackoverflow.com/users/6902190/liberxue" title="è®¿é—® LiberXue_stackoverflow" data-hover="StackOverflow">StackOverflow</a>
          <a class="social oschina" target="blank" href="https://my.oschina.net/bolanzw" title="è®¿é—® LiberXue_Oschina" data-hover="Oschina">Oschina</a>
     <a class="social rss" target="blank" href="/feed.xml"title="è®¿é—® LiberXue_RSS" data-hover="RSS">RSS</a>
	</div>
		</div>
	</div>
	<div class="footer-meta">
        <div class="footer-container">
            <div class="meta-item meta-copyright">
                <div class="meta-copyright-info">
                    <a href="/" class="info-logo">
                         <img src="http://localhost:2333/style/images/logo-liberxue.png"   title="è®¿é—® LiberXue_blog" data-hover="LiberXue_blog" alt="LiberXue_blog" /> </a>
                    <div class="info-text">
                        <p>Theme is <a href="http://www.liberxue.com/2017/08/03/Jekyllthemes.html" title="è®¿é—® Jekyll liberxueä¸»é¢˜"  data-hover="Jekyll liberxue"target="_blank">Jekyll liberxue</a> by <a href="http://www.liberxue.com/about" target="_blank">liberxue</a></p>
                        <p>Powered by <a href="http://localhost:2333/tags/#Jekyll" title="Jekyll" data-hover="Jekyll" target="_blank" rel="nofollow">Jekyll</a></p>
                        <p>&copy; 2017 <a href="/feed.xml"  title="è®¿é—® liberxue blog RSS" data-hover="liberxue blog RSS">liberxue blog RSS</a></p>
                        <p>æ€»è®¡æ–‡ç« ï¼šç¯‡</p>
                      <p>æœ¬blogå·²å¼€æºç‚¹å‡»Fork</p><iframe src="http://ghbtns.com/github-btn.html?user=liberxue&repo=liberxue.github.io&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
                    </div>
                </div>
            </div>
            <div class="meta-item meta-posts">
                <h3 class="meta-title">ç½®é¡¶æ–‡ç« </h3>
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
            </div>
            <div class="meta-item meta-comments">
                <h3 class="meta-title">æœ€æ–°æ–‡ç« </h3>
  
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
</div>
		</div>
    </div>
</footer> -->
<script src="//cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>
<script async src="/search/js/520.js"></script>
<script async src="/search/js/gtag.js"></script>
<script async src="/search/live2d/autoload.js"></script>
<!-- <script src="/search/js/canvas.js"></script> -->

<script>
    $(function () {
        setTimeout(function () {
            $('code').removeClass('hljs');
            $('code').removeClass('language');
        }, 90);
    });
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    <!--liberxueconnnet-menu-->
    <div id="directory-content" class="directory-content">
        <div id="directory"></div>
    </div>
    <!--liberxueconnnet-menu-->
    <script>
      const directoryContainer = document.getElementById('directory')
      const postTitle = document.getElementsByClassName('post-title')[0]
      var postDirectoryBuild = function () {
        var postChildren = function children(childNodes, reg) {
          var result = [],
              isReg = typeof reg === 'object',
              isStr = typeof reg === 'string',
              node, i, len;
          for (i = 0, len = childNodes.length; i < len; i++) {
            node = childNodes[i];
            if ((node.nodeType === 1 || node.nodeType === 9) &&
              (!reg ||
                  isReg && reg.test(node.tagName.toLowerCase()) ||
                  isStr && node.tagName.toLowerCase() === reg)) {
                result.push(node);
              }
            }
            return result;
          },
          createPostDirectory = function (article, directory, isDirNum) {
            var contentArr = [],
                titleId = [],
                levelArr, root, level,
                currentList, list, li, link, i, len;
            levelArr = (function (article, contentArr, titleId) {
                  var titleElem = postChildren(article.childNodes, /^h\d$/),
                      levelArr = [],
                      lastNum = 1,
                      lastRevNum = 1,
                      count = 0,
                      guid = 1,
                      id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                      lastRevNum, num, elem;
                  while (titleElem.length) {
                      elem = titleElem.shift();
                      contentArr.push(elem.innerHTML);
                      num = +elem.tagName.match(/\d/)[0];
                      if (num > lastNum) {
                          levelArr.push(1);
                          lastRevNum += 1;
                      } else if (num === lastRevNum ||
                          num > lastRevNum && num <= lastNum) {
                          levelArr.push(0);
                          lastRevNum = lastRevNum;
                      } else if (num < lastRevNum) {
                          levelArr.push(num - lastRevNum);
                          lastRevNum = num;
                      }
                      count += levelArr[levelArr.length - 1];
                      lastNum = num;
                      elem.id = elem.id || (id + guid++);
                      titleId.push(elem.id);
                  }
                  if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                  return levelArr;
              })(article, contentArr, titleId);
              currentList = root = document.createElement('ul');
              dirNum = [0];
              for (i = 0, len = levelArr.length; i < len; i++) {
                  level = levelArr[i];
                  if (level === 1) {
                      list = document.createElement('ul');
                      if (!currentList.lastElementChild) {
                          currentList.appendChild(document.createElement('li'));
                      }
                      currentList.lastElementChild.appendChild(list);
                      currentList = list;
                      dirNum.push(0);
                  } else if (level < 0) {
                      level *= 2;
                      while (level++) {
                          if (level % 2) dirNum.pop();
                          currentList = currentList.parentNode;
                      }
                  }
                  dirNum[dirNum.length - 1]++;
                  li = document.createElement('li');
                  link = document.createElement('a');
                  link.name = '#' + titleId[i];
                  link.href = 'Javascript:;'
                  link.className = "post-aside-anchor"
                  link.title = 'è®¿é—®' + titleId[i];
                  link.innerHTML = !isDirNum ? contentArr[i] :
                      dirNum.join('.') + ' ' + contentArr[i];
                  li.appendChild(link);
                  currentList.appendChild(li);
              }
            directory.appendChild(root);
          };
        createPostDirectory(document.getElementById('post-content'), directoryContainer, true);
      };
      postDirectoryBuild();
    </script>
    <script>
      // gtag('config', GA_TRACKING_ID, {
      //   'page_title' : 'Blog',
      //   'page_path': window.location.pathname,
      //   'post_title': 'watttsdfasdf',
      // });

    </script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        lang = hljs.initHighlightingOnLoad();
    </script>
</body>

</html>
