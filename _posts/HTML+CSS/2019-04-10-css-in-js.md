---
layout: blog
front: true
comments: True
flag: CSS
background: purple
category: å‰ç«¯
title:  CSS in JS
date:   2019-04-13 19:46:00 GMT+0800 (CST)
update: 2019-04-14 23:14:00 GMT+0800 (CST)
background-image: http://www.ruanyifeng.com/blogimg/asset/2017/bg2017040602.jpg
tags:
- css
- js
- React
---
# {{ page.title }}

## ä»€ä¹ˆæ˜¯ CSS in JS

å¯¹äºä»¥å¾€çš„å¼€å‘ï¼Œé€šå¸¸æ˜¯é‡‡ç”¨"å…³æ³¨ç‚¹åˆ†ç¦»"çš„æ¨¡å¼ï¼Œå³:

* HTML - è´Ÿè´£ç½‘é¡µçš„ç»“æ„ï¼Œåˆç§°è¯­ä¹‰å±‚
* CSS - è´Ÿè´£ç½‘é¡µçš„æ ·å¼ï¼Œåˆç§°è§†è§‰å±‚
* JavaScript - è´Ÿè´£ç½‘é¡µçš„é€»è¾‘å’Œäº¤äº’ï¼Œåˆç§°é€»è¾‘å±‚æˆ–äº¤äº’å±‚

å…¶ä¸­ CSS çš„å‘å±•ç›¸è¾ƒä¸‹æ¥æ˜¯ååˆ†ç¼“æ…¢çš„ï¼Œåˆ°ç°åœ¨ä»ç„¶æ— æ³•è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜:

* å…¨å±€ä½œç”¨åŸŸ - å¯ä»¥éµå¾ª CSS ä¼˜å…ˆçº§
* ä¹¦å†™ - å¯ä»¥é‡‡ç”¨é¢„ç¼–è¯‘ `less`ã€`sass` æˆ–è€… [**PostCss**](https://postcss.org)
* å‘½åè§„åˆ™ - å¯ä»¥éµå¾ª [**BEM**](http://getbem.com/naming/)ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³å‘½åå†²çªä»¥åŠæ›´å¥½çš„è¯­ä¹‰åŒ–è€Œç”Ÿçš„

CSS æ¨¡å—åŒ–çš„è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œä½†ä¸»è¦æœ‰ä¸¤ç±»:

* **CSS Modules** - é‡‡ç”¨ CSSï¼Œæ­é… webpack ä½¿ç”¨
* **CSS in JS** - æŠ›å¼ƒ CSSï¼Œé€šè¿‡ JS æ¥å†™æ ·å¼
  * ç¼ºç‚¹æ˜¯ä¸èƒ½åˆ©ç”¨æˆç†Ÿçš„ CSS é¢„å¤„ç†å™¨ï¼Œå¤ç”¨æ€§å·®ï¼Œéœ€è¦ç¼–è¾‘å™¨æ”¯æŒä»£ç è¡¥å…¨å’Œé«˜äº®

## CSS Modules

### localIdentName

[**CSS Modules**](https://github.com/css-modules/css-modules) ä¸­å¯ä»¥å®šä¹‰å±€éƒ¨å’Œå…¨å±€å˜é‡:

* **:local** - é€šè¿‡ localIdentName è§„åˆ™å¤„ç†
* **:global** - æ ·å¼ç¼–è¯‘åä¸å˜

```CSS
/* ä¸‹é¢ä¸¤ä¸ªç­‰ä»·ï¼Œé»˜è®¤ç»™æ¯ä¸ª class åå¤–åŠ åŠ äº†ä¸€ä¸ª `:local` */
.normal {
  color: green;
}

:local(.normal) {
  color: green;
}

/* å…¨å±€æ ·å¼ */
:global {
  .link {
    color: green;
  }
  .box {
    color: yellow;
  }
}
```

CSS Modules ä¸ webpack çš„ `css-loader` å¯ä»¥å¾ˆå¥½åœ°[æ­é…ä½¿ç”¨](https://webpack.js.org/loaders/css-loader/#modules):

```JS
// modules è®¾ç½®ä¸º trueï¼Œåˆ™å¯ç”¨ CSS Modules
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        loader: 'css-loader',
        options: {
          modules: true,
        },
      },
    ],
  },
};
```

è¿™æ ·çš„è¯ï¼Œæ ·å¼ä¼šè¢«è½¬æ¢æˆä¸€ä¸²å“ˆå¸Œå€¼ï¼Œä¸ä¾¿äºæˆ‘ä»¬å»å®šä½ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ç”Ÿæˆæ ·å¼çš„[å‘½åè§„åˆ™](https://github.com/webpack/loader-utils#interpolatename):

```JS
// modules å³ä¸ºå¯ç”¨ï¼ŒlocalIdentName æ˜¯è®¾ç½®ç”Ÿæˆæ ·å¼çš„å‘½åè§„åˆ™
// [name]è¡¨ç¤ºæ–‡ä»¶åï¼Œ[local]è¡¨ç¤ºç±»åï¼Œ[hash:base64:5] æ˜¯æŒ‰ç…§ç»™å®šç®—æ³•ç”Ÿæˆçš„åºåˆ—ç 
options: {
  modules: true,
  localIdentName: '[path][name]__[local]-[hash:base64:5]',
},
```

ç„¶åæˆ‘ä»¬çœ‹ä»¥ä¸‹è¿™ä¸ªæ —å­:

```CSS
/* test.css */
.active {...}
.disabled {...}
```

```JS
import styles from './test.css';

console.log(styles);
/*
 * Object {
 *  active: 'h1__active-abc53',
 *  disabled: 'h1__disabled-def84',
 * }
*/

elem.outerHTML = `<h1 class=${styles.active}>CSS Modules</h1>`
```

å¯ä»¥æœ€ç»ˆçœ‹åˆ°ç”Ÿæˆçš„ HTML æ˜¯:

```HTML
<h1 class="h1__active-abc53"> Processing... </h1>
```

### ç»„åˆ Composes

å¯¹äºæ ·å¼å¤ç”¨ï¼ŒCSS Modules åªæä¾›äº†å”¯ä¸€çš„æ–¹å¼æ¥å¤„ç†ï¼Œå³ **composes** ç»„åˆ:

```CSS
.className {
  color: green;
  background: red;
}

/* ç¼–è¯‘æ—¶ä¼šç¼–è¯‘æˆä¸¤ä¸ª class */
.otherClassName {
  composes: className;
  color: yellow;
}
```

å½“ç„¶ composes è¿˜å¯ä»¥ç»„åˆå¤–éƒ¨æ ·å¼æ–‡ä»¶:

```CSS
/* settings.css */
.primary-color {
  color: #f40;
}
```

```CSS
/* components/Button.css */
.base { /* æ‰€æœ‰é€šç”¨çš„æ ·å¼ */ }

.primary {
  composes: base;
  composes: primary-color from './settings.css';
  /* primary å…¶å®ƒæ ·å¼ */
}
```

### :export

**:export** å…³é”®å­—å¯ä»¥æŠŠ CSS ä¸­çš„å˜é‡è¾“å‡ºåˆ° JS ä¸­:

```CSS
$primary-color: #f40;

:export {
  primaryColor: $primary-color;
}
```

```JS
import style from 'index.scss';

console.log(style.primaryColor); // #f40
```

> ä¸ React æ­é…ä½¿ç”¨çš„è¯æ¨è [react-css-modules](https://github.com/gajus/react-css-modules) ğŸ‘ˆ

## Web Components è§„èŒƒ

è°ˆåˆ°ç»„ä»¶åŒ–çš„è¯å¿…é¡»è¯´åˆ° [**Web Components**](https://developer.mozilla.org/zh-CN/docs/Web/Web_Components)ï¼Œå®ƒé€šè¿‡ä¸€ç§æ ‡å‡†åŒ–çš„éä¾µå…¥çš„æ–¹å¼å°è£…ä¸€ä¸ªç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶èƒ½ç»„ç»‡å¥½å®ƒè‡ªèº«çš„ HTML ç»“æ„ã€CSS æ ·å¼ã€JavaScript ä»£ç ï¼Œå¹¶ä¸”ä¸ä¼šå¹²æ‰°é¡µé¢ä¸Šçš„å…¶ä»–å…ƒç´ ã€‚è¿™æ„å‘³ç€ä½ æ— éœ€ React æˆ– Angular ç­‰æ¡†æ¶ä¹Ÿèƒ½åˆ›å»ºç»„ä»¶ã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿™äº›ç»„ä»¶è¿˜éƒ½å¯ä»¥æ— ç¼é›†æˆåˆ°è¿™äº›æ¡†æ¶ä¸­ï¼Œå¹¶æ”¯æŒè·¨å¹³å°ã€‚Web Components ä¸»è¦ç”±ä»¥ä¸‹å››ç§æŠ€æœ¯ç»„æˆ:

* **Custom elements(è‡ªå®šä¹‰å…ƒç´ )** - ä¸€ç»„ JavaScript APIï¼Œå…è®¸æ‚¨å®šä¹‰ custom elements åŠå…¶è¡Œä¸ºï¼Œç„¶åå¯ä»¥åœ¨æ‚¨çš„ç”¨æˆ·ç•Œé¢ä¸­æŒ‰ç…§éœ€è¦ä½¿ç”¨å®ƒä»¬
  * Custom Elements å¯ä»¥ç»§æ‰¿åŸç”Ÿ HTMLElement ç±»å’Œå…¶å­ç±»ã€‚
  * é€šè¿‡ `customElements.define()` ç»´æŠ¤è‡ªå®šä¹‰æ ‡ç­¾æ³¨å†Œè¡¨ã€‚
  * ç‰¹å®šç”Ÿå‘½å‘¨æœŸå‡½æ•°åœ¨æ ‡ç­¾åˆ›å»ºã€æ·»åŠ åˆ° DOMã€å±æ€§è¢«ä¿®æ”¹ç­‰æ—¶åˆ»è°ƒç”¨
* **Shadow DOM(å½±å­ DOM)** - ä¸€ç»„ JavaScript APIï¼Œç”¨äºå°†å°è£…çš„â€œå½±å­â€ DOM æ ‘é™„åŠ åˆ°å…ƒç´ (ä¸ä¸»æ–‡æ¡£ DOM åˆ†å¼€å‘ˆç°)å¹¶æ§åˆ¶å…¶å…³è”çš„åŠŸèƒ½ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥ä¿æŒå…ƒç´ çš„åŠŸèƒ½ç§æœ‰ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥è¢«è„šæœ¬åŒ–å’Œæ ·å¼åŒ–ï¼Œè€Œä¸ç”¨æ‹…å¿ƒä¸æ–‡æ¡£çš„å…¶ä»–éƒ¨åˆ†å‘ç”Ÿå†²çª
* **HTML templates(HTML æ¨¡æ¿)** - `<template>` å’Œ `<slot>` å…ƒç´ ä½¿æ‚¨å¯ä»¥ç¼–å†™ä¸åœ¨å‘ˆç°é¡µé¢ä¸­æ˜¾ç¤ºçš„æ ‡è®°æ¨¡æ¿ã€‚ç„¶åå®ƒä»¬å¯ä»¥ä½œä¸ºè‡ªå®šä¹‰å…ƒç´ ç»“æ„çš„åŸºç¡€è¢«å¤šæ¬¡é‡ç”¨
* **HTML Imports(HTML å¯¼å…¥)** - ä¸€æ—¦å®šä¹‰äº†è‡ªå®šä¹‰ç»„ä»¶ï¼Œæœ€ç®€å•çš„é‡ç”¨å®ƒçš„æ–¹æ³•å°±æ˜¯ä½¿å…¶å®šä¹‰ç»†èŠ‚ä¿å­˜åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œç„¶åä½¿ç”¨å¯¼å…¥æœºåˆ¶å°†å…¶å¯¼å…¥åˆ°æƒ³è¦å®é™…ä½¿ç”¨å®ƒçš„é¡µé¢ä¸­

### Custom elements

è¦æ³¨å†Œä¸€ä¸ªæ–°å…ƒç´ æ—¶ï¼Œéœ€è¦é€šè¿‡ `window.customElements` è·å–æ³¨å†Œè¡¨å®ä¾‹å¹¶è°ƒç”¨å…¶ `define` æ–¹æ³•:

```JS
// <my-element></my-element>

window.customElements.define('my-element', MyElement);
```

> ä¸ºäº†é¿å…æœªæ¥çš„å†²çªï¼Œæ‰€æœ‰è‡ªå®šä¹‰æ ‡ç­¾å¿…é¡»åŠ è¿è¯ç¬¦ **-**ï¼ŒåŒæ—¶åŸç”Ÿ HTML æ ‡ç­¾ä¿è¯ç»ä¸åŒ…å«æ­¤ç±»è¿è¯ç¬¦

ç°åœ¨é¡µé¢ä¸Šçš„æ¯ä¸ª `<my-element>` æ ‡ç­¾éƒ½ä¸ä¸€ä¸ª MyElement å…ƒç´ å¯¹åº”ã€‚ é¡µé¢æ¯è§£æä¸€ä¸ªè¯¥æ ‡ç­¾å°±è°ƒç”¨ä¸€æ¬¡ MyElement çš„æ„é€ å‡½æ•°ã€‚é™¤äº†æ ‡ç­¾åˆ›å»ºæ—¶ä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¼šåœ¨ç‰¹å®šæ—¶åˆ»è¢«è°ƒç”¨:

* **connectedCallback** - å½“å…ƒç´ è¢«æ·»åŠ åˆ°æ–‡æ¡£ä¸­æ—¶è°ƒç”¨ã€‚è¿™ä¸ªå‡½æ•°å¯èƒ½å¤šæ¬¡è°ƒç”¨ï¼Œæ¯”å¦‚æ ‡ç­¾ç§»åŠ¨ã€ç§»é™¤æˆ–é‡æ–°æ·»åŠ æ—¶
* **disconnectedCallback** - ä¸ connectedCallback ç›¸å¯¹åº”
* **attributeChangeCallback** - å…ƒç´ å±æ€§æ›´æ”¹æ—¶è°ƒç”¨

```JS
class GreetingElement extends HTMLElement {
  constructor() {
    super();
    this._name = 'Stranger';
  }
  connectedCallback() {
    this.addEventListener('click', e => alert(`Hello, ${this._name}!`));
  }
  attributeChangedCallback(attrName, oldValue, newValue) {
    if (attrName === 'name') {
      if (newValue) {
        this._name = newValue;
      } else {
        this._name = 'Stranger';
      }
    }
  }
  doSomething() { // åˆ›å»ºå…¬å…± API
    // do something in this method
  }
}
// ä¸€æ—¦å±æ€§çš„å€¼å‘ç”Ÿå˜åŠ¨ï¼Œå°±å°†ä½¿ç”¨å±æ€§çš„åç§°ã€å…¶å½“å‰å€¼åŠå…¶æ–°å€¼è°ƒç”¨ attributeChangedCallback
GreetingElement.observedAttributes = ['name'];
customElements.define('hey-there', GreetingElement);
```

```JS
// ä»å¤–éƒ¨ç»„ä»¶è°ƒç”¨å®šä¹‰çš„ API
const element = document.querySelector('my-element');
element.doSomething();
```

å¦‚æœè¦ç»§æ‰¿ä¸€ä¸ª HTML åŸç”Ÿæ ‡ç­¾ï¼Œä½ å¯èƒ½ä¼šæƒ³å®šä¹‰ä¸€ä¸ªçœ‹èµ·æ¥å®Œå…¨ä¸åŒæ–°æ ‡ç­¾ã€‚æ¯”å¦‚è®© `<hey-there>` å»ç»§æ‰¿ `<button>`:

```JS
class GreetingElement extends HTMLButtonElement {...}

// åŒæ—¶è¦åœ¨è‡ªå®šä¹‰æ ‡ç­¾æ³¨å†Œè¡¨ä¸­ä½“ç°å‡ºç»§æ‰¿ä¸€ä¸ªå·²æœ‰æ ‡ç­¾
customElements.define('hey-there', GreetingElement, { extends: 'button' });
```

æˆ‘ä»¬åº”è¯¥ç”¨è¢«ç»§æ‰¿çš„æ ‡ç­¾åŠ  **is** å±æ€§æ¥è¡¨ç¤ºè¿™ç§ç»§æ‰¿å…³ç³»ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨è‡ªå®šä¹‰æ ‡ç­¾:

```HTML
<button is="hey-there" name="World">Howdy</button>
```

### Shadow DOM

æˆ‘ä»¬å†™å‡ºäº†å‹å¥½çš„ custom elementï¼Œä¹Ÿä¸ºå…¶æ·»åŠ äº†æ¼‚äº®çš„æ ·å¼ã€‚ç°åœ¨æˆ‘ä»¬æƒ³æŠŠå®ƒç”¨åœ¨æˆ‘ä»¬çš„ç«™ç‚¹ä¸Šï¼Œä¹Ÿæƒ³æŠŠä»£ç åˆ†äº«å‡ºå»ï¼Œè®©æ›´å¤šçš„äººç”¨åœ¨ä»–ä»¬çš„ç½‘ç«™ä¸Šã€‚ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆé¿å…è‡ªå®šä¹‰ `<button>` æ ‡ç­¾å’Œå…¶ä»–ç½‘ç«™çš„ css å†²çªï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨[**Shadow DOM**](https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/%E5%BD%B1%E5%AD%90_DOM)ã€‚

Shadow DOM æ ‡å‡†æå‡ºäº† **shadow root(å½±å­æ ¹)** çš„æ¦‚å¿µã€‚ä½¿ç”¨ Shadow DOM æ—¶ï¼Œè‡ªå®šä¹‰å…ƒç´ çš„ HTML å’Œ CSS ä¼šå®Œå…¨å°è£…åœ¨ç»„ä»¶å†…éƒ¨ã€‚è¿™æ„å‘³ç€è¯¥å…ƒç´ å°†åœ¨æ–‡æ¡£çš„ DOM æ ‘ä¸­æ˜¾ç¤ºä¸ºå•ä¸ª HTML æ ‡ç­¾ï¼Œå…¶å†…éƒ¨ HTML ç»“æ„åˆ™æ”¾åœ¨ä¸€ä¸ª **#shadow-root** ä¸­:

```HTML
<div class="shadow-host">Hello, world!</div>
<script>
  // å½±å­å®¿ä¸»ï¼ˆshadow hostï¼‰
  var shadowHost = document.querySelector('.shadow-host');
  // åˆ›å»ºå½±å­æ ¹ï¼ˆshadow rootï¼‰
  // createShadowRoot æ–¹æ³•å·²å¼ƒç”¨
  // var shadowRoot = shadowHost.createShadowRoot();
  var shadowRoot = shadowHost.attachShadow({ mode: 'open' });
  // shadowHost.shadowRoot // the shadow root. è‹¥é€‰æ‹© closedï¼Œåˆ™ä¸º null
  // shadowHost.shadowRoot.host // the el itself.
  // å½±å­æ ¹ä½œä¸ºå½±å­æ ‘çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä»–çš„èŠ‚ç‚¹æ¯”å¦‚pèŠ‚ç‚¹éƒ½æ˜¯å®ƒçš„å­èŠ‚ç‚¹ã€‚
  shadowRoot.innerHTML = '<p class="shadow-root">Shadow DOM</p>';
</script>
```

å½“æˆ‘ä»¬é€šè¿‡å¸¸è§„é€‰æ‹©å™¨é€‰æ‹© shadow DOM é‡Œçš„å…ƒç´ æ—¶ï¼Œä¼šå‘ç°æ— æ³•è·å–:

```JS
document.querySelector('.shadow-root') // null

// è‹¥è¦è·å–çš„è¯ï¼Œéœ€è¦é€šè¿‡ shadowRoot
var container = document.querySelector('.shadow-host')
container.shadowRoot.querySelector('shadow-root')
```

> `mode: open` å¯ä»¥åœ¨å¼€å‘å·¥å…·ä¸­æ£€æŸ¥ï¼Œå¹¶é€šè¿‡æŸ¥è¯¢ã€é…ç½®ä»»ä½•å…¬å¼€çš„ CSS å±æ€§æˆ–ç›‘å¬å®ƒæŠ›å‡ºçš„äº‹ä»¶æ¥äº¤äº’ï¼Œåä¹‹åˆ™æ˜¯ 'closed'

æˆ‘ä»¬å¯ä»¥éšä¾¿æ‰¾ä¸€ä¸ªè§†é¢‘ï¼Œæ‰¾åˆ° `video` æ ‡ç­¾ï¼Œç„¶ååœ¨æµè§ˆå™¨è®¾ç½®é‡Œå¼€å¯ `Show user agent shadow DOM`ï¼Œæˆ‘ä»¬ä¼šå‘ç°è§†é¢‘æ ‡ç­¾ä¸‹ä¹Ÿè—äº†åµŒå¥—çš„ shadow DOM:

![video](https://cdn-images-1.medium.com/max/1600/1*h6j3PjczSAfh8jkPYRWMVQ.jpeg)

**ç»„åˆ(Composition)** æ˜¯å°† Shadow DOM æ ‘ä¸ç”¨æˆ·æä¾›çš„æ ‡è®°ç»„åˆåœ¨ä¸€èµ·çš„è¿‡ç¨‹ã€‚è¿™æ˜¯é€šè¿‡æ’æ§½ `<slot>` å…ƒç´ å®Œæˆçš„ï¼Œè¯¥å…ƒç´ æœ¬è´¨ä¸Šæ˜¯ Shadow DOM ä¸­çš„å ä½ç¬¦ï¼Œå…¶ä¸­å‘ˆç°ç”¨æˆ·æä¾›çš„æ ‡è®°:

```HTML
<!-- å¸¦æœ‰åå­—çš„ slot -->
<image-gallery>
  <img src="foo.jpg" slot="image">
  <img src="b.arjpg" slot="image">
</image-gallery>
```

å¸¦æœ‰åç§°çš„ slot å‘Šè¯‰ç»„ä»¶åº”è¯¥åœ¨å…¶ Shadow DOM ä¸­çš„ä»€ä¹ˆä½ç½®å‘ˆç°å®ƒä»¬:

```HTML
<div id="container">
  <div class="images">
    <slot name="image"></slot>
  </div>
</div>

<!-- ç”Ÿæˆ -->
<div id="container">
  <div class="images">
    <slot name="image">
      <img src="foo.jpg" slot="image">
      <img src="bar.jpg" slot="image">
    </slot>
  </div>
</div>

```

## Vue scoped & module

Vue ä¸»å¼ ä¸ºç»„ä»¶æ ·å¼[è®¾ç½®ä½œç”¨åŸŸ](https://vue-loader-v14.vuejs.org/zh-cn/features/scoped-css.html)ï¼Œå¯¹äºåº”ç”¨æ¥è¯´ï¼Œé¡¶çº§ App ç»„ä»¶å’Œå¸ƒå±€ç»„ä»¶ä¸­çš„æ ·å¼å¯ä»¥æ˜¯å…¨å±€çš„ï¼Œä½†æ˜¯å…¶å®ƒæ‰€æœ‰ç»„ä»¶éƒ½åº”è¯¥æ˜¯æœ‰ä½œç”¨åŸŸçš„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ **scoped** ç‰¹æ€§æ¥å®ç°éš”ç¦»ä½œç”¨åŸŸ:

```HTML
<!-- ä½¿ç”¨ `scoped` ç‰¹æ€§ï¼Œè¿™ç±»ä¼¼äº Shadow DOM ä¸­çš„æ ·å¼å°è£… -->
<template>
  <div class="example">hi</div>
</template>

<style scoped>
.example {
  color: red;
}
</style>

```

ç”±äº **vue-loader** å†…éƒ¨é€šè¿‡ **PostCSS** å¤„ç†å…¶æ ·å¼ï¼Œé€šè¿‡å®ƒæ¥å®ç°ä»¥ä¸‹è½¬æ¢:

```HTML
<template>
  <div class="example" data-v-f3f3eg9>hi</div>
</template>

<style>
.example[data-v-f3f3eg9] {
  color: red;
}
</style>
```

å¦‚æœä½ å¸Œæœ› scoped æ ·å¼ä¸­çš„ä¸€ä¸ªé€‰æ‹©å™¨èƒ½å¤Ÿä½œç”¨å¾—â€œæ›´æ·±â€ï¼Œä¾‹å¦‚å½±å“å­ç»„ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ `>>>` æˆ– `/deep/` æ“ä½œç¬¦æ¥å®ç°**æ·±åº¦ä½œç”¨é€‰æ‹©å™¨**:

```HTML
<style scoped>
  .a >>> .b { /* ... */ }
</style>
```

![vue-scoped.png]( {{site.url}}/style/images/smms/vue-scoped.png )

å½“ç„¶å®˜æ–¹è¿˜æ˜¯æ›´[æ¨èä¸€äº›åŸºäº class çš„ç­–ç•¥](https://cn.vuejs.org/v2/style-guide/#ä¸ºç»„ä»¶æ ·å¼è®¾ç½®ä½œç”¨åŸŸ-å¿…è¦)ï¼Œæ¯”å¦‚ä¸Šé¢æåˆ°çš„ [**CSS Modules**](https://vue-loader-v14.vuejs.org/zh-cn/features/css-modules.html)ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºæ¨¡å—åŒ–å’Œç»„åˆ CSS çš„æµè¡Œç³»ç»Ÿã€‚**vue-loader** æä¾›äº†ä¸ CSS æ¨¡å—çš„ä¸€æµé›†æˆï¼Œå¯ä»¥ä½œä¸ºæ¨¡æ‹Ÿ CSS ä½œç”¨åŸŸçš„æ›¿ä»£æ–¹æ¡ˆ:

```HTML
<template>
  <button :class="[$style.button, $style.buttonClose]">X</button>
</template>

<!-- ä½¿ç”¨ CSS Modules -->
<!-- å°†ä¸º css-loader æ‰“å¼€ CSS Modules æ¨¡å¼ï¼Œç”Ÿæˆçš„ CSS å¯¹è±¡å°†ä¸ºç»„ä»¶æ³¨å…¥ä¸€ä¸ªåå« $style çš„è®¡ç®—å±æ€§ï¼Œä½ å¯ä»¥åœ¨ä½ çš„æ¨¡å—ä¸­ä½¿ç”¨åŠ¨æ€ class ç»‘å®š -->
<style module>
.button {
  border: none;
  border-radius: 2px;
}

.buttonClose {
  background-color: red;
}
</style>

<!-- ä¹Ÿå¯ä»¥åœ¨ JS ä¸­è®¿é—® $style å±æ€§ -->
<script>
export default {
  created () {
    console.log(this.$style.button)
    // -> "HelloWorld_color_1DT2e"
    // an identifier generated based on filename and className.
  }
}
</script>
```

![vue-css-module.png]( {{site.url}}/style/images/smms/vue-css-module.png )

å½“ç„¶ä½ å¯ä»¥å®šä¹‰ä¸æ­¢ä¸€ä¸ª \<style\>ï¼Œä¸ºäº†é¿å…è¢«è¦†ç›–ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½® module å±æ€§æ¥ä¸ºå®ƒä»¬å®šä¹‰æ³¨å…¥åè®¡ç®—å±æ€§çš„åç§°:

```HTML
<template>
  <button :class="a.button">X</button>
  <button :class="b.button">X</button>
</template>

<style module="a">
  /* identifiers injected as a */
</style>

<style module="b">
  /* identifiers injected as b */
</style>
```

## Angular ViewEncapsulation

Angular é‡‡ç”¨äº†è§†å›¾å°è£…çš„æšä¸¾ç±»å‹ **ViewEncapsulation**ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ç§å€¼:

* **ViewEncapsulation.Emulated** - é»˜è®¤é¡¹ï¼Œæ—  Shadow DOMï¼Œä½†æ˜¯é€šè¿‡ Angular æä¾›çš„æ ·å¼åŒ…è£…æœºåˆ¶æ¥å°è£…ç»„ä»¶ï¼Œä½¿å¾—ç»„ä»¶çš„æ ·å¼ä¸å—å¤–éƒ¨å½±å“
* **ViewEncapsulation.Native** - ä½¿ç”¨åŸç”Ÿçš„ Shadow DOM ç‰¹æ€§ã€‚å·²å¼ƒç”¨ï¼Œæ”¹ä¸º **ShadowDom**
* **ViewEncapsulation.None** - æ—  Shadow DOMï¼Œå¹¶ä¸”ä¹Ÿæ— æ ·å¼åŒ…è£…

```JS
import { Component, ViewEncapsulation } from '@angular/core';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.less'],
  encapsulation: ViewEncapsulation.None,
})
export class AppComponent {
  title = 'angular-demo';
}
```

æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹æ¯”ä¸‹ä¸‰ç§è®¾ç½®ä¸‹çš„ HTMLï¼Œé¦–å…ˆæ˜¯è®¾ç½®ä¸º None:

![ViewEncapsulation-Native.png]( {{site.url}}/style/images/smms/ViewEncapsulation-Native.png )

è®¾ç½®ä¸º Emulatedï¼Œæ³¨æ„çœ‹æ ·å¼å˜æˆäº†:

```CSS
/* å¯¹åº” html ä¸­çš„ _ngcontent-kty-c0 å±æ€§ */
.test[_ngcontent-kty-c0] {...}
```

![ViewEncapsulation-Emulated.png]( {{site.url}}/style/images/smms/ViewEncapsulation-Emulated.png )

è®¾ç½®ä¸º Native:

![ViewEncapsulation-None.png]( {{site.url}}/style/images/smms/ViewEncapsulation-None.png )

## React CSS-in-JS

React ä¸€ç›´æ¨å´‡ç»„ä»¶åŒ–æ€æƒ³ï¼Œå°†ä¸‰ç§è¯­è¨€èåˆåˆ°ä¸€èµ·ï¼Œä»è€Œåˆ›å»ºå‡ºæ²¡æœ‰å¤–éƒ¨ä¾èµ–çš„ç‹¬ç«‹å¯å¤ç”¨çš„ç»„ä»¶ã€‚React ä¸ä»…ä»…å°è£…äº† HTMLï¼Œå³ `JSX`(å…·ä½“å¯ä»¥[æŸ¥çœ‹è¿™ä¸€èŠ‚]({{site.url}}/2018/08/06/react-profile.html#jsx))ï¼Œä¹Ÿå°è£…äº† CSSï¼Œå…¶å®å°±æ˜¯ç®€å•å®šä¹‰ä¸€ä¸ªæ ·å¼å¯¹è±¡:

```JS
const style = {
  color: 'orange',
  fontSize: '12px',
}

function App() {
  return (
    <div style={style}>hello</div>
  )
}
```

> æ ·å¼å¯¹è±¡é‡Œçš„å†™æ³•ï¼Œæ¯”å¦‚ fontSizeï¼Œå…¶å®å°±æ˜¯é€šè¿‡ style å¯ä»¥è®¿é—®çš„[æ ·å¼å±æ€§åˆ—è¡¨](https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Properties_Reference) ğŸ‘ˆ

### styled-components

è¿™ç§å°è£…çš„ CSS å†™æ³•ä¼¼ä¹åˆå›åˆ°äº†è§£æ”¾å‰ï¼Œä¸ºäº†åŠ å¼º React çš„ CSS æ“ä½œï¼Œä¸€ç³»åˆ—ç¬¬ä¸‰æ–¹åº“åº”è¿è€Œç”Ÿã€‚github æœ‰ä¸ªé¡¹ç›®ä¹Ÿå¯¹è¿™äº›åº“åšäº†ä¸ªæ•´ç†ï¼Œå¯ä»¥[ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹](https://github.com/MicheleBertoli/css-in-js)ï¼Œå…¶ä¸­æ¯”è¾ƒç«çš„æœ‰ [**styled-components**](https://github.com/styled-components/styled-components):

```JSX
import React from 'react';
import styled from 'styled-components';

// Create a <Title> react component that renders an <h1> which is centered, palevioletred and sized at 1.5em
// Returns a function that accepts a tagged template literal and turns it into a StyledComponent
const Title = styled.h1`
  font-size: 1.5em;
  text-align: center;
  color: palevioletred;
`;

// Create a <Wrapper> react component that renders a <section> with some padding and a papayawhip background
const Wrapper = styled.section`
  padding: 4em;
  background: papayawhip;
`;

const OrangeTitle = styled(Title)`
  color: orange;
`

// Use them like any other React component â€“ except they're styled!
<Wrapper>
  <Title>Hello World, this is my first styled component!</Title>
</Wrapper>
```

å½“ç„¶ï¼Œå®ƒè¿˜æ”¯æŒä¸€äº›æ›´å¤æ‚çš„å†™æ³•ï¼Œæ¯”å¦‚ä¼ å‚:

```JSX
const padding = '3em'

const Section = styled.section`
  color: white;

  /* Pass variables as inputs */
  padding: ${padding};

  /* Adjust the background from the properties */
  background: ${props => props.background};
`

render(
  <Section background="cornflowerblue">
    âœ¨ Magic
  </Section>
)
```

è®©æˆ‘ä»¬å†çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆåšåˆ°éš”ç¦»ä½œç”¨åŸŸçš„:

![styled-components.png]( {{site.url}}/style/images/smms/styled-components.png )

> styled-components è¿™ç§æ ·å¼å†™æ³•å…¶å®å°±æ˜¯ ES6 é‡Œçš„[æ ‡ç­¾æ¨¡æ¿(tagged template)]({{site.url}}/2018/03/15/es6-extension-previous.html#æ ‡ç­¾æ¨¡æ¿)ï¼Œæ›´å¤šçš„ API ä¹Ÿ[å¯ä»¥å‚è€ƒè¿™é‡Œ](https://www.styled-components.com/docs/api) ğŸ‘ˆ

### JSS

**material-ui** UI æ¡†æ¶é€šè¿‡ **JSS** ä¹Ÿå®ç°äº† CSS in JS çš„å†™æ³•ï¼Œå…·ä½“[å¯ä»¥æŸ¥çœ‹è¿™ä¸€ç¯‡]({{site.url}}/2018/08/13/react-material-ui.html#jss) ğŸ‘ˆ

ä½†æ˜¯ Material-UI çš„æ ·å¼è§£å†³æ–¹æ¡ˆå—åˆ°è®¸å¤šå…¶ä»– CSS-in-JS åº“çš„å¯å‘ï¼Œä¾‹å¦‚ä¸Šé¢æåˆ°çš„ styled-componentsï¼Œè¿™äº›ä»åœ¨[å®éªŒç‰ˆæœ¬ä¸­](https://material-ui.com/css-in-js/basics/) ğŸ‘ˆ

åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹çœ‹å®ƒæ€ä¹ˆåšåˆ°éš”ç¦»ä½œç”¨åŸŸçš„ï¼Œæ¯”å¦‚ `CouponComponent` ç»„ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªåä¸º `title` çš„æ ·å¼:

```JSX
const styles = {
  title: {
    height: '55px',
    lineHeight: '60px',
    fontSize: '18px',
    textIndent: '1em',
  },
}
...
return {
  ...
  <div className={classes.title} style={{ textAlign }}>{titleName}</div>
}
```

æˆ‘ä»¬å¯ä»¥ä»ä¸‹å›¾çœ‹åˆ°ç±»åä¿®æ”¹çš„è§„åˆ™ä¸º `ç»„ä»¶å + ç±»å + å››ä½éšæœºæ•°å­—`:

![material-ui-jss.png]( {{site.url}}/style/images/smms/material-ui-jss.png )

## å‚è€ƒé“¾æ¥

1. [ä½ çš„å‰ç«¯æ¡†æ¶è¦è¢« Web ç»„ä»¶å–ä»£äº†](https://www.infoq.cn/article/LlxdiogqZvvci57_ZgJm) By Danny Moerkerke
2. [[è¯‘]ç»„ä»¶åŒ–å¼€å‘åˆ©å™¨ï¼šWeb Components æ ‡å‡†](https://juejin.im/post/5c4a972b6fb9a049a7122eb7) By è€æ²™322
3. [Angular 2 ViewEncapsulation](https://segmentfault.com/a/1190000008677532) By Semlinker
4. [ç¥å¥‡çš„ Shadow DOM](https://aotu.io/notes/2016/06/24/Shadow-DOM/) By æš–æš–
5. [CSS Modules ä½¿ç”¨è¯¦è§£](https://imweb.io/topic/586519b1b3ce6d8e3f9f99aa) By å¼ é¢–
6. [praveenpuglia/shadow-dom.md - github](https://gist.github.com/praveenpuglia/0832da687ed5a5d7a0907046c9ef1813)
