---
layout: blog
front: true
comments: True
flag: HTML
background: purple
category: å‰ç«¯
title:  Core Web Vitals
date:   2021-12-29 11:10:00 GMT+0800 (CST)
background-image: https://web-dev.imgix.net/image/admin/BHaoqqR73jDWe6FL2kfw.png?auto=format&w=1600
tags:
- HTML
- JavaScript
---
# {{ page.title }}

## ä»€ä¹ˆæ˜¯ Google CWV

**CWV(Core Web Vitals) å³æ ¸å¿ƒ web æŒ‡æ ‡**ï¼Œå½“å‰ä¾§é‡äºç”¨æˆ·ä½“éªŒçš„ä¸‰ä¸ªæ–¹é¢ â€”â€” **åŠ è½½æ€§èƒ½**ã€**äº¤äº’æ€§**å’Œ**è§†è§‰ç¨³å®šæ€§**ï¼š

* [**Largest Contentful Paint (LCP)**](https://web.dev/i18n/zh/lcp/) - æœ€å¤§å†…å®¹ç»˜åˆ¶ï¼Œæµ‹é‡åŠ è½½æ€§èƒ½ã€‚ä¸ºäº†æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼ŒLCP åº”åœ¨é¡µé¢é¦–æ¬¡å¼€å§‹åŠ è½½åçš„ 2.5 ç§’å†…å‘ç”Ÿã€‚
* [**First Input Delay (FID)**](https://web.dev/i18n/zh/fid/) - é¦–æ¬¡è¾“å…¥å»¶è¿Ÿï¼Œæµ‹é‡äº¤äº’æ€§ã€‚ä¸ºäº†æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œé¡µé¢çš„ FID åº”ä¸º 100 æ¯«ç§’æˆ–æ›´çŸ­ã€‚
* [**Cumulative Layout Shift (CLS)**](https://web.dev/i18n/zh/cls/) - ç´¯ç§¯å¸ƒå±€åç§»ï¼Œæµ‹é‡è§†è§‰ç¨³å®šæ€§ã€‚ä¸ºäº†æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œé¡µé¢çš„ CLS åº”ä¿æŒåœ¨ 0.1 æˆ–æ›´å°‘ã€‚

![cwv]( {{site.url}}/style/images/smms/cwv.png )

### LCP

è¯¸å¦‚ **loadï¼ˆåŠ è½½ï¼‰**æˆ– **DOMContentLoadedï¼ˆDOM å†…å®¹åŠ è½½å®Œæ¯•ï¼‰**è¿™æ ·çš„æ—§æœ‰æŒ‡æ ‡å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºè¿™äº›æŒ‡æ ‡ä¸ä¸€å®šä¸ç”¨æˆ·åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„å†…å®¹ç›¸å¯¹åº”ã€‚è€Œåƒ **First Contentful Paint é¦–æ¬¡å†…å®¹ç»˜åˆ¶ (FCP)** è¿™ç±»ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„è¾ƒæ–°æ€§èƒ½æŒ‡æ ‡åªä¼šæ•è·åŠ è½½ä½“éªŒæœ€å¼€å§‹çš„éƒ¨åˆ†ã€‚å¦‚æœæŸä¸ªé¡µé¢æ˜¾ç¤ºçš„æ˜¯ä¸€æ®µå¯åŠ¨ç”»é¢æˆ–åŠ è½½æŒ‡ç¤ºï¼Œé‚£ä¹ˆè¿™äº›æ—¶åˆ»ä¸ç”¨æˆ·çš„å…³è”æ€§å¹¶ä¸å¤§ã€‚

**LCP** æŒ‡æ ‡ä¼šæ ¹æ®é¡µé¢é¦–æ¬¡å¼€å§‹åŠ è½½çš„æ—¶é—´ç‚¹æ¥æŠ¥å‘Šå¯è§†åŒºåŸŸå†…å¯è§çš„æœ€å¤§å›¾åƒæˆ–æ–‡æœ¬å—å®Œæˆæ¸²æŸ“çš„ç›¸å¯¹æ—¶é—´ã€‚æ ¹æ®å½“å‰æœ€å¤§å†…å®¹ç»˜åˆ¶ API ä¸­çš„è§„å®šï¼Œæœ€å¤§å†…å®¹ç»˜åˆ¶è€ƒé‡çš„å…ƒç´ ç±»å‹ä¸ºï¼š

1. \<img\>å…ƒç´ 
1. å†…åµŒåœ¨ \<svg\> å…ƒç´ å†…çš„ \<image\> å…ƒç´ 
1. \<video\> å…ƒç´ ï¼ˆä½¿ç”¨å°é¢å›¾åƒï¼‰
1. é€šè¿‡ url() å‡½æ•°ï¼ˆè€Œéä½¿ç”¨ CSS æ¸å˜ï¼‰åŠ è½½çš„å¸¦æœ‰èƒŒæ™¯å›¾åƒçš„å…ƒç´ 
1. åŒ…å«æ–‡æœ¬èŠ‚ç‚¹æˆ–å…¶ä»–è¡Œå†…çº§æ–‡æœ¬å…ƒç´ å­å…ƒç´ çš„[å—çº§å…ƒç´ ](https://developer.mozilla.org/en-US/docs/Web/HTML/Block-level_elements)ã€‚

> å¦‚æœæœ‰å…ƒç´ å»¶ä¼¸åˆ°å¯è§†åŒºåŸŸä¹‹å¤–ï¼Œæˆ–è€…ä»»ä½•å…ƒç´ è¢«å‰ªè£æˆ–åŒ…å«ä¸å¯è§çš„æº¢å‡ºï¼Œåˆ™è¿™äº›éƒ¨åˆ†ä¸è®¡å…¥å…ƒç´ å¤§å°ã€‚

![lcp](https://web-dev.imgix.net/image/admin/uJAGswhXK3bE6Vs4I5bP.png?auto=format&w=1600)

æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸Šç¤ºä¾‹ä¸­çœ‹å‡ºï¼ŒInstagram æ ‡å¿—åŠ è½½å¾—ç›¸å¯¹è¾ƒæ—©ï¼Œå³ä½¿å…¶ä»–å†…å®¹éšåé™†ç»­æ˜¾ç¤ºï¼Œä½†æ ‡å¿—å§‹ç»ˆæ˜¯æœ€å¤§å…ƒç´ ã€‚åœ¨ Instagram æ—¶é—´è½´çš„ç¬¬ä¸€å¸§ä¸­ï¼Œç›¸æœºæ ‡å¿—çš„å‘¨å›´æ²¡æœ‰ç”¨ç»¿æ¡†æ¡†å‡ºã€‚è¿™æ˜¯å› ä¸ºè¯¥æ ‡å¿—æ˜¯ä¸€ä¸ª \<svg\> å…ƒç´ ï¼Œè€Œ \<svg\> å…ƒç´ ç›®å‰ä¸è¢«è§†ä¸º LCP å€™é€‰å¯¹è±¡ã€‚é¦–ä¸ª LCP å€™é€‰å¯¹è±¡æ˜¯ç¬¬äºŒå¸§ä¸­çš„æ–‡æœ¬ã€‚

è¦åœ¨ JavaScript ä¸­æµ‹é‡ LCPï¼Œå¯ä»¥ä½¿ç”¨æœ€å¤§å†…å®¹ç»˜åˆ¶ APIã€‚ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª PerformanceObserver æ¥ä¾¦å¬ **largest-contentful-paint** æ¡ç›®å¹¶è®°å½•åœ¨æ§åˆ¶å°ä¸­:

```js
new PerformanceObserver((entryList) => {
  for (const entry of entryList.getEntries()) {
    console.log('LCP candidate:', entry.startTime, entry)
  }
}).observe({ type: 'largest-contentful-paint', buffered: true })
```

LCP ä¸»è¦å—å››ä¸ªå› ç´ å½±å“ï¼š

1. ç¼“æ…¢çš„æœåŠ¡å™¨å“åº”é€Ÿåº¦ - å¯é€šè¿‡ TTFB æ¥æµ‹é‡æœåŠ¡å™¨å“åº”æ—¶é—´
1. JavaScript å’Œ CSS æ¸²æŸ“é˜»å¡
1. èµ„æºåŠ è½½æ—¶é—´
1. å®¢æˆ·ç«¯æ¸²æŸ“

æ”¹è¿›æ–¹æ¡ˆï¼Œæ›´å¤šç»†èŠ‚å¯ä»¥[å‚è€ƒè¿™é‡Œ](https://web.dev/i18n/zh/optimize-lcp/) ğŸ‘ˆï¼š

1. ä½¿ç”¨ [**PRPL**](https://web.dev/apply-instant-loading-with-prpl/) æ¨¡å¼åšåˆ°å³æ—¶åŠ è½½
1. ä¼˜åŒ–å…³é”®æ¸²æŸ“è·¯å¾„
1. ä¼˜åŒ–æ‚¨çš„ CSS
1. ä¼˜åŒ–æ‚¨çš„å›¾åƒ
1. ä¼˜åŒ–ç½‘é¡µå­—ä½“
1. ä¼˜åŒ–æ‚¨çš„ JavaScriptï¼ˆé’ˆå¯¹å®¢æˆ·ç«¯æ¸²æŸ“çš„ç½‘ç«™ï¼‰

### FID

ç”¨æˆ·å¯¹æ‚¨çš„ç½‘ç«™åŠ è½½é€Ÿåº¦çš„ç¬¬ä¸€å°è±¡å¯ä»¥é€šè¿‡ FCP è¿›è¡Œæµ‹é‡ã€‚ä½†ç½‘ç«™åœ¨å±å¹•ä¸Šç»˜åˆ¶åƒç´ çš„é€Ÿåº¦åªæ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†ï¼ŒåŒæ ·é‡è¦çš„è¿˜æœ‰å½“ç”¨æˆ·è¯•å›¾ä¸è¿™äº›åƒç´ è¿›è¡Œäº¤äº’æ—¶ï¼Œç½‘ç«™æ˜¯å¦èƒ½å¤ŸåŠæ—¶å“åº”ï¼

**FID** æµ‹é‡ä»ç”¨æˆ·ç¬¬ä¸€æ¬¡ä¸é¡µé¢äº¤äº’ï¼ˆä¾‹å¦‚å½“ä»–ä»¬å•å‡»é“¾æ¥ã€ç‚¹æŒ‰æŒ‰é’®æˆ–ä½¿ç”¨ç”± JavaScript é©±åŠ¨çš„è‡ªå®šä¹‰æ§ä»¶ï¼‰ç›´åˆ°æµè§ˆå™¨å¯¹äº¤äº’ä½œå‡ºå“åº”ï¼Œå¹¶å®é™…èƒ½å¤Ÿå¼€å§‹å¤„ç†äº‹ä»¶å¤„ç†ç¨‹åºæ‰€ç»è¿‡çš„æ—¶é—´ã€‚ä¸ºä»€ä¹ˆè¦æµ‹è¯•é¦–æ¬¡ï¼Ÿæ˜¯å› ä¸ºç¬¬ä¸€å°è±¡è‡³å…³é‡è¦ã€‚

> FID æ˜¯æµ‹é‡é¡µé¢åŠ è½½æœŸé—´å“åº”åº¦çš„æŒ‡æ ‡ã€‚å› æ­¤ï¼ŒFID åªå…³æ³¨ä¸è¿ç»­æ“ä½œå¯¹åº”çš„è¾“å…¥äº‹ä»¶ï¼Œå¦‚ç‚¹å‡»ã€è½»è§¦å’ŒæŒ‰é”®ã€‚å…¶ä»–è¯¸å¦‚æ»šåŠ¨å’Œç¼©æ”¾ä¹‹ç±»çš„äº¤äº’å±äºè¿ç»­æ“ä½œï¼Œå…·æœ‰å®Œå…¨ä¸åŒçš„æ€§èƒ½çº¦æŸã€‚

> **FID æ˜¯ä¸€ä¸ªåªèƒ½è¿›è¡Œå®é™…æµ‹é‡çš„æŒ‡æ ‡**ã€‚ä½†æ˜¯ï¼Œ**Total Blocking Time æ€»é˜»å¡æ—¶é—´ (TBT)** æŒ‡æ ‡ä¸ä»…å¯ä»¥è¿›è¡Œå®éªŒå®¤æµ‹é‡ï¼Œè¿˜ä¸å®é™…çš„ FID å…³è”æ€§å¼ºï¼Œè€Œä¸”å¯ä»¥æ•è·å½±å“äº¤äº’æ€§çš„é—®é¢˜ã€‚èƒ½å¤Ÿåœ¨å®éªŒå®¤ä¸­æ”¹è¿› TBT çš„ä¼˜åŒ–ä¹Ÿåº”è¯¥èƒ½ä¸ºæ‚¨çš„ç”¨æˆ·æ”¹è¿› FIDã€‚

è¾ƒé•¿çš„é¦–æ¬¡è¾“å…¥å»¶è¿Ÿé€šå¸¸å‘ç”Ÿåœ¨ FCP å’Œ **Time to Interactive å¯äº¤äº’æ—¶é—´ (TTI)** ä¹‹é—´ï¼Œå› ä¸ºåœ¨æ­¤æœŸé—´ï¼Œé¡µé¢å·²ç»æ¸²æŸ“å‡ºéƒ¨åˆ†å†…å®¹ï¼Œä½†äº¤äº’æ€§è¿˜å°šä¸å¯é ã€‚æ ¹æ®ä»¥ä¸‹æ—¶é—´è½´å¯ä»¥çœ‹å‡ºï¼ŒFCP å’Œ TTI ä¹‹é—´æœ‰ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´ï¼ˆåŒ…æ‹¬ä¸‰æ®µé•¿ä»»åŠ¡ï¼‰ï¼Œå¦‚æœç”¨æˆ·åœ¨è¿™æ®µæ—¶é—´å†…å°è¯•ä¸é¡µé¢è¿›è¡Œäº¤äº’ï¼ˆä¾‹å¦‚å•å‡»ä¸€ä¸ªé“¾æ¥ï¼‰ï¼Œé‚£ä¹ˆä»æµè§ˆå™¨æ¥æ”¶åˆ°å•å‡»ç›´è‡³ä¸»çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¹‹å‰å°±ä¼šæœ‰ä¸€æ®µå»¶è¿Ÿï¼š

![fid](https://web-dev.imgix.net/image/admin/krOoeuQ4TWCbt9t6v5Wf.svg)

è¦åœ¨ JavaScript ä¸­æµ‹é‡ FIDï¼Œæ‚¨å¯ä»¥ä½¿ç”¨äº‹ä»¶è®¡æ—¶ APIã€‚ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª PerformanceObserver æ¥ä¾¦å¬ first-input æ¡ç›®å¹¶è®°å½•åœ¨æ§åˆ¶å°ä¸­ï¼š

```js
new PerformanceObserver((entryList) => {
  for (const entry of entryList.getEntries()) {
    const delay = entry.processingStart - entry.startTime
    console.log('FID candidate:', delay, entry)
  }
}).observe({ type: 'first-input', buffered: true })
```

æ”¹è¿›æ–¹æ¡ˆï¼š

1. å‡å°‘ç¬¬ä¸‰æ–¹ä»£ç çš„å½±å“
1. å‡å°‘ JavaScript æ‰§è¡Œæ—¶é—´
1. æœ€å°åŒ–ä¸»çº¿ç¨‹å·¥ä½œ
1. ä¿æŒè¾ƒä½çš„è¯·æ±‚æ•°å’Œè¾ƒå°çš„ä¼ è¾“å¤§å°

### CLS

æœ‰æ²¡æœ‰é‡åˆ°è¿‡ä¸€ç§æƒ…å†µï¼Œå½“ä½ æ­£è¦ç‚¹å‡»ä¸€ä¸ªé“¾æ¥æˆ–ä¸€ä¸ªæŒ‰é’®æ—¶ï¼Œçªç„¶é—´ç§»ä½äº†ï¼Œç»“æœç‚¹åˆ°äº†åˆ«çš„ä¸œè¥¿ï¼é¡¿æ—¶ C è¯­è¨€ï¼ï¼é¡µé¢å†…å®¹çš„æ„å¤–ç§»åŠ¨é€šå¸¸æ˜¯ç”±äºå¼‚æ­¥åŠ è½½èµ„æºï¼Œæˆ–è€…åŠ¨æ€æ·»åŠ  DOM å…ƒç´ åˆ°é¡µé¢ç°æœ‰å†…å®¹çš„ä¸Šæ–¹ã€‚ç½ªé­ç¥¸é¦–å¯èƒ½æ˜¯æœªçŸ¥å°ºå¯¸çš„å›¾åƒæˆ–è§†é¢‘ã€å®é™…æ¸²æŸ“åæ¯”åå¤‡å­—ä½“æ›´å¤§æˆ–æ›´å°çš„å­—ä½“ï¼Œæˆ–è€…æ˜¯åŠ¨æ€è°ƒæ•´è‡ªèº«å¤§å°çš„ç¬¬ä¸‰æ–¹å¹¿å‘Šæˆ–å°ç»„ä»¶ã€‚

**CLS** æµ‹é‡æ•´ä¸ªé¡µé¢ç”Ÿå‘½å‘¨æœŸå†…å‘ç”Ÿçš„æ‰€æœ‰æ„å¤–å¸ƒå±€åç§»ä¸­æœ€å¤§ä¸€è¿ä¸²çš„å¸ƒå±€åç§»åˆ†æ•°ã€‚æ¯å½“ä¸€ä¸ªå¯è§å…ƒç´ çš„ä½ç½®ä»ä¸€ä¸ªå·²æ¸²æŸ“å¸§å˜æ›´åˆ°ä¸‹ä¸€ä¸ªå·²æ¸²æŸ“å¸§æ—¶ï¼Œå°±å‘ç”Ÿäº†**å¸ƒå±€åç§»**ã€‚ä¸€è¿ä¸²çš„å¸ƒå±€åç§»ï¼Œä¹Ÿå«**ä¼šè¯çª—å£**ï¼Œæ˜¯æŒ‡ä¸€ä¸ªæˆ–å¤šä¸ªå¿«é€Ÿè¿ç»­å‘ç”Ÿçš„å•æ¬¡å¸ƒå±€åç§»ï¼Œæ¯æ¬¡åç§»ç›¸éš”çš„æ—¶é—´å°‘äº 1 ç§’ï¼Œä¸”æ•´ä¸ªçª—å£çš„æœ€å¤§æŒç»­æ—¶é•¿ä¸º 5 ç§’ã€‚

```text
å¸ƒå±€åç§»åˆ†æ•° = å½±å“åˆ†æ•° * è·ç¦»åˆ†æ•°
```

**å½±å“åˆ†æ•°**ï¼šæµ‹é‡ä¸ç¨³å®šå…ƒç´ å¯¹ä¸¤å¸§ä¹‹é—´çš„å¯è§†åŒºåŸŸäº§ç”Ÿçš„å½±å“ï¼Œå³å‰ä¸€å¸§å’Œå½“å‰å¸§çš„æ‰€æœ‰ä¸ç¨³å®šå…ƒç´ çš„å¯è§åŒºåŸŸé›†åˆ:

![å½±å“åˆ†æ•°](https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format)

åœ¨ä¸Šå›¾ä¸­ï¼Œæœ‰ä¸€ä¸ªå…ƒç´ åœ¨ä¸€å¸§ä¸­å æ®äº†ä¸€åŠçš„å¯è§†åŒºåŸŸã€‚æ¥ç€ï¼Œåœ¨ä¸‹ä¸€å¸§ä¸­ï¼Œå…ƒç´ ä¸‹ç§»äº†å¯è§†åŒºåŸŸé«˜åº¦çš„ 25%ã€‚çº¢è‰²è™šçº¿çŸ©å½¢æ¡†è¡¨ç¤ºä¸¤å¸§ä¸­å…ƒç´ çš„å¯è§åŒºåŸŸé›†åˆï¼Œåœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œè¯¥é›†åˆå æ€»å¯è§†åŒºåŸŸçš„ 75%ï¼Œå› æ­¤å…¶å½±å“åˆ†æ•°ä¸º 0.75ã€‚

**è·ç¦»åˆ†æ•°**ï¼šæµ‹é‡ä¸ç¨³å®šå…ƒç´ ç›¸å¯¹äºå¯è§†åŒºåŸŸä½ç§»çš„è·ç¦»ï¼ˆæ°´å¹³æˆ–å‚ç›´ï¼‰ã€‚

è¿˜æ˜¯ä»¥ä¸Šå›¾ä¸ºå‡†ï¼Œæœ€å¤§çš„å¯è§†åŒºåŸŸå°ºå¯¸ç»´åº¦æ˜¯é«˜åº¦ï¼Œä¸ç¨³å®šå…ƒç´ çš„ä½ç§»è·ç¦»ä¸ºå¯è§†åŒºåŸŸé«˜åº¦çš„ 25%ï¼Œå› æ­¤è·ç¦»åˆ†æ•°ä¸º 0.25ã€‚å› æ­¤åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå½±å“åˆ†æ•°æ˜¯ 0.75 ï¼Œè·ç¦»åˆ†æ•°æ˜¯ 0.25 ï¼Œæ‰€ä»¥å¸ƒå±€åç§»åˆ†æ•°æ˜¯ `0.75 * 0.25 = 0.1875`ã€‚

è¦åœ¨ JavaScript ä¸­æµ‹é‡ CLSï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¸ƒå±€ä¸ç¨³å®šæ€§ APIã€‚ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª PerformanceObserver æ¥ä¾¦å¬æ„å¤– layout-shift æ¡ç›®ã€å°†æ¡ç›®æŒ‰ä¼šè¯åˆ†ç»„ã€è®°å½•æœ€å¤§ä¼šè¯å€¼ï¼Œå¹¶åœ¨æœ€å¤§ä¼šè¯å€¼å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–°è®°å½•ï¼š

```js
let clsValue = 0;
let clsEntries = [];

let sessionValue = 0;
let sessionEntries = [];

new PerformanceObserver((entryList) => {
  for (const entry of entryList.getEntries()) {
    // åªå°†ä¸å¸¦æœ‰æœ€è¿‘ç”¨æˆ·è¾“å…¥æ ‡å¿—çš„å¸ƒå±€åç§»è®¡ç®—åœ¨å†…ã€‚
    if (!entry.hadRecentInput) {
      const firstSessionEntry = sessionEntries[0];
      const lastSessionEntry = sessionEntries[sessionEntries.length - 1];

      // å¦‚æœæ¡ç›®ä¸ä¸Šä¸€æ¡ç›®çš„ç›¸éš”æ—¶é—´å°äº 1 ç§’ä¸”ä¸ä¼šè¯ä¸­ç¬¬ä¸€ä¸ªæ¡ç›®çš„ç›¸éš”æ—¶é—´å°äº 5 ç§’ï¼Œé‚£ä¹ˆå°†æ¡ç›®
      // åŒ…å«åœ¨å½“å‰ä¼šè¯ä¸­ã€‚å¦åˆ™ï¼Œå¼€å§‹ä¸€ä¸ªæ–°ä¼šè¯ã€‚
      if (sessionValue &&
          entry.startTime - lastSessionEntry.startTime < 1000 &&
          entry.startTime - firstSessionEntry.startTime < 5000) {
        sessionValue += entry.value;
        sessionEntries.push(entry);
      } else {
        sessionValue = entry.value;
        sessionEntries = [entry];
      }

      // å¦‚æœå½“å‰ä¼šè¯å€¼å¤§äºå½“å‰ CLS å€¼ï¼Œ
      // é‚£ä¹ˆæ›´æ–° CLS åŠå…¶ç›¸å…³æ¡ç›®ã€‚
      if (sessionValue > clsValue) {
        clsValue = sessionValue;
        clsEntries = sessionEntries;

        // å°†æ›´æ–°å€¼ï¼ˆåŠå…¶æ¡ç›®ï¼‰è®°å½•åœ¨æ§åˆ¶å°ä¸­ã€‚
        console.log('CLS:', clsValue, clsEntries)
      }
    }
  }
}).observe({ type: 'layout-shift', buffered: true })
```

å¦‚ä½•æ”¹è¿› CLSï¼š

1. **å§‹ç»ˆåœ¨æ‚¨çš„å›¾åƒå’Œè§†é¢‘å…ƒç´ ä¸ŠåŒ…å«å°ºå¯¸å±æ€§ï¼Œæˆ–è€…é€šè¿‡ä½¿ç”¨ CSS é•¿å®½æ¯”å®¹å™¨ä¹‹ç±»çš„æ–¹å¼é¢„ç•™æ‰€éœ€çš„ç©ºé—´** - è¿™ç§æ–¹æ³•å¯ä»¥ç¡®ä¿æµè§ˆå™¨èƒ½å¤Ÿåœ¨åŠ è½½å›¾åƒæœŸé—´åœ¨æ–‡æ¡£ä¸­åˆ†é…æ­£ç¡®çš„ç©ºé—´å¤§å°ã€‚è¯·æ³¨æ„ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ unsized-media åŠŸèƒ½ç­–ç•¥åœ¨æ”¯æŒåŠŸèƒ½ç­–ç•¥çš„æµè§ˆå™¨ä¸­å¼ºåˆ¶æ‰§è¡Œæ­¤è¡Œä¸ºã€‚
1. **é™¤éæ˜¯å¯¹ç”¨æˆ·äº¤äº’åšå‡ºå“åº”ï¼Œå¦åˆ™åˆ‡å‹¿åœ¨ç°æœ‰å†…å®¹çš„ä¸Šæ–¹æ’å…¥å†…å®¹** - è¿™æ ·èƒ½å¤Ÿç¡®ä¿å‘ç”Ÿçš„ä»»ä½•å¸ƒå±€åç§»éƒ½åœ¨é¢„æœŸä¹‹å†…ã€‚
1. **é¦–é€‰è½¬æ¢åŠ¨ç”»ï¼Œè€Œä¸æ˜¯è§¦å‘å¸ƒå±€åç§»çš„å±æ€§åŠ¨ç”»** - åŠ¨ç”»è¿‡æ¸¡çš„ç›®æ ‡æ˜¯æä¾›çŠ¶æ€ä¸çŠ¶æ€ä¹‹é—´çš„ä¸Šä¸‹æ–‡è¿ç»­æ€§ã€‚å¦‚ CSS **transform** å±æ€§ä½¿æ‚¨èƒ½å¤Ÿåœ¨ä¸è§¦å‘å¸ƒå±€åç§»çš„æƒ…å†µä¸‹ä¸ºå…ƒç´ è®¾ç½®åŠ¨ç”»ï¼š
   1. ç”¨ `transform: scale()` æ¥æ›¿ä»£å’Œè°ƒæ•´ height å’Œ width å±æ€§ã€‚
   2. å¦‚éœ€ä½¿å…ƒç´ èƒ½å¤Ÿå››å¤„ç§»åŠ¨ï¼Œå¯ä»¥ç”¨ `transform: translate()` æ¥æ›¿ä»£å’Œè°ƒæ•´ topã€rightã€bottom æˆ– left å±æ€§ã€‚

## å…¶ä»–æŒ‡æ ‡

### FCP / FP

[**FCP(First Contentful Paint)**](https://web.dev/i18n/zh/fcp/) å³é¦–æ¬¡å†…å®¹ç»˜åˆ¶ã€‚æµ‹é‡é¡µé¢ä»å¼€å§‹åŠ è½½åˆ°é¡µé¢å†…å®¹çš„ä»»ä½•éƒ¨åˆ†åœ¨å±å¹•ä¸Šå®Œæˆæ¸²æŸ“çš„æ—¶é—´ã€‚å¯¹äºè¯¥æŒ‡æ ‡ï¼Œ"å†…å®¹"æŒ‡çš„æ˜¯`æ–‡æœ¬ã€å›¾åƒï¼ˆåŒ…æ‹¬èƒŒæ™¯å›¾åƒï¼‰ã€<svg> å…ƒç´ æˆ–éç™½è‰²çš„ <canvas> å…ƒç´ `ã€‚ä¸ºäº†æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œç½‘ç«™åº”è¯¥åŠªåŠ›å°†é¦–æ¬¡å†…å®¹ç»˜åˆ¶æ§åˆ¶åœ¨ 1.8 ç§’æˆ–ä»¥å†…ã€‚

è¦åœ¨ JavaScript ä¸­æµ‹é‡ FCPï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç»˜åˆ¶è®¡æ—¶ APIã€‚ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª PerformanceObserver æ¥ä¾¦å¬åç§°ä¸º first-contentful-paint çš„æ¡ç›®å¹¶è®°å½•åœ¨æ§åˆ¶å°ä¸­ï¼š

```js
new PerformanceObserver((entryList) => {
  for (const entry of entryList.getEntriesByName('first-contentful-paint')) {
    console.log('FCP candidate:', entry.startTime, entry)
  }
}).observe({ type: 'paint', buffered: true })
```

å¦‚ä½•æ”¹è¿› FCPï¼š

1. æ¶ˆé™¤é˜»å¡æ¸²æŸ“çš„èµ„æº
1. ç¼©å° CSS
1. ç§»é™¤æœªä½¿ç”¨çš„ CSS
1. é¢„è¿æ¥åˆ°æ‰€éœ€çš„æ¥æº
1. å‡å°‘æœåŠ¡å™¨å“åº”æ—¶é—´ (TTFB)
1. é¿å…å¤šä¸ªé¡µé¢é‡å®šå‘
1. é¢„åŠ è½½å…³é”®è¯·æ±‚
1. é¿å…å·¨å¤§çš„ç½‘ç»œè´Ÿè½½
1. ä½¿ç”¨é«˜æ•ˆçš„ç¼“å­˜ç­–ç•¥æœåŠ¡é™æ€èµ„äº§
1. é¿å… DOM è¿‡å¤§
1. æœ€å°åŒ–å…³é”®è¯·æ±‚æ·±åº¦
1. ç¡®ä¿æ–‡æœ¬åœ¨ç½‘é¡µå­—ä½“åŠ è½½æœŸé—´ä¿æŒå¯è§
1. ä¿æŒè¾ƒä½çš„è¯·æ±‚æ•°å’Œè¾ƒå°çš„ä¼ è¾“å¤§å°

> FP å’Œ FCP é€šå¸¸ç›¸åŒï¼Œä½†ä¹Ÿå¯èƒ½æ˜¯ FP ä¼˜å…ˆ

### FMP

**FMP(First Meaningful Paint)** æµ‹é‡ç”¨æˆ·å¯åŠ¨é¡µé¢åŠ è½½å’Œé¡µé¢å‘ˆç°ä¸»è¦é¦–å±å†…å®¹ä¹‹é—´çš„æ—¶é—´ã€‚å½“é¡µé¢ä¸Šå‘ˆç°çš„ç¬¬ä¸€ä½å†…å®¹åŒ…æ‹¬é¦–å±å†…å®¹æ—¶ï¼ŒFCP å’Œ FMP é€šå¸¸æ˜¯ç›¸åŒçš„ã€‚ ä½†æ˜¯ï¼Œä¾‹å¦‚å½“ iframe ä¸­çš„é¦–å±æœ‰å†…å®¹æ—¶ï¼Œè¿™äº›æŒ‡æ ‡å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚FMP åœ¨ iframe ä¸­çš„å†…å®¹å¯¹ç”¨æˆ·å¯è§æ—¶æ³¨å†Œï¼Œè€Œ FCP ä¸åŒ…æ‹¬ iframe å†…å®¹ï¼Œå› æ­¤ FMP å¯èƒ½æ‰“åˆ†æ›´ä½ã€‚ä»¥ä¸‹å›¾ç‰‡ä»…ä¾›å‚è€ƒ:

![FCP/FMP]( {{site.url}}/style/images/smms/cwv-tti.png )

### TBT

[**TBT(Total Blocking Time)**](https://web.dev/i18n/zh/tbt/) å³æ€»é˜»å¡æ—¶é—´ã€‚ä¸€ä¸ªé¡µé¢çš„æ€»é˜»å¡æ—¶é—´æ˜¯åœ¨ FCP å’Œ TTI ä¹‹é—´å‘ç”Ÿçš„æ¯ä¸ªé•¿ä»»åŠ¡çš„é˜»å¡æ—¶é—´æ€»å’Œã€‚æ¯å½“å‡ºç°**é•¿ä»»åŠ¡**ï¼ˆåœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œè¶…è¿‡ 50 æ¯«ç§’çš„ä»»åŠ¡ï¼‰æ—¶ï¼Œä¸»çº¿ç¨‹éƒ½è¢«è§†ä½œ"é˜»å¡çŠ¶æ€"ã€‚æˆ‘ä»¬è¯´ä¸»çº¿ç¨‹å¤„äº"é˜»å¡çŠ¶æ€"æ˜¯å› ä¸ºæµè§ˆå™¨æ— æ³•ä¸­æ–­æ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡ã€‚å› æ­¤ï¼Œå¦‚æœç”¨æˆ·åœ¨æŸä¸ªé•¿ä»»åŠ¡è¿è¡ŒæœŸé—´ä¸é¡µé¢è¿›è¡Œäº¤äº’ï¼Œé‚£ä¹ˆæµè§ˆå™¨å¿…é¡»ç­‰åˆ°ä»»åŠ¡å®Œæˆåæ‰èƒ½ä½œå‡ºå“åº”ã€‚

![TBT](https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xKxwKagiz8RliuOI2Xtc.svg)

å¦‚ä¸Šå›¾ï¼Œè™½ç„¶åœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œä»»åŠ¡çš„æ€»æ—¶é—´ä¸º 560 æ¯«ç§’ï¼Œä½†å…¶ä¸­åªæœ‰ 345 æ¯«ç§’è¢«è§†ä¸ºé˜»å¡æ—¶é—´ã€‚

å¦‚ä½•æ”¹è¿› TBTï¼š

1. å‡å°‘ç¬¬ä¸‰æ–¹ä»£ç çš„å½±å“
1. å‡å°‘ JavaScript æ‰§è¡Œæ—¶é—´
1. æœ€å°åŒ–ä¸»çº¿ç¨‹å·¥ä½œ
1. ä¿æŒè¾ƒä½çš„è¯·æ±‚æ•°å’Œè¾ƒå°çš„ä¼ è¾“å¤§å°

> TBT æŒ‡æ ‡åº”è¯¥åœ¨å®éªŒå®¤ä¸­è¿›è¡Œæµ‹é‡ï¼Œä¸ FIDã€TTI ç­‰å¼ºå…³è”

### TTI

[**TTI(Time to Interactive)**](https://web.dev/tti/) å³å¯äº¤äº’æ—¶é—´ã€‚æµ‹é‡é¡µé¢ä»å¼€å§‹åŠ è½½åˆ°ä¸»è¦å­èµ„æºå®Œæˆæ¸²æŸ“ï¼Œå¹¶èƒ½å¤Ÿå¿«é€Ÿã€å¯é åœ°å“åº”ç”¨æˆ·è¾“å…¥æ‰€éœ€çš„æ—¶é—´ã€‚å¦‚éœ€æ ¹æ®ç½‘é¡µçš„æ€§èƒ½è·Ÿè¸ªè®¡ç®— TTIï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤:

1. å…ˆè¿›è¡Œ FCPã€‚
1. æ²¿æ—¶é—´è½´æ­£å‘æœç´¢æ—¶é•¿è‡³å°‘ä¸º 5 ç§’çš„å®‰é™çª—å£ï¼Œå…¶ä¸­ï¼Œå®‰é™çª—å£çš„å®šä¹‰ä¸ºï¼šæ²¡æœ‰é•¿ä»»åŠ¡ä¸”ä¸è¶…è¿‡ä¸¤ä¸ªæ­£åœ¨å¤„ç†çš„ç½‘ç»œ GET è¯·æ±‚ã€‚
1. æ²¿æ—¶é—´è½´åå‘æœç´¢å®‰é™çª—å£ä¹‹å‰çš„æœ€åä¸€ä¸ªé•¿ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°é•¿ä»»åŠ¡ï¼Œåˆ™åœ¨ FCP æ­¥éª¤åœæ­¢æ‰§è¡Œã€‚
1. TTI æ˜¯å®‰é™çª—å£ä¹‹å‰æœ€åä¸€ä¸ªé•¿ä»»åŠ¡çš„ç»“æŸæ—¶é—´ï¼ˆå¦‚æœæ²¡æœ‰æ‰¾åˆ°é•¿ä»»åŠ¡ï¼Œåˆ™ä¸ FCP å€¼ç›¸åŒï¼‰ã€‚

![TTI](https://web-dev.imgix.net/image/admin/WZM0n4aXah67lEyZugOT.svg)

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSSR ç­‰æŠ€æœ¯å¯èƒ½ä¼šå¯¼è‡´é¡µé¢çœ‹ä¼¼å…·å¤‡äº¤äº’æ€§ï¼ˆå³ï¼Œé“¾æ¥å’ŒæŒ‰é’®åœ¨å±å¹•ä¸Šå¯è§ï¼‰ï¼Œä½†å®é™…ä¸Šå¹¶ä¸èƒ½è¿›è¡Œäº¤äº’ï¼Œå› ä¸ºä¸»çº¿ç¨‹è¢«é˜»å¡æˆ–æ˜¯å› ä¸ºæ§åˆ¶è¿™äº›å…ƒç´ çš„ JavaScript ä»£ç å°šæœªå®ŒæˆåŠ è½½ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œ**è¯·å°½ä¸€åˆ‡åŠªåŠ›å°† FCP å’Œ TTI ä¹‹é—´çš„å·®å€¼é™è‡³æœ€ä½**ã€‚

å¦‚ä½•æ”¹è¿› TTIï¼š

1. ç¼©å° JavaScript
1. é¢„è¿æ¥åˆ°æ‰€éœ€çš„æ¥æº
1. é¢„åŠ è½½å…³é”®è¯·æ±‚
1. å‡å°‘ç¬¬ä¸‰æ–¹ä»£ç çš„å½±å“
1. æœ€å°åŒ–å…³é”®è¯·æ±‚æ·±åº¦
1. å‡å°‘ JavaScript æ‰§è¡Œæ—¶é—´
1. æœ€å°åŒ–ä¸»çº¿ç¨‹å·¥ä½œ
1. ä¿æŒè¾ƒä½çš„è¯·æ±‚æ•°å’Œè¾ƒå°çš„ä¼ è¾“å¤§å°

### TTFB

[**TTFB(Time to First Byte)**](https://web.dev/ttfb/) å³é¦–å­—èŠ‚æ—¶é—´ã€‚ä»¥ä¸‹æ˜¯ç½‘ç»œè¯·æ±‚é˜¶æ®µåŠå…¶ç›¸å…³æ—¶åºå›¾ã€‚TTFB æµ‹é‡ startTime å’Œ responseStart ä¹‹é—´ç»è¿‡çš„æ—¶é—´ã€‚

![TTFB](https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/ccT8ltSPrTri3tz7AA3h.png?auto=format&w=1600)

è¦åœ¨ JavaScript ä¸­æµ‹é‡ TTFBï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç»˜åˆ¶è®¡æ—¶ APIã€‚ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª PerformanceObserver æ¥ä¾¦å¬åç§°ä¸º navigation çš„æ¡ç›®å¹¶è®°å½•åœ¨æ§åˆ¶å°ä¸­ï¼š

```js
new PerformanceObserver((entryList) => {
  const [pageNav] = entryList.getEntriesByType('navigation')
  console.log(`TTFB: ${pageNav.responseStart}`)
}).observe({
  type: 'navigation',
  buffered: true
})
```

å¦‚ä½•æ”¹è¿› TTFBï¼š

1. Hosting services with inadequate infrastructure to handle high traffic loads
1. Web servers with insufficient memory that can lead to thrashing
1. Unoptimized database tables
1. Suboptimal database server configuration

### Speed Index

**Speed Index** å³é¦–å±å±•ç°å¹³å‡å€¼ï¼Œè¡¡é‡å†…å®¹åœ¨é¡µé¢åŠ è½½æœŸé—´å¯è§†åŒ–æ˜¾ç¤ºçš„é€Ÿåº¦ã€‚PageSpeed Insights ä½¿ç”¨ä»¥ä¸‹åˆ†æ•°å¯¹ç½‘ç«™çš„é¦–å±å±•ç°å¹³å‡å€¼è¿›è¡Œæ’åå¹¶ç›¸åº”åœ°å¯¹å…¶è¿›è¡Œé¢œè‰²ç¼–ç ï¼š

1. ç»¿è‰²ï¼ˆè‰¯å¥½ï¼‰â€” 0 åˆ° 3.4 ç§’
1. æ©™è‰²ï¼ˆä¸­ç­‰ï¼‰â€” 3.4 åˆ° 5.8 ç§’
1. çº¢è‰²ï¼ˆæ…¢ï¼‰ â€“ è¶…è¿‡ 5.8 ç§’

![Speed Index](https://imgh.xieyonghui.com/images/progressive-rendering-20190331.png)

å¦‚ä½•æ”¹è¿› Speed Indexï¼š

1. å‡å°‘æ¸²æŸ“é˜»å¡èµ„æº - å¦‚å»¶è¿Ÿè„šæœ¬æ‰§è¡Œ
2. å‡å°‘ç½‘ç«™ä¸»çº¿ç¨‹å·¥ä½œ - å¦‚ä¼˜åŒ–ç¬¬ä¸‰æ–¹è„šæœ¬ï¼Œæç®€åŒ– JS
3. ç¡®ä¿åœ¨åŠ è½½å­—ä½“æ—¶ï¼Œå­—ä½“èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤º - å¦‚[é¢„åŠ è½½å­—ä½“](https://web.dev/font-display/)

## ä»€ä¹ˆæ˜¯ PRPL

[**PRPL**](https://web.dev/apply-instant-loading-with-prpl/) æ˜¯å³æ—¶åŠ è½½èµ„æºçš„ä¸€ç§ç­–ç•¥ï¼š

* **Push (or preload)** the most important resources.
* **Render** the initial route as soon as possible.
* **Pre-cache** remaining assets.
* **Lazy load** other routes and non-critical assets.

ä¸€ã€Preload critical resources

å…³é”®å­— preload ä½œä¸ºå…ƒç´  \<link\> çš„å±æ€§ rel çš„å€¼ï¼Œä»£è¡¨éœ€è¦æµè§ˆå™¨é¢„å…ˆè·å–å’Œç¼“å­˜å¯¹åº”èµ„æºã€‚

```html
<!-- The path to the resource in the href attribute. -->
<!-- The type of resource in the as attribute. -->
<link rel="preload" as="style" href="css/style.css">
```

äºŒã€Render the initial route as soon as possible

æˆ‘ä»¬éœ€è¦å‡å°‘ **First Paint**ï¼Œå³ç¬¬ä¸€ä¸ªåƒç´ æ¸²æŸ“åˆ°å±å¹•ä¸Šæ‰€ç”¨çš„æ—¶é—´ã€‚ç›®å‰çš„æ–¹æ¡ˆæ¯”å¦‚æœ‰ä½¿ç”¨ async/defer æ¥æ¨è¿Ÿ js è„šæœ¬æ‰§è¡Œæ—¶é—´ï¼Œå†…è”é¦–å±ä½¿ç”¨çš„å…³é”® CSSï¼Œæˆ–è€… SSRã€‚

ä¸‰ã€Pre-cache assets

å¯ä»¥å°è¯•ä½¿ç”¨ Service Worker æˆ–è€…ä¸€äº›ç¬¬ä¸‰æ–¹åº“ Workbox æ¥åˆ¶å®šç¼“å­˜ç­–ç•¥ã€‚

![service worker](https://web-dev.imgix.net/image/admin/xv1f7ZLKeBZD83Wcw6pd.png?auto=format&w=1600)

å››ã€Lazy load

æ‹†åˆ†è¾ƒå¤§çš„ chunksï¼Œå®ç°æŒ‰éœ€åŠ è½½ã€‚å¦‚æœç½‘é¡µä¸ŠåŠ è½½äº†è®¸å¤šå›¾åƒï¼Œè¯·åœ¨åŠ è½½é¡µé¢æ—¶æ¨è¿Ÿæ‰€æœ‰ä½äºé¦–å±ä¸‹æ–¹æˆ–è®¾å¤‡è§†å£ä¹‹å¤–çš„å›¾åƒã€‚

## ä»€ä¹ˆæ˜¯å…³é”®è·¯å¾„æ¸²æŸ“

## ä»€ä¹ˆæ˜¯é•¿ä»»åŠ¡

æ—¶é—´åˆ‡ç‰‡

## performace é¢æ¿

## å®éªŒå®¤å·¥å…· & å®æµ‹å·¥å…·

å®æµ‹å·¥å…·ï¼š

1. Chrome [ç”¨æˆ·ä½“éªŒæŠ¥å‘Š](https://developers.google.com/web/tools/chrome-user-experience-report)
1. [PageSpeed Insights](https://pagespeed.web.dev) ç½‘é¡µé€Ÿåº¦æµ‹é‡å·¥å…·
1. [æœç´¢æ§åˆ¶å°](https://support.google.com/webmasters/answer/9205520)ï¼ˆæ ¸å¿ƒ Web æŒ‡æ ‡æŠ¥å‘Šï¼‰
1. [web-vitals](https://github.com/GoogleChrome/web-vitals) JavaScript åº“

å®éªŒå®¤å·¥å…·ï¼š

1. Chrome [å¼€å‘è€…å·¥å…·](https://developer.chrome.com/docs/devtools/)
1. [Lighthouse](https://developers.google.com/web/tools/lighthouse/)
1. [WebPageTest](https://webpagetest.org) ç½‘é¡µæ€§èƒ½æµ‹è¯•å·¥å…·

## å‚è€ƒæ–‡æ¡£

1. [web vitals](https://web.dev/i18n/zh/vitals/) by Philip Walton
