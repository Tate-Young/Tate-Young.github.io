---
layout: blog
tool: true
comments: True
flag: Git
background: green
category: å‰ç«¯
title: Git Flow
date:   2018-03-10 23:36:00 GMT+0800 (CST)
background-image: http://nvie.com/img/git-model@2x.png
tags:
- git
---
# {{ page.title }}

## ä»€ä¹ˆæ˜¯ Git

**Git** æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚

### ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ VCS

**ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ(Version Control System - VCS)** æœ€åŸºæœ¬çš„åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ§åˆ¶ã€‚å³åœ¨æ–‡ä»¶çš„ä¿®æ”¹å†ç¨‹ä¸­ä¿ç•™ä¿®æ”¹å†å²ï¼Œè®©ä½ å¯ä»¥æ–¹ä¾¿åœ°æ’¤é”€ä¹‹å‰å¯¹æ–‡ä»¶çš„ä¿®æ”¹æ“ä½œã€‚

**ä¸­å¤®å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ(Centralized VCS)** éƒ½æœ‰ä¸€ä¸ªå•ä¸€çš„é›†ä¸­ç®¡ç†çš„æœåŠ¡å™¨ï¼Œä¿å­˜æ‰€æœ‰æ–‡ä»¶çš„ä¿®è®¢ç‰ˆæœ¬ï¼Œè€ŒååŒå·¥ä½œçš„äººä»¬éƒ½é€šè¿‡å®¢æˆ·ç«¯è¿åˆ°è¿™å°æœåŠ¡å™¨ï¼Œå–å‡ºæœ€æ–°çš„æ–‡ä»¶æˆ–è€…æäº¤æ›´æ–°ã€‚ç¼ºç‚¹æ˜¯ä¸­å¤®æœåŠ¡å™¨çš„å•ç‚¹æ•…éšœå¯èƒ½å¯¼è‡´æ— æ³•æäº¤æ›´æ–°ï¼Œç”šè‡³å¯èƒ½ä¸¢å¤±å†å²è®°å½•ã€‚

**åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ(Distributed VCS)** å®¢æˆ·ç«¯å¹¶ä¸åªæå–æœ€æ–°ç‰ˆæœ¬çš„æ–‡ä»¶å¿«ç…§ï¼Œè€Œæ˜¯æŠŠä»£ç ä»“åº“å®Œæ•´åœ°é•œåƒä¸‹æ¥ã€‚è¿™ä¹ˆä¸€æ¥ï¼Œä»»ä½•ä¸€å¤„ååŒå·¥ä½œç”¨çš„æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œäº‹åéƒ½å¯ä»¥ç”¨ä»»ä½•ä¸€ä¸ªé•œåƒå‡ºæ¥çš„æœ¬åœ°ä»“åº“æ¢å¤ã€‚å› ä¸ºæ¯ä¸€æ¬¡çš„å…‹éš†æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯ä¸€æ¬¡å¯¹ä»£ç ä»“åº“çš„å®Œæ•´å¤‡ä»½ã€‚

![VCS](https://i.loli.net/2018/03/09/5aa23d502bf86.png)

### SVN

**SVN** ä½œä¸º CVCSï¼ŒGit ç›¸æ¯” SVN çš„ä¸»è¦ä¼˜ç‚¹:

* **ç›´æ¥è®°å½•å¿«ç…§ï¼Œè€Œéå·®å¼‚æ¯”è¾ƒ**

Git å­˜å‚¨é¡¹ç›®éšæ—¶é—´æ”¹å˜çš„å¿«ç…§ï¼Œæ•ˆç‡æ›´é«˜ï¼›è€Œ SVN å­˜å‚¨æ¯ä¸ªæ–‡ä»¶ä¸åˆå§‹ç‰ˆæœ¬çš„å·®å¼‚ã€‚

* **è¿‘ä¹æ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ¬åœ°æ‰§è¡Œ**

Git ä¸­çš„ç»å¤§å¤šæ•°æ“ä½œéƒ½åªéœ€è¦è®¿é—®æœ¬åœ°æ–‡ä»¶å’Œèµ„æºï¼Œæ‰€ä»¥é€Ÿåº¦æ›´å¿«ï¼Œè€Œä¸”æ— éœ€è”ç½‘ï¼›è€Œ SVN å¤„äºæ–­ç½‘çŠ¶æ€æ—¶æ˜¯æ— æ³•æäº¤æ›´æ–°çš„ã€‚

* **æ•°æ®å®Œæ•´æ€§**

Git ä¸­æ‰€æœ‰æ•°æ®åœ¨å­˜å‚¨å‰éƒ½é€šè¿‡ SHA-1 æ•£åˆ—è®¡ç®—æ ¡éªŒå’Œï¼Œç„¶åä»¥æ ¡éªŒå’Œæ¥å¼•ç”¨ã€‚å®é™…ä¸Šï¼ŒGit æ•°æ®åº“ä¸­ä¿å­˜çš„ä¿¡æ¯éƒ½æ˜¯ä»¥æ–‡ä»¶å†…å®¹çš„å“ˆå¸Œå€¼æ¥ç´¢å¼•ï¼Œè€Œä¸æ˜¯æ–‡ä»¶åï¼Œå¦‚ commit idã€‚

* **æ›´ä¼˜çš„åˆ†æ”¯**

Git ä¸­åˆ†æ”¯(branch)çš„åˆ›å»ºå®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥ç§»åŠ¨çš„æ–°çš„æŒ‡é’ˆï¼Œæ“ä½œå‡ ä¹èƒ½åœ¨ç¬é—´å®Œæˆï¼Œå¹¶ä¸”åœ¨ä¸åŒåˆ†æ”¯ä¹‹é—´çš„åˆ‡æ¢æ“ä½œä¹Ÿæ˜¯ä¸€æ ·ä¾¿æ·ï¼›è€Œ SVN ä¸­çš„åˆ†æ”¯æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç›®å½•ï¼Œä¸”è¿™ä¸ªç›®å½•æ‹¥æœ‰å®Œæ•´çš„å®é™…æ–‡ä»¶ï¼Œå ç”¨ç©ºé—´å¤§ä¸”ä½æ•ˆã€‚

## Git Flow

Git Flow å¸¸ç”¨çš„åˆ†æ”¯:

| åˆ†æ”¯ | æè¿° |
|:--------------|:---------|
| **Production** | å³ Master åˆ†æ”¯ï¼Œä¸»è¦åˆå¹¶æœ€è¿‘å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒçš„ä»£ç ï¼Œå¹¶æ‰“ä¸Šæ ‡ç­¾ï¼Œæ­¤åˆ†æ”¯åªèƒ½ä»å…¶ä»–åˆ†æ”¯åˆå¹¶ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹ |
| **Develop** | ä¸»è¦å¼€å‘åˆ†æ”¯ï¼ŒåŒ…å«æ‰€æœ‰è¦å‘å¸ƒåˆ°ä¸‹ä¸€ä¸ª Release çš„ä»£ç  |
| **Feature** | ä¸»è¦æ˜¯ç”¨æ¥å¼€å‘ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå¼€å‘å®Œæˆååˆå¹¶åˆ° Develop åˆ†æ”¯ï¼Œç„¶ååˆ é™¤è¯¥ç‰¹æ€§åˆ†æ”¯ |
| **Release** | å½“éœ€è¦å‘å¸ƒçš„æ—¶å€™ï¼ŒåŸºäº Develop åˆ†æ”¯åˆ›å»ºä¸€ä¸ª Release åˆ†æ”¯ï¼Œå®Œæˆå‘å¸ƒåå°†å…¶åˆå¹¶åˆ° Master å’Œ Develop åˆ†æ”¯ï¼Œç„¶ååˆ é™¤è¯¥å‘å¸ƒåˆ†æ”¯ |
| **Hotfix** | å½“åœ¨ Master åˆ†æ”¯å‘ç°æ–°çš„ Bug æ—¶å€™ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª Hotfix åˆ†æ”¯, å®Œæˆä¿®å¤åå°†å…¶åˆå¹¶å› Master å’Œ Develop åˆ†æ”¯ï¼Œæ‰€ä»¥Hotfixçš„æ”¹åŠ¨ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªRelease |

![Git Flow](http://nvie.com/img/git-model@2x.png)

> Git ä¸­åˆ†æ”¯å®é™…ä¸Šæ˜¯æŒ‡å‘æŸä¸ª commit çš„æŒ‡é’ˆã€‚

## .gitignore

é€šè¿‡ **.gitignore** æ–‡ä»¶é…ç½®å¯å¿½ç•¥è·Ÿè¸ªçš„æ–‡ä»¶ï¼Œå…¶æ ¼å¼è§„èŒƒå¦‚ä¸‹ï¼š

* æ‰€æœ‰ç©ºè¡Œæˆ–è€…ä»¥æ³¨é‡Šç¬¦å· ï¼ƒ å¼€å¤´çš„è¡Œéƒ½ä¼šè¢« Git å¿½ç•¥ã€‚
* å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ *globæ¨¡å¼* åŒ¹é…ã€‚
* åŒ¹é…æ¨¡å¼æœ€åè·Ÿåæ–œæ  (/) è¯´æ˜è¦å¿½ç•¥çš„æ˜¯ç›®å½•ã€‚
* è¦å¿½ç•¥æŒ‡å®šæ¨¡å¼ä»¥å¤–çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥åœ¨æ¨¡å¼å‰åŠ ä¸ŠæƒŠå¹å· (!) å–åã€‚

**globæ¨¡å¼** æ˜¯æŒ‡ shell æ‰€ä½¿ç”¨çš„ç®€åŒ–äº†çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚:

* æ˜Ÿå· (*) - åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦
* [abc] - åŒ¹é…ä»»ä½•ä¸€ä¸ªåˆ—åœ¨æ–¹æ‹¬å·ä¸­çš„å­—ç¬¦
* é—®å· (?) - åªåŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦
* [0-9] - è¡¨ç¤ºåŒ¹é…æ‰€æœ‰ 0 åˆ° 9 çš„æ•°å­—

ä»¥ä¸‹æ˜¯ .gitignore æ–‡ä»¶ç¤ºä¾‹ï¼Œå„ä¸ªè¯­è¨€ç¯å¢ƒä¸‹çš„æ ‡å‡†å¯[å‚è€ƒè¿™é‡Œ](https://github.com/github/gitignore) ğŸ‘ˆğŸ‘ˆğŸ‘ˆ

```SHELL
# æ­¤ä¸ºæ³¨é‡Š â€“ å°†è¢« Git å¿½ç•¥
# å¿½ç•¥æ‰€æœ‰ .a ç»“å°¾çš„æ–‡ä»¶
*.a
# ä½† lib.a é™¤å¤–
!lib.a
# ä»…ä»…å¿½ç•¥é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ TODO æ–‡ä»¶ï¼Œä¸åŒ…æ‹¬ subdir/TODO
/TODO
# å¿½ç•¥ build/ ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
build/
# ä¼šå¿½ç•¥ doc/notes.txt ä½†ä¸åŒ…æ‹¬ doc/server/arch.txt
doc/*.txt
# å¿½ç•¥ doc/ ç›®å½•ä¸‹æ‰€æœ‰æ‰©å±•åä¸º txt çš„æ–‡ä»¶
doc/**/*.txt
```

å¦‚æœæŸä¸ªæ–‡ä»¶å¯ä»¥æ”¾å¼€ï¼Œç›´æ¥åœ¨ .gitignore ä¸­å»é™¤å¯¹åº”é…ç½®å¹¶é‡æ–°è¿½è¸ªå³å¯;å¦‚æœæŸä¸ªæ–‡ä»¶åœ¨å¿½ç•¥å‰å·²ç»è¢«è¿½è¸ªï¼Œç›´æ¥åœ¨ .gitignore ä¸­æ·»åŠ æ˜¯æ— æ•ˆçš„ã€‚éœ€è¦å»é™¤æ–‡ä»¶ç¼“å­˜:

```SHELL
git rm -r --cached filename
```

## Git Hooks

**Git é’©å­(hooks)**éƒ½è¢«å­˜å‚¨åœ¨ Git ç›®å½•ä¸‹çš„ hooks å­ç›®å½•ä¸­ï¼Œå³å¤§éƒ¨åˆ†é¡¹ç›®ä¸­çš„ .git/hooksã€‚åœ¨ Git 1.6 ç‰ˆæœ¬ä¹‹åï¼Œè¿™äº›æ ·æœ¬åéƒ½æ˜¯ä»¥.sample ç»“å°¾ï¼Œå› æ­¤å¿…é¡»é‡æ–°å‘½åã€‚Git æä¾›ä¸¤ç»„é’©å­ï¼š[å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯](https://git-scm.com/book/zh/v1/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git%E6%8C%82%E9%92%A9)ã€‚

è¿™é‡Œç›´æ¥ä½¿ç”¨ [husky](https://github.com/typicode/husky)ï¼Œå®‰è£…åï¼Œ.git/hooks ç›®å½•é‡Œé¢çš„é’©å­éƒ½ä¼šè¢« husky æ›¿æ¢æ‰ã€‚åœ¨ package.json é‡Œè¿›è¡Œé…ç½®å³å¯:

```JSON
// ç‰ˆæœ¬ 0.14
"scripts": {
  "postcommit": "echo hi snow",
  "precommit": "echo hi tate"
}

// ç‰ˆæœ¬ 0.14 ä¹‹å
// å¯ç›´æ¥è¿è¡Œ ./node_modules/.bin/husky-upgrade è¿›è¡Œè¿ç§»
{
  "husky": {
    "hooks": {
      "pre-commit": "echo hi tate",
      "post-commit": "echo hi snow",
    }
  }
}
```

```SHELL
git commit -a -m 'add husky'
# husky > pre-commit (node v9.3.0)
# im tate
# husky > post-commit (node v9.3.0)
# im snow
# [master 8a1b6a3] add husky
```

## å‚è€ƒé“¾æ¥

1. [Git](https://git-scm.com/book/zh/v2)
2. [Git æ•™ç¨‹](https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000) By å»–é›ªå³°
3. [A successful Git branching model](http://nvie.com/posts/a-successful-git-branching-model/) By Vincent Driessen
4. [Git åœ¨å›¢é˜Ÿä¸­çš„æœ€ä½³å®è·µ--å¦‚ä½•æ­£ç¡®ä½¿ç”¨ Git Flow](http://www.cnblogs.com/cnblogsfans/p/5075073.html) By wangdeshui
