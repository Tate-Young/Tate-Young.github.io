---
layout: blog
back: true
comments: True
flag: HTTP
background: orange
category: 后端
title: Cookie
date:   2018-03-01 10:58:00 GMT+0800 (CST)
background-image: http://upload-images.jianshu.io/upload_images/1234352-474c42b13e2d470d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240
tags:
- http
---
# {{ page.title }}

## cookie

### 类型

**cookie** 总是保存在客户端中，按在客户端中的存储位置，可分为:

* 内存 cookie - 由浏览器维护，保存在内存中，浏览器关闭后就消失了，其存在时间是短暂的，一般不设置过期时间会存在内存中
* 硬盘 cookie - 保存在硬盘里，有一个过期时间，除非用户手工清理或到了过期时间，否则不会被删除，其存在时间是长期的

### 缺点

* cookie 会被附加在每个 HTTP 请求中，所以无形中增加了流量。
* 由于在 HTTP 请求中的 cookie 是明文传递的，所以安全性成问题，除非用 HTTPS。
* cookie 的大小限制在 4KB 左右，数量也有限制，对于复杂的存储需求来说是不够用的。

> cookie 附加在每次 HTTP 请求中是客户端的操作，可以禁用 cookie。

### 属性

* **max-age** - HTTP1.1产物(HTTP1.0 使用 Expires)，设置相对过期时间，单位秒，有三种值：
  * 负数 - 即有效期为 session，属于会话 cookie(内存)
  * 0 - 删除
  * 正数 - 创建，有效期为创建时刻 + max-age
* **domain** - 目标域名，默认为当前创建时所在的域名
* **path** - 目标路径，默认为当前创建时所在的路径
* **secure** - 只在确保安全的请求中才会发送，如 HTTPS，默认不带
* **HttpOnly** - 是否能通过 js 去访问，默认不带

```JS
document.cookie; // 这个方法只能获取非 HttpOnly 类型的 cookie
// "_ga=GA1.2.865451383.1517365757; __lnkrntdmcvrd=-1; PHPSESSID=web2~207a6ac37f624ce19d9a4f268dc01304; _gid=GA1.2.1650902441.1519796826; afpCT=1; Hm_lvt_e23800c454aa573c0ccb16b52665ac26=1519705527,1519796826,1519830084,1519866651; Hm_lpvt_e23800c454aa573c0ccb16b52665ac26=1519866651"


// 在设置 cookie 属性时，属性之间由一个分号和一个空格隔开
document.cookie = "key=name; max-age=-1; domain=www.example.com; path=/; secure; HttpOnly"
```

> domain 是域名，path 是路径，可以来限制 cookie 能被哪些 URL 访问。

### 设置

cookie 既可以由服务端来设置，也可以由客户端来设置。

* **服务端**

在响应头中可加入 set-cookie 字段设置 cookie，如下图则对应 5 个 cookie:

![cookie - 服务端](https://sfault-image.b0.upaiyun.com/237/110/2371104766-56dd2fc2ba7ae_articlex)

* **客户端**

直接通过 document.cookie 设置，当 Name / domain / path 相同时则是修改，否则为新建。

```JS
document.cookie = "key=name; max-age=100; secure";
```

![cookie.png](https://i.loli.net/2018/03/01/5a976bda462c4.png)

> 默认情况下，在发生 CORS 跨域请求时，cookie 作为一种 credential 信息是不会被传送到服务端的。必须要进行额外设置才可以。

## session

![session](http://upload-images.jianshu.io/upload_images/1234352-474c42b13e2d470d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## Web Storage API

### SessionStorage

### LocalStorage

## 参考链接

1. [聊一聊 cookie](https://segmentfault.com/a/1190000004556040) By ruoyiqing
1. [session 和 cookies 会话机制详解](https://liuchi.coding.me/2016/07/20/session%E5%92%8Ccookies%E4%BC%9A%E8%AF%9D%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/) By Liu Chi
1. [详说 Cookie, LocalStorage 与 SessionStorage](http://jerryzou.com/posts/cookie-and-web-storage/) By jerryzou