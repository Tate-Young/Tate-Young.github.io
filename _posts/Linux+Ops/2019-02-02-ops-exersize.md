---
layout: blog
front: true
comments: True
flag: Ops
background: gray
category: åç«¯
title: è®°ä¸€äº›è¿ç»´å®è·µ
date:   2019-02-02 17:54:00 GMT+0800 (CST)
update: 2021-11-03 19:45:00 GMT+0800 (CST)
description: add prometheus and grafana and so on
background-image: /style/images/smms/linux.jpg
tags:
- Ops
---
# {{ page.title }}

åˆšå·¥ä½œæ—¶å€™ï¼Œæœ‰ä¸ªå¤§å­¦ç”Ÿä¼˜é€‰åŸ¹è®­è®¡åˆ’ï¼Œå½“æ—¶å¯¼å¸ˆæ˜¯è¿ç»´è€å¸æœºï¼Œæ‰€ä»¥è·Ÿéšç€ä»–æ£é¼“äº†ä¸€äº›è¿ç»´æ–¹é¢çš„é—®é¢˜ï¼Œæƒ³æƒ³ä¹Ÿéƒ½æ˜¯å‡ å¹´å‰çš„äº‹äº†ï¼Œä»¥ä¸‹è¿™äº›å®è·µéƒ½æ˜¯ä»å°è±¡ç¬”è®°è¿ç§»è¿‡æ¥çš„ï¼Œå°±å½“ç•™ä½œä¸ªçºªå¿µå§ ~

## Oracle 11g å®‰è£…

ä»€ä¹ˆï¼Ÿå®‰è£…ä¹Ÿè¦æ¬è¿›æ¥å—ï¼Ÿæ˜¯çš„ï¼ŒOracle çš„å®‰è£…ç»ä¸ç®€å•ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ä»¥å­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œå…³é”®ç‚¹åœ¨äºæ€ä¹ˆå»æœç´¢å’Œæ’é”™ã€‚

Oracle å…·ä½“å®‰è£…æ­¥éª¤å¯ä»¥[å‚ç…§æ–‡æ¡£](/style/files/Oracle11gInstallation.pdf) ğŸ‘ˆ

åŒæ—¶ä¹Ÿè®°å½•ä¸‹æ¥æ“ä½œè¿‡ç¨‹ä¸­çš„[ä¸€äº›å‘½ä»¤](/style/files/oracleInstallation.txt) ğŸ‘ˆ

## ESXI è™šæ‹ŸåŒ–å¹³å°

**è™šæ‹ŸåŒ–**ï¼Œç®€å•è®²ï¼Œå°±æ˜¯å¯ä»¥å®ç°å°†ä¸€å°è®¡ç®—æœºè™šæ‹ŸåŒ–ä¸ºè‹¥å¹²å°é€»è¾‘è®¡ç®—æœºï¼Œæ¯ä¸ªé€»è¾‘è®¡ç®—æœºèƒ½è¿è¡Œä¸åŒæ“ä½œç³»ç»Ÿè€Œäº’ä¸å¹²æ‰°ï¼Œèƒ½è¾ƒå¤§æé«˜èµ„æºåˆ©ç”¨ç‡ã€‚é€šè¿‡è™šæ‹ŸåŒ–å¹³å°çš„æ­å»ºï¼Œå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯å¯¹ä¸åŒæœåŠ¡å™¨ç»Ÿä¸€çš„ç®¡ç†ï¼Œå®ç°åŠ¨æ€èµ„æºè°ƒåº¦ã€å®‰å…¨éƒ¨ç½²å’Œå®æ—¶åŠ¨æ€ç›‘æ§ç­‰åŠŸèƒ½ã€‚

**ESXI** ä¸“ä¸ºè¿è¡Œè™šæ‹Ÿæœºã€æœ€å¤§é™åº¦é™ä½é…ç½®è¦æ±‚å’Œç®€åŒ–éƒ¨ç½²è€Œè®¾è®¡ï¼Œå…¶æœ¬èº«ç±»ä¼¼äºä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œå¯å®‰è£…è‡³è™šæ‹Ÿæœºï¼Œå®‰è£…æ­¥éª¤å¯ä»¥[å‚ç…§æ–‡æ¡£](/style/files/esxi.pdf) ğŸ‘ˆ

é‡Œé¢è¿˜æ¶‰åŠåˆ° **Vmware vSphere Client** å’Œ **vCenter** çš„æ¦‚å¿µï¼Œè€Œ **VMware vSphere Hypervisor** ä¹Ÿå°±æ˜¯æŒ‡çš„ EXSIï¼Œåªæ˜¯ä¸åŒçš„å«æ³•è€Œå·²ã€‚

## FTP æœåŠ¡å™¨

**FTP**(File Transfer Protocol Server) æœåŠ¡å™¨æ˜¯ä¾ç…§ FTP åè®®æä¾›æœåŠ¡ï¼Œåœ¨äº’è”ç½‘ä¸Šæä¾›æ–‡ä»¶å­˜å‚¨å’Œè®¿é—®æœåŠ¡çš„è®¡ç®—æœºã€‚å‚è€ƒè¿™é‡Œå¯ä»¥äº†è§£åˆ°å¦‚ä½•åœ¨ Linux å’Œ window server 2008 R2 ç³»ç»Ÿä¸‹è¿›è¡Œ [FTP æœåŠ¡å™¨çš„æ­å»º](/style/files/ftp.pdf) ğŸ‘ˆ

## æ–‡ä»¶æœåŠ¡å™¨

åœ¨å±€åŸŸç½‘ä¸­ï¼Œä»¥æ–‡ä»¶æ•°æ®å…±äº«ä¸ºç›®æ ‡ï¼Œéœ€è¦å°†ä¾›å¤šå°è®¡ç®—æœºå…±äº«çš„æ–‡ä»¶å­˜æ”¾äºä¸€å°è®¡ç®—æœºä¸­ã€‚è¿™å°è®¡ç®—æœºå°±è¢«ç§°ä¸º**æ–‡ä»¶æœåŠ¡å™¨**ã€‚å‚è€ƒè¿™é‡Œå¯ä»¥äº†è§£åˆ°å¦‚ä½•åœ¨ Linux å’Œ window server 2008 R2 ç³»ç»Ÿä¸‹è¿›è¡Œ[æ–‡ä»¶æœåŠ¡å™¨çš„æ­å»º](/style/files/fileServer.pdf) ğŸ‘ˆ

## æ•°æ®ä»“åº“åŠ ODS

**æ•°æ®ä»“åº“**(Data Warehouse)ï¼šæ˜¯ä¸€ä¸ªé¢å‘ä¸»é¢˜çš„(Subject Oriented)ã€é›†æˆçš„(Integrated)ã€ç›¸å¯¹ç¨³å®šçš„(Non-Volatile)ã€åæ˜ å†å²å˜åŒ–(Time Variant)çš„æ•°æ®é›†åˆï¼Œç”¨äºæ”¯æŒç®¡ç†å†³ç­–(Decision Making Support)ã€‚

**ODS**(Operational Data Store)ï¼šæ˜¯ä¸€ä¸ªé¢å‘ä¸»é¢˜çš„ã€é›†æˆçš„ã€å¯å˜çš„ã€å½“å‰çš„ç»†èŠ‚æ•°æ®é›†åˆï¼Œç”¨äºæ”¯æŒä¼ä¸šå¯¹äºå³æ—¶æ€§çš„ã€æ“ä½œæ€§çš„ã€é›†æˆçš„å…¨ä½“ä¿¡æ¯çš„éœ€æ±‚ã€‚

> ODS æ˜¯çŸ­æœŸçš„å®æ—¶çš„æ•°æ®ï¼Œä¾›äº§å“æˆ–è€…è¿è¥äººå‘˜æ—¥å¸¸ä½¿ç”¨ï¼Œè€Œæ•°æ®ä»“åº“æ˜¯ä¾›æˆ˜ç•¥å†³ç­–ä½¿ç”¨çš„æ•°æ®ï¼›å‰è€…æ˜¯å¯ä»¥æ›´æ–°çš„æ•°æ®ï¼Œæ•°æ®ä»“åº“æ˜¯åŸºæœ¬ä¸æ›´æ–°çš„ååº”å†å²å˜åŒ–çš„æ•°æ®

ä¸¤è€…å¹¶å­˜çš„å…¶ä¸­ä¸€ç§æ–¹æ¡ˆ:

![ods.png]( {{site.url}}/style/images/smms/ods.png )

**ETL** åˆ†åˆ«æ˜¯`Extract`ã€`Transform`ã€`Load`ä¸‰ä¸ªå•è¯çš„é¦–å­—æ¯ç¼©å†™ï¼Œå³"æŠ½å–"ã€"è½¬æ¢"ã€"è£…è½½"ï¼Œç”±äºä¸åŒåŸå§‹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ¥æºã€æ ¼å¼ä¸ä¸€æ ·ï¼Œå¯¼è‡´äº†ç³»ç»Ÿå®æ–½ã€æ•°æ®æ•´åˆå‡ºç°é—®é¢˜ï¼ŒETL å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸€é—®é¢˜çš„ã€‚ETL åŒ…å«äº†ä¸‰æ–¹é¢:

* æŠ½å– - å°†æ•°æ®ä»å„ç§åŸå§‹çš„ä¸šåŠ¡ç³»ç»Ÿä¸­è¯»å–å‡ºæ¥ï¼Œè¿™æ˜¯æ‰€æœ‰å·¥ä½œçš„å‰æ
* è½¬æ¢ - æŒ‰ç…§é¢„å…ˆè®¾è®¡å¥½çš„è§„åˆ™å°†æŠ½å–å¾—æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œä½¿æœ¬æ¥å¼‚æ„çš„æ•°æ®æ ¼å¼èƒ½ç»Ÿä¸€èµ·æ¥
* è£…è½½ - å°†è½¬æ¢å®Œçš„æ•°æ®æŒ‰è®¡åˆ’å¢é‡æˆ–å…¨éƒ¨å¯¼å…¥åˆ°æ•°æ®ä»“åº“ä¸­

## Apollo

å½“å‰æˆ‘ä»¬ Node.js é¡¹ç›®ç›¸å…³çš„é…ç½®è¦ä¹ˆæ˜¯ç¡¬ç¼–ç åœ¨é¡¹ç›®ä»£ç é‡Œï¼Œè¦ä¹ˆæ˜¯é€šè¿‡ç¯å¢ƒå˜é‡æ¥è¿›è¡Œæ§åˆ¶ã€‚å¯¹äºå˜åŠ¨ä¸é¢‘ç¹çš„é…ç½®æ•°æ®ï¼Œè¿™ä¸¤ç§æ–¹æ³•éå¸¸é€‚åˆï¼Œä½†æ˜¯å¯¹äºä¸€äº›éœ€è¦ç»å¸¸å˜åŠ¨ï¼Œæˆ–è€…å˜åŠ¨æ—¶æ•ˆæ€§è¦æ±‚è¾ƒé«˜çš„é…ç½®ï¼Œæ¯æ¬¡éƒ½è¦ç»è¿‡ä¿®æ”¹ä»£ç å†å‘å¸ƒç‰ˆæœ¬ï¼Œæ‰èƒ½ä½¿å˜åŠ¨ç”Ÿæ•ˆè¿™æ ·çš„æµç¨‹å°±æ˜¾å¾—æ¯”è¾ƒç¹çäº†ï¼ˆç¯å¢ƒå˜é‡çš„ä¿®æ”¹ä¹Ÿéœ€è¦é‡å¯ pm2 è¿›ç¨‹ï¼‰ã€‚

[**Apollo**](https://www.apolloconfig.com/#/zh/README) æ˜¯ä¸€æ¬¾å¯é çš„åˆ†å¸ƒå¼é…ç½®ç®¡ç†ä¸­å¿ƒï¼Œè¯ç”Ÿäºæºç¨‹æ¡†æ¶ç ”å‘éƒ¨ï¼Œèƒ½å¤Ÿé›†ä¸­åŒ–ç®¡ç†åº”ç”¨ä¸åŒç¯å¢ƒã€ä¸åŒé›†ç¾¤çš„é…ç½®ï¼Œé…ç½®ä¿®æ”¹åèƒ½å¤Ÿå®æ—¶æ¨é€åˆ°åº”ç”¨ç«¯ï¼Œå¹¶ä¸”å…·å¤‡è§„èŒƒçš„æƒé™ã€æµç¨‹æ²»ç†ç­‰ç‰¹æ€§ï¼Œé€‚ç”¨äºå¾®æœåŠ¡é…ç½®ç®¡ç†åœºæ™¯ã€‚åœ¨ Apollo åå°æ–°å»ºæˆ–è€…æ›´æ–°äº†é…ç½®ï¼Œæˆ‘ä»¬çš„ä»£ç ä¼šç«‹å³ç”Ÿæ•ˆå—ï¼Ÿä¸ä¼šï¼Œæ›´æ–°æ•°æ®é‡‡å–çš„æ˜¯åº”ç”¨ä¸»åŠ¨æ‹‰å–ï¼ˆè½®è¯¢ï¼‰æœºåˆ¶ï¼Œæ‰€ä»¥åœ¨ Apollo æ›´æ”¹äº†é…ç½®ï¼Œåº”ç”¨å¹¶ä¸èƒ½ç«‹å³æ›´æ–°ã€‚å¯¹äºæˆ‘ä»¬çš„ Node.js åº”ç”¨æ¥è®²ï¼Œä¸ºäº†åˆ†æ•£è·å– Apollo æœåŠ¡çš„å‹åŠ›ï¼Œæœ‰æ„é”™å¼€äº†æ¯ä¸ªè¿›ç¨‹çš„æ‹‰å–æ—¶é—´é—´éš”ã€‚å½“å‰æˆ‘ä»¬å®é™…è®¾ç½®æ˜¯ï¼Œä»åœ¨ Apollo åå°æ›´æ–°å®Œæ•°æ®å¼€å§‹ç®—èµ·ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½è·å–åˆ°æœ€æ–°é…ç½®æ•°æ®çš„æ—¶é—´åº”è¯¥ä¸ä¼šè¶…è¿‡ 3 åˆ†é’Ÿã€‚

![apollo](https://cdn.jsdelivr.net/gh/apolloconfig/apollo@master/doc/images/apollo-home-screenshot.jpg)

å¦‚ä¸‹å³æ˜¯ Apollo çš„åŸºç¡€æ¨¡å‹:

1. ç”¨æˆ·åœ¨é…ç½®ä¸­å¿ƒå¯¹é…ç½®è¿›è¡Œä¿®æ”¹å¹¶å‘å¸ƒ
2. é…ç½®ä¸­å¿ƒé€šçŸ¥ Apollo å®¢æˆ·ç«¯æœ‰é…ç½®æ›´æ–°
3. Apollo å®¢æˆ·ç«¯ä»é…ç½®ä¸­å¿ƒæ‹‰å–æœ€æ–°çš„é…ç½®ã€æ›´æ–°æœ¬åœ°é…ç½®å¹¶é€šçŸ¥åˆ°åº”ç”¨
4. åŒæ—¶ä¼šä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œåœ¨é‡åˆ°æœåŠ¡ä¸å¯ç”¨ï¼Œæˆ–ç½‘ç»œä¸é€šçš„æ—¶å€™ï¼Œä¾ç„¶èƒ½ä»æœ¬åœ°æ¢å¤é…ç½®
5. åº”ç”¨ç¨‹åºå¯ä»¥ä» Apollo å®¢æˆ·ç«¯è·å–æœ€æ–°çš„é…ç½®ã€è®¢é˜…é…ç½®æ›´æ–°é€šçŸ¥

![apollo åŸºç¡€æ¨¡å‹](https://cdn.jsdelivr.net/gh/apolloconfig/apollo@master/doc/images/client-architecture.png)

é‡Œé¢æ¶‰åŠåˆ°çš„ [**namespace**](https://github.com/apolloconfig/apollo/wiki/Apolloæ ¸å¿ƒæ¦‚å¿µä¹‹â€œNamespaceâ€) æ˜¯é…ç½®é¡¹çš„é›†åˆï¼Œç±»ä¼¼äºä¸€ä¸ªé…ç½®æ–‡ä»¶çš„æ¦‚å¿µã€‚Apollo åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œéƒ½ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªåä¸º â€œapplicationâ€ çš„ Namespaceã€‚é¡¾åæ€ä¹‰ï¼Œâ€œapplicationâ€ æ˜¯ç»™åº”ç”¨è‡ªèº«ä½¿ç”¨çš„ï¼Œç†Ÿæ‚‰ Spring Boot çš„åŒå­¦éƒ½çŸ¥é“ï¼ŒSpring Boot é¡¹ç›®éƒ½æœ‰ä¸€ä¸ªé»˜è®¤é…ç½®æ–‡ä»¶ application.ymlã€‚åœ¨è¿™é‡Œ application.yml å°±ç­‰åŒäº â€œapplicationâ€ çš„ Namespaceã€‚å¯¹äº 90% çš„åº”ç”¨æ¥è¯´ï¼Œâ€œapplicationâ€ çš„ Namespace å·²ç»æ»¡è¶³æ—¥å¸¸é…ç½®ä½¿ç”¨åœºæ™¯äº†ã€‚ä¸Šé¢å›¾ç¤ºä¸­çš„ FX.apollo å°±æ˜¯ namespaceã€‚

ä»¥ node ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸‰æ–¹ä»“åº“ [ctrip-apollo](https://github.com/kaelzhang/ctrip-apollo):

```JS
const apollo = require('ctrip-apollo')

const ns = apollo({
  host: 'http://localhost:8070',
  appId: '100004458',
  enableUpdateNotification: false, // set to false to disable update notification
  enableFetch: true,
  cachePath: path.join(__dirname, '../config'), // path specify this option to enable the feature to save configurations to the disk
  fetchInterval: createInterval(), // interval in milliseconds to pull the new configurations. Defaults to 5 minutes. Setting this option to 0 will disable the feature.
  fetchTimeout: 5000,
})

const start = async () => {
  // We can also use async/await
  await ns.ready()

  console.log(ns.config())
  // {
  //   'portal.elastic.document.type': 'biz',
  //   'portal.elastic.cluster.name': 'hermes-es-fws'
  // }
}

start()
```

## Kafka

**Kafka** æ˜¯æœ€åˆç”± Linkedin å…¬å¸å¼€å‘ï¼Œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€åˆ†åŒºçš„ã€å¤šå‰¯æœ¬çš„ã€å¤šè®¢é˜…è€…ï¼ŒåŸºäº zookeeper åè°ƒçš„åˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿï¼ˆä¹Ÿå¯ä»¥å½“åš MQ ç³»ç»Ÿï¼‰ï¼Œå¸¸è§å¯ä»¥ç”¨äº web/nginx æ—¥å¿—ã€è®¿é—®æ—¥å¿—ï¼Œæ¶ˆæ¯æœåŠ¡ç­‰ç­‰ï¼ŒLinkedin äº 2010 å¹´è´¡çŒ®ç»™äº† Apache åŸºé‡‘ä¼šå¹¶æˆä¸ºé¡¶çº§å¼€æºé¡¹ç›®ã€‚ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼šæ—¥å¿—æ”¶é›†ç³»ç»Ÿå’Œæ¶ˆæ¯ç³»ç»Ÿã€‚é‡‡ç”¨çš„æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚

![kafka]( {{site.url}}/style/images/smms/kafka.png )

* **broker** - Kafka é›†ç¾¤åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨èŠ‚ç‚¹å³ç§°ä¸º broker
* **topic** - ä¸»é¢˜ï¼Œç”±ç”¨æˆ·å®šä¹‰å¹¶é…ç½®åœ¨ Kafka æœåŠ¡å™¨ï¼Œç”¨äºå»ºç«‹ Producer å’Œ Consumer ä¹‹é—´çš„è®¢é˜…å…³ç³»ã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šçš„ Topic ä¸‹ï¼Œæ¶ˆæ¯è€…ä»è¿™ä¸ª Topic ä¸‹æ¶ˆè´¹æ¶ˆæ¯
* **partition** - æ¶ˆæ¯åˆ†åŒºï¼Œä¸€ä¸ª topic å¯ä»¥åˆ†ä¸ºå¤šä¸ª partitionï¼Œæ¯ä¸ª partition æ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ã€‚partition ä¸­çš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªæœ‰åºçš„ idï¼Œå³ offset
* **producer** - ç”Ÿäº§è€…å³æ•°æ®çš„å‘å¸ƒè€…ï¼Œè¯¥è§’è‰²å°†æ¶ˆæ¯å‘å¸ƒåˆ° Kafka çš„ topic ä¸­
* **consumer** - æ¶ˆè´¹è€…å¯ä»¥ä» broker ä¸­è¯»å–æ•°æ®ã€‚æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ª topic ä¸­çš„æ•°æ®
* **cosumer group** - æ¶ˆè´¹è€…åˆ†ç»„ï¼Œç”¨äºå½’ç»„åŒç±»æ¶ˆè´¹è€…ã€‚æ¯ä¸ª consumer å±äºä¸€ä¸ªç‰¹å®šçš„ consumer groupï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å…±åŒæ¶ˆè´¹ä¸€ä¸ª Topic ä¸‹çš„æ¶ˆæ¯
* **offset** - æ¶ˆæ¯åœ¨ partition ä¸­çš„åç§»é‡ã€‚æ¯ä¸€æ¡æ¶ˆæ¯åœ¨ partition éƒ½æœ‰å”¯ä¸€çš„åç§»é‡ï¼Œæ¶ˆæ¯è€…å¯ä»¥æŒ‡å®šåç§»é‡æ¥æŒ‡å®šè¦æ¶ˆè´¹çš„æ¶ˆæ¯

## OpenTracing & jaeger

æœ¬èŠ‚ä¸»è¦[æ‘˜è‡ª å¼€æ”¾åˆ†å¸ƒå¼è¿½è¸ªï¼ˆOpenTracingï¼‰å…¥é—¨ä¸ Jaeger å®ç°](https://developer.aliyun.com/article/514488)ã€‚

![æ¶æ„æ¼”è¿›](http://ata2-img.cn-hangzhou.img-pub.aliyun-inc.com/9e95e41a2fa724dc66b2f49a967845c6.png)

ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåº”ç”¨æ¶æ„å¼€å§‹ä»å•ä½“ç³»ç»Ÿé€æ­¥è½¬å˜ä¸º**å¾®æœåŠ¡**ï¼Œå…¶ä¸­çš„ä¸šåŠ¡é€»è¾‘éšä¹‹è€Œæ¥å°±ä¼šå˜æˆå¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ä¸è¯·æ±‚ã€‚èµ„æºè§’åº¦æ¥çœ‹ï¼Œä¼ ç»ŸæœåŠ¡å™¨è¿™ä¸ªç‰©ç†å•ä½ä¹Ÿé€æ¸æ·¡åŒ–ï¼Œå˜æˆäº†çœ‹ä¸è§æ‘¸ä¸åˆ°çš„è™šæ‹Ÿèµ„æºæ¨¡å¼ã€‚ä»ä»¥ä¸Šä¸¤ä¸ªå˜åŒ–å¯ä»¥çœ‹åˆ°è¿™ç§å¼¹æ€§ã€æ ‡å‡†åŒ–çš„æ¶æ„èƒŒåï¼ŒåŸå…ˆè¿ç»´ä¸è¯Šæ–­çš„éœ€æ±‚ä¹Ÿå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚ä¸ºäº†åº”å¯¹è¿™ç§å˜åŒ–è¶‹åŠ¿ï¼Œè¯ç”Ÿä¸€ç³»åˆ—é¢å‘ DevOps çš„è¯Šæ–­ä¸åˆ†æç³»ç»Ÿï¼ŒåŒ…æ‹¬**é›†ä¸­å¼æ—¥å¿—ç³»ç»Ÿï¼ˆLoggingï¼‰ï¼Œé›†ä¸­å¼åº¦é‡ç³»ç»Ÿï¼ˆMetricsï¼‰å’Œåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿï¼ˆTracingï¼‰**ï¼š

* **Logging** - ç”¨äºè®°å½•ç¦»æ•£çš„äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºçš„è°ƒè¯•ä¿¡æ¯æˆ–é”™è¯¯ä¿¡æ¯ã€‚å®ƒæ˜¯æˆ‘ä»¬è¯Šæ–­é—®é¢˜çš„ä¾æ®ã€‚
* **Metrics** - ç”¨äºè®°å½•å¯èšåˆçš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œé˜Ÿåˆ—çš„å½“å‰æ·±åº¦å¯è¢«å®šä¹‰ä¸ºä¸€ä¸ªåº¦é‡å€¼ï¼Œåœ¨å…ƒç´ å…¥é˜Ÿæˆ–å‡ºé˜Ÿæ—¶è¢«æ›´æ–°ï¼›HTTP è¯·æ±‚ä¸ªæ•°å¯è¢«å®šä¹‰ä¸ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ–°è¯·æ±‚åˆ°æ¥æ—¶è¿›è¡Œç´¯åŠ ã€‚
* **Tracing** - ç”¨äºè®°å½•è¯·æ±‚èŒƒå›´å†…çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œä¸€æ¬¡è¿œç¨‹æ–¹æ³•è°ƒç”¨çš„æ‰§è¡Œè¿‡ç¨‹å’Œè€—æ—¶ã€‚å®ƒæ˜¯æˆ‘ä»¬æ’æŸ¥ç³»ç»Ÿæ€§èƒ½é—®é¢˜çš„åˆ©å™¨ã€‚

é€šè¿‡ä¸Šè¿°ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å·²æœ‰ç³»ç»Ÿè¿›è¡Œåˆ†ç±»ã€‚ä¾‹å¦‚ï¼ŒZipkin ä¸“æ³¨äº tracing é¢†åŸŸï¼›Prometheus å¼€å§‹ä¸“æ³¨äº metricsï¼›ELKï¼Œé˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡è¿™æ ·çš„ç³»ç»Ÿå¼€å§‹ä¸“æ³¨äº logging é¢†åŸŸã€‚

åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿå‘å±•å¾ˆå¿«ï¼Œç§ç±»ç¹å¤šï¼Œæ¯”å¦‚ Google çš„ Dapperï¼ŒTwitter çš„ Zipkin ç­‰ï¼Œä½†æ ¸å¿ƒæ­¥éª¤ä¸€èˆ¬æœ‰ä¸‰ä¸ªï¼š**ä»£ç åŸ‹ç‚¹ï¼Œæ•°æ®å­˜å‚¨ã€æŸ¥è¯¢å±•ç¤º**ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è°ƒç”¨çš„ä¾‹å­ï¼Œå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚é¦–å…ˆåˆ°è¾¾è´Ÿè½½å‡è¡¡å™¨ï¼Œæ¥ç€ç»è¿‡è®¤è¯æœåŠ¡ï¼Œè®¡è´¹æœåŠ¡ï¼Œç„¶åè¯·æ±‚èµ„æºï¼Œæœ€åè¿”å›ç»“æœï¼š

![åˆ†å¸ƒå¼è°ƒç”¨](http://ata2-img.cn-hangzhou.img-pub.aliyun-inc.com/9e30ca9d4ac0f76502e1be2f87d2a2df.png)

æ•°æ®è¢«é‡‡é›†å­˜å‚¨åï¼Œåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿä¸€èˆ¬ä¼šé€‰æ‹©ä½¿ç”¨åŒ…å«æ—¶é—´è½´çš„æ—¶åºå›¾æ¥å‘ˆç°è¿™ä¸ª Traceã€‚ä½†åœ¨æ•°æ®é‡‡é›†è¿‡ç¨‹ä¸­ï¼Œç”±äºéœ€è¦ä¾µå…¥ç”¨æˆ·ä»£ç ï¼Œå¹¶ä¸”ä¸åŒç³»ç»Ÿçš„ API å¹¶ä¸å…¼å®¹ï¼Œè¿™å°±å¯¼è‡´äº†å¦‚æœæ‚¨å¸Œæœ›åˆ‡æ¢è¿½è¸ªç³»ç»Ÿï¼Œå¾€å¾€ä¼šå¸¦æ¥è¾ƒå¤§æ”¹åŠ¨ï¼š

![æ•°æ®å‘ˆç°](http://ata2-img.cn-hangzhou.img-pub.aliyun-inc.com/e8813c5c6d2bf7cdc4780ad7fe477245.png)

äºæ˜¯ä¸ºäº†è§£å†³ä¸åŒçš„åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿ API ä¸å…¼å®¹çš„é—®é¢˜ï¼Œè¯ç”Ÿäº† **OpenTracing** è§„èŒƒã€‚OpenTracing æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ ‡å‡†åŒ–å±‚ï¼Œå®ƒä½äºåº”ç”¨ç¨‹åº/ç±»åº“å’Œè¿½è¸ªæˆ–æ—¥å¿—åˆ†æç¨‹åºä¹‹é—´ã€‚

```TEXT
+-------------+  +---------+  +----------+  +------------+
| Application |  | Library |  |   OSS    |  |  RPC/IPC   |
|    Code     |  |  Code   |  | Services |  | Frameworks |
+-------------+  +---------+  +----------+  +------------+
       |              |             |             |
       |              |             |             |
       v              v             v             v
  +------------------------------------------------------+
  |                     OpenTracing                      |
  +------------------------------------------------------+
     |                |                |               |
     |                |                |               |
     v                v                v               v
+-----------+  +-------------+  +-------------+  +-----------+
|  Tracing  |  |   Logging   |  |   Metrics   |  |  Tracing  |
| System A  |  | Framework B |  | Framework C |  | System D  |
+-----------+  +-------------+  +-------------+  +-----------+
```

å¤§å¤šæ•°åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿçš„æ€æƒ³æ¨¡å‹éƒ½æ¥è‡ªGoogle's Dapperè®ºæ–‡ï¼ŒOpenTracingä¹Ÿä½¿ç”¨ç›¸ä¼¼çš„æœ¯è¯­ï¼š

* **Trace** - äº‹ç‰©åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç§»åŠ¨æ—¶çš„æè¿°
* **Span** -  ä¸€ç§å‘½åçš„ã€å®šæ—¶çš„æ“ä½œï¼Œè¡¨ç¤ºå·¥ä½œæµçš„ä¸€éƒ¨åˆ†ã€‚Spans æ¥å— key:value æ ‡ç­¾ä»¥åŠé™„åŠ åˆ°ç‰¹å®š Span å®ä¾‹çš„ç»†ç²’åº¦ã€å¸¦æ—¶é—´æˆ³çš„ç»“æ„åŒ–æ—¥å¿—
* **Span Contenxt** - æºå¸¦åˆ†å¸ƒå¼äº‹åŠ¡çš„è·Ÿè¸ªä¿¡æ¯ï¼ŒåŒ…æ‹¬å½“å®ƒé€šè¿‡ç½‘ç»œæˆ–æ¶ˆæ¯æ€»çº¿å°†æœåŠ¡ä¼ é€’ç»™æœåŠ¡æ—¶ã€‚SPAN ä¸Šä¸‹æ–‡åŒ…å« Trace æ ‡è¯†ç¬¦ã€SPAN æ ‡è¯†ç¬¦å’Œè·Ÿè¸ªç³»ç»Ÿéœ€è¦ä¼ æ’­åˆ°ä¸‹æ¸¸æœåŠ¡çš„ä»»ä½•å…¶ä»–æ•°æ®

![opentracing api](https://pic1.zhimg.com/80/v2-3c0a8b91c21c84ce802790149effd1fc_1440w.jpg)

[**Jaeger**](https://github.com/jaegertracing/jaeger) å— Dapper å’Œ OpenZipkin çš„å¯å‘, æ˜¯ç”± Uber Technologies ä½œä¸ºå¼€æºå‘å¸ƒçš„åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿï¼Œå…¼å®¹ OpenTracing APIã€‚å®ƒç”¨äºç›‘è§†å’Œè¯Šæ–­åŸºäºå¾®æœåŠ¡çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒåŒ…æ‹¬åˆ†å¸ƒå¼ä¸Šä¸‹æ–‡ä¼ æ’­ã€åˆ†å¸ƒå¼äº¤æ˜“ç›‘æ§ã€æ ¹æœ¬åŸå› åˆ†æã€æœåŠ¡ä¾èµ–æ€§åˆ†æå’Œæ€§èƒ½/å»¶è¿Ÿä¼˜åŒ–ç­‰ã€‚

> å…·ä½“å†ç¨‹å¯ä»¥å‚è€ƒ uber [å‘å¸ƒçš„æ–‡ç« ](https://eng.uber.com/distributed-tracing/) ğŸ‘ˆ

![jager](http://ata2-img.cn-hangzhou.img-pub.aliyun-inc.com/f671cb89ab5946b181443c53962cfa2f.png)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒJaeger ä¸»è¦ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼š

* **Jaeger Client** - ä¸ºä¸åŒè¯­è¨€å®ç°äº†ç¬¦åˆ OpenTracing æ ‡å‡†çš„ SDKã€‚åº”ç”¨ç¨‹åºé€šè¿‡ API å†™å…¥æ•°æ®ï¼Œclient library æŠŠ trace ä¿¡æ¯æŒ‰ç…§åº”ç”¨ç¨‹åºæŒ‡å®šçš„é‡‡æ ·ç­–ç•¥ä¼ é€’ç»™ jaeger-agentã€‚
* **Agent** - å®ƒæ˜¯ä¸€ä¸ªç›‘å¬åœ¨ UDP ç«¯å£ä¸Šæ¥æ”¶ span æ•°æ®çš„ç½‘ç»œå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒä¼šå°†æ•°æ®æ‰¹é‡å‘é€ç»™ collectorã€‚å®ƒè¢«è®¾è®¡æˆä¸€ä¸ªåŸºç¡€ç»„ä»¶ï¼Œéƒ¨ç½²åˆ°æ‰€æœ‰çš„å®¿ä¸»æœºä¸Šã€‚Agent å°† client library å’Œ collector è§£è€¦ï¼Œä¸º client library å±è”½äº†è·¯ç”±å’Œå‘ç° collector çš„ç»†èŠ‚ã€‚
* **Collector** - æ¥æ”¶ jaeger-agent å‘é€æ¥çš„æ•°æ®ï¼Œç„¶åå°†æ•°æ®å†™å…¥åç«¯å­˜å‚¨ã€‚Collector è¢«è®¾è®¡æˆæ— çŠ¶æ€çš„ç»„ä»¶ï¼Œå› æ­¤æ‚¨å¯ä»¥åŒæ—¶è¿è¡Œä»»æ„æ•°é‡çš„ jaeger-collectorã€‚
* **Data Store** - åç«¯å­˜å‚¨è¢«è®¾è®¡æˆä¸€ä¸ªå¯æ’æ‹”çš„ç»„ä»¶ï¼Œæ”¯æŒå°†æ•°æ®å†™å…¥ cassandraã€elasticsearchã€‚
* **Query** - æ¥æ”¶æŸ¥è¯¢è¯·æ±‚ï¼Œç„¶åä»åç«¯å­˜å‚¨ç³»ç»Ÿä¸­æ£€ç´¢ trace å¹¶é€šè¿‡ UI è¿›è¡Œå±•ç¤ºã€‚Query æ˜¯æ— çŠ¶æ€çš„ï¼Œæ‚¨å¯ä»¥å¯åŠ¨å¤šä¸ªå®ä¾‹ï¼ŒæŠŠå®ƒä»¬éƒ¨ç½²åœ¨ nginx è¿™æ ·çš„è´Ÿè½½å‡è¡¡å™¨åé¢ã€‚

## Elasticsearch

### å…¨æ–‡æ£€ç´¢

[**Elasticsearch**](https://github.com/elastic/elasticsearch) æ˜¯ä¸€ä¸ªå®æ—¶çš„åˆ†å¸ƒå¼æœç´¢åˆ†æå¼•æ“ï¼Œåº•å±‚æ˜¯å¼€æºåº“ Apache Luceneã€‚å®ƒå±è”½äº† Lucene å„ç§å¤æ‚çš„è®¾ç½®ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†å¾ˆå‹å¥½çš„ä¾¿åˆ©ï¼Œå¾ˆå¤šä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä¹Ÿæä¾›å…¨æ–‡æ£€ç´¢ï¼Œæœ‰çš„æ˜¯åŸºäº Lucene å†…åµŒï¼Œæœ‰çš„æ˜¯åŸºäºè‡ªç ”ï¼Œä¸ Elasticsearch æ¯”è¾ƒèµ·æ¥ï¼ŒåŠŸèƒ½å•ä¸€ï¼Œæ€§èƒ½ä¹Ÿè¡¨ç°ä¸æ˜¯å¾ˆå¥½ï¼Œæ‰©å±•æ€§å‡ ä¹æ²¡æœ‰ã€‚ES èƒ½è®©ä½ ä»¥å‰æ‰€æœªæœ‰çš„é€Ÿåº¦å’Œè§„æ¨¡ï¼Œå»æ¢ç´¢ä½ çš„æ•°æ®ã€‚å®ƒè¢«ç”¨ä½œ**å…¨æ–‡æ£€ç´¢**ã€ç»“æ„åŒ–æœç´¢ã€åˆ†æä»¥åŠè¿™ä¸‰ä¸ªåŠŸèƒ½çš„ç»„åˆã€‚GitHub ä¹Ÿæ˜¯ä½¿ç”¨ Elasticsearch å¯¹æµ·é‡ä»£ç è¿›è¡ŒæŸ¥è¯¢ã€‚

> å¦ä¸€ä¸ªæ¯”è¾ƒæµè¡Œçš„æœç´¢å¼•æ“ä¹Ÿæ˜¯åŸºäº Lucene å¼€å‘çš„ [Apache Solr](https://solr.apache.org)ï¼Œè¯»ä½œ "solar"ã€‚

> Elasticsearch é‡‡ç”¨çš„æ˜¯[**å€’æ’ç´¢å¼•ç®—æ³•**](https://www.cnblogs.com/dreamroute/p/8484457.html) ğŸ‘ˆ

**Elasticsearch æœ¬è´¨æ˜¯ä¸€ä¸ªæ•°æ®åº“**ï¼Œä¹Ÿéœ€è¦æœ‰ä¸“é—¨çš„ DBA è¿ç»´ï¼Œåªæ˜¯æ›´åé‡åº”ç”¨å±‚é¢ï¼Œæ‰€ä»¥è¿ç»´èŒè´£ç›¸å¯¹ä¼ ç»Ÿ DBA æ²¡æœ‰é‚£ä¹ˆä¸¥è‹›ã€‚å¯¹äºé›†ç¾¤å±‚é¢å¿…é¡»æŒæ¡é›†ç¾¤æ­å»ºï¼Œé›†ç¾¤æ‰©å®¹ã€é›†ç¾¤å‡çº§ã€é›†ç¾¤å®‰å…¨ã€é›†ç¾¤ç›‘æ§å‘Šè­¦ç­‰ï¼›å¦å¤–å¯¹äºæ•°æ®å±‚é¢è¿ç»´ï¼Œå¿…é¡»æŒæ¡æ•°æ®å¤‡ä»½ä¸è¿˜åŸã€æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œè¿˜æœ‰ä¸€äº›æ—¥å¸¸é—®é¢˜è¯Šæ–­ç­‰ã€‚

> è¯¦ç»†æ•™ç¨‹å¯ä»¥[æŸ¥çœ‹è¿™é‡Œ](https://www.sojson.com/blog/81.html) ğŸ‘ˆ

### ELK ä¹‹ Kibana

è‘—åçš„ **ELK** ä¸‰ä»¶å¥—ï¼Œè®²çš„å°±æ˜¯ **Elasticsearchï¼ŒLogstashï¼ŒKibana**ï¼Œä¸“é—¨é’ˆå¯¹æ—¥å¿—é‡‡é›†ã€å­˜å‚¨ã€æŸ¥è¯¢è®¾è®¡çš„äº§å“ç»„åˆã€‚å½“ç„¶ç°åœ¨å·²ç»å‘å±•æˆäº† [**Elastic Stack**](https://www.elastic.co/what-is/elk-stack)ã€‚

Logstash æ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œå¯ä»¥åŒæ—¶ä»å¤šä¸ªæ•°æ®æºè·å–æ•°æ®ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè½¬æ¢ï¼Œç„¶åå°†å…¶å‘é€åˆ°ä½ æœ€å–œæ¬¢çš„â€œå­˜å‚¨â€ï¼ˆå½“ç„¶å¯ä»¥å°±æ˜¯ Elasticsearchï¼‰ã€‚

Kibana æ˜¯ä¸€ç§æ•°æ®å¯è§†åŒ–å’ŒæŒ–æ˜å·¥å…·ï¼Œå¯ä»¥ç”¨äºæ—¥å¿—å’Œæ—¶é—´åºåˆ—åˆ†æã€åº”ç”¨ç¨‹åºç›‘æ§å’Œè¿è¥æ™ºèƒ½ä½¿ç”¨æ¡ˆä¾‹ã€‚å®ƒæä¾›äº†å¼ºå¤§ä¸”æ˜“ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ç›´æ–¹å›¾ã€çº¿å½¢å›¾ã€é¥¼å›¾ã€çƒ­å›¾å’Œå†…ç½®çš„åœ°ç†ç©ºé—´æ”¯æŒã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æä¾›äº†ä¸ Elasticsearch çš„ç´§å¯†é›†æˆï¼Œè¿™ä½¿å¾— Kibana æˆä¸ºäº†å¯è§†åŒ– Elasticsearch ä¸­å­˜å‚¨æ•°æ®çš„é»˜è®¤ä¹‹é€‰ã€‚

![kibana](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt47b86adba2f459aa/5fa31e03bfc5dd7188659491/screenshot-kibana-dashboard-webtraffic2-710-547x308.jpg)

## Grafana

[**Grafana**](https://grafana.com) æ˜¯ä¸€æ¬¾ç”¨ Go è¯­è¨€å¼€å‘çš„å¼€æºæ•°æ®å¯è§†åŒ–å·¥å…·ï¼Œå¯ä»¥åšæ•°æ®ç›‘æ§å’Œæ•°æ®ç»Ÿè®¡ï¼Œå¹¶å¸¦æœ‰å‘Šè­¦åŠŸèƒ½:

> The open and composable observability and data visualization platform. Visualize metrics, logs, and traces from multiple sources like Prometheus, Loki, Elasticsearch, InfluxDB, Postgres and many more.

![grafana](https://grafana.com/static/img/screenshots/Modal_dashboards.png)

> Kibana å’Œ Grafana éƒ½æ˜¯å¼ºå¤§çš„å¯è§†åŒ–å·¥å…·ã€‚ç„¶è€Œï¼ŒGrafana å’Œ InfluxDB ç»„åˆæ˜¯ç”¨äºåº¦é‡æ•°æ®çš„ï¼Œåä¹‹ï¼ŒKibana æ˜¯æµè¡Œçš„ ELK æ ˆçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¯ä»¥æ›´ä¸ºçµæ´»åœ°æµè§ˆæ—¥å¿—æ•°æ®ã€‚è¿™ä¸¤ä¸ªå¹³å°éƒ½æ˜¯å¥½çš„é€‰æ‹©ï¼Œç”šè‡³æœ‰æ—¶è¿˜å¯ä»¥äº’è¡¥ã€‚é¦–å…ˆï¼Œç”¨ Kibana å»åˆ†æä½ çš„æ—¥å¿—ã€‚ç„¶åï¼ŒæŠŠæ•°æ®å¯¼å…¥åˆ° Grafana ä½œä¸ºå¯è§†åŒ–å±‚ã€‚

## Zabbix

**Zabbix** æ˜¯ä¸€ä¸ªåŸºäº web ç•Œé¢çš„æä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›‘è§†ä»¥åŠç½‘ç»œç›‘è§†åŠŸèƒ½çš„ä¼ä¸šçº§çš„å¼€æºè§£å†³æ–¹æ¡ˆï¼ŒåŸºäº `Server-Client` æ¶æ„ã€‚ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆ:

* **zabbix server** - é€šè¿‡ SNMPã€zabbix agentã€pingï¼Œç«¯å£ç›‘è§†ç­‰æ–¹æ³•æä¾›å¯¹è¿œç¨‹æœåŠ¡å™¨/ç½‘ç»œçŠ¶æ€çš„ç›‘è§†ï¼Œæ•°æ®æ”¶é›†ç­‰åŠŸèƒ½
* **zabbix agent** - å®‰è£…åœ¨è¢«ç›‘è§†çš„ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œå®ƒä¸»è¦å®Œæˆå¯¹ç¡¬ä»¶ä¿¡æ¯æˆ–ä¸æ“ä½œç³»ç»Ÿæœ‰å…³çš„å†…å­˜ã€CPU ç­‰ä¿¡æ¯çš„æ”¶é›†

å¦å¤– grafana å¹³å°ä¹Ÿå¯ä»¥æ¥å…¥ zabbix æ•°æ®è¿›è¡Œå±•ç¤ºï¼Œæ›¿æ¢æ‰ zabbix è‡ªå¸¦çš„å‡ºå›¾ç•Œé¢ï¼š

1. åœ¨ä»»æ„ä¸€å°ç”µè„‘ä¸Šå®‰è£… zabbix-serverï¼Œç„¶åå†åœ¨è¢«æµ‹è¯•çš„æ€§èƒ½æœåŠ¡å™¨ä¸Šå®‰è£… zabbix-agentï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥æŠŠæ€§èƒ½æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæ€§èƒ½æœåŠ¡å™¨å„ç§ç›‘æ§æ•°æ®ç»™ zabbix-server
2. åœ¨ä»»æ„ä¸€å°ç”µè„‘ä¸Šå®‰è£… grafanaï¼Œç„¶åå†å®‰è£… zabbix æ’ä»¶ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥è®© grafana æ”¯æŒ zabbix
3. åœ¨ grafana ä¸­ï¼Œé…ç½® zabbix-server ä½œä¸ºæ•°æ®æºï¼Œå†æ·»åŠ å±•ç¤ºé¢æ¿ï¼Œè¿™æ ·ï¼Œå°±èƒ½æŠŠç”¨ zabbix ç›‘æ§çš„è¢«æµ‹è¯•çš„æ€§èƒ½æœåŠ¡å™¨çš„æ•°æ®åœ¨ grafana ä¸­å±•ç¤ºäº†

æ›´å¤šæ–‡ç« å¯ä»¥å‚è€ƒï¼š

1. å…·ä½“å®‰è£…æ–¹æ³•å¯ä»¥[å‚è€ƒè¿™ç¯‡æ–‡ç« ](https://www.jianshu.com/p/49ef09f6d8db)
2. [zabbix ä»å¬è¯´åˆ°å­¦ä¼š](https://www.jianshu.com/p/49ef09f6d8db) By JokerW
3. [Zabbix 3.0 ä»å…¥é—¨åˆ°ç²¾é€š(zabbix ä½¿ç”¨è¯¦è§£)](https://www.cnblogs.com/clsn/p/7885990.html) By æƒ¨ç»¿å°‘å¹´

## Prometheus

[**Prometheus**](https://github.com/prometheus/prometheus) æ˜¯ç”±å‰ Google å·¥ç¨‹å¸ˆä» 2012 å¹´å¼€å§‹åœ¨ Soundcloud ä»¥å¼€æºè½¯ä»¶çš„å½¢å¼è¿›è¡Œç ”å‘çš„ç³»ç»Ÿç›‘æ§å’Œå‘Šè­¦å·¥å…·åŒ…ï¼Œè‡ªæ­¤ä»¥åï¼Œè®¸å¤šå…¬å¸å’Œç»„ç»‡éƒ½é‡‡ç”¨äº† Prometheus ä½œä¸ºç›‘æ§å‘Šè­¦å·¥å…·ã€‚Prometheus çš„å¼€å‘è€…å’Œç”¨æˆ·ç¤¾åŒºéå¸¸æ´»è·ƒï¼Œå®ƒç°åœ¨æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¼€æºé¡¹ç›®ï¼Œå¯ä»¥ç‹¬ç«‹äºä»»ä½•å…¬å¸è¿›è¡Œç»´æŠ¤ã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼ŒPrometheus äº 2016 å¹´ 5 æœˆåŠ å…¥ CNCF åŸºé‡‘ä¼šï¼Œæˆä¸ºç»§ Kubernetes ä¹‹åçš„ç¬¬äºŒä¸ª CNCF æ‰˜ç®¡é¡¹ç›®ã€‚è¯¦æƒ…å¯ä»¥å‚è€ƒ[ä¸­æ–‡æ–‡æ¡£](https://prometheus.fuckcloudnative.io/di-yi-zhang-jie-shao/overview) ğŸ‘ˆ

Prometheus Server ç›´æ¥ä»ç›‘æ§ç›®æ ‡ä¸­æˆ–è€…é—´æ¥é€šè¿‡æ¨é€ç½‘å…³æ¥æ‹‰å–ç›‘æ§æŒ‡æ ‡ï¼Œå®ƒåœ¨æœ¬åœ°å­˜å‚¨æ‰€æœ‰æŠ“å–åˆ°çš„æ ·æœ¬æ•°æ®ï¼Œå¹¶å¯¹æ­¤æ•°æ®æ‰§è¡Œä¸€ç³»åˆ—è§„åˆ™ï¼Œä»¥æ±‡æ€»å’Œè®°å½•ç°æœ‰æ•°æ®çš„æ–°æ—¶é—´åºåˆ—æˆ–ç”Ÿæˆå‘Šè­¦ã€‚å¯ä»¥é€šè¿‡ Grafana æˆ–è€…å…¶ä»–å·¥å…·æ¥å®ç°ç›‘æ§æ•°æ®çš„å¯è§†åŒ–ï¼š

![Prometheus](https://camo.githubusercontent.com/f14ac82eda765733a5f2b5200d78b4ca84b62559d17c9835068423b223588939/68747470733a2f2f63646e2e6a7364656c6976722e6e65742f67682f70726f6d6574686575732f70726f6d65746865757340633334323537643036396336333036383564613335626365663038343633326666643564363230392f646f63756d656e746174696f6e2f696d616765732f6172636869746563747572652e737667)

Prometheus é€‚ç”¨äºè®°å½•æ–‡æœ¬æ ¼å¼çš„æ—¶é—´åºåˆ—ï¼Œå®ƒæ—¢é€‚ç”¨äºä»¥æœºå™¨ä¸ºä¸­å¿ƒçš„ç›‘æ§ï¼Œä¹Ÿé€‚ç”¨äºé«˜åº¦åŠ¨æ€çš„é¢å‘æœåŠ¡æ¶æ„çš„ç›‘æ§ã€‚åœ¨å¾®æœåŠ¡çš„ä¸–ç•Œä¸­ï¼Œå®ƒå¯¹å¤šç»´æ•°æ®æ”¶é›†å’ŒæŸ¥è¯¢çš„æ”¯æŒæœ‰ç‰¹æ®Šä¼˜åŠ¿ã€‚Prometheus æ˜¯ä¸“ä¸ºæé«˜ç³»ç»Ÿå¯é æ€§è€Œè®¾è®¡çš„ï¼Œå®ƒå¯ä»¥åœ¨æ–­ç”µæœŸé—´å¿«é€Ÿè¯Šæ–­é—®é¢˜ï¼Œæ¯ä¸ª Prometheus Server éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸ä¾èµ–äºç½‘ç»œå­˜å‚¨æˆ–å…¶ä»–è¿œç¨‹æœåŠ¡ã€‚å½“åŸºç¡€æ¶æ„å‡ºç°æ•…éšœæ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ Prometheus å¿«é€Ÿå®šä½æ•…éšœç‚¹ï¼Œè€Œä¸”ä¸ä¼šæ¶ˆè€—å¤§é‡çš„åŸºç¡€æ¶æ„èµ„æºã€‚

Prometheus éå¸¸é‡è§†å¯é æ€§ï¼Œå³ä½¿åœ¨å‡ºç°æ•…éšœçš„æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿå¯ä»¥éšæ—¶æŸ¥çœ‹æœ‰å…³ç³»ç»Ÿçš„å¯ç”¨ç»Ÿè®¡ä¿¡æ¯ã€‚å¦‚æœä½ éœ€è¦ç™¾åˆ†ä¹‹ç™¾çš„å‡†ç¡®åº¦ï¼Œä¾‹å¦‚æŒ‰è¯·æ±‚æ•°é‡è®¡è´¹ï¼Œé‚£ä¹ˆ Prometheus ä¸å¤ªé€‚åˆä½ ï¼Œå› ä¸ºå®ƒæ”¶é›†çš„æ•°æ®å¯èƒ½ä¸å¤Ÿè¯¦ç»†å®Œæ•´ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ æœ€å¥½ä½¿ç”¨å…¶ä»–ç³»ç»Ÿæ¥æ”¶é›†å’Œåˆ†ææ•°æ®ä»¥è¿›è¡Œè®¡è´¹ï¼Œå¹¶ä½¿ç”¨ Prometheus æ¥ç›‘æ§ç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†ã€‚

Prometheus ä¸ zabbix çš„å¯¹æ¯”å¯ä»¥[å‚è€ƒè¿™ç¯‡æ–‡ç« ](https://www.cnblogs.com/xiaoyuxixi/p/12235979.html)ã€‚æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼šå¦‚æœç›‘æ§çš„æ˜¯ç‰©ç†æœºï¼Œç”¨ Zabbix æ²¡æ¯›ç—…ï¼ŒZabbix åœ¨ä¼ ç»Ÿç›‘æ§ç³»ç»Ÿä¸­ï¼Œå°¤å…¶æ˜¯åœ¨æœåŠ¡å™¨ç›¸å…³ç›‘æ§æ–¹é¢ï¼Œå æ®ç»å¯¹ä¼˜åŠ¿ã€‚ç”šè‡³ç¯å¢ƒå˜åŠ¨ä¸ä¼šå¾ˆé¢‘ç¹çš„æƒ…å†µä¸‹ï¼ŒZabbix ä¹Ÿä¼šæ¯” Prometheus å¥½ä½¿ï¼›ä½†å¦‚æœæ˜¯äº‘ç¯å¢ƒçš„è¯ï¼Œé™¤éæ˜¯ Zabbix ç©çš„éå¸¸æºœï¼Œå¯ä»¥åšå„ç§å®šåˆ¶ï¼Œå¦åˆ™è¿˜æ˜¯ Prometheus å§ï¼Œæ¯•ç«Ÿäººå®¶å°±æ˜¯å¹²è¿™ä¸ªçš„ã€‚Prometheus å¼€å§‹æˆä¸ºä¸»å¯¼åŠå®¹å™¨ç›‘æ§æ–¹é¢çš„æ ‡é…ï¼Œå¹¶ä¸”åœ¨æœªæ¥å¯è§çš„æ—¶é—´å†…è¢«å¹¿æ³›åº”ç”¨ã€‚å¦‚æœæ˜¯åˆšåˆšè¦ä¸Šç›‘æ§ç³»ç»Ÿçš„è¯ï¼Œä¸ç”¨çŠ¹è±«äº†ï¼ŒPrometheus å‡†æ²¡é”™ã€‚

![diff-prometheus-zabbix](http://dockone.io/uploads/article/20200613/88a28e93ed9f9f649d121c561dbf5347.png)

## SonarQube

**SonarQube** æ˜¯ç®¡ç†ä»£ç è´¨é‡ä¸€ä¸ªå¼€æ”¾å¹³å°ï¼Œå¯ä»¥å¿«é€Ÿçš„å®šä½ä»£ç ä¸­æ½œåœ¨çš„æˆ–è€…æ˜æ˜¾çš„é”™è¯¯ã€‚å¯é€šè¿‡å®‰è£…ä¸åŒçš„æ’ä»¶ï¼Œsonar å¯ä»¥é›†æˆæµ‹è¯•å·¥å…·ã€ä»£ç è´¨é‡åˆ†æå·¥å…·ã€æŒç»­é›†æˆç­‰å¤šç§åŠŸèƒ½ã€‚SonarQube æ¶æ„ä¸»è¦ç”±ï¼šSonarQube æœåŠ¡å™¨ã€sonar æ•°æ®åº“ã€æ’ä»¶ã€SonarQube scanners å››éƒ¨åˆ†ç»„æˆã€‚

![sonarqube](https://www.sonarqube.org/features/enhance-your-workflow/index/flow-header@2x.png)

Sonar å®é™…ä¸Šæ˜¯ä¸€ä¸ª Web ç³»ç»Ÿï¼Œå±•ç°äº†é™æ€ä»£ç æ‰«æçš„ç»“æœï¼ŒçœŸæ­£å®ç°ä»£ç æ‰«æçš„æ˜¯ SonarQube Scanner è¿™ä¸ªå·¥å…·ï¼Œå¯ä»¥æ”¯æŒå¤šç§å¼€å‘è¯­è¨€ã€‚SonarQube éœ€è¦æ•°æ®åº“çš„æ”¯æŒï¼Œç”¨äºå­˜å‚¨æ£€æµ‹é¡¹ç›®åçš„åˆ†ææ•°æ®ï¼ŒåŒæ—¶ä¸ºäº†å®ç°å¯æŒç»­ç›‘æµ‹ï¼Œè¿˜éœ€è¦æŒç»­é›†æˆå·¥å…·ï¼ˆå¦‚ Jenkinsï¼‰çš„æ”¯æŒï¼Œåœ¨æ„å»ºç‰ˆæœ¬å‰ï¼Œé€šè¿‡ Jenkins + Sonar æ’ä»¶æ‰§è¡Œé¡¹ç›®åˆ†ææŒ‡ä»¤ï¼Œæœ€ç»ˆçš„ç»“æœä¼šé€šè¿‡ SonarQube æœåŠ¡å™¨çš„ Web é¡µé¢å±•ç¤ºã€‚ä¸‹å›¾æ˜¯ä½¿ç”¨ SonarQube åšä»£ç æŒç»­å®¡æŸ¥çš„ç®€æ˜“æµç¨‹å›¾ï¼š

![sonar-dev-cycle](https://docs.sonarqube.org/latest/images/dev-cycle.png)

1. Developers develop and merge code in an IDE (preferably using *SonarLint* to receive immediate feedback in the editor) and check-in their code to their DevOps Platform.
2. An organizationâ€™s *continuous integration (CI)* tool checks out, builds, and runs unit tests, and an integrated SonarQube scanner analyzes the results.
3. The scanner posts the results to the SonarQube server which provides feedback to developers through the SonarQube interface, email, in-IDE notifications (through SonarLint), and decoration on pull or merge requests (when using Developer Edition and above).

## Docker

**Docker** å®¹å™¨å¹¶éè™šæ‹Ÿæœºï¼Œä½†å¯ä»¥æ¯”å–»ä¸ºæ›´è½»é‡çº§çš„è™šæ‹Ÿæœºã€‚ä½¿ç”¨è™šæ‹Ÿæœºè¿è¡Œå¤šä¸ªç›¸äº’éš”ç¦»çš„åº”ç”¨æ—¶(ä»¥ä¸‹ç¿»è¯‘[å‚è€ƒè‡ªè¿™é‡Œ](http://www.techug.com/post/comparing-virtual-machines-vs-docker-containers.html)):

![virtual-machine-architecture.jpg]( {{site.url}}/style/images/smms/virtual-machine-architecture.jpg )

* åŸºç¡€è®¾æ–½(Infrastructure) - å¯ä»¥æ˜¯ä¸ªäººç”µè„‘ï¼Œæ•°æ®ä¸­å¿ƒçš„æœåŠ¡å™¨ï¼Œæˆ–è€…æ˜¯äº‘ä¸»æœºã€‚
* ä¸»æ“ä½œç³»ç»Ÿ(Host Operating System) - è¿è¡Œçš„å¯èƒ½æ˜¯ MacOSï¼ŒWindows æˆ–è€…æŸä¸ª Linux å‘è¡Œç‰ˆã€‚
* è™šæ‹Ÿæœºç®¡ç†ç³»ç»Ÿ(Hypervisor) - åˆ©ç”¨ Hypervisor(å³ä¸Šè¿°çš„ ESXI)ï¼Œå¯ä»¥åœ¨ä¸»æ“ä½œç³»ç»Ÿä¹‹ä¸Šè¿è¡Œå¤šä¸ªä¸åŒçš„ä»æ“ä½œç³»ç»Ÿã€‚
* ä»æ“ä½œç³»ç»Ÿ(Guest Operating System) - å‡è®¾ä½ éœ€è¦è¿è¡Œ 3 ä¸ªç›¸äº’éš”ç¦»çš„åº”ç”¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨ Hypervisor å¯åŠ¨ 3 ä¸ªä»æ“ä½œç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ 3 ä¸ªè™šæ‹Ÿæœºã€‚è¿™äº›è™šæ‹Ÿæœºéƒ½éå¸¸å¤§ï¼Œä¹Ÿè®¸æœ‰ 700MBï¼Œè¿™å°±æ„å‘³ç€å®ƒä»¬å°†å ç”¨ 2.1GB çš„ç£ç›˜ç©ºé—´ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå®ƒä»¬è¿˜ä¼šæ¶ˆè€—å¾ˆå¤š CPU å’Œå†…å­˜ã€‚
* å„ç§ä¾èµ– - æ¯ä¸€ä¸ªä»æ“ä½œç³»ç»Ÿéƒ½éœ€è¦å®‰è£…è®¸å¤šä¾èµ–ã€‚å¦‚æœä½ ä½¿ç”¨ Ruby çš„è¯ï¼Œåº”è¯¥éœ€è¦å®‰è£… gemsï¼›å¦‚æœä½¿ç”¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å¦‚ Python æˆ–è€… Node.jsï¼Œéƒ½ä¼šéœ€è¦å®‰è£…å¯¹åº”çš„ä¾èµ–åº“ã€‚
* åº”ç”¨ - å®‰è£…ä¾èµ–ä¹‹åï¼Œå°±å¯ä»¥åœ¨å„ä¸ªä»æ“ä½œç³»ç»Ÿåˆ†åˆ«è¿è¡Œåº”ç”¨äº†ï¼Œè¿™æ ·å„ä¸ªåº”ç”¨å°±æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚

ä½¿ç”¨ Docker å®¹å™¨è¿è¡Œå¤šä¸ªç›¸äº’éš”ç¦»çš„åº”ç”¨æ—¶:

![docker-container.jpg]( {{site.url}}/style/images/smms/docker-container.jpg )

* åŸºç¡€è®¾æ–½(Infrastructure) - åŒä¸Š
* ä¸»æ“ä½œç³»ç»Ÿ(Host Operating System) - æ‰€æœ‰ä¸»æµçš„ Linux å‘è¡Œç‰ˆéƒ½å¯ä»¥è¿è¡Œ Dockerã€‚å¯¹äº MacOS å’Œ Windowsï¼Œä¹Ÿæœ‰ä¸€äº›åŠæ³•"è¿è¡Œ" Dockerã€‚
* Dockerå®ˆæŠ¤è¿›ç¨‹(Docker Daemon) - Docker å®ˆæŠ¤è¿›ç¨‹å–ä»£äº† Hypervisorï¼Œå®ƒæ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„åå°è¿›ç¨‹ï¼Œè´Ÿè´£ç®¡ç† Docker å®¹å™¨ã€‚
* å„ç§ä¾èµ– - å¯¹äº Dockerï¼Œåº”ç”¨çš„æ‰€æœ‰ä¾èµ–éƒ½æ‰“åŒ…åœ¨ Docker é•œåƒä¸­ï¼ŒDocker å®¹å™¨æ˜¯åŸºäº Docker é•œåƒåˆ›å»ºçš„ã€‚
* åº”ç”¨ - åº”ç”¨çš„æºä»£ç ä¸å®ƒçš„ä¾èµ–éƒ½æ‰“åŒ…åœ¨ Docker é•œåƒä¸­ï¼Œä¸åŒçš„åº”ç”¨éœ€è¦ä¸åŒçš„ Docker é•œåƒã€‚ä¸åŒçš„åº”ç”¨è¿è¡Œåœ¨ä¸åŒçš„ Docker å®¹å™¨ä¸­ï¼Œå®ƒä»¬æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚

è™šæ‹Ÿæœºå’Œ Docker çš„ä¸€äº›å¯¹æ¯”:

Docker å®ˆæŠ¤è¿›ç¨‹å¯ä»¥ç›´æ¥ä¸ä¸»æ“ä½œç³»ç»Ÿè¿›è¡Œé€šä¿¡ï¼Œä¸ºå„ä¸ª Docker å®¹å™¨åˆ†é…èµ„æºï¼›å®ƒè¿˜å¯ä»¥å°†å®¹å™¨ä¸ä¸»æ“ä½œç³»ç»Ÿéš”ç¦»ï¼Œå¹¶å°†å„ä¸ªå®¹å™¨äº’ç›¸éš”ç¦»ã€‚è™šæ‹Ÿæœºå¯åŠ¨éœ€è¦æ•°åˆ†é’Ÿï¼Œè€Œ Docker å®¹å™¨å¯ä»¥åœ¨æ•°æ¯«ç§’å†…å¯åŠ¨ã€‚ç”±äºæ²¡æœ‰è‡ƒè‚¿çš„ä»æ“ä½œç³»ç»Ÿï¼ŒDocker å¯ä»¥èŠ‚çœå¤§é‡çš„ç£ç›˜ç©ºé—´ä»¥åŠå…¶ä»–ç³»ç»Ÿèµ„æºã€‚

ä½†å¹¶ä¸æ˜¯è¯´è™šæ‹Ÿæœºå°±è¢«å–ä»£äº†ï¼Œå› ä¸ºä¸¤è€…æœ‰ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚è™šæ‹Ÿæœºæ›´æ“…é•¿äºå½»åº•éš”ç¦»æ•´ä¸ªè¿è¡Œç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œäº‘æœåŠ¡æä¾›å•†é€šå¸¸é‡‡ç”¨è™šæ‹ŸæœºæŠ€æœ¯éš”ç¦»ä¸åŒçš„ç”¨æˆ·ã€‚è€Œ Docker é€šå¸¸ç”¨äºéš”ç¦»ä¸åŒçš„åº”ç”¨ï¼Œä¾‹å¦‚å‰ç«¯ï¼Œåç«¯ä»¥åŠæ•°æ®åº“ã€‚

## ZooKeeper

[**ZooKeeper**](https://github.com/apache/zookeeper) æ˜¯å¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚å·²ç»ä½œä¸ºæ ¸å¿ƒç»„ä»¶è¢«å¹¿æ³›åº”ç”¨åœ¨å¾ˆå¤šå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒåŒ…æ‹¬ Hadoopã€Hbaseã€Stormã€Kafkaã€Dubbo ç­‰ã€‚

Zookeeper æ˜¯ä¸€ä¸ªç”±å¤šä¸ª server ç»„æˆçš„é›†ç¾¤ï¼Œä¸€ä¸ª leaderï¼Œå¤šä¸ª followerï¼ˆè¿™ä¸ªä¸åŒäºæˆ‘ä»¬å¸¸è§çš„ Master/Slave æ¨¡å¼ï¼‰ã€‚leader ä¸ºå®¢æˆ·ç«¯æœåŠ¡å™¨æä¾›è¯»å†™æœåŠ¡ï¼Œé™¤äº† leader å¤–å…¶ä»–çš„æœºå™¨åªèƒ½æä¾›è¯»æœåŠ¡ã€‚æ¯ä¸ª server ä¿å­˜ä¸€ä»½æ•°æ®å‰¯æœ¬å…¨æ•°æ®ä¸€è‡´ï¼Œåˆ†å¸ƒå¼è¯» followerï¼Œå†™ç”± leader å®æ–½æ›´æ–°è¯·æ±‚è½¬å‘ï¼Œç”± leader å®æ–½æ›´æ–°è¯·æ±‚é¡ºåºè¿›è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ª client çš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œæ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚å…¨å±€å”¯ä¸€æ•°æ®è§†å›¾ï¼Œclient æ— è®ºè¿æ¥åˆ°å“ªä¸ª serverï¼Œæ•°æ®è§†å›¾éƒ½æ˜¯ä¸€è‡´çš„å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šäº‹ä»¶èŒƒå›´å†…ï¼Œclient èƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚

![zookeeper](https://zookeeper.apache.org/doc/r3.7.0/images/zkservice.jpg)

ç”±äº ZooKeeper é›†ç¾¤é€‰ä¸¾ leader éœ€è¦éµå¾ªè¿‡åŠæœºåˆ¶ï¼šâ€œ**å­˜æ´»çš„èŠ‚ç‚¹æ•° > æ€»èŠ‚ç‚¹æ•° / 2**â€ã€‚ä¸€èˆ¬é‡‡ç”¨å¥‡æ•°ä¸ªçš„èŠ‚ç‚¹ä¸»è¦æ˜¯å‡ºäºä¸¤æ–¹é¢çš„è€ƒè™‘ï¼š

1ã€é˜²æ­¢ç”±**è„‘è£‚**é€ æˆçš„é›†ç¾¤ä¸å¯ç”¨ã€‚

é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯è„‘è£‚ï¼Ÿé›†ç¾¤çš„è„‘è£‚é€šå¸¸æ˜¯å‘ç”Ÿåœ¨èŠ‚ç‚¹ä¹‹é—´é€šä¿¡ä¸å¯è¾¾çš„æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä¼šåˆ†è£‚æˆä¸åŒçš„å°é›†ç¾¤ï¼Œå°é›†ç¾¤å„è‡ªé€‰å‡ºè‡ªå·±çš„ master èŠ‚ç‚¹ï¼Œå¯¼è‡´åŸæœ‰çš„é›†ç¾¤å‡ºç°å¤šä¸ª master èŠ‚ç‚¹çš„æƒ…å†µï¼Œè¿™å°±æ˜¯è„‘è£‚ã€‚

å‡å¦‚ ZooKeeper é›†ç¾¤æœ‰ 5 ä¸ªèŠ‚ç‚¹ï¼Œè„‘è£‚æˆäº† Aã€B ä¸¤ä¸ªå°é›†ç¾¤ï¼Œè¦ä¹ˆ (2ã€3)ï¼Œè¦ä¹ˆ (1ã€4)ï¼Œæ»¡è¶³ä¸Šè¿°çš„è¿‡åŠæœºåˆ¶ï¼›å¦‚æœé›†ç¾¤æœ‰ 4 ä¸ªèŠ‚ç‚¹ï¼Œåˆ™è¦ä¹ˆ (2ã€2)ï¼Œè¦ä¹ˆ (1ã€3)ã€‚æ˜¾ç„¶ (2ã€2) æ˜¯æ²¡åŠæ³•æä¾›æœåŠ¡çš„ã€‚å› æ­¤é’ˆå¯¹è„‘è£‚æˆ 2 ä¸ªé›†ç¾¤çš„æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨å¥‡æ•°å°æœåŠ¡å™¨ã€‚

2ã€å®¹ç¾èƒ½åŠ›çš„è§’åº¦ã€‚

```TEXT
æ ¹æ®è¿‡åŠæœºåˆ¶éªŒè¯ï¼š
1ï¼‰å‡è®¾é›†ç¾¤æœ‰ 3 å°æœåŠ¡å™¨ï¼Œ1 å° Leaderï¼Œ2 å° Followerã€‚
Leader æŒ‚æ‰ï¼Œé‚£ä¹ˆå‰©ä¸‹ 2 å°æœåŠ¡å™¨ï¼Œå³ 2>(3/2=1) æ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆå¯ä»¥é€‰ä¸¾å‡º 1 ä¸ª Leader
2ï¼‰å‡è®¾é›†ç¾¤æœ‰ 4 å°æœåŠ¡å™¨ï¼Œ1 å° Leaderï¼Œ3 å° Followerã€‚
Leader æŒ‚æ‰ï¼Œé‚£ä¹ˆå‰©ä¸‹ 3 å°æœåŠ¡å™¨ï¼Œå³ 3>(4/2=2) æ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆå¯ä»¥é€‰ä¸¾å‡º 1 ä¸ª Leader
3ï¼‰å‡è®¾é›†ç¾¤æœ‰ 4 å°æœåŠ¡å™¨ï¼Œ1 å°Leaderï¼Œ3 å° Followerã€‚
Leader å’Œä¸€å° Follower æŒ‚æ‰ï¼Œé‚£ä¹ˆå‰©ä¸‹ 2 å°æœåŠ¡å™¨ï¼Œå³ 2>(4/2=2) æ¡ä»¶ä¸æˆç«‹ï¼Œé‚£ä¹ˆä¸å¯ä»¥é€‰ä¸¾å‡º Leader
ä¾æ¬¡ç±»æ¨.......
ç»“è®º: 2n-1 å°å’Œ 2n å°æœåŠ¡å™¨å®¹ç¾èƒ½åŠ›ä¸€æ ·ï¼Œå¤§å¯ä¸å¿…å¤šèŠ±ä¸€å°æœåŠ¡å™¨éƒ¨ç½²
```

## AWS äº‘å¯¹è±¡å­˜å‚¨

éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œéœ€è¦ç®¡ç†æ€¥å‰§å¢åŠ å¹¶ä¸”å­¤ç«‹çš„å¤§é‡æ•°æ®ï¼Œè¿™äº›æ•°æ®æ¥è‡ªå¾ˆå¤šè¢«ä»»æ„æ•°é‡çš„åº”ç”¨ç¨‹åºå’Œä¸šåŠ¡æµç¨‹ä½¿ç”¨çš„æ¥æºã€‚ç°åœ¨ï¼Œå¾ˆå¤šå…¬å¸éƒ½é¢ä¸´ç€ç¢ç‰‡åŒ–å­˜å‚¨äº§å“å¸¦æ¥çš„æŒ‘æˆ˜ã€‚è¿™äº›äº§å“ä¸ä»…å¢åŠ äº†ä¸šåŠ¡åº”ç”¨ç¨‹åºçš„å¤æ‚æ€§ï¼Œè¿˜å‡ç¼“äº†å…¶åˆ›æ–°é€Ÿåº¦ã€‚å¯¹è±¡å­˜å‚¨èƒ½å¤Ÿæä¾›å¯ä»¥å¤§è§„æ¨¡æ‰©å±•å¹¶ä¸”ç»æµé«˜æ•ˆçš„å­˜å‚¨æ¥ä»¥åŸç”Ÿæ ¼å¼å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œä»è€Œæ‰“ç ´è¿™äº›é™åˆ¶ã€‚

**AWS(Amazon Web Services)** æ˜¯ Amazon å…¬å¸æ——ä¸‹äº‘è®¡ç®—æœåŠ¡å¹³å°ï¼Œä¸ºå…¨ä¸–ç•ŒèŒƒå›´å†…çš„å®¢æˆ·æä¾›äº‘è§£å†³æ–¹æ¡ˆã€‚é¢å‘ç”¨æˆ·æä¾›åŒ…æ‹¬å¼¹æ€§è®¡ç®—ã€å­˜å‚¨ã€æ•°æ®åº“ã€åº”ç”¨ç¨‹åºåœ¨å†…çš„ä¸€æ•´å¥—äº‘è®¡ç®—æœåŠ¡ï¼Œå¸®åŠ©ä¼ä¸šé™ä½ IT æŠ•å…¥æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ã€‚åŒç±»å‹çš„è¿˜å¯ä»¥äº†è§£ä¸‹ [Azure](https://zh.wikipedia.org/wiki/Microsoft_Azure)ã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ã€‚

## ç«¯å£æ˜ å°„å’Œ DMZ ä¸»æœº

**ç«¯å£æ˜ å°„**æ˜¯ [**ç½‘ç»œåœ°å€è½¬æ¢(NAT)**](https://zh.wikipedia.org/wiki/ç½‘ç»œåœ°å€è½¬æ¢) çš„ä¸€ç§ï¼Œå°±æ˜¯å°†å¤–ç½‘ä¸»æœºçš„ IP åœ°å€çš„ä¸€ä¸ªç«¯å£æ˜ å°„åˆ°å†…ç½‘ä¸­ä¸€å°æœºå™¨ï¼Œæä¾›ç›¸åº”çš„æœåŠ¡ã€‚å½“ç”¨æˆ·è®¿é—®è¯¥ IP çš„è¿™ä¸ªç«¯å£æ—¶ï¼ŒæœåŠ¡å™¨è‡ªåŠ¨å°†è¯·æ±‚æ˜ å°„åˆ°å¯¹åº”å±€åŸŸç½‘å†…éƒ¨çš„æœºå™¨ä¸Šã€‚ç«¯å£æ˜ å°„æœ‰åŠ¨æ€å’Œé™æ€ä¹‹åˆ†ã€‚

å†…ç½‘çš„ä¸€å°ç”µè„‘è¦ä¸Šå› ç‰¹ç½‘æˆ–è€…ç»™å› ç‰¹ç½‘å¯åŠ¨æœåŠ¡ï¼Œå°±éœ€è¦ç«¯å£æ˜ å°„ã€‚ä¾‹å¦‚è¦æ˜ å°„ä¸€å° IP åœ°å€ä¸º 192.168.111.10 çš„ WEB æœåŠ¡å™¨ï¼Œåªéœ€æŠŠæœåŠ¡å™¨çš„ IP åœ°å€å’Œæä¾› web æœåŠ¡çš„ TCP ç«¯å£ 80 å¡«å…¥åˆ°è·¯ç”±å™¨çš„ç«¯å£æ˜ å°„è¡¨ä¸­å³å¯ã€‚

**DMZ(demilitarized zone)** ï¼Œå³"éš”ç¦»åŒº"æˆ–"éå†›äº‹åŒ–åŒº"ã€‚å®ƒæ˜¯ä¸ºäº†è§£å†³å®‰è£…é˜²ç«å¢™åå¤–éƒ¨ç½‘ç»œä¸èƒ½è®¿é—®å†…éƒ¨ç½‘ç»œæœåŠ¡å™¨çš„é—®é¢˜ï¼Œè€Œè®¾ç«‹çš„ä¸€ä¸ªéå®‰å…¨ç³»ç»Ÿä¸å®‰å…¨ç³»ç»Ÿä¹‹é—´çš„ç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºä½äºä¼ä¸šå†…éƒ¨ç½‘ç»œå’Œå¤–éƒ¨ç½‘ç»œä¹‹é—´çš„å°ç½‘ç»œåŒºåŸŸå†…ï¼Œåœ¨è¿™ä¸ªå°ç½‘ç»œåŒºåŸŸå†…å¯ä»¥æ”¾ç½®ä¸€äº›å¿…é¡»å…¬å¼€çš„æœåŠ¡å™¨è®¾æ–½ï¼Œå¦‚ä¼ä¸š Web æœåŠ¡å™¨ã€FTP æœåŠ¡å™¨å’Œè®ºå›ç­‰ã€‚å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡è¿™æ ·ä¸€ä¸ª DMZ åŒºåŸŸï¼Œæ›´åŠ æœ‰æ•ˆåœ°ä¿æŠ¤äº†å†…éƒ¨ç½‘ç»œï¼Œå› ä¸ºè¿™ç§ç½‘ç»œéƒ¨ç½²ï¼Œæ¯”èµ·ä¸€èˆ¬çš„é˜²ç«å¢™æ–¹æ¡ˆï¼Œå¯¹æ”»å‡»è€…æ¥è¯´åˆå¤šäº†ä¸€é“å…³å¡ã€‚ DMZ ä¸»æœºå°±æ˜¯ä¸€ä¸ªå¼€æ”¾æ‰€æœ‰ç«¯å£çš„è™šæ‹ŸæœåŠ¡å™¨ã€‚

> ç«¯å£æ˜ å°„åªæ˜¯æ˜ å°„æŒ‡å®šçš„ç«¯å£ï¼ŒDMZ ç›¸å½“äºæ˜ å°„æ‰€æœ‰çš„ç«¯å£ï¼Œå¹¶ä¸”ç›´æ¥æŠŠä¸»æœºæš´éœ²åœ¨ç½‘å…³ä¸­ï¼Œæ¯”ç«¯å£æ˜ å°„æ–¹ä¾¿ä½†æ˜¯ä¸å®‰å…¨ã€‚ä¸”å½“è®¾ç½®äº† DMZ ä¸»æœºåï¼Œæ‰€æœ‰ç«¯å£çš„æ˜ å°„éƒ½å°†æŒ‡å‘ DMZ ä¸»æœºï¼ŒæŒ‡å‘å…¶ä»–ç”µè„‘çš„ç«¯å£æ˜ å°„å°†æ— æ•ˆã€‚

## å…¨é“¾è·¯å‹æµ‹

### å‹æµ‹æŒ‡æ ‡åŠå·¥å…·

**å…¨é“¾è·¯å‹æµ‹**æ˜¯åŸºäºçº¿ä¸ŠçœŸå®ç¯å¢ƒå’Œå®é™…ä¸šåŠ¡åœºæ™¯ï¼Œé€šè¿‡æ¨¡æ‹Ÿæµ·é‡çš„ç”¨æˆ·è¯·æ±‚ï¼Œæ¥å¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚ç›¸å¯¹äºæ¯”è¾ƒç®€å•çš„å‹æµ‹ï¼Œæ¯”å¦‚åªå¯¹çº¿ä¸Šçš„å•æœºæˆ–é›†ç¾¤å‘èµ·æœåŠ¡è°ƒç”¨ï¼›å°†çº¿ä¸Šæµé‡è¿›è¡Œå½•åˆ¶ï¼Œç„¶ååœ¨å•å°æœºå™¨ä¸Šè¿›è¡Œå›æ”¾ç­‰ã€‚èƒ½å¤Ÿæ›´å…¨é¢åœ°è¿›è¡Œé“¾è·¯è¦†ç›–ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„ä¸€äº›æŒ‡æ ‡ï¼š

| æŒ‡æ ‡        |   æè¿°   |
| ------------ | ------- |
| **qps**(query per second) | æ¯ç§’å¤„ç†è¯·æ±‚æ•° |
| **tps**(transactions per second) | æ¯ç§’å¤„ç†çš„äº‹åŠ¡ |
| **hps**(hits per second) | æ¯ç§’ç‚¹å‡»æ¬¡æ•° |
| **rt**(response time) | å“åº”æ—¶é—´ï¼Œç›¸å½“äº latency |
| CPU ä½¿ç”¨ç‡ | å‡ºäºèŠ‚ç‚¹å®•æœºåè´Ÿè½½å‡è¡¡çš„è€ƒè™‘ï¼Œä¸€èˆ¬ CPU ä½¿ç”¨ç‡å°äº 75% æ¯”è¾ƒåˆé€‚ |
| å†…å­˜ä½¿ç”¨ç‡ | å†…å­˜å ç”¨æƒ…å†µï¼Œä¸€èˆ¬è§‚å¯Ÿå†…å­˜æ˜¯å¦æœ‰å°–åˆºæˆ–æ³„éœ² |
| ç¼“å­˜å‘½ä¸­ç‡ | å¤šå°‘æµé‡èƒ½å‘½ä¸­ç¼“å­˜å±‚ï¼ˆredisã€memcached ç­‰ï¼‰ |

> tps ä¸€ä¸ªå®Œæ•´äº‹åŠ¡å¯èƒ½åŒ…å«ä¸€äº›åˆ—çš„è¯·æ±‚è¿‡ç¨‹ã€‚æ¯”å¦‚è®¿é—®ä¸€ä¸ªç½‘é¡µï¼Œå¯ä»¥å½“åšä¸€ä¸ªäº‹åŠ¡ï¼Œä½†æ˜¯è®¿é—®ä¸€ä¸ªç½‘é¡µå¯èƒ½ä¼šå¯¹å¤šä¸ªæœåŠ¡å™¨å‘èµ·å¤šæ¬¡è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚ä¼šå½“åšå¤šæ¬¡ qps è®¡ç®—åœ¨å†…ã€‚

> ä¸€èˆ¬æƒ…å†µä¸‹ç”¨ tps æ¥è¡¡é‡æ•´ä¸ªä¸šåŠ¡æµç¨‹ï¼Œç”¨ qps æ¥è¡¡é‡æ¥å£æŸ¥è¯¢æ¬¡æ•°ï¼Œç”¨ hps æ¥è¡¨ç¤ºå¯¹æœåŠ¡å™¨å•å‡»è¯·æ±‚ã€‚

å‹æµ‹å·¥å…·çš„é€‰æ‹©ä¹Ÿæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ [**Apache ab**](https://httpd.apache.org/docs/2.4/programs/ab.html)ã€[**Apache JMeter**](https://jmeter.apache.org)ã€[**locust**](https://locust.io) ç­‰ã€‚ä¹Ÿæœ‰ä¸€äº›è½»é‡çº§çš„å·¥å…·ï¼Œå¦‚ [**wrk**](https://github.com/wg/wrk) ç­‰ï¼Œæˆ‘ä»¬ç®€å•çœ‹ä¸‹ wrk çš„è¾“å‡ºï¼š

```shell
# This runs a benchmark for 30 seconds, using 12 threads, and keeping 400 HTTP connections open.
$ wrk -t12 -c400 -d30s http://127.0.0.1:8080/index.html

Running 30s test @ http://127.0.0.1:8080/index.html
  12 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   635.91us    0.89ms  12.92ms   93.69%
    Req/Sec    56.20k     8.07k   62.00k    86.54%
  22464657 requests in 30.00s, 17.76GB read
Requests/sec: 748868.53
Transfer/sec:    606.33MB
```

### æµé‡å½•åˆ¶åŠå›æ”¾

ä¸€èˆ¬é’ˆå¯¹æ¯”è¾ƒå¤§å‹çš„é¡¹ç›®ï¼Œå®¹æ˜“å‡ºç°æ¼æµ‹æˆ–è€…æœ‰å¾ˆå¤šæ²¡è¯„ä¼°åˆ°çš„åœ°æ–¹ï¼Œå¦‚æœç”¨çº¿ä¸Šæµé‡åšä¸€æ¬¡å›å½’æµ‹è¯•ï¼Œå¯ä»¥è¿›ä¸€æ­¥å‡å°‘ bug çš„é£é™©ï¼ŒåŒæ—¶å¤§å¤§èŠ‚çœæ„é€ æµ‹è¯•æ•°æ®çš„æ—¶é—´ï¼Œæé«˜æµ‹è¯•æ•ˆç‡ã€‚

![stress-testing]( {{site.url}}/style/images/smms/stress-testing.png )

> ä¸€èˆ¬æµé‡å›æ”¾åªå›æ”¾ get è¯·æ±‚ï¼Œå› ä¸ºå…¶ä»–è¯·æ±‚å¯èƒ½ä¼šå¯¹ç”¨æˆ·æ•°æ®è¿›è¡Œæ“ä½œï¼Œæœ‰é£é™©éœ€è¦æ’é™¤æ‰ã€‚

## API ç½‘å…³

### ç½‘å…³çš„ä½œç”¨

[æ‘˜è‡ªçŸ¥ä¹](https://www.zhihu.com/question/309582197/answer/2077037990)ã€‚å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç”µå•†ç½‘ç«™ï¼Œé‚£ä¹ˆè¿™é‡Œä¼šæ¶‰åŠåˆ°å¾ˆå¤šåç«¯çš„å¾®æœåŠ¡ï¼Œæ¯”å¦‚ä¼šå‘˜ã€å•†å“ã€æ¨èæœåŠ¡ç­‰ç­‰ã€‚é‚£ä¹ˆè¿™é‡Œå°±ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼ŒAPP/Browser æ€ä¹ˆå»è®¿é—®è¿™äº›åç«¯çš„æœåŠ¡? å¦‚æœä¸šåŠ¡æ¯”è¾ƒç®€å•çš„è¯ï¼Œå¯ä»¥ç»™æ¯ä¸ªä¸šåŠ¡éƒ½åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„åŸŸå(https://service.api.company.com)ï¼Œä½†è¿™ç§æ–¹å¼ä¼šæœ‰å‡ ä¸ªé—®é¢˜:

1. æ¯ä¸ªä¸šåŠ¡éƒ½ä¼šéœ€è¦é‰´æƒã€é™æµã€æƒé™æ ¡éªŒç­‰é€»è¾‘ï¼Œéœ€è¦è¿›è¡Œå‰¥ç¦»
2. æ¯”å¦‚æ·˜å®ã€äºšé©¬é€Šæ‰“å¼€ä¸€ä¸ªé¡µé¢å¯èƒ½ä¼šæ¶‰åŠåˆ°æ•°ç™¾ä¸ªå¾®æœåŠ¡ååŒå·¥ä½œï¼Œå¦‚æœæ¯ä¸€ä¸ªå¾®æœåŠ¡éƒ½åˆ†é…ä¸€ä¸ªåŸŸåçš„è¯ï¼Œä¸€æ–¹é¢å®¢æˆ·ç«¯ä»£ç ä¼šå¾ˆéš¾ç»´æŠ¤ï¼Œå¦ä¸€æ–¹é¢æ˜¯è¿æ¥æ•°çš„ç“¶é¢ˆã€‚è€Œä¸”æ¯ä¸Šçº¿ä¸€ä¸ªæ–°çš„æœåŠ¡ï¼Œéƒ½éœ€è¦è¿ç»´å‚ä¸ï¼Œç”³è¯·åŸŸåã€é…ç½® Nginx ç­‰ï¼Œå½“ä¸Šçº¿ã€ä¸‹çº¿æœåŠ¡å™¨æ—¶ï¼ŒåŒæ ·ä¹Ÿéœ€è¦è¿ç»´å‚ä¸ï¼Œå¦å¤–é‡‡ç”¨åŸŸåè¿™ç§æ–¹å¼ï¼Œå¯¹äºç¯å¢ƒçš„éš”ç¦»ä¹Ÿä¸å¤ªå‹å¥½ï¼Œè°ƒç”¨è€…éœ€è¦æ ¹æ®åŸŸåè‡ªå·±è¿›è¡Œåˆ¤æ–­ã€‚
3. åç«¯æ¯ä¸ªå¾®æœåŠ¡å¯èƒ½æ˜¯ç”±ä¸åŒè¯­è¨€ç¼–å†™çš„ã€é‡‡ç”¨äº†ä¸åŒçš„åè®®ï¼Œæ¯”å¦‚ HTTPã€Dubboã€GRPC ç­‰ï¼Œä½†æ˜¯ä½ ä¸å¯èƒ½è¦æ±‚å®¢æˆ·ç«¯å»é€‚é…è¿™ä¹ˆå¤šç§åè®®ï¼Œè¿™æ˜¯ä¸€é¡¹éå¸¸æœ‰æŒ‘æˆ˜çš„å·¥ä½œï¼Œé¡¹ç›®ä¼šå˜çš„éå¸¸å¤æ‚ä¸”å¾ˆéš¾ç»´æŠ¤ã€‚åæœŸå¦‚æœéœ€è¦å¯¹å¾®æœåŠ¡è¿›è¡Œé‡æ„çš„è¯ï¼Œä¹Ÿä¼šå˜çš„éå¸¸éº»çƒ¦ï¼Œéœ€è¦å®¢æˆ·ç«¯é…åˆä½ ä¸€èµ·è¿›è¡Œæ”¹é€ ï¼Œæ¯”å¦‚å•†å“æœåŠ¡ï¼Œéšç€ä¸šåŠ¡å˜çš„è¶Šæ¥è¶Šå¤æ‚ï¼ŒåæœŸéœ€è¦è¿›è¡Œæ‹†åˆ†æˆå¤šä¸ªå¾®æœåŠ¡ï¼Œè¿™ä¸ªæ—¶å€™å¯¹å¤–æä¾›çš„æœåŠ¡ä¹Ÿéœ€è¦æ‹†åˆ†æˆå¤šä¸ªï¼ŒåŒæ—¶éœ€è¦å®¢æˆ·ç«¯é…åˆä½ è¿›è¡Œæ”¹é€ ï¼Œéå¸¸è›‹ç–¼ã€‚

![api gateway](https://pic1.zhimg.com/80/v2-0903a05306217b52effca6ebb80b45ea_1440w.jpg?source=1940ef5c)

å› æ­¤å¯ä»¥å®ç°ä¸€ä¸ª **API ç½‘å…³(API Gateway)**æ¥ç®¡æ‰€æœ‰çš„å…¥å£æµé‡ï¼Œç±»ä¼¼ Nginx çš„ä½œç”¨ï¼Œå°†æ‰€æœ‰ç”¨æˆ·çš„è¯·æ±‚è½¬å‘ç»™åç«¯çš„æœåŠ¡å™¨ï¼Œä½†ç½‘å…³åšçš„ä¸ä»…ä»…åªæ˜¯ç®€å•çš„è½¬å‘ï¼Œä¹Ÿä¼šé’ˆå¯¹æµé‡åšä¸€äº›æ‰©å±•ï¼Œæ¯”å¦‚é‰´æƒã€é™æµã€æƒé™ã€ç†”æ–­ã€åè®®è½¬æ¢ã€é”™è¯¯ç ç»Ÿä¸€ã€ç¼“å­˜ã€æ—¥å¿—ã€ç›‘æ§ã€å‘Šè­¦ç­‰ï¼Œè¿™æ ·å°†é€šç”¨çš„é€»è¾‘æŠ½å‡ºæ¥ï¼Œç”±ç½‘å…³ç»Ÿä¸€å»åšï¼Œä¸šåŠ¡æ–¹ä¹Ÿèƒ½å¤Ÿæ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œæå‡è¿­ä»£çš„æ•ˆç‡ã€‚é€šè¿‡å¼•å…¥ API ç½‘å…³ï¼Œå®¢æˆ·ç«¯åªéœ€è¦ä¸ API ç½‘å…³äº¤äº’ï¼Œè€Œä¸ç”¨ä¸å„ä¸ªä¸šåŠ¡æ–¹çš„æ¥å£åˆ†åˆ«é€šè®¯ã€‚

æœåŠ¡è°ƒç”¨æ–¹ï¼ˆå†…éƒ¨å’Œå¤–éƒ¨ï¼‰åŒæ—¶é€šè¿‡ nginx å’Œ API ç½‘å…³è®¿é—®æœåŠ¡æä¾›æ–¹ç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![api-gateway-consul-nginx]( {{site.url}}/style/images/smms/api-gateway-consul-nginx.png )

è°ƒç”¨æ–¹åˆ°æä¾›æ–¹ç»è¿‡ API ç½‘å…³çš„æ•´ä¸ªé“¾è·¯çš„å„ä¸ªç¯èŠ‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![api-gateway-consul]( {{site.url}}/style/images/smms/api-gateway-consul.png )

### consul æœåŠ¡å‘ç°

[å‚è€ƒè¿™é‡Œ](https://cloud.tencent.com/developer/article/1444664)ã€‚å¾®æœåŠ¡çš„æ¡†æ¶ä½“ç³»ä¸­ï¼Œ**æœåŠ¡å‘ç°**æ˜¯ä¸èƒ½ä¸æçš„ä¸€ä¸ªæ¨¡å—ã€‚æˆ‘ä»¬çœ‹çœ‹ä»¥å‰çš„æ–¹æ¡ˆã€‚å®¢æˆ·ç«¯çš„ä¸€ä¸ªæ¥å£ï¼Œéœ€è¦è°ƒç”¨æœåŠ¡ A-Nã€‚å®¢æˆ·ç«¯å¿…é¡»è¦çŸ¥é“æ‰€æœ‰æœåŠ¡çš„ç½‘ç»œä½ç½®çš„ï¼Œä»¥å¾€çš„åšæ³•æ˜¯é…ç½®æ˜¯é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ–è€…æœ‰äº›é…ç½®åœ¨æ•°æ®åº“ä¸­ã€‚è¿™é‡Œå°±å¸¦å‡ºå‡ ä¸ªé—®é¢˜ï¼š

1. éœ€è¦é…ç½® N ä¸ªæœåŠ¡çš„ç½‘ç»œä½ç½®ï¼ŒåŠ å¤§é…ç½®çš„å¤æ‚æ€§
2. æœåŠ¡çš„ç½‘ç»œä½ç½®å˜åŒ–ï¼Œéƒ½éœ€è¦æ”¹å˜æ¯ä¸ªè°ƒç”¨è€…çš„é…ç½®
3. é›†ç¾¤çš„æƒ…å†µä¸‹ï¼Œéš¾ä»¥åšè´Ÿè½½ï¼ˆåå‘ä»£ç†çš„æ–¹å¼é™¤å¤–ï¼‰

![consul-before]( {{site.url}}/style/images/smms/consul-before.png )

æˆ‘ä»¬å†å¯¹æ¯”ä¸‹åŠ äº†æœåŠ¡å‘ç°çš„æ•ˆæœã€‚æœåŠ¡ A-N æŠŠå½“å‰è‡ªå·±çš„ç½‘ç»œä½ç½®æ³¨å†Œåˆ°æœåŠ¡å‘ç°æ¨¡å—ï¼ŒæœåŠ¡å‘ç°å°±ä»¥ K-V çš„æ–¹å¼è®°å½•ä¸‹ï¼ŒK ä¸€èˆ¬æ˜¯æœåŠ¡åï¼ŒV å°±æ˜¯ IP:PORTã€‚æœåŠ¡å‘ç°æ¨¡å—ä¼šå®šæ—¶è½®è¯¢æŸ¥çœ‹è¿™äº›æœåŠ¡æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è®¿é—®ï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚å®¢æˆ·ç«¯åœ¨è°ƒç”¨æœåŠ¡ A-N çš„æ—¶å€™ï¼Œå°±è·‘å»æœåŠ¡å‘ç°æ¨¡å—é—®ä¸‹å®ƒä»¬çš„ç½‘ç»œä½ç½®ï¼Œç„¶åå†è°ƒç”¨å®ƒä»¬çš„æœåŠ¡ã€‚å®¢æˆ·ç«¯å®Œå…¨ä¸éœ€è¦è®°å½•è¿™äº›æœåŠ¡ç½‘ç»œä½ç½®ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å®Œå…¨è§£è€¦ï¼

![consul-after]( {{site.url}}/style/images/smms/consul-after.png )

> åšæœåŠ¡å‘ç°çš„æ¡†æ¶é™¤äº† consul å¤–ï¼Œå¸¸ç”¨çš„è¿˜æœ‰ zookeeperã€eurekaã€etcd ç­‰ã€‚

ä»¥ä¸‹æ˜¯ consul çš„ ui ç•Œé¢ï¼š

![consul-ui](https://learn.hashicorp.com/img/consul/1.9/ui-services.png)

## å¼€æºè®¸å¯è¯å¯¹æ¯”

![mit]( {{site.url}}/style/images/smms/mit.jpg )

## å‚è€ƒé“¾æ¥

1. [Comparing Virtual Machines vs Docker Containers](https://nickjanetakis.com/blog/comparing-virtual-machines-vs-docker-containers) By Nick Janetakis
2. [ç«¯å£æ˜ å°„å’Œ dmz](https://blog.csdn.net/shaochat/article/details/40583937) By å¾å¿ƒå®‰å¤„æ–¹æ˜¯å®¶
3. [å½•åˆ¶çº¿ä¸Šæµé‡åšå›å½’æµ‹è¯•çš„æ­£ç¡®æ‰“å¼€æ–¹å¼](https://testerhome.com/topics/25641) By å°‘å¹´
4. [å¼€æ”¾åˆ†å¸ƒå¼è¿½è¸ªï¼ˆOpenTracingï¼‰å…¥é—¨ä¸ Jaeger å®ç°](https://developer.aliyun.com/article/514488) By å´æ³¢bruce_wu
