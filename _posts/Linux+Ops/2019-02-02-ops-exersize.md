---
layout: blog
front: true
comments: True
flag: Ops
background: gray
category: åç«¯
title: è®°ä¸€äº›è¿ç»´å®è·µ
date:   2019-02-02 17:54:00 GMT+0800 (CST)
update: 2021-10-28 20:59:00 GMT+0800 (CST)
background-image: /style/images/smms/linux.jpg
tags:
- Ops
---
# {{ page.title }}

åˆšå·¥ä½œæ—¶å€™ï¼Œæœ‰ä¸ªå¤§å­¦ç”Ÿä¼˜é€‰åŸ¹è®­è®¡åˆ’ï¼Œå½“æ—¶å¯¼å¸ˆæ˜¯è¿ç»´è€å¸æœºï¼Œæ‰€ä»¥è·Ÿéšç€ä»–æ£é¼“äº†ä¸€äº›è¿ç»´æ–¹é¢çš„é—®é¢˜ï¼Œæƒ³æƒ³ä¹Ÿéƒ½æ˜¯å‡ å¹´å‰çš„äº‹äº†ï¼Œä»¥ä¸‹è¿™äº›å®è·µéƒ½æ˜¯ä»å°è±¡ç¬”è®°è¿ç§»è¿‡æ¥çš„ï¼Œå°±å½“ç•™ä½œä¸ªçºªå¿µå§ ~

## Oracle 11g å®‰è£…

ä»€ä¹ˆï¼Ÿå®‰è£…ä¹Ÿè¦æ¬è¿›æ¥å—ï¼Ÿæ˜¯çš„ï¼ŒOracle çš„å®‰è£…ç»ä¸ç®€å•ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ä»¥å­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œå…³é”®ç‚¹åœ¨äºæ€ä¹ˆå»æœç´¢å’Œæ’é”™ã€‚

Oracle å…·ä½“å®‰è£…æ­¥éª¤å¯ä»¥[å‚ç…§æ–‡æ¡£](/style/files/Oracle11gInstallation.pdf) ğŸ‘ˆ

åŒæ—¶ä¹Ÿè®°å½•ä¸‹æ¥æ“ä½œè¿‡ç¨‹ä¸­çš„[ä¸€äº›å‘½ä»¤](/style/files/oracleInstallation.txt) ğŸ‘ˆ

## ESXI è™šæ‹ŸåŒ–å¹³å°

**è™šæ‹ŸåŒ–**ï¼Œç®€å•è®²ï¼Œå°±æ˜¯å¯ä»¥å®ç°å°†ä¸€å°è®¡ç®—æœºè™šæ‹ŸåŒ–ä¸ºè‹¥å¹²å°é€»è¾‘è®¡ç®—æœºï¼Œæ¯ä¸ªé€»è¾‘è®¡ç®—æœºèƒ½è¿è¡Œä¸åŒæ“ä½œç³»ç»Ÿè€Œäº’ä¸å¹²æ‰°ï¼Œèƒ½è¾ƒå¤§æé«˜èµ„æºåˆ©ç”¨ç‡ã€‚é€šè¿‡è™šæ‹ŸåŒ–å¹³å°çš„æ­å»ºï¼Œå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯å¯¹ä¸åŒæœåŠ¡å™¨ç»Ÿä¸€çš„ç®¡ç†ï¼Œå®ç°åŠ¨æ€èµ„æºè°ƒåº¦ã€å®‰å…¨éƒ¨ç½²å’Œå®æ—¶åŠ¨æ€ç›‘æ§ç­‰åŠŸèƒ½ã€‚

**ESXI** ä¸“ä¸ºè¿è¡Œè™šæ‹Ÿæœºã€æœ€å¤§é™åº¦é™ä½é…ç½®è¦æ±‚å’Œç®€åŒ–éƒ¨ç½²è€Œè®¾è®¡ï¼Œå…¶æœ¬èº«ç±»ä¼¼äºä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œå¯å®‰è£…è‡³è™šæ‹Ÿæœºï¼Œå®‰è£…æ­¥éª¤å¯ä»¥[å‚ç…§æ–‡æ¡£](/style/files/esxi.pdf) ğŸ‘ˆ

é‡Œé¢è¿˜æ¶‰åŠåˆ° **Vmware vSphere Client** å’Œ **vCenter** çš„æ¦‚å¿µï¼Œè€Œ **VMware vSphere Hypervisor** ä¹Ÿå°±æ˜¯æŒ‡çš„ EXSIï¼Œåªæ˜¯ä¸åŒçš„å«æ³•è€Œå·²ã€‚

## FTP æœåŠ¡å™¨

**FTP**(File Transfer Protocol Server) æœåŠ¡å™¨æ˜¯ä¾ç…§ FTP åè®®æä¾›æœåŠ¡ï¼Œåœ¨äº’è”ç½‘ä¸Šæä¾›æ–‡ä»¶å­˜å‚¨å’Œè®¿é—®æœåŠ¡çš„è®¡ç®—æœºã€‚å‚è€ƒè¿™é‡Œå¯ä»¥äº†è§£åˆ°å¦‚ä½•åœ¨ Linux å’Œ window server 2008 R2 ç³»ç»Ÿä¸‹è¿›è¡Œ [FTP æœåŠ¡å™¨çš„æ­å»º](/style/files/ftp.pdf) ğŸ‘ˆ

## æ–‡ä»¶æœåŠ¡å™¨

åœ¨å±€åŸŸç½‘ä¸­ï¼Œä»¥æ–‡ä»¶æ•°æ®å…±äº«ä¸ºç›®æ ‡ï¼Œéœ€è¦å°†ä¾›å¤šå°è®¡ç®—æœºå…±äº«çš„æ–‡ä»¶å­˜æ”¾äºä¸€å°è®¡ç®—æœºä¸­ã€‚è¿™å°è®¡ç®—æœºå°±è¢«ç§°ä¸º**æ–‡ä»¶æœåŠ¡å™¨**ã€‚å‚è€ƒè¿™é‡Œå¯ä»¥äº†è§£åˆ°å¦‚ä½•åœ¨ Linux å’Œ window server 2008 R2 ç³»ç»Ÿä¸‹è¿›è¡Œ[æ–‡ä»¶æœåŠ¡å™¨çš„æ­å»º](/style/files/fileServer.pdf) ğŸ‘ˆ

## æ•°æ®ä»“åº“åŠ ODS

**æ•°æ®ä»“åº“**(Data Warehouse)ï¼šæ˜¯ä¸€ä¸ªé¢å‘ä¸»é¢˜çš„(Subject Oriented)ã€é›†æˆçš„(Integrated)ã€ç›¸å¯¹ç¨³å®šçš„(Non-Volatile)ã€åæ˜ å†å²å˜åŒ–(Time Variant)çš„æ•°æ®é›†åˆï¼Œç”¨äºæ”¯æŒç®¡ç†å†³ç­–(Decision Making Support)ã€‚

**ODS**(Operational Data Store)ï¼šæ˜¯ä¸€ä¸ªé¢å‘ä¸»é¢˜çš„ã€é›†æˆçš„ã€å¯å˜çš„ã€å½“å‰çš„ç»†èŠ‚æ•°æ®é›†åˆï¼Œç”¨äºæ”¯æŒä¼ä¸šå¯¹äºå³æ—¶æ€§çš„ã€æ“ä½œæ€§çš„ã€é›†æˆçš„å…¨ä½“ä¿¡æ¯çš„éœ€æ±‚ã€‚

> ODS æ˜¯çŸ­æœŸçš„å®æ—¶çš„æ•°æ®ï¼Œä¾›äº§å“æˆ–è€…è¿è¥äººå‘˜æ—¥å¸¸ä½¿ç”¨ï¼Œè€Œæ•°æ®ä»“åº“æ˜¯ä¾›æˆ˜ç•¥å†³ç­–ä½¿ç”¨çš„æ•°æ®ï¼›å‰è€…æ˜¯å¯ä»¥æ›´æ–°çš„æ•°æ®ï¼Œæ•°æ®ä»“åº“æ˜¯åŸºæœ¬ä¸æ›´æ–°çš„ååº”å†å²å˜åŒ–çš„æ•°æ®

ä¸¤è€…å¹¶å­˜çš„å…¶ä¸­ä¸€ç§æ–¹æ¡ˆ:

![ods.png]( {{site.url}}/style/images/smms/ods.png )

**ETL** åˆ†åˆ«æ˜¯`Extract`ã€`Transform`ã€`Load`ä¸‰ä¸ªå•è¯çš„é¦–å­—æ¯ç¼©å†™ï¼Œå³"æŠ½å–"ã€"è½¬æ¢"ã€"è£…è½½"ï¼Œç”±äºä¸åŒåŸå§‹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ¥æºã€æ ¼å¼ä¸ä¸€æ ·ï¼Œå¯¼è‡´äº†ç³»ç»Ÿå®æ–½ã€æ•°æ®æ•´åˆå‡ºç°é—®é¢˜ï¼ŒETL å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸€é—®é¢˜çš„ã€‚ETL åŒ…å«äº†ä¸‰æ–¹é¢:

* æŠ½å– - å°†æ•°æ®ä»å„ç§åŸå§‹çš„ä¸šåŠ¡ç³»ç»Ÿä¸­è¯»å–å‡ºæ¥ï¼Œè¿™æ˜¯æ‰€æœ‰å·¥ä½œçš„å‰æ
* è½¬æ¢ - æŒ‰ç…§é¢„å…ˆè®¾è®¡å¥½çš„è§„åˆ™å°†æŠ½å–å¾—æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œä½¿æœ¬æ¥å¼‚æ„çš„æ•°æ®æ ¼å¼èƒ½ç»Ÿä¸€èµ·æ¥
* è£…è½½ - å°†è½¬æ¢å®Œçš„æ•°æ®æŒ‰è®¡åˆ’å¢é‡æˆ–å…¨éƒ¨å¯¼å…¥åˆ°æ•°æ®ä»“åº“ä¸­

## Elasticsearch

### å…¨æ–‡æ£€ç´¢

[**Elasticsearch**](https://github.com/elastic/elasticsearch) æ˜¯ä¸€ä¸ªå®æ—¶çš„åˆ†å¸ƒå¼æœç´¢åˆ†æå¼•æ“ï¼Œåº•å±‚æ˜¯å¼€æºåº“ Apache Luceneã€‚å®ƒå±è”½äº† Lucene å„ç§å¤æ‚çš„è®¾ç½®ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†å¾ˆå‹å¥½çš„ä¾¿åˆ©ï¼Œå¾ˆå¤šä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä¹Ÿæä¾›å…¨æ–‡æ£€ç´¢ï¼Œæœ‰çš„æ˜¯åŸºäº Lucene å†…åµŒï¼Œæœ‰çš„æ˜¯åŸºäºè‡ªç ”ï¼Œä¸ Elasticsearch æ¯”è¾ƒèµ·æ¥ï¼ŒåŠŸèƒ½å•ä¸€ï¼Œæ€§èƒ½ä¹Ÿè¡¨ç°ä¸æ˜¯å¾ˆå¥½ï¼Œæ‰©å±•æ€§å‡ ä¹æ²¡æœ‰ã€‚ES èƒ½è®©ä½ ä»¥å‰æ‰€æœªæœ‰çš„é€Ÿåº¦å’Œè§„æ¨¡ï¼Œå»æ¢ç´¢ä½ çš„æ•°æ®ã€‚å®ƒè¢«ç”¨ä½œ**å…¨æ–‡æ£€ç´¢**ã€ç»“æ„åŒ–æœç´¢ã€åˆ†æä»¥åŠè¿™ä¸‰ä¸ªåŠŸèƒ½çš„ç»„åˆã€‚GitHub ä¹Ÿæ˜¯ä½¿ç”¨ Elasticsearch å¯¹æµ·é‡ä»£ç è¿›è¡ŒæŸ¥è¯¢ã€‚

> å¦ä¸€ä¸ªæ¯”è¾ƒæµè¡Œçš„æœç´¢å¼•æ“ä¹Ÿæ˜¯åŸºäº Lucene å¼€å‘çš„ [Apache Solr](https://solr.apache.org)ï¼Œè¯»ä½œ "solar"ã€‚

**Elasticsearch æœ¬è´¨æ˜¯ä¸€ä¸ªæ•°æ®åº“**ï¼Œä¹Ÿéœ€è¦æœ‰ä¸“é—¨çš„ DBA è¿ç»´ï¼Œåªæ˜¯æ›´åé‡åº”ç”¨å±‚é¢ï¼Œæ‰€ä»¥è¿ç»´èŒè´£ç›¸å¯¹ä¼ ç»Ÿ DBA æ²¡æœ‰é‚£ä¹ˆä¸¥è‹›ã€‚å¯¹äºé›†ç¾¤å±‚é¢å¿…é¡»æŒæ¡é›†ç¾¤æ­å»ºï¼Œé›†ç¾¤æ‰©å®¹ã€é›†ç¾¤å‡çº§ã€é›†ç¾¤å®‰å…¨ã€é›†ç¾¤ç›‘æ§å‘Šè­¦ç­‰ï¼›å¦å¤–å¯¹äºæ•°æ®å±‚é¢è¿ç»´ï¼Œå¿…é¡»æŒæ¡æ•°æ®å¤‡ä»½ä¸è¿˜åŸã€æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œè¿˜æœ‰ä¸€äº›æ—¥å¸¸é—®é¢˜è¯Šæ–­ç­‰ã€‚

> è¯¦ç»†æ•™ç¨‹å¯ä»¥[æŸ¥çœ‹è¿™é‡Œ](https://www.sojson.com/blog/81.html) ğŸ‘ˆ

### ELK ä¹‹ Kibana

è‘—åçš„ **ELK** ä¸‰ä»¶å¥—ï¼Œè®²çš„å°±æ˜¯ **Elasticsearchï¼ŒLogstashï¼ŒKibana**ï¼Œä¸“é—¨é’ˆå¯¹æ—¥å¿—é‡‡é›†ã€å­˜å‚¨ã€æŸ¥è¯¢è®¾è®¡çš„äº§å“ç»„åˆã€‚å½“ç„¶ç°åœ¨å·²ç»å‘å±•æˆäº† [**Elastic Stack**](https://www.elastic.co/what-is/elk-stack)ã€‚

Logstash æ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œå¯ä»¥åŒæ—¶ä»å¤šä¸ªæ•°æ®æºè·å–æ•°æ®ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè½¬æ¢ï¼Œç„¶åå°†å…¶å‘é€åˆ°ä½ æœ€å–œæ¬¢çš„â€œå­˜å‚¨â€ï¼ˆå½“ç„¶å¯ä»¥å°±æ˜¯ Elasticsearchï¼‰ã€‚

Kibana is a data visualization and exploration tool used for log and time-series analytics, application monitoring, and operational intelligence use cases. It offers powerful and easy-to-use features such as histograms, line graphs, pie charts, heat maps, and built-in geospatial support. Also, it provides tight integration with Elasticsearch, a popular analytics and search engine, which makes Kibana the default choice for visualizing data stored in Elasticsearch.

## ZooKeeper

[**ZooKeeper**](https://github.com/apache/zookeeper) æ˜¯å¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚å·²ç»ä½œä¸ºæ ¸å¿ƒç»„ä»¶è¢«å¹¿æ³›åº”ç”¨åœ¨å¾ˆå¤šå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒåŒ…æ‹¬ Hadoopã€Hbaseã€Stormã€Kafkaã€Dubbo ç­‰ã€‚

Zookeeper æ˜¯ä¸€ä¸ªç”±å¤šä¸ª server ç»„æˆçš„é›†ç¾¤ï¼Œä¸€ä¸ª leaderï¼Œå¤šä¸ª followerï¼ˆè¿™ä¸ªä¸åŒäºæˆ‘ä»¬å¸¸è§çš„ Master/Slave æ¨¡å¼ï¼‰ã€‚leader ä¸ºå®¢æˆ·ç«¯æœåŠ¡å™¨æä¾›è¯»å†™æœåŠ¡ï¼Œé™¤äº† leader å¤–å…¶ä»–çš„æœºå™¨åªèƒ½æä¾›è¯»æœåŠ¡ã€‚æ¯ä¸ª server ä¿å­˜ä¸€ä»½æ•°æ®å‰¯æœ¬å…¨æ•°æ®ä¸€è‡´ï¼Œåˆ†å¸ƒå¼è¯» followerï¼Œå†™ç”± leader å®æ–½æ›´æ–°è¯·æ±‚è½¬å‘ï¼Œç”± leader å®æ–½æ›´æ–°è¯·æ±‚é¡ºåºè¿›è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ª client çš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œæ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚å…¨å±€å”¯ä¸€æ•°æ®è§†å›¾ï¼Œclient æ— è®ºè¿æ¥åˆ°å“ªä¸ª serverï¼Œæ•°æ®è§†å›¾éƒ½æ˜¯ä¸€è‡´çš„å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šäº‹ä»¶èŒƒå›´å†…ï¼Œclient èƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚

![zookeeper](https://zookeeper.apache.org/doc/r3.7.0/images/zkservice.jpg)

## Kafka

## Zabbix

**Zabbix** æ˜¯ä¸€ä¸ªåŸºäº web ç•Œé¢çš„æä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›‘è§†ä»¥åŠç½‘ç»œç›‘è§†åŠŸèƒ½çš„ä¼ä¸šçº§çš„å¼€æºè§£å†³æ–¹æ¡ˆï¼ŒåŸºäº `Server-Client` æ¶æ„ã€‚ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆ:

* **zabbix server** - é€šè¿‡ SNMPã€zabbix agentã€pingï¼Œç«¯å£ç›‘è§†ç­‰æ–¹æ³•æä¾›å¯¹è¿œç¨‹æœåŠ¡å™¨/ç½‘ç»œçŠ¶æ€çš„ç›‘è§†ï¼Œæ•°æ®æ”¶é›†ç­‰åŠŸèƒ½
* **zabbix agent** - å®‰è£…åœ¨è¢«ç›‘è§†çš„ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œå®ƒä¸»è¦å®Œæˆå¯¹ç¡¬ä»¶ä¿¡æ¯æˆ–ä¸æ“ä½œç³»ç»Ÿæœ‰å…³çš„å†…å­˜ã€CPU ç­‰ä¿¡æ¯çš„æ”¶é›†

å…·ä½“å®‰è£…æ–¹æ³•å¯ä»¥[å‚è€ƒè¿™ç¯‡æ–‡ç« ](https://www.jianshu.com/p/49ef09f6d8db)

## Docker

**Docker** å®¹å™¨å¹¶éè™šæ‹Ÿæœºï¼Œä½†å¯ä»¥æ¯”å–»ä¸ºæ›´è½»é‡çº§çš„è™šæ‹Ÿæœºã€‚ä½¿ç”¨è™šæ‹Ÿæœºè¿è¡Œå¤šä¸ªç›¸äº’éš”ç¦»çš„åº”ç”¨æ—¶(ä»¥ä¸‹ç¿»è¯‘[å‚è€ƒè‡ªè¿™é‡Œ](http://www.techug.com/post/comparing-virtual-machines-vs-docker-containers.html)):

![virtual-machine-architecture.jpg]( {{site.url}}/style/images/smms/virtual-machine-architecture.jpg )

* åŸºç¡€è®¾æ–½(Infrastructure) - å¯ä»¥æ˜¯ä¸ªäººç”µè„‘ï¼Œæ•°æ®ä¸­å¿ƒçš„æœåŠ¡å™¨ï¼Œæˆ–è€…æ˜¯äº‘ä¸»æœºã€‚
* ä¸»æ“ä½œç³»ç»Ÿ(Host Operating System) - è¿è¡Œçš„å¯èƒ½æ˜¯ MacOSï¼ŒWindows æˆ–è€…æŸä¸ª Linux å‘è¡Œç‰ˆã€‚
* è™šæ‹Ÿæœºç®¡ç†ç³»ç»Ÿ(Hypervisor) - åˆ©ç”¨ Hypervisor(å³ä¸Šè¿°çš„ ESXI)ï¼Œå¯ä»¥åœ¨ä¸»æ“ä½œç³»ç»Ÿä¹‹ä¸Šè¿è¡Œå¤šä¸ªä¸åŒçš„ä»æ“ä½œç³»ç»Ÿã€‚
* ä»æ“ä½œç³»ç»Ÿ(Guest Operating System) - å‡è®¾ä½ éœ€è¦è¿è¡Œ 3 ä¸ªç›¸äº’éš”ç¦»çš„åº”ç”¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨ Hypervisor å¯åŠ¨ 3 ä¸ªä»æ“ä½œç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ 3 ä¸ªè™šæ‹Ÿæœºã€‚è¿™äº›è™šæ‹Ÿæœºéƒ½éå¸¸å¤§ï¼Œä¹Ÿè®¸æœ‰ 700MBï¼Œè¿™å°±æ„å‘³ç€å®ƒä»¬å°†å ç”¨ 2.1GB çš„ç£ç›˜ç©ºé—´ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå®ƒä»¬è¿˜ä¼šæ¶ˆè€—å¾ˆå¤š CPU å’Œå†…å­˜ã€‚
* å„ç§ä¾èµ– - æ¯ä¸€ä¸ªä»æ“ä½œç³»ç»Ÿéƒ½éœ€è¦å®‰è£…è®¸å¤šä¾èµ–ã€‚å¦‚æœä½ ä½¿ç”¨ Ruby çš„è¯ï¼Œåº”è¯¥éœ€è¦å®‰è£… gemsï¼›å¦‚æœä½¿ç”¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å¦‚ Python æˆ–è€… Node.jsï¼Œéƒ½ä¼šéœ€è¦å®‰è£…å¯¹åº”çš„ä¾èµ–åº“ã€‚
* åº”ç”¨ - å®‰è£…ä¾èµ–ä¹‹åï¼Œå°±å¯ä»¥åœ¨å„ä¸ªä»æ“ä½œç³»ç»Ÿåˆ†åˆ«è¿è¡Œåº”ç”¨äº†ï¼Œè¿™æ ·å„ä¸ªåº”ç”¨å°±æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚

ä½¿ç”¨ Docker å®¹å™¨è¿è¡Œå¤šä¸ªç›¸äº’éš”ç¦»çš„åº”ç”¨æ—¶:

![docker-container.jpg]( {{site.url}}/style/images/smms/docker-container.jpg )

* åŸºç¡€è®¾æ–½(Infrastructure) - åŒä¸Š
* ä¸»æ“ä½œç³»ç»Ÿ(Host Operating System) - æ‰€æœ‰ä¸»æµçš„ Linux å‘è¡Œç‰ˆéƒ½å¯ä»¥è¿è¡Œ Dockerã€‚å¯¹äº MacOS å’Œ Windowsï¼Œä¹Ÿæœ‰ä¸€äº›åŠæ³•"è¿è¡Œ" Dockerã€‚
* Dockerå®ˆæŠ¤è¿›ç¨‹(Docker Daemon) - Docker å®ˆæŠ¤è¿›ç¨‹å–ä»£äº† Hypervisorï¼Œå®ƒæ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„åå°è¿›ç¨‹ï¼Œè´Ÿè´£ç®¡ç† Docker å®¹å™¨ã€‚
* å„ç§ä¾èµ– - å¯¹äº Dockerï¼Œåº”ç”¨çš„æ‰€æœ‰ä¾èµ–éƒ½æ‰“åŒ…åœ¨ Docker é•œåƒä¸­ï¼ŒDocker å®¹å™¨æ˜¯åŸºäº Docker é•œåƒåˆ›å»ºçš„ã€‚
* åº”ç”¨ - åº”ç”¨çš„æºä»£ç ä¸å®ƒçš„ä¾èµ–éƒ½æ‰“åŒ…åœ¨ Docker é•œåƒä¸­ï¼Œä¸åŒçš„åº”ç”¨éœ€è¦ä¸åŒçš„ Docker é•œåƒã€‚ä¸åŒçš„åº”ç”¨è¿è¡Œåœ¨ä¸åŒçš„ Docker å®¹å™¨ä¸­ï¼Œå®ƒä»¬æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚

è™šæ‹Ÿæœºå’Œ Docker çš„ä¸€äº›å¯¹æ¯”:

Docker å®ˆæŠ¤è¿›ç¨‹å¯ä»¥ç›´æ¥ä¸ä¸»æ“ä½œç³»ç»Ÿè¿›è¡Œé€šä¿¡ï¼Œä¸ºå„ä¸ª Docker å®¹å™¨åˆ†é…èµ„æºï¼›å®ƒè¿˜å¯ä»¥å°†å®¹å™¨ä¸ä¸»æ“ä½œç³»ç»Ÿéš”ç¦»ï¼Œå¹¶å°†å„ä¸ªå®¹å™¨äº’ç›¸éš”ç¦»ã€‚è™šæ‹Ÿæœºå¯åŠ¨éœ€è¦æ•°åˆ†é’Ÿï¼Œè€Œ Docker å®¹å™¨å¯ä»¥åœ¨æ•°æ¯«ç§’å†…å¯åŠ¨ã€‚ç”±äºæ²¡æœ‰è‡ƒè‚¿çš„ä»æ“ä½œç³»ç»Ÿï¼ŒDocker å¯ä»¥èŠ‚çœå¤§é‡çš„ç£ç›˜ç©ºé—´ä»¥åŠå…¶ä»–ç³»ç»Ÿèµ„æºã€‚

ä½†å¹¶ä¸æ˜¯è¯´è™šæ‹Ÿæœºå°±è¢«å–ä»£äº†ï¼Œå› ä¸ºä¸¤è€…æœ‰ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚è™šæ‹Ÿæœºæ›´æ“…é•¿äºå½»åº•éš”ç¦»æ•´ä¸ªè¿è¡Œç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œäº‘æœåŠ¡æä¾›å•†é€šå¸¸é‡‡ç”¨è™šæ‹ŸæœºæŠ€æœ¯éš”ç¦»ä¸åŒçš„ç”¨æˆ·ã€‚è€Œ Docker é€šå¸¸ç”¨äºéš”ç¦»ä¸åŒçš„åº”ç”¨ï¼Œä¾‹å¦‚å‰ç«¯ï¼Œåç«¯ä»¥åŠæ•°æ®åº“ã€‚

## AWS äº‘å¯¹è±¡å­˜å‚¨

éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œéœ€è¦ç®¡ç†æ€¥å‰§å¢åŠ å¹¶ä¸”å­¤ç«‹çš„å¤§é‡æ•°æ®ï¼Œè¿™äº›æ•°æ®æ¥è‡ªå¾ˆå¤šè¢«ä»»æ„æ•°é‡çš„åº”ç”¨ç¨‹åºå’Œä¸šåŠ¡æµç¨‹ä½¿ç”¨çš„æ¥æºã€‚ç°åœ¨ï¼Œå¾ˆå¤šå…¬å¸éƒ½é¢ä¸´ç€ç¢ç‰‡åŒ–å­˜å‚¨äº§å“å¸¦æ¥çš„æŒ‘æˆ˜ã€‚è¿™äº›äº§å“ä¸ä»…å¢åŠ äº†ä¸šåŠ¡åº”ç”¨ç¨‹åºçš„å¤æ‚æ€§ï¼Œè¿˜å‡ç¼“äº†å…¶åˆ›æ–°é€Ÿåº¦ã€‚å¯¹è±¡å­˜å‚¨èƒ½å¤Ÿæä¾›å¯ä»¥å¤§è§„æ¨¡æ‰©å±•å¹¶ä¸”ç»æµé«˜æ•ˆçš„å­˜å‚¨æ¥ä»¥åŸç”Ÿæ ¼å¼å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œä»è€Œæ‰“ç ´è¿™äº›é™åˆ¶ã€‚

**AWS(Amazon Web Services)** æ˜¯ Amazon å…¬å¸æ——ä¸‹äº‘è®¡ç®—æœåŠ¡å¹³å°ï¼Œä¸ºå…¨ä¸–ç•ŒèŒƒå›´å†…çš„å®¢æˆ·æä¾›äº‘è§£å†³æ–¹æ¡ˆã€‚é¢å‘ç”¨æˆ·æä¾›åŒ…æ‹¬å¼¹æ€§è®¡ç®—ã€å­˜å‚¨ã€æ•°æ®åº“ã€åº”ç”¨ç¨‹åºåœ¨å†…çš„ä¸€æ•´å¥—äº‘è®¡ç®—æœåŠ¡ï¼Œå¸®åŠ©ä¼ä¸šé™ä½ IT æŠ•å…¥æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ã€‚åŒç±»å‹çš„è¿˜å¯ä»¥äº†è§£ä¸‹ [Azure](https://zh.wikipedia.org/wiki/Microsoft_Azure)ã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ã€‚

## ç«¯å£æ˜ å°„å’Œ DMZ ä¸»æœº

**ç«¯å£æ˜ å°„**æ˜¯ [**ç½‘ç»œåœ°å€è½¬æ¢(NAT)**](https://zh.wikipedia.org/wiki/ç½‘ç»œåœ°å€è½¬æ¢) çš„ä¸€ç§ï¼Œå°±æ˜¯å°†å¤–ç½‘ä¸»æœºçš„ IP åœ°å€çš„ä¸€ä¸ªç«¯å£æ˜ å°„åˆ°å†…ç½‘ä¸­ä¸€å°æœºå™¨ï¼Œæä¾›ç›¸åº”çš„æœåŠ¡ã€‚å½“ç”¨æˆ·è®¿é—®è¯¥ IP çš„è¿™ä¸ªç«¯å£æ—¶ï¼ŒæœåŠ¡å™¨è‡ªåŠ¨å°†è¯·æ±‚æ˜ å°„åˆ°å¯¹åº”å±€åŸŸç½‘å†…éƒ¨çš„æœºå™¨ä¸Šã€‚ç«¯å£æ˜ å°„æœ‰åŠ¨æ€å’Œé™æ€ä¹‹åˆ†ã€‚

å†…ç½‘çš„ä¸€å°ç”µè„‘è¦ä¸Šå› ç‰¹ç½‘æˆ–è€…ç»™å› ç‰¹ç½‘å¯åŠ¨æœåŠ¡ï¼Œå°±éœ€è¦ç«¯å£æ˜ å°„ã€‚ä¾‹å¦‚è¦æ˜ å°„ä¸€å° IP åœ°å€ä¸º 192.168.111.10 çš„ WEB æœåŠ¡å™¨ï¼Œåªéœ€æŠŠæœåŠ¡å™¨çš„ IP åœ°å€å’Œæä¾› web æœåŠ¡çš„ TCP ç«¯å£ 80 å¡«å…¥åˆ°è·¯ç”±å™¨çš„ç«¯å£æ˜ å°„è¡¨ä¸­å³å¯ã€‚

**DMZ(demilitarized zone)** ï¼Œå³"éš”ç¦»åŒº"æˆ–"éå†›äº‹åŒ–åŒº"ã€‚å®ƒæ˜¯ä¸ºäº†è§£å†³å®‰è£…é˜²ç«å¢™åå¤–éƒ¨ç½‘ç»œä¸èƒ½è®¿é—®å†…éƒ¨ç½‘ç»œæœåŠ¡å™¨çš„é—®é¢˜ï¼Œè€Œè®¾ç«‹çš„ä¸€ä¸ªéå®‰å…¨ç³»ç»Ÿä¸å®‰å…¨ç³»ç»Ÿä¹‹é—´çš„ç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºä½äºä¼ä¸šå†…éƒ¨ç½‘ç»œå’Œå¤–éƒ¨ç½‘ç»œä¹‹é—´çš„å°ç½‘ç»œåŒºåŸŸå†…ï¼Œåœ¨è¿™ä¸ªå°ç½‘ç»œåŒºåŸŸå†…å¯ä»¥æ”¾ç½®ä¸€äº›å¿…é¡»å…¬å¼€çš„æœåŠ¡å™¨è®¾æ–½ï¼Œå¦‚ä¼ä¸š Web æœåŠ¡å™¨ã€FTP æœåŠ¡å™¨å’Œè®ºå›ç­‰ã€‚å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡è¿™æ ·ä¸€ä¸ª DMZ åŒºåŸŸï¼Œæ›´åŠ æœ‰æ•ˆåœ°ä¿æŠ¤äº†å†…éƒ¨ç½‘ç»œï¼Œå› ä¸ºè¿™ç§ç½‘ç»œéƒ¨ç½²ï¼Œæ¯”èµ·ä¸€èˆ¬çš„é˜²ç«å¢™æ–¹æ¡ˆï¼Œå¯¹æ”»å‡»è€…æ¥è¯´åˆå¤šäº†ä¸€é“å…³å¡ã€‚ DMZ ä¸»æœºå°±æ˜¯ä¸€ä¸ªå¼€æ”¾æ‰€æœ‰ç«¯å£çš„è™šæ‹ŸæœåŠ¡å™¨ã€‚

> ç«¯å£æ˜ å°„åªæ˜¯æ˜ å°„æŒ‡å®šçš„ç«¯å£ï¼ŒDMZ ç›¸å½“äºæ˜ å°„æ‰€æœ‰çš„ç«¯å£ï¼Œå¹¶ä¸”ç›´æ¥æŠŠä¸»æœºæš´éœ²åœ¨ç½‘å…³ä¸­ï¼Œæ¯”ç«¯å£æ˜ å°„æ–¹ä¾¿ä½†æ˜¯ä¸å®‰å…¨ã€‚ä¸”å½“è®¾ç½®äº† DMZ ä¸»æœºåï¼Œæ‰€æœ‰ç«¯å£çš„æ˜ å°„éƒ½å°†æŒ‡å‘ DMZ ä¸»æœºï¼ŒæŒ‡å‘å…¶ä»–ç”µè„‘çš„ç«¯å£æ˜ å°„å°†æ— æ•ˆã€‚

## å…¨é“¾è·¯å‹æµ‹

### å‹æµ‹æŒ‡æ ‡åŠå·¥å…·

**å…¨é“¾è·¯å‹æµ‹**æ˜¯åŸºäºçº¿ä¸ŠçœŸå®ç¯å¢ƒå’Œå®é™…ä¸šåŠ¡åœºæ™¯ï¼Œé€šè¿‡æ¨¡æ‹Ÿæµ·é‡çš„ç”¨æˆ·è¯·æ±‚ï¼Œæ¥å¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚ç›¸å¯¹äºæ¯”è¾ƒç®€å•çš„å‹æµ‹ï¼Œæ¯”å¦‚åªå¯¹çº¿ä¸Šçš„å•æœºæˆ–é›†ç¾¤å‘èµ·æœåŠ¡è°ƒç”¨ï¼›å°†çº¿ä¸Šæµé‡è¿›è¡Œå½•åˆ¶ï¼Œç„¶ååœ¨å•å°æœºå™¨ä¸Šè¿›è¡Œå›æ”¾ç­‰ã€‚èƒ½å¤Ÿæ›´å…¨é¢åœ°è¿›è¡Œé“¾è·¯è¦†ç›–ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„ä¸€äº›æŒ‡æ ‡ï¼š

| æŒ‡æ ‡        |   æè¿°   |
| ------------ | ------- |
| **qps**(query per second) | æ¯ç§’å¤„ç†è¯·æ±‚æ•° |
| **tps**(transactions per second) | æ¯ç§’å¤„ç†çš„äº‹åŠ¡ |
| **hps**(hits per second) | æ¯ç§’ç‚¹å‡»æ¬¡æ•° |
| **rt**(response time) | å“åº”æ—¶é—´ï¼Œç›¸å½“äº latency |
| CPU ä½¿ç”¨ç‡ | å‡ºäºèŠ‚ç‚¹å®•æœºåè´Ÿè½½å‡è¡¡çš„è€ƒè™‘ï¼Œä¸€èˆ¬ CPU ä½¿ç”¨ç‡å°äº 75% æ¯”è¾ƒåˆé€‚ |
| å†…å­˜ä½¿ç”¨ç‡ | å†…å­˜å ç”¨æƒ…å†µï¼Œä¸€èˆ¬è§‚å¯Ÿå†…å­˜æ˜¯å¦æœ‰å°–åˆºæˆ–æ³„éœ² |
| ç¼“å­˜å‘½ä¸­ç‡ | å¤šå°‘æµé‡èƒ½å‘½ä¸­ç¼“å­˜å±‚ï¼ˆredisã€memcached ç­‰ï¼‰ |

> tps ä¸€ä¸ªå®Œæ•´äº‹åŠ¡å¯èƒ½åŒ…å«ä¸€äº›åˆ—çš„è¯·æ±‚è¿‡ç¨‹ã€‚æ¯”å¦‚è®¿é—®ä¸€ä¸ªç½‘é¡µï¼Œå¯ä»¥å½“åšä¸€ä¸ªäº‹åŠ¡ï¼Œä½†æ˜¯è®¿é—®ä¸€ä¸ªç½‘é¡µå¯èƒ½ä¼šå¯¹å¤šä¸ªæœåŠ¡å™¨å‘èµ·å¤šæ¬¡è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚ä¼šå½“åšå¤šæ¬¡ qps è®¡ç®—åœ¨å†…ã€‚

> ä¸€èˆ¬æƒ…å†µä¸‹ç”¨ tps æ¥è¡¡é‡æ•´ä¸ªä¸šåŠ¡æµç¨‹ï¼Œç”¨ qps æ¥è¡¡é‡æ¥å£æŸ¥è¯¢æ¬¡æ•°ï¼Œç”¨ hps æ¥è¡¨ç¤ºå¯¹æœåŠ¡å™¨å•å‡»è¯·æ±‚ã€‚

å‹æµ‹å·¥å…·çš„é€‰æ‹©ä¹Ÿæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ [**Apache ab**](https://httpd.apache.org/docs/2.4/programs/ab.html)ã€[**Apache JMeter**](https://jmeter.apache.org)ã€[**locust**](https://locust.io) ç­‰ã€‚ä¹Ÿæœ‰ä¸€äº›è½»é‡çº§çš„å·¥å…·ï¼Œå¦‚ [**wrk**](https://github.com/wg/wrk) ç­‰ï¼Œæˆ‘ä»¬ç®€å•çœ‹ä¸‹ wrk çš„è¾“å‡ºï¼š

```shell
# This runs a benchmark for 30 seconds, using 12 threads, and keeping 400 HTTP connections open.
$ wrk -t12 -c400 -d30s http://127.0.0.1:8080/index.html

Running 30s test @ http://127.0.0.1:8080/index.html
  12 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   635.91us    0.89ms  12.92ms   93.69%
    Req/Sec    56.20k     8.07k   62.00k    86.54%
  22464657 requests in 30.00s, 17.76GB read
Requests/sec: 748868.53
Transfer/sec:    606.33MB
```

### æµé‡å½•åˆ¶åŠå›æ”¾

ä¸€èˆ¬é’ˆå¯¹æ¯”è¾ƒå¤§å‹çš„é¡¹ç›®ï¼Œå®¹æ˜“å‡ºç°æ¼æµ‹æˆ–è€…æœ‰å¾ˆå¤šæ²¡è¯„ä¼°åˆ°çš„åœ°æ–¹ï¼Œå¦‚æœç”¨çº¿ä¸Šæµé‡åšä¸€æ¬¡å›å½’æµ‹è¯•ï¼Œå¯ä»¥è¿›ä¸€æ­¥å‡å°‘ bug çš„é£é™©ï¼ŒåŒæ—¶å¤§å¤§èŠ‚çœæ„é€ æµ‹è¯•æ•°æ®çš„æ—¶é—´ï¼Œæé«˜æµ‹è¯•æ•ˆç‡ã€‚

![stress-testing]( {{site.url}}/style/images/smms/stress-testing.png )

> ä¸€èˆ¬æµé‡å›æ”¾åªå›æ”¾ get è¯·æ±‚ï¼Œå› ä¸ºå…¶ä»–è¯·æ±‚å¯èƒ½ä¼šå¯¹ç”¨æˆ·æ•°æ®è¿›è¡Œæ“ä½œï¼Œæœ‰é£é™©éœ€è¦æ’é™¤æ‰ã€‚

## API ç½‘å…³

### ç½‘å…³çš„ä½œç”¨

[æ‘˜è‡ªçŸ¥ä¹](https://www.zhihu.com/question/309582197/answer/2077037990)ã€‚å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç”µå•†ç½‘ç«™ï¼Œé‚£ä¹ˆè¿™é‡Œä¼šæ¶‰åŠåˆ°å¾ˆå¤šåç«¯çš„å¾®æœåŠ¡ï¼Œæ¯”å¦‚ä¼šå‘˜ã€å•†å“ã€æ¨èæœåŠ¡ç­‰ç­‰ã€‚é‚£ä¹ˆè¿™é‡Œå°±ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼ŒAPP/Browser æ€ä¹ˆå»è®¿é—®è¿™äº›åç«¯çš„æœåŠ¡? å¦‚æœä¸šåŠ¡æ¯”è¾ƒç®€å•çš„è¯ï¼Œå¯ä»¥ç»™æ¯ä¸ªä¸šåŠ¡éƒ½åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„åŸŸå(https://service.api.company.com)ï¼Œä½†è¿™ç§æ–¹å¼ä¼šæœ‰å‡ ä¸ªé—®é¢˜:

1. æ¯ä¸ªä¸šåŠ¡éƒ½ä¼šéœ€è¦é‰´æƒã€é™æµã€æƒé™æ ¡éªŒç­‰é€»è¾‘ï¼Œéœ€è¦è¿›è¡Œå‰¥ç¦»
2. æ¯”å¦‚æ·˜å®ã€äºšé©¬é€Šæ‰“å¼€ä¸€ä¸ªé¡µé¢å¯èƒ½ä¼šæ¶‰åŠåˆ°æ•°ç™¾ä¸ªå¾®æœåŠ¡ååŒå·¥ä½œï¼Œå¦‚æœæ¯ä¸€ä¸ªå¾®æœåŠ¡éƒ½åˆ†é…ä¸€ä¸ªåŸŸåçš„è¯ï¼Œä¸€æ–¹é¢å®¢æˆ·ç«¯ä»£ç ä¼šå¾ˆéš¾ç»´æŠ¤ï¼Œå¦ä¸€æ–¹é¢æ˜¯è¿æ¥æ•°çš„ç“¶é¢ˆã€‚è€Œä¸”æ¯ä¸Šçº¿ä¸€ä¸ªæ–°çš„æœåŠ¡ï¼Œéƒ½éœ€è¦è¿ç»´å‚ä¸ï¼Œç”³è¯·åŸŸåã€é…ç½® Nginx ç­‰ï¼Œå½“ä¸Šçº¿ã€ä¸‹çº¿æœåŠ¡å™¨æ—¶ï¼ŒåŒæ ·ä¹Ÿéœ€è¦è¿ç»´å‚ä¸ï¼Œå¦å¤–é‡‡ç”¨åŸŸåè¿™ç§æ–¹å¼ï¼Œå¯¹äºç¯å¢ƒçš„éš”ç¦»ä¹Ÿä¸å¤ªå‹å¥½ï¼Œè°ƒç”¨è€…éœ€è¦æ ¹æ®åŸŸåè‡ªå·±è¿›è¡Œåˆ¤æ–­ã€‚
3. åç«¯æ¯ä¸ªå¾®æœåŠ¡å¯èƒ½æ˜¯ç”±ä¸åŒè¯­è¨€ç¼–å†™çš„ã€é‡‡ç”¨äº†ä¸åŒçš„åè®®ï¼Œæ¯”å¦‚ HTTPã€Dubboã€GRPC ç­‰ï¼Œä½†æ˜¯ä½ ä¸å¯èƒ½è¦æ±‚å®¢æˆ·ç«¯å»é€‚é…è¿™ä¹ˆå¤šç§åè®®ï¼Œè¿™æ˜¯ä¸€é¡¹éå¸¸æœ‰æŒ‘æˆ˜çš„å·¥ä½œï¼Œé¡¹ç›®ä¼šå˜çš„éå¸¸å¤æ‚ä¸”å¾ˆéš¾ç»´æŠ¤ã€‚åæœŸå¦‚æœéœ€è¦å¯¹å¾®æœåŠ¡è¿›è¡Œé‡æ„çš„è¯ï¼Œä¹Ÿä¼šå˜çš„éå¸¸éº»çƒ¦ï¼Œéœ€è¦å®¢æˆ·ç«¯é…åˆä½ ä¸€èµ·è¿›è¡Œæ”¹é€ ï¼Œæ¯”å¦‚å•†å“æœåŠ¡ï¼Œéšç€ä¸šåŠ¡å˜çš„è¶Šæ¥è¶Šå¤æ‚ï¼ŒåæœŸéœ€è¦è¿›è¡Œæ‹†åˆ†æˆå¤šä¸ªå¾®æœåŠ¡ï¼Œè¿™ä¸ªæ—¶å€™å¯¹å¤–æä¾›çš„æœåŠ¡ä¹Ÿéœ€è¦æ‹†åˆ†æˆå¤šä¸ªï¼ŒåŒæ—¶éœ€è¦å®¢æˆ·ç«¯é…åˆä½ è¿›è¡Œæ”¹é€ ï¼Œéå¸¸è›‹ç–¼ã€‚

![api gateway](https://pic1.zhimg.com/80/v2-0903a05306217b52effca6ebb80b45ea_1440w.jpg?source=1940ef5c)

å› æ­¤å¯ä»¥å®ç°ä¸€ä¸ª **API ç½‘å…³(API Gateway)**æ¥ç®¡æ‰€æœ‰çš„å…¥å£æµé‡ï¼Œç±»ä¼¼ Nginx çš„ä½œç”¨ï¼Œå°†æ‰€æœ‰ç”¨æˆ·çš„è¯·æ±‚è½¬å‘ç»™åç«¯çš„æœåŠ¡å™¨ï¼Œä½†ç½‘å…³åšçš„ä¸ä»…ä»…åªæ˜¯ç®€å•çš„è½¬å‘ï¼Œä¹Ÿä¼šé’ˆå¯¹æµé‡åšä¸€äº›æ‰©å±•ï¼Œæ¯”å¦‚é‰´æƒã€é™æµã€æƒé™ã€ç†”æ–­ã€åè®®è½¬æ¢ã€é”™è¯¯ç ç»Ÿä¸€ã€ç¼“å­˜ã€æ—¥å¿—ã€ç›‘æ§ã€å‘Šè­¦ç­‰ï¼Œè¿™æ ·å°†é€šç”¨çš„é€»è¾‘æŠ½å‡ºæ¥ï¼Œç”±ç½‘å…³ç»Ÿä¸€å»åšï¼Œä¸šåŠ¡æ–¹ä¹Ÿèƒ½å¤Ÿæ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œæå‡è¿­ä»£çš„æ•ˆç‡ã€‚é€šè¿‡å¼•å…¥ API ç½‘å…³ï¼Œå®¢æˆ·ç«¯åªéœ€è¦ä¸ API ç½‘å…³äº¤äº’ï¼Œè€Œä¸ç”¨ä¸å„ä¸ªä¸šåŠ¡æ–¹çš„æ¥å£åˆ†åˆ«é€šè®¯ã€‚

æœåŠ¡è°ƒç”¨æ–¹ï¼ˆå†…éƒ¨å’Œå¤–éƒ¨ï¼‰åŒæ—¶é€šè¿‡ nginx å’Œ API ç½‘å…³è®¿é—®æœåŠ¡æä¾›æ–¹ç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![api-gateway-consul-nginx]( {{site.url}}/style/images/smms/api-gateway-consul-nginx.png )

è°ƒç”¨æ–¹åˆ°æä¾›æ–¹ç»è¿‡ API ç½‘å…³çš„æ•´ä¸ªé“¾è·¯çš„å„ä¸ªç¯èŠ‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![api-gateway-consul]( {{site.url}}/style/images/smms/api-gateway-consul.png )

### consul æœåŠ¡å‘ç°

[å‚è€ƒè¿™é‡Œ](https://cloud.tencent.com/developer/article/1444664)ã€‚å¾®æœåŠ¡çš„æ¡†æ¶ä½“ç³»ä¸­ï¼Œ**æœåŠ¡å‘ç°**æ˜¯ä¸èƒ½ä¸æçš„ä¸€ä¸ªæ¨¡å—ã€‚æˆ‘ä»¬çœ‹çœ‹ä»¥å‰çš„æ–¹æ¡ˆã€‚å®¢æˆ·ç«¯çš„ä¸€ä¸ªæ¥å£ï¼Œéœ€è¦è°ƒç”¨æœåŠ¡ A-Nã€‚å®¢æˆ·ç«¯å¿…é¡»è¦çŸ¥é“æ‰€æœ‰æœåŠ¡çš„ç½‘ç»œä½ç½®çš„ï¼Œä»¥å¾€çš„åšæ³•æ˜¯é…ç½®æ˜¯é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ–è€…æœ‰äº›é…ç½®åœ¨æ•°æ®åº“ä¸­ã€‚è¿™é‡Œå°±å¸¦å‡ºå‡ ä¸ªé—®é¢˜ï¼š

1. éœ€è¦é…ç½® N ä¸ªæœåŠ¡çš„ç½‘ç»œä½ç½®ï¼ŒåŠ å¤§é…ç½®çš„å¤æ‚æ€§
2. æœåŠ¡çš„ç½‘ç»œä½ç½®å˜åŒ–ï¼Œéƒ½éœ€è¦æ”¹å˜æ¯ä¸ªè°ƒç”¨è€…çš„é…ç½®
3. é›†ç¾¤çš„æƒ…å†µä¸‹ï¼Œéš¾ä»¥åšè´Ÿè½½ï¼ˆåå‘ä»£ç†çš„æ–¹å¼é™¤å¤–ï¼‰

![consul-before]( {{site.url}}/style/images/smms/consul-before.png )

æˆ‘ä»¬å†å¯¹æ¯”ä¸‹åŠ äº†æœåŠ¡å‘ç°çš„æ•ˆæœã€‚æœåŠ¡ A-N æŠŠå½“å‰è‡ªå·±çš„ç½‘ç»œä½ç½®æ³¨å†Œåˆ°æœåŠ¡å‘ç°æ¨¡å—ï¼ŒæœåŠ¡å‘ç°å°±ä»¥ K-V çš„æ–¹å¼è®°å½•ä¸‹ï¼ŒK ä¸€èˆ¬æ˜¯æœåŠ¡åï¼ŒV å°±æ˜¯ IP:PORTã€‚æœåŠ¡å‘ç°æ¨¡å—ä¼šå®šæ—¶è½®è¯¢æŸ¥çœ‹è¿™äº›æœåŠ¡æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è®¿é—®ï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚å®¢æˆ·ç«¯åœ¨è°ƒç”¨æœåŠ¡ A-N çš„æ—¶å€™ï¼Œå°±è·‘å»æœåŠ¡å‘ç°æ¨¡å—é—®ä¸‹å®ƒä»¬çš„ç½‘ç»œä½ç½®ï¼Œç„¶åå†è°ƒç”¨å®ƒä»¬çš„æœåŠ¡ã€‚å®¢æˆ·ç«¯å®Œå…¨ä¸éœ€è¦è®°å½•è¿™äº›æœåŠ¡ç½‘ç»œä½ç½®ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å®Œå…¨è§£è€¦ï¼

![consul-after]( {{site.url}}/style/images/smms/consul-after.png )

> åšæœåŠ¡å‘ç°çš„æ¡†æ¶é™¤äº† consul å¤–ï¼Œå¸¸ç”¨çš„è¿˜æœ‰ zookeeperã€eurekaã€etcd ç­‰ã€‚

## å¼€æºè®¸å¯è¯å¯¹æ¯”

![mit]( {{site.url}}/style/images/smms/mit.jpg )

## å‚è€ƒé“¾æ¥

1. [zabbix ä»å¬è¯´åˆ°å­¦ä¼š](https://www.jianshu.com/p/49ef09f6d8db) By JokerW
2. [Zabbix 3.0 ä»å…¥é—¨åˆ°ç²¾é€š(zabbix ä½¿ç”¨è¯¦è§£)](https://www.cnblogs.com/clsn/p/7885990.html) By æƒ¨ç»¿å°‘å¹´
3. [Comparing Virtual Machines vs Docker Containers](https://nickjanetakis.com/blog/comparing-virtual-machines-vs-docker-containers) By Nick Janetakis
4. [ç«¯å£æ˜ å°„å’Œ dmz](https://blog.csdn.net/shaochat/article/details/40583937) By å¾å¿ƒå®‰å¤„æ–¹æ˜¯å®¶
5. [å½•åˆ¶çº¿ä¸Šæµé‡åšå›å½’æµ‹è¯•çš„æ­£ç¡®æ‰“å¼€æ–¹å¼](https://testerhome.com/topics/25641) By å°‘å¹´
