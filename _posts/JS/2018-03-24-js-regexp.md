---
layout: blog
front: true
comments: True
flag: JS
background: blue
category: å‰ç«¯
title:  æ­£åˆ™è¡¨è¾¾å¼
date:   2018-03-25 23:21:00 GMT+0800 (CST)
update: 2019-02-20 11:14:00 GMT+0800 (CST)
background-image: https://i.loli.net/2018/03/24/5ab65abe04a13.png
tags:
- JavaScript
---
# {{ page.title }}

## ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼

**æ­£åˆ™è¡¨è¾¾å¼(Regular Expressions)** æ˜¯ç”¨äºåŒ¹é…å­—ç¬¦ä¸²ä¸­å­—ç¬¦ç»„åˆçš„æ¨¡å¼ï¼Œæ„å»ºæ­£åˆ™è¡¨è¾¾å¼æœ‰ä¸¤ç§å½¢å¼:

```JS
/*
   /pattern/flags
*/
var regex = /[0-9a-zA-Z]/g;
```

```JS
/*
    new RegExp(pattern [, flags])
*/
var regex = new RegExp('[0-9a-zA-Z]', 'g');
var regex = new RegExp(/[0-9a-zA-Z]/g);
```

## ç‰¹æ®Šå­—ç¬¦(pattern)

![regexp.png](https://i.loli.net/2018/03/24/5ab65abe04a13.png)

### (x) / (?:x)

æ­£åˆ™ä¸­ï¼Œ(x) è¡¨ç¤ºæ•è·æ•°ç»„ï¼Œ(?:x) è¡¨ç¤ºä¸æ•è·æ•°ç»„ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼çš„æ›¿æ¢ç¯èŠ‚ï¼Œåˆ™è¦ä½¿ç”¨åƒ $1ã€$2ã€$n è¿™æ ·çš„è¯­æ³•ï¼Œä¾‹å¦‚:

```JS
'bar foo'.replace( /(\w+) (\w+)/, '$2 $1'); // 'foo bar'
```

(?:x) åŒ¹é… 'x' ä½†æ˜¯ä¸è®°ä½åŒ¹é…é¡¹:

```JS
/foo{1,2}/; // {1,2} å°†åªå¯¹ 'foo' çš„æœ€åä¸€ä¸ªå­—ç¬¦ 'o' ç”Ÿæ•ˆ
/(?:foo){1,2}/; // ä½¿ç”¨éæ•è·æ‹¬å·ï¼Œåˆ™{1,2}ä¼šåŒ¹é…æ•´ä¸ª 'foo' å•è¯
```

```JS
'abcabc'.match(/(?:a)(b)(c)/);
// ç»“æœ ['abc', 'b', 'c']
// m[0] æ˜¯/(?:a)(b)(c)/åŒ¹é…åˆ°çš„æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™é‡ŒåŒ…æ‹¬äº† a
// m[1] æ˜¯æ•è·ç»„1ï¼Œå³(b)åŒ¹é…çš„å­å­—ç¬¦ä¸²
// m[2] æ˜¯æ•è·ç»„2ï¼Œå³(c)åŒ¹é…çš„å­å­—ç¬¦ä¸²

var m = 'abcabc'.match(/(a)(b)(c)/);
// ç»“æœ ['abc', 'a', 'b', 'c']
```

åœ¨ vscode ç”¨æ­£åˆ™æ›¿æ¢å­—ç¬¦æ—¶ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ç”¨æ­¤æ–¹æ³•:

![regexp-vscode.png](https://i.loli.net/2019/02/20/5c6cc546a3f3d.png)

### \1 / \n

**\1** éœ€è¦å’Œåˆ†ç»„ç¬¦å· (x) ä¸€èµ·ä½¿ç”¨ï¼Œä»£è¡¨ä¸ç¬¬ä¸€ä¸ªå°æ‹¬å·ä¸­è¦åŒ¹é…çš„å†…å®¹ç›¸åŒï¼ŒåŒç† \2 åŒ¹é…ç¬¬äºŒä¸ªæ‹¬å·çš„å†…å®¹ï¼Œä¸¾ä¸ªæ —å­:

```JS
var reg = /(foo) (bar) \1 \2/;
var str = 'foo bar foo bar';
reg.test(str); // true
```

```JS
// åŒ¹é…é‡å¤ 4 æ¬¡æˆ–ä»¥ä¸Šçš„å­—æ¯å’Œæ•°å­—
var reg = /(\w)(?=\1{3,})/;
reg.test('tttttt'); // true
reg.test('ttts'); // false
```

### å…ˆè¡Œæ–­è¨€ / åè¡Œæ–­è¨€

æ­£åˆ™è¡¨è¾¾å¼çš„å…ˆè¡Œæ–­è¨€å’Œåè¡Œæ–­è¨€ä¸€å…±æœ‰ 4 ç§å½¢å¼:

* **(?=pattern)** - é›¶å®½æ­£å‘å…ˆè¡Œæ–­è¨€(zero-width positive lookahead assertion)ï¼Œä»£è¡¨å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œç´§æ¥è¯¥ä½ç½®ä¹‹åçš„å­—ç¬¦åºåˆ—èƒ½å¤ŸåŒ¹é… pattern
* **(?!pattern)** - é›¶å®½è´Ÿå‘å…ˆè¡Œæ–­è¨€(zero-width negative lookahead assertion)ï¼Œä»£è¡¨å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œç´§æ¥è¯¥ä½ç½®ä¹‹åçš„å­—ç¬¦åºåˆ—ä¸èƒ½åŒ¹é… pattern
* (?<=pattern) - é›¶å®½æ­£å‘åè¡Œæ–­è¨€(zero-width positive lookbehind assertion)ï¼Œä»£è¡¨å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œç´§æ¥è¯¥ä½ç½®ä¹‹å‰çš„å­—ç¬¦åºåˆ—èƒ½å¤ŸåŒ¹é… pattern
* (?<\!pattern) - é›¶å®½è´Ÿå‘åè¡Œæ–­è¨€(zero-width negative lookbehind assertion)ï¼Œä»£è¡¨å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œç´§æ¥è¯¥ä½ç½®ä¹‹å‰çš„å­—ç¬¦åºåˆ—ä¸èƒ½åŒ¹é… pattern

**é›¶å®½**çš„å«ä¹‰æ˜¯å®ƒä»¬åªåŒ¹é…æŸäº›ä½ç½®ï¼Œåœ¨åŒ¹é…è¿‡ç¨‹ä¸­ä¸å ç”¨å­—ç¬¦ã€‚ä½†æ˜¯ JS ä¸æ”¯æŒåè¡Œæ–­è¨€ï¼Œè¿™é‡Œåªè€ƒè™‘å…ˆè¡Œæ–­è¨€ï¼Œä¸¾ä¸ªæ —å­ ğŸŒ°:

```JS
var str='snowTATE520snowZZ';
var reg=/snow(?=[A-Z])/g; // åŒ¹é…ä½ç½®åé¢è·Ÿéšä»»æ„ä¸€ä¸ªå¤§å†™å­—æ¯çš„å­—ç¬¦ä¸² 'snow'
console.log(str.match(reg)); // ['snow', 'snow']
```

å†çœ‹ä¸ªæ —å­ï¼Œå°†æ•°å­—è½¬æˆé‡‘é¢æ˜¾ç¤ºï¼Œæ¯ä¸‰ä¸ªä½ç½®ç”¨é€—å·éš”å¼€ï¼Œå¦‚ 15000 -> 15,000:

```JS
Number.prototype.formatNum = function() {
  let myNum = this + '';
  const reg = /\B(?=(?:\d{3})+$)/g;
  return myNum.replace(reg, ',')
};
var money = 15000;
console.log(money.formatNum());
```

å¦‚æœå¯¹ä¸Šè¿°æ­£åˆ™æŒæœ‰ç–‘é—®ï¼Œå¯ä»¥é¦–å…ˆçœ‹ä¸‹ \b å’Œ \B çš„ç”¨æ³•ï¼Œå¯ä»¥æŸ¥ä¸‹ä¸Šé¢çš„è¡¨æ ¼ï¼Œçœ‹çœ‹ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œç®€å•æ¥è®²:

* **\b** - åŒ¹é…å•è¯è¾¹ç•Œï¼Œå³å•è¯å’Œç¬¦å·çš„è¾¹ç•Œ
* **\B** - åŒ¹é…éå•è¯è¾¹ç•Œ

> **[\b]** æ˜¯åŒ¹é…ä¸€ä¸ªé€€æ ¼(U+0008)ã€‚åˆ‡å‹¿ä¸ \b æ··æ·†ã€‚

```JS
var str = 'this is,test';
str.split(/\B/); // ['t', 'h', 'i', 's i', 's,t', 'e', 's', 't']
str.split(/\b/); // ['this', ' ', 'is', ',', 'test']

'15000'.replace(/\B/g, ','); // '1, 5, 0, 0, 0'
```

å› æ­¤æ­£åˆ™ä¸­çš„ \B å¯ä»¥çœ‹æˆåŒ¹é… "15000" ä¸­çš„éå•è¯è¾¹ç•Œï¼Œå³æ¯ä¸¤ä¸ªæ•°å­—é—´çš„ä½ç½®ï¼Œä½†åŒæ—¶è¦æ»¡è¶³å…ˆè¡Œæ–­è¨€ <code>(\d{3}+$)</code>ï¼Œå³ä¸‰ä¸ªæ•°å­—ä¸ºä¸€ç»„ï¼Œå¿…é¡»ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªç»„ç»“å°¾ã€‚è¿›è¡Œ replace ä½ç½®æ›¿æ¢åï¼Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º:

```TEXT
1 5 0 0 0       1 5 0 0 0      1 5,0 0 0
 | | | |    =>   | | | |   =>
 x âœ” x x           ,
```

## æ ‡å¿—(flags)

| æ ‡å¿— | æè¿° |
|:--------------|:---------|
| g | å…¨å±€æœç´¢ |
| i | ä¸åŒºåˆ†å¤§å°å†™æœç´¢ |
| m | å¤šè¡Œæœç´¢ |
| u | unicode æ¨¡å¼ï¼Œç”¨æ¥æ­£ç¡®å¤„ç†å¤§äº \uFFFF çš„ Unicode å­—ç¬¦ |
| y | æ‰§è¡Œ'ç²˜æ€§'æœç´¢,åŒ¹é…ä»ç›®æ ‡å­—ç¬¦ä¸²çš„å½“å‰ä½ç½®å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ y æ ‡å¿— |

```JS
var reg = /\w+\s/g; // åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦åæœ‰ä¸€ä¸ªç©ºæ ¼çš„å­—ç¬¦ä¸²ï¼Œå…¨å±€æœç´¢
var str = 'a b c';

reg.flags; // 'g' å¯é€šè¿‡ flags è·å–æ ‡å¿—
str.match(reg); // ['a', 'b', 'c'] å…¨å±€åŒ¹é…
```

u æ ‡å¿—ä¸º ES6 æ–°å¢:

```JS
/^\uD83D/.test('\uD83D\uDC2A') // true
/^\uD83D/u.test('\uD83D\uDC2A') // false ä¿®æ­£é”™è¯¯

// æœ‰äº› Unicode å­—ç¬¦çš„ç¼–ç ä¸åŒï¼Œä½†æ˜¯å­—å‹å¾ˆç›¸è¿‘ï¼Œæ¯”å¦‚ï¼Œ\u004B ä¸ \u212A éƒ½æ˜¯å¤§å†™çš„ K
'\u004B'.normalize() === '\u212A'.normalize(); // true
/[a-z]/i.test('\u212A') // false
/[a-z]/iu.test('\u212A') // true
```

y æ ‡å¿—ä½ ES6 æ–°å¢ï¼Œè¡¨ç¤º"ç²˜æ€§(sticky)"æœç´¢ï¼Œy æ ‡å¿—çš„ä½œç”¨ä¸ g æ ‡å¿—ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å…¨å±€åŒ¹é…ï¼Œä½†åä¸€æ¬¡åŒ¹é…éƒ½ä»ä¸Šä¸€æ¬¡åŒ¹é…æˆåŠŸçš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹:

```JS
var s = 'aaa_aa_a';
var r1 = /a+/g;
var r2 = /a+/y;
r2.sticky; // true

r1.exec(s) // ['aaa']
r2.exec(s) // ['aaa']

r1.exec(s) // ['aa']
r2.exec(s) // null ä» '_aa_a' é¦–ä½å¼€å§‹åŒ¹é…
```

## æ–¹æ³•

| æ–¹æ³• | æè¿° |
|:--------------|:---------|
| **exec** | RegExp æ–¹æ³• | æ‰§è¡ŒæŸ¥æ‰¾åŒ¹é…ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„æˆ– null |
| **test** | RegExp æ–¹æ³• | æµ‹è¯•æ˜¯å¦åŒ¹é…ï¼Œè¿”å›å¸ƒå°”å€¼ |
| **match** | String æ–¹æ³• | æ‰§è¡ŒæŸ¥æ‰¾åŒ¹é…ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„æˆ– null |
| **search** | String æ–¹æ³• | æµ‹è¯•åŒ¹é…ï¼Œè¿”å›åŒ¹é…åˆ°çš„ä½ç½®ç´¢å¼•æˆ– -1 |
| **replace** | String æ–¹æ³• | æ‰§è¡ŒæŸ¥æ‰¾åŒ¹é…ï¼Œå¹¶ä¸”ä½¿ç”¨æ›¿æ¢å­—ç¬¦ä¸²æ›¿æ¢æ‰åŒ¹é…åˆ°çš„å­å­—ç¬¦ä¸² |
| **split** | String æ–¹æ³• | ä¸€ä¸ªä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ–è€…ä¸€ä¸ªå›ºå®šå­—ç¬¦ä¸²åˆ†éš”ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å°†åˆ†éš”åçš„å­å­—ç¬¦ä¸²å­˜å‚¨åˆ°æ•°ç»„ä¸­ |

```JS
var reg = /^t|$e/;
var name = 'tate';

reg.test(name); // true
reg.exec(name); // ['t', index: 0, input: 'tate']

name.match(reg); // ['t', index: 0, input: 'tate']
name.search(reg); // 0
name.split(reg); // ['', 'ate']
```

## æ­é… replace

**replace** æ–¹æ³•å¹¶ä¸æ”¹å˜è°ƒç”¨å®ƒçš„å­—ç¬¦ä¸²æœ¬èº«ï¼Œè€Œåªæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„æ›¿æ¢åçš„å­—ç¬¦ä¸²ã€‚æ›¿æ¢å­—ç¬¦ä¸²å¯ä»¥æ’å…¥ä¸‹é¢çš„ç‰¹æ®Šå˜é‡å:

```JS
// ä½¿ç”¨æ–¹æ³•
str.replace(regexp|substr, newSubStr|function)
```

```JS
var str = 'Twas the night before Xmas...';
var newstr = str.replace(/xmas/i, 'Christmas');
console.log(newstr); // Twas the night before Christmas...
```

| å˜é‡å | æè¿° |
|:--------------|:---------|
| $$ | æ’å…¥ä¸€ä¸ª '$' |
| $& | æ’å…¥åŒ¹é…çš„å­ä¸² |
| $` | æ’å…¥å½“å‰åŒ¹é…çš„å­ä¸²å·¦è¾¹çš„å†…å®¹ |
| $' | æ’å…¥å½“å‰åŒ¹é…çš„å­ä¸²å³è¾¹çš„å†…å®¹ |
| $ | å‡å¦‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ RegExp å¯¹è±¡ï¼Œå¹¶ä¸” n æ˜¯ä¸ªå°äº 100 çš„éè´Ÿæ•´æ•°ï¼Œé‚£ä¹ˆæ’å…¥ç¬¬ n ä¸ªæ‹¬å·åŒ¹é…çš„å­—ç¬¦ä¸² |

```JS
var re = /(\w+)\s(\w+)/;
var str = 'John Smith';
var newstr = str.replace(re, '$2, $1');
console.log(newstr); // Smith, John
```

replace è¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‚æ•°å¯ä»¥ä¸º:

| match | åŒ¹é…çš„å­ä¸²ã€‚(å¯¹åº”äºä¸Šè¿°çš„ $&ï¼‰ |
| p1,p2, ... | å‡å¦‚ replace æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª RegExp å¯¹è±¡ï¼Œåˆ™ä»£è¡¨ç¬¬ n ä¸ªæ‹¬å·åŒ¹é…çš„å­—ç¬¦ä¸²ã€‚(å¯¹åº”äºä¸Šè¿°çš„ $1ï¼Œ$2 ç­‰) |
| offset | åŒ¹é…åˆ°çš„å­å­—ç¬¦ä¸²åœ¨åŸå­—ç¬¦ä¸²ä¸­çš„åç§»é‡ã€‚(æ¯”å¦‚ï¼Œå¦‚æœåŸå­—ç¬¦ä¸²æ˜¯â€œabcdâ€ï¼ŒåŒ¹é…åˆ°çš„å­å­—ç¬¦ä¸²æ˜¯â€œbcâ€ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°å°†æ˜¯ 1) |
| string | è¢«åŒ¹é…çš„åŸå­—ç¬¦ä¸² |

```JS
function replacer(match, p1, p2, p3, offset, string) {
  // p1 is nondigits, p2 digits, and p3 non-alphanumerics
  return [p1, p2, p3].join(' - ');
}
var newString = 'abc12345#$*%'.replace(/([^\d]*)(\d*)([^\w]*)/, replacer);
console.log(newString);  // abc - 12345 - #$*%
```

## ç¤ºä¾‹

1ã€éªŒè¯ QQ å·åˆæ³•æ€§ï¼Œåˆæ³• QQ å·è§„åˆ™:

* 5-15 ä½
* å…¨æ˜¯æ•°å­—
* ä¸ä»¥ 0 å¼€å¤´

```JS
var reg = /^[1-9][0-9]{4,15}$/;
```

2ã€éªŒè¯å›½å†…ç”µè¯å·ç ï¼Œå¦‚ 0555-6581752ã€021-86128488:

```JS
var reg = /(^0[0-9]{3}-[1-9][0-9]{6}$)|(^0[0-9]{2}-[1-9][0-9]{7}$)/;
```

å…¶ä»–å¸¸ç”¨ç¤ºä¾‹:

```JS
// æ£€éªŒä¸­æ–‡è¾“å…¥ï¼Œå¯¹äºä¸¤ä¸ªåŒå­—èŠ‚è¡¨ç¤ºçš„æ±‰å­—æ— æ•ˆï¼Œå¦‚ 'ğ ®·'
/[\u4e00-\u9fa5]/
// URL
/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i
// Email
/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/
// trim() å»æ‰å‰åç©ºæ ¼
/^\s+|\s+$/g
```

## å‚è€ƒé“¾æ¥

1. [MDN - æ­£åˆ™è¡¨è¾¾å¼](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions)
1. [JS æ­£åˆ™è¡¨è¾¾å¼å…¥é—¨ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†](https://segmentfault.com/a/1190000009324194) By wuming
1. [æ­£åˆ™è¡¨è¾¾å¼é›¶å®½æ–­è¨€è¯¦è§£ï¼ˆ?=,?<=,?!,?<!ï¼‰](http://www.cnblogs.com/macq/p/6597366.html) By æ— æ‰€äº‹äº‹è€…çˆ±å˜²ç¬‘
1. [String.prototype.replace()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/replace)
