---
layout: blog
front: true
comments: True
flag: HTML
background: green
category: å‰ç«¯
title:  Github Actions
date:   2020-05-25 18:05:00 GMT+0800 (CST)
update: 2021-11-08 15:44:00 GMT+0800 (CST)
description: add Travis CI
background-image: https://www.wangbase.com/blogimg/asset/201909/bg2019091201.jpg
tags:
- html
---
# {{ page.title }}

## CI / CD

### æŒç»­é›†æˆ

**æŒç»­é›†æˆ(Continuous Integration)**å¼ºè°ƒå¼€å‘äººå‘˜æäº¤äº†æ–°ä»£ç ä¹‹åï¼Œç«‹åˆ»è¿›è¡Œæ„å»ºã€æµ‹è¯•ã€‚æ ¹æ®æµ‹è¯•ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šæ–°ä»£ç å’ŒåŸæœ‰ä»£ç èƒ½å¦æ­£ç¡®åœ°é›†æˆåœ¨ä¸€èµ·ï¼Œä»è€Œå°½æ—©åœ°å‘ç°é›†æˆé”™è¯¯ã€‚æµ‹è¯•æ–¹å¼æœ‰å‡ ç§:

1. å•å…ƒæµ‹è¯• - é’ˆå¯¹å‡½æ•°æˆ–æ¨¡å—çš„æµ‹è¯•
2. é›†æˆæµ‹è¯• - é’ˆå¯¹æ•´ä½“äº§å“çš„æŸä¸ªåŠŸèƒ½çš„æµ‹è¯•ï¼Œåˆç§°åŠŸèƒ½æµ‹è¯•
3. ç«¯å¯¹ç«¯æµ‹è¯• - ä»ç”¨æˆ·ç•Œé¢ç›´è¾¾æ•°æ®åº“çš„å…¨é“¾è·¯æµ‹è¯•

> ä¹‹å‰æåˆ°çš„ `Cypress` å°±å¯ä»¥å®Œæˆä¸Šè¿°çš„è‡ªåŠ¨åŒ–æµ‹è¯•

æ„å»ºå·¥å…·çš„è¯å¸¸ç”¨çš„ä¹Ÿæœ‰ä»¥ä¸‹å‡ ç§, å®ƒä»¬éƒ½ä¼šå°†æ„å»ºå’Œæµ‹è¯•ï¼Œåœ¨ä¸€æ¬¡è¿è¡Œä¸­æ‰§è¡Œå®Œæˆ:

1. [**Jenkins**](https://www.jenkins.io)
1. [**Travis**](https://travis-ci.com)
1. Codeship
1. Strider

![integration](https://3lsqjy1sj7i027fcn749gutj-wpengine.netdna-ssl.com/wp-content/uploads/2015/12/409-images-for-snap-blog-postedit_image1.png)

### æŒç»­äº¤ä»˜

**æŒç»­äº¤ä»˜(Continuous Delivery)**åœ¨æŒç»­é›†æˆçš„åŸºç¡€ä¸Šï¼Œå°†é›†æˆåçš„ä»£ç éƒ¨ç½²åˆ°æ›´è´´è¿‘çœŸå®è¿è¡Œç¯å¢ƒçš„ã€Œç±»ç”Ÿäº§ç¯å¢ƒã€(production-like environments)ä¸­ï¼Œæ¯”å¦‚ç°åº¦ç¯å¢ƒã€‚å¦‚æœä»£ç æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥ç»§ç»­æ‰‹åŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚

### æŒç»­éƒ¨ç½²

**æŒç»­éƒ¨ç½²(Continuous Deployment)**åˆ™æ˜¯åœ¨æŒç»­äº¤ä»˜çš„åŸºç¡€ä¸Šï¼ŒæŠŠéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„è¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚å¯ä»¥å€ŸåŠ©å·¥å…· `Ansibleï¼ŒChefï¼ŒPuppet` ç­‰:

![deployment](https://3lsqjy1sj7i027fcn749gutj-wpengine.netdna-ssl.com/wp-content/uploads/2015/12/409-images-for-snap-blog-postedit_image3-auto.png)

## DevOps

### ä»€ä¹ˆæ˜¯ DevOps

**DevOps** æ˜¯ `Development` å’Œ `Operations` çš„ç»“åˆï¼Œé›†æ–‡åŒ–ç†å¿µã€å®è·µå’Œå·¥å…·äºä¸€èº«ï¼Œå¯ä»¥æé«˜ç»„ç»‡é«˜é€Ÿäº¤ä»˜åº”ç”¨ç¨‹åºå’ŒæœåŠ¡çš„èƒ½åŠ›ã€‚**å…¶æ ¸å¿ƒæ˜¯é€šè¿‡æ‰“ç ´ç»„ç»‡å­¤å²›ï¼Œæé«˜é€æ˜åº¦å¹¶ä¿ƒè¿›å¼€å‘äººå‘˜ä¸ IT è¿è¥å›¢é˜Ÿä¹‹é—´çš„å¼€æ”¾å¼æ²Ÿé€šï¼Œä¸ºç»„ç»‡å¸¦æ¥ä¸šåŠ¡ä»·å€¼**ï¼Œè€Œä¸Šè¿°æåˆ°çš„ CI / CD åˆ™å¯ä»¥æ›´å¥½å»é©±åŠ¨ã€‚

ç”±äºè½¯ä»¶å¼€å‘æµç¨‹åˆ†ä¸ºè®¸å¤šé˜¶æ®µï¼Œè¿‡å»æˆ‘ä»¬éƒ½å¸¸å¸¸å°†è¿™äº›é˜¶æ®µè§†ä¸ºå„è‡ªç‹¬ç«‹ï¼Œå½¼æ­¤ä»»åŠ¡å®Œæˆåäº¤ä»˜ç»™ä¸‹ä¸€ä¸ªé˜¶æ®µçš„äººå‘˜ï¼Œè¿™é€ æˆäº†è®¸å¤šäººå‘˜æ²Ÿé€šä¸åˆä½œä¸Šçš„å±éšœï¼Œè€Œ DevOps çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå°¤å…¶æ˜¯è½¯ä»¶æœ€åéƒ¨ç½²å¸¸å¸¸ä¼šå‡ºç°é—®é¢˜ã€‚å¦‚é€ æˆæ—¶ç¨‹çš„å»¶è¿Ÿï¼Œæ— æ³•é¡ºåˆ©äº¤ä»˜ç­‰ã€‚

![old way](https://3lsqjy1sj7i027fcn749gutj-wpengine.netdna-ssl.com/wp-content/uploads/2016/01/457-image-for-devops-part-of-blog_old-way_1200x400.png)

ä½†éšç€è½¯ä½“çš„å‘å±•ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šéœ€è¦å¿«é€Ÿè¿­ä»£æˆ‘ä»¬çš„è½¯ä½“ç‰ˆæœ¬å‘¨æœŸï¼Œè®¸å¤šå¤§å‹ç½‘è·¯å…¬å¸éƒ½å¸Œæœ›èƒ½å¤Ÿæ›´å°½å¿«åœ°éƒ¨ç½²æ›´æ–°äº§å“ï¼ŒåŒæ—¶ï¼Œéšç€è™šæ‹ŸåŒ–æŠ€æœ¯ä¸å„ç§æµ‹è¯•è½¯ä½“çš„æ¼”è¿›ï¼Œä¾¿åœ¨æ—¶ä»£çš„æ¼”è¿›ä¸‹æå€¡å‡ºäº†ä¸€ç§ DevOps çš„"å¤šäººè¿åŠ¨"ã€‚åœ¨ DevOps æ¨¡å¼ä¸‹ï¼Œå¼€å‘å›¢é˜Ÿå’Œè¿è¥å›¢é˜Ÿéƒ½ä¸å†æ˜¯â€œå­¤ç«‹â€çš„å›¢é˜Ÿã€‚æœ‰æ—¶ï¼Œè¿™ä¸¤ä¸ªå›¢é˜Ÿä¼šåˆä¸ºä¸€ä¸ªå›¢é˜Ÿï¼Œä»–ä»¬çš„å·¥ç¨‹å¸ˆä¼šåœ¨åº”ç”¨ç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ˆä»å¼€å‘æµ‹è¯•åˆ°éƒ¨ç½²å†åˆ°è¿è¥ï¼‰å†…ç›¸äº’åä½œï¼Œå¼€å‘å‡ºä¸€ç³»åˆ—ä¸é™äºå•ä¸€èŒèƒ½çš„æŠ€èƒ½:

![new way](https://3lsqjy1sj7i027fcn749gutj-wpengine.netdna-ssl.com/wp-content/uploads/2016/01/457-image-for-devops-part-of-blog_new-way_560x560.png)

è‹¥æƒ³è¦äº†è§£å¦‚æœé€è¿‡ä¸€äº›å·¥å…·ååŠ©è®©ä½ çš„å…¬å¸æ‹¥æœ‰è‰¯å¥½çš„ DevOps æ–‡åŒ–ï¼Œä½ å¯ä»¥å‚è€ƒä»¥ä¸‹çš„å›¾ï¼Œä¹Ÿå¯ä»¥[å‚è€ƒè¿™ç¯‡æ–‡ç« ](https://cloud.tencent.com/developer/news/613701):

![devops tools](http://www.jamesbowman.me/post/cdlandscape/ContinuousDeliveryToolLandscape-fullsize.jpeg)

### ä¸æ•æ·å¼€å‘çš„å…³ç³»

é¦–å…ˆæˆ‘ä»¬è¦äº†è§£ä»€ä¹ˆæ˜¯æ•æ·å¼€å‘ï¼Ÿ

**æ•æ·å¼€å‘(agile development)**æ˜¯ä¸€ç§ä»¥äººä¸ºæ ¸å¿ƒã€è¿­ä»£ã€å¾ªåºæ¸è¿›çš„å¼€å‘æ–¹æ³•ï¼Œ**æ ¸å¿ƒå°±æ˜¯è¿­ä»£å¼€å‘ï¼Œæ¯ä¸ª Sprint çš„è¿­ä»£å‘¨æœŸæœ«å°¾ï¼Œéƒ½å…·å¤‡å¯ä»¥äº¤ä»˜çš„åŠŸèƒ½**ã€‚åœ¨æ•æ·å¼€å‘ä¸­ï¼Œè½¯ä»¶é¡¹ç›®çš„æ„å»ºè¢«åˆ‡åˆ†æˆå¤šä¸ªå­é¡¹ç›®ï¼Œå„ä¸ªå­é¡¹ç›®çš„æˆæœéƒ½ç»è¿‡æµ‹è¯•ï¼Œå…·å¤‡é›†æˆå’Œå¯è¿è¡Œçš„ç‰¹å¾ã€‚æ¢è¨€ä¹‹ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå¤§é¡¹ç›®åˆ†ä¸ºå¤šä¸ªç›¸äº’è”ç³»ï¼Œä½†ä¹Ÿå¯ç‹¬ç«‹è¿è¡Œçš„å°é¡¹ç›®ï¼Œå¹¶åˆ†åˆ«å®Œæˆï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­è½¯ä»¶ä¸€ç›´å¤„äºå¯ä½¿ç”¨çŠ¶æ€ã€‚ç®€è¦åˆ—ä¸¾ä¸€ä¸‹å®ƒçš„ç‰¹ç‚¹:

1. TDD æµ‹è¯•é©±åŠ¨å¼€å‘
2. æŒç»­é›†æˆ
3. é‡æ„(Refactoring) - clean code that works
4. ç»“å¯¹ç¼–ç¨‹(Pair-Programming) - ä¸¤ä¸ªäººåœ¨ä¸€èµ·æ¢è®¨å¾ˆå®¹æ˜“äº§ç”Ÿæ€æƒ³çš„ç«èŠ±
5. ç«™ç«‹ä¼šè®®(stand up) - æ¯å¤©æ—©ä¸Šï¼Œé¡¹ç›®ç»„çš„æ‰€æœ‰æˆå‘˜éƒ½ä¼šç«™ç«‹è¿›è¡Œä¸€æ¬¡ä¼šè®®ã€‚ä¸€èˆ¬æ¥è¯´æ˜¯ 15-20 åˆ†é’Ÿã€‚ä¼šè®®çš„å†…å®¹å¹¶ä¸æ˜¯éœ€æ±‚åˆ†æã€ä»»åŠ¡åˆ†é…ç­‰ï¼Œè€Œæ˜¯æ¯ä¸ªäººéƒ½å›ç­”ä¸‰ä¸ªé—®é¢˜ï¼š1. ä½ æ˜¨å¤©åšäº†ä»€ä¹ˆï¼Ÿ2. ä½ ä»Šå¤©è¦åšä»€ä¹ˆï¼Ÿ 3. ä½ é‡åˆ°äº†å“ªäº›å›°éš¾ï¼Ÿç«™ç«‹ä¼šè®®è®©å›¢é˜Ÿè¿›è¡Œäº¤æµï¼Œå½¼æ­¤ç›¸äº’ç†Ÿæ‚‰å·¥ä½œå†…å®¹
6. å°ç‰ˆæœ¬å‘å¸ƒ(Frequent Releases) - å‘å¸ƒé¢‘ç¹ï¼Œæ¯ä¸€ä¸ªç‰ˆæœ¬æ–°å¢çš„åŠŸèƒ½ç®€å•ï¼Œä¸éœ€è¦å¤æ‚çš„è®¾è®¡ï¼Œè¿™æ ·æ–‡æ¡£å’Œè®¾è®¡å°±åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šç®€åŒ–
7. ä»¥åˆä½œä¸ºä¸­å¿ƒï¼Œè¡¨ç°ä¸ºä»£ç å…±äº«ï¼›å¯è°ƒæ•´è®¡åˆ’ï¼›è‡ªåŠ¨åŒ–æµ‹è¯•ç­‰å…¶ä»–ç‰¹ç‚¹

> æ•æ·å¼€å‘æ–¹æ³•å¾ˆå¤šï¼ŒåŒ…æ‹¬ `Scrumã€æé™ç¼–ç¨‹ã€åŠŸèƒ½é©±åŠ¨å¼€å‘ä»¥åŠç»Ÿä¸€è¿‡ç¨‹ï¼ˆRUPï¼‰`ç­‰å¤šç§æ³•ï¼Œè¿™äº›æ–¹æ³•æœ¬è´¨å®é™…ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥æŒ‰ç…§é¡¹ç›®æˆå‘˜æœ¬èº«æ¥çµæ´»å®šåˆ¶ã€‚

**DevOps ä¸æ•æ·å¼€å‘æ˜¯ç›¸è¾…ç›¸æˆçš„**ã€‚DevOps æ˜¯ä¸€ç§æ–‡åŒ–ï¼Œæ—¨åœ¨ä¿ƒè¿›è½¯ä½“å¼€å‘å’Œç»´æŠ¤è¿‡ç¨‹ä¸­æ‰€æœ‰å‚ä¸è€…é—´çš„å…±åŒä½œä¸šã€‚æ•æ·å¼å¼€å‘å¯è¯´æ˜¯ä¸€é¡¹å¼€å‘æ–¹æ³•ï¼Œæ—¨åœ¨äºéœ€æ±‚ä¸æ–­å˜åŒ–çš„æ™®éç°å®æƒ…å†µä¸‹ï¼Œä¿æŒç”Ÿäº§åŠ›å’ŒåŠ é€Ÿå‘è¡Œã€‚è™½ç„¶ DevOps ä¸æ•æ·å¼€å‘ä¸åŒï¼Œä½†æ­é…ä½¿ç”¨æ—¶ï¼Œè¿™ä¸¤ç§æ–¹æ³•çš†èƒ½æå‡æ•ˆç‡ä¸ç»“æœçš„å¯é æ€§ã€‚

### ä¸ ITSM / ITIL çš„å…³ç³»

**ITSM(IT Service Management)**æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ç»„ç»‡ä¸ºè®¾è®¡ã€å®æ–½ã€æ”¹è¿›å’Œæ”¯æŒ IT æœåŠ¡è€Œæ‰§è¡Œçš„æ‰€æœ‰æ´»åŠ¨ã€æµç¨‹ã€ç­–ç•¥å’Œè¿‡ç¨‹ã€‚è¿™æ˜¯ç®¡ç†ç»„ç»‡ä¸­çš„ä¿¡æ¯æŠ€æœ¯å¹¶ä¸ºå®¢æˆ·æä¾›ä»·å€¼çš„ä¸€ç§æˆ˜ç•¥æ–¹æ³•ã€‚å®ƒçš„å¥½å¤„æ˜¯:

1. ç¡®å®šçš„è§’è‰²å’ŒèŒè´£
2. ä»¥ä½æˆæœ¬æä¾›æ›´å¥½çš„æœåŠ¡
3. æé«˜ç”Ÿäº§ç‡
4. è¯†åˆ«å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›
5. æœ€ç»ˆç”¨æˆ·æ»¡æ„åº¦

> **ITIL(IT Infrastructure Library)** æ˜¯ ITSM çš„æœ€ä½³å®è·µæ¡†æ¶ã€‚å®ƒæœ‰åŠ©äºæä¾›å¿…è¦çš„å·¥å…·å’ŒæŠ€æœ¯ï¼Œä»¥æœ‰æ•ˆåœ°æä¾›é‚£äº›æœåŠ¡ã€‚å…¶ä»–æ¡†æ¶è¿˜æœ‰ `COBITã€FitSMã€Lean å’Œ Agile and DevOps` ç­‰ã€‚

æœ‰äººå¯èƒ½ä¼šè¯´ DevOps ä¼šä»£æ›¿ ITILï¼Ÿ

äº‹å®å¹¶éå¦‚æ­¤ã€‚å› ä¸ºå°½ç®¡ IT éƒ¨é—¨å¯èƒ½æ‘†è„±äº† ITIL åŸ¹è®­å’Œæµç¨‹å­¤å²›ï¼Œä½†ä»–ä»¬ä»ç„¶éœ€è¦åšä¸€äº›æœåŠ¡ç®¡ç†æ–¹é¢çš„å·¥ä½œã€‚è¿™äº›æ˜¯å¿…ä¸å¯å°‘çš„ä¸šåŠ¡åŠŸèƒ½ï¼ŒDevOps å¹¶æ²¡æœ‰åƒ ITIL é‚£æ ·ä¸ºæˆ‘ä»¬æä¾›æµç¨‹æŒ‡å¯¼ï¼Œå› æ­¤ï¼Œå³ä½¿æ˜¯åªä½¿ç”¨ DevOps ï¼Œç°åœ¨ä»ç„¶éµå¾ªæŸäº› ITIL æµç¨‹æˆ–åŸåˆ™ã€‚

å¾ˆæ˜¾ç„¶ï¼ŒITIL å’Œ DevOps çš„åŸºç¡€å¹¶æ²¡æœ‰å¤ªå¤§å·®å¼‚ï¼Œå®ƒä»¬çš„æ ¹æºç›¸ä¼¼ï¼Œæ—¨åœ¨æ›´å¥½åœ°åä½œå’Œæé«˜æ•ˆç‡ã€‚DevOps æ—¨åœ¨é€šè¿‡è‡ªåŠ¨åŒ–å®ç°æ›´å¿«çš„å‘¨è½¬å’Œæ•æ·æ€§ï¼Œè€Œ ITIL è¿˜å¼ºè°ƒè‡ªåŠ¨åŒ–ä»¥æé«˜æœåŠ¡æ•ˆç‡ã€‚æˆåŠŸçš„ç§˜è¯€åœ¨äºæ¸…æ¥šåœ°äº†è§£æ¯ä¸ªç›®æ ‡çš„ç›®çš„ï¼Œå¹¶é’ˆå¯¹æ­£ç¡®çš„é—®é¢˜å®æ–½æ­£ç¡®çš„æ–¹æ³•ã€‚åªè¦ä¼ä¸šäº†è§£å…¶åŠ¨æ€ï¼ŒITIL å’Œ DevOps å¯ä»¥æˆä¸ºå¾ˆå¥½çš„æœ‹å‹ã€‚

## Github Actions

å›åˆ°æˆ‘ä»¬çš„ä¸»é¢˜ - [**Github Actions**](https://help.github.com/en/actions/creating-actions/about-actions#versioning-your-action)ã€‚å®ƒå…¶å®æ˜¯ä¸Šé¢è®²åˆ°çš„ CI / CD å·¥å…·ã€‚2019 å¹´ 8 æœˆ 8 æ—¥ï¼ŒGitHub å®˜æ–¹åšå®¢å‘æ–‡ç§°ï¼Œç¨‹åºå‘˜æœŸå¾…å·²ä¹…çš„åŠŸèƒ½æ¥äº†ï¼ŒGithub Actions ç»ˆäºæ”¯æŒå†…ç½® CI / CD äº†ï¼Œå¹¶å¯¹æ‰€æœ‰å¼€æºé¡¹ç›®å…è´¹ã€‚GitHub Actions çš„ä¸»è¦ä½œç”¨å°±æ˜¯è®©ç”¨æˆ·èƒ½å¤Ÿåœ¨ GitHub æœåŠ¡å™¨ä¸Šç›´æ¥æ‰§è¡Œå’Œæµ‹è¯•ä»£ç ï¼Œåªéœ€å‡ ä¸ªç®€å•æ­¥éª¤å°±å¯ä»¥å®ç°æ„å»ºã€å…±äº«å’Œæ‰§è¡Œä»£ç ã€‚ä¸‹é¢ä¸»è¦æ‘˜è‡ªé˜®ä¸€å³°çš„ [Github Actions å…¥é—¨æ•™ç¨‹](http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html)ã€‚

å½“ç„¶ï¼Œä¹Ÿä¼šæœ‰äººæ‹…å¿ƒ Actions CI / CD æ˜¯å¦ä¼šä¸ `Jenkinsã€ AWS CodeDeploy æˆ– GitLab CI` ç­‰å…¶ä»– CI / CD å·¥å…·ç«äº‰ã€‚å¯¹æ­¤ï¼ŒGitHub äº§å“è®¾è®¡é«˜çº§æ€»ç›‘ Max Schoening è¡¨ç¤ºï¼šâ€œæˆ‘ä»¬ä»æœªå°†å…¶å®ƒ CI/CD å·¥å…·æˆ–å‚å•†è§†ä¸ºç«äº‰å¯¹æ‰‹ï¼ŒGitHub Actions æ˜¯ç¤¾åŒºé©±åŠ¨æ”¯æŒçš„å·¥ä½œæµç¨‹è‡ªåŠ¨åŒ–ã€‚GitHub å’Œæˆ‘ä»¬çš„ç¤¾åŒºä¸€ç›´ç›¸ä¿¡é€‰æ‹©å’Œå¼€æ”¾çš„ç”Ÿæ€ç³»ç»Ÿï¼Œè¿™æ˜¯æˆ‘ä»¬å¯¹å¾…æ¯ä»¶äº‹çš„æ€åº¦ã€‚GitHub Actions å…è®¸å¼€å‘äººå‘˜é›†æˆä»–ä»¬ç°æœ‰çš„æ‰€æœ‰å·¥å…·ï¼Œæ··åˆå’ŒåŒ¹é…æ–°çš„å¼€å‘äººå‘˜äº§å“ï¼Œå¹¶è¿æ¥åˆ°è½¯ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ‰€æœ‰éƒ¨åˆ†ï¼ŒåŒ…æ‹¬ç°æœ‰çš„ CI / CD åˆä½œä¼™ä¼´ã€‚â€

æŒç»­é›†æˆç”±å¾ˆå¤šæ“ä½œç»„æˆï¼Œæ¯”å¦‚æŠ“å–ä»£ç ã€è¿è¡Œæµ‹è¯•ã€ç™»å½•è¿œç¨‹æœåŠ¡å™¨ï¼Œå‘å¸ƒåˆ°ç¬¬ä¸‰æ–¹æœåŠ¡ç­‰ç­‰ã€‚GitHub æŠŠè¿™äº›æ“ä½œå°±ç§°ä¸º actionsã€‚ä¸åŒé¡¹ç›®ä¸‹ actions å¯èƒ½ç›¸åŒï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€äº›è„šæœ¬æˆ–è€…ç›´æ¥å¼•ç”¨åˆ«äººå†™å¥½çš„ï¼ŒGitHub åšäº†ä¸€ä¸ª[å®˜æ–¹å¸‚åœº](https://github.com/marketplace?type=actions)ï¼Œå¯ä»¥æœç´¢åˆ°ä»–äººæäº¤çš„ actionsã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ª [awesome actions](https://github.com/sdras/awesome-actions) çš„ä»“åº“ï¼Œä¹Ÿæ”¶å½•å’Œæ•´ç†äº†ä¸å°‘ actionsã€‚

æ—¢ç„¶ actions æ˜¯ä»£ç ä»“åº“ï¼Œå½“ç„¶å°±æœ‰ç‰ˆæœ¬çš„æ¦‚å¿µï¼Œç”¨æˆ·å¯ä»¥å¼•ç”¨æŸä¸ªå…·ä½“ç‰ˆæœ¬çš„ actionã€‚ä¸‹é¢éƒ½æ˜¯åˆæ³•çš„ action å¼•ç”¨ï¼Œç”¨çš„å°±æ˜¯ Git çš„æŒ‡é’ˆæ¦‚å¿µ:

```SHELL
actions/setup-node@74bc508 # æŒ‡å‘ä¸€ä¸ª commit
actions/setup-node@v1.0    # æŒ‡å‘ä¸€ä¸ªæ ‡ç­¾
actions/setup-node@master  # æŒ‡å‘ä¸€ä¸ªåˆ†æ”¯
```

Github Actions æœ‰ä¸€äº›æ¦‚å¿µéœ€è¦ä»‹ç»ä¸‹:

1. **workflow** - æŒç»­é›†æˆä¸€æ¬¡è¿è¡Œçš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä¸€ä¸ª workflow
2. **job** - ä¸€ä¸ª workflow ç”±ä¸€ä¸ªæˆ–å¤šä¸ª jobs æ„æˆï¼Œå«ä¹‰æ˜¯ä¸€æ¬¡æŒç»­é›†æˆçš„è¿è¡Œï¼Œå¯ä»¥å®Œæˆå¤šä¸ªä»»åŠ¡
3. **step** - æ¯ä¸ª job ç”±å¤šä¸ª step æ„æˆï¼Œä¸€æ­¥æ­¥å®Œæˆ
4. **action** - æ¯ä¸ª step å¯ä»¥ä¾æ¬¡æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå‘½ä»¤(action)

æˆ‘ä»¬æ¥çœ‹çœ‹ Github Actions é…ç½®æ–‡ä»¶çš„åŸºæœ¬æ„æˆï¼Œé…ç½®æ–‡ä»¶æ ¼å¼æ˜¯ `.yml`ï¼Œç¤ºä¾‹å¦‚ä¸‹:

```YAML
# workflow åç§°
name: Github Action Example

# è§¦å‘ workflow çš„äº‹ä»¶
on:
  push:
    branches:
      - master # åªæœ‰ master åˆ†æ”¯å‘ç”Ÿ push äº‹ä»¶æ—¶ï¼Œæ‰ä¼šè§¦å‘ workflow

# å½“å‰ workflow è¦æ‰§è¡Œçš„ä¸€é¡¹æˆ–å¤šé¡¹ä»»åŠ¡ jobs
jobs:
  # ä¸€ä¸ª job ä»»åŠ¡ï¼Œä»»åŠ¡åä¸º build
  build:
    # runs-on æŒ‡å®š job ä»»åŠ¡è¿è¡Œæ‰€éœ€è¦çš„è™šæ‹Ÿæœºç¯å¢ƒ(å¿…å¡«å­—æ®µ)
    runs-on: ubuntu-latest
    # steps æ˜¯æ¯ä¸ª job çš„è¿è¡Œæ­¥éª¤ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤
    steps:
      # action å‘½ä»¤ï¼Œåˆ‡æ¢åˆ†æ”¯è·å–æºç 
      - name: Checkout
        # ä½¿ç”¨ action åº“ actions/checkout è®¿é—®ä»“åº“ä»£ç 
        uses: actions/checkout@master
      # action å‘½ä»¤ï¼Œå®‰è£… Node10
      - name: use Node.js 10
        # ä½¿ç”¨ action åº“  actions/setup-node å®‰è£… node
        uses: actions/setup-node@v1
        with:
          node-version: 10
      # action å‘½ä»¤ï¼Œinstall && test
      - name: npm install and test
        # è¿è¡Œçš„å‘½ä»¤æˆ–è€… action
        run: | # å¤šè¡Œå­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨ | ä¿ç•™æ¢è¡Œç¬¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ > æŠ˜å æ¢è¡Œ
          npm install
          npm run test
        # ç¯å¢ƒå˜é‡
        env:
          CI: true
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
```

å½“æˆ‘ä»¬é…ç½®å®Œåï¼Œå°†æäº¤ push åˆ°è¿œç«¯ä»“åº“æ—¶ï¼Œ Github ä¸€æ—¦å‘ç°äº† workflow æ–‡ä»¶ä»¥åï¼Œå°±ä¼šè‡ªåŠ¨è¿è¡Œã€‚å¹¶ä¸”å¯ä»¥åœ¨ç½‘ç«™ä¸Šå®æ—¶æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼Œæœ‰ä¸åŒçš„çŠ¶æ€ä¿¡æ¯:

## Gitlab CI / CD

å¯¹äºæ—¥å¸¸å›¢é˜Ÿå¼€å‘ï¼Œæˆ‘ä»¬é¡¹ç›®éƒ½æ˜¯æ‰˜ç®¡åœ¨ Gitlab ä¸Šï¼Œå®ƒä¹Ÿæä¾›äº†ç›¸åº”çš„ CI / CD åŠŸèƒ½ï¼Œå³ [**Gitlab CI / CD**](https://docs.gitlab.com/ee/ci/)ã€‚å…¶é…ç½®æ–‡ä»¶ä½äºæ ¹ç›®å½•ï¼Œåä¸º `.gitlab-ci.yml`ï¼Œè¯¥æ–‡ä»¶åˆ›å»ºä¸€ä¸ª**ç®¡é“(pipeline)**ï¼Œè¯¥ç®¡é“è¿è¡Œä»¥æ›´æ”¹å­˜å‚¨åº“ä¸­çš„ä»£ç ã€‚ç®¡é“ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‰é¡ºåºè¿è¡Œçš„é˜¶æ®µç»„æˆï¼Œæ¯ä¸ªé˜¶æ®µå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå¹¶è¡Œè¿è¡Œçš„è„šæœ¬ã€‚è¿™äº›è„šæœ¬ç”± `GitLab Runner` ä»£ç†æ‰§è¡Œã€‚

> **GitLab Runner** is an application that works with GitLab CI/CD to run jobs in a pipeline.

<!-- ![Gitlab CI / CD](https://about.gitlab.com/images/ci/gg_2x.png) -->

Gitlab æä¾›äº†[ä¸€äº›æ¨¡æ¿](https://gitlab.com/gitlab-org/gitlab-foss/tree/master/lib/gitlab/ci/templates)ä¾›æˆ‘ä»¬é€‰æ‹©ã€‚å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ï¼Œå…·ä½“çš„é…ç½®å¯ä»¥[æŸ¥çœ‹ä¸‹å®˜æ–¹æ–‡æ¡£](https://docs.gitlab.com/ee/ci/yaml/README.html)ã€‚è¿™é‡Œåªæ˜¯ç®€å•ä»‹ç»ä¸€äº›æ¦‚å¿µ:

<!-- ![Gitlab CI / CD templates](https://docs.gitlab.com/ee/ci/img/add_file_template_11_10.png) -->

1. **stages** - å®šä¹‰ pipeline çš„ job æ•°é‡å’Œåç§°
2. **variables** - å®šä¹‰æµç¨‹ä¸­çš„ä¸€äº›ç¯å¢ƒå˜é‡
3. **before_scripts** - åœ¨æ¯ä¸ª job çš„ scripts æ‰§è¡Œå‰è¿›è¡Œçš„å‘½ä»¤é›†ï¼Œä¸€èˆ¬æ˜¯åˆ›å»ºç›®å½•ï¼Œæ‰“å° context ç›®å½•ç­‰æ“ä½œï¼Œå¯ç±»æ¯” unittest çš„ setUp æ–¹æ³•
4. **stage** - å®šä¹‰äº†ä¸€ä¸ª job çš„å…·ä½“æµç¨‹ï¼Œå¯ä»¥åœ¨å‰é¢åŠ ä¸Šåç§°

```YAML
stages: # åŒ…å«äº†ä¸‰ä¸ª job - test, build, deployã€‚åˆ†åˆ«å®ç°è‡ªåŠ¨æµ‹è¯•ï¼Œæ‰“åŒ…é¡¹ç›®å’Œéƒ¨ç½²
  - test
  - build
  - deploy

variables: # è®¾ç½®ä¸€äº›å˜é‡
  GIT_STRATEGY: none
  PROJECT_REPO_NAMESPACE: test
  PROJECT_REPO_NAME: cicd_learn
  DEPLOYMENT_REPO_NAMESPACE: test
  DEPLOYMENT_REPO_NAME: deploy_test

before_script:
  - export ROOT_PATH=$(pwd)
  - echo 'root path:' $ROOT_PATH
  - mkdir $PROJECT_REPO_NAME
  - cd $PROJECT_REPO_NAME
  - <some git manipulation here>
  - echo 'date:' $DATE

test_stage:
  stage: test
  script:
    - <test related command here>
  artifacts: # å®šä¹‰ job çš„äº§å‡º
    paths: # æ•°ç»„å†…çš„ paths å’Œ when åˆ†åˆ«å®šä¹‰æŠ¥å‘Šçš„è·¯å¾„å’Œäº§å‡ºåœºæ™¯ã€‚æ­¤å¤„è¡¨ç¤ºæŠ¥å‘Šæ”¾ç½®äºæ ¹ç›®å½•ä¸‹ï¼Œä»»ä½•æ—¶å€™éƒ½è¦æä¾›æŠ¥å‘Š
      - xxx.html
    when: always
  allow_failure: false # å¦‚æœå€¼ä¸º trueï¼Œé‚£ä¹ˆå³ä½¿æ²¡é€šè¿‡æµ‹è¯•ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œåç»­çš„ job

build_stage:
  stage: build
  script:
     - <build related command here>
  when: manual # å€¼ä¸º manual è¡¨ç¤ºå…¶éœ€è¦åœ¨ Gitlab ä¸Šæ‰‹åŠ¨è§¦å‘ï¼ˆé¡µé¢ä¸Šç‚¹å‡»æŒ‰é’®å³å¯ï¼‰
  allow_failure: false
  only: # è¡¨æ˜åªæœ‰ master åˆ†æ”¯å¯ä»¥æ‰§è¡Œ buildï¼Œå¦‚æœè¦ç”¨æ’é™¤æ³•åå‘æŒ‡å®šï¼Œå¯ä»¥ç”¨ except
    - master

deploy:
  stage: deploy
  script:
    - <deploy related command here>
  allow_failure: false
  only:
    - master
```

å½“ç„¶ GitLab CI / CD ä¸ä»…å¯ä»¥æ‰§è¡Œè®¾ç½®çš„è„šæœ¬ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºæ‰§è¡ŒæœŸé—´å‘ç”Ÿçš„æƒ…å†µï¼Œå°±åƒåœ¨ç»ˆç«¯æœºä¸­çœ‹åˆ°çš„é‚£æ ·:

![Gitlab CI/CD job running](https://docs.gitlab.com/ee/ci/introduction/img/job_running.png)

> å…³äº Github Actions å’Œ Gitlab CI / CD çš„åŒºåˆ«å’Œè¿ç§»ç»†èŠ‚å¯ä»¥[å‚è€ƒè¿™é‡Œ](https://docs.github.com/en/actions/migrating-to-github-actions/migrating-from-gitlab-cicd-to-github-actions) ğŸ‘ˆ

## Jenkins

[**Jenkins**](https://www.jenkins.io/doc/) çš„ç›®æ ‡æ˜¯è¦å°†è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„æ•´ä¸ªè¿‡ç¨‹éƒ½è‡ªåŠ¨åŒ–ï¼Œä»å¼€å‘äººå‘˜å‘ä»£ç åº“ä¸­æäº¤ä»£ç å¼€å§‹ï¼Œåˆ°å°†æ­¤ä»£ç æŠ•å…¥ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¸ºæ­¢ã€‚ä¸ºäº†ä½¿æ•´ä¸ªè½¯ä»¶å¼€å‘æµç¨‹å¤„äº DevOps æ¨¡å¼æˆ–è‡ªåŠ¨åŒ–æ¨¡å¼ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹ CI/CD æµæ°´çº¿è¿›è¡Œè‡ªåŠ¨åŒ–ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€æ¬¾è‡ªåŠ¨åŒ–å·¥å…·æ¥åšè¿™ä»¶äº‹æƒ…ï¼Œå®ƒå°±æ˜¯ Jenkinsã€‚Jenkins æ˜¯åŸºäº Java å¼€å‘çš„æŒç»­é›†æˆå·¥å…·ï¼Œæä¾›äº† web å¯è§†åŒ–é…ç½®ç®¡ç†é¡µé¢ï¼Œå®‰è£…é…ç½®ç®€å•ï¼Œæ’ä»¶èµ„æºä¸°å¯Œã€‚

![jenkins](https://sdn.youdianzhishi.com/images/2019/12/30/7fdc1bd02af848df80d6c0951f9dd1af.png)

### pipeline

æœ¬è´¨ä¸Šï¼ŒJenkins æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å¼•æ“ï¼Œå®ƒæ”¯æŒè®¸å¤šè‡ªåŠ¨æ¨¡å¼ã€‚**æµæ°´çº¿(pipeline)**å‘ Jenkins æ·»åŠ äº†ä¸€ç»„å¼ºå¤§çš„å·¥å…·ï¼Œæ”¯æŒç”¨ä¾‹ã€ç®€å•çš„æŒç»­é›†æˆåˆ°å…¨é¢çš„æŒç»­äº¤ä»˜æµæ°´çº¿ã€‚ é€šè¿‡å¯¹ä¸€ç³»åˆ—çš„å‘å¸ƒä»»åŠ¡å»ºç«‹æ ‡å‡†çš„æ¨¡æ¿ï¼Œç”¨æˆ·å¯ä»¥åˆ©ç”¨æ›´å¤šæµæ°´çº¿çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼š

1. ä»£ç åŒ–ï¼šæµæ°´çº¿æ˜¯åœ¨ä»£ç ä¸­å®ç°çš„ï¼Œé€šå¸¸ä¼šå­˜æ”¾åˆ°æºä»£ç æ§åˆ¶ï¼Œä½¿å›¢é˜Ÿå…·æœ‰ç¼–è¾‘ã€å®¡æŸ¥å’Œæ›´æ–°ä»–ä»¬é¡¹ç›®çš„äº¤ä»˜æµæ°´çº¿çš„èƒ½åŠ›ã€‚
1. è€ç”¨æ€§ï¼šæµæ°´çº¿å¯ä»¥ä» Jenkins çš„ master èŠ‚ç‚¹é‡å¯åç»§ç»­è¿è¡Œã€‚
1. å¯æš‚åœçš„ï¼šæµæ°´çº¿å¯ä»¥ç”±äººåŠŸè¾“å…¥æˆ–æ‰¹å‡†ç»§ç»­æ‰§è¡Œæµæ°´çº¿ã€‚
1. è§£å†³å¤æ‚å‘å¸ƒï¼šæ”¯æŒå¤æ‚çš„äº¤ä»˜æµç¨‹ã€‚ä¾‹å¦‚å¾ªç¯ã€å¹¶è¡Œæ‰§è¡Œã€‚
1. å¯æ‰©å±•æ€§ï¼šæ”¯æŒæ‰©å±• DSL å’Œå…¶ä»–æ’ä»¶é›†æˆã€‚

æµæ°´çº¿å¥½æ¯”åœ°é“ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡åœ°é“çš„è¿è¡Œçº¿è·¯å›¾ï¼ˆJenkinsfileï¼‰ï¼Œåœ¨çº¿è·¯å›¾ä¸­æŒ‡å®šè¦ç»è¿‡çš„ç«™ç‚¹ï¼ˆstagesï¼‰ã€‚**Jenkinsfile** ä½¿ç”¨ä¸¤ç§è¯­æ³•è¿›è¡Œç¼–å†™ï¼Œåˆ†åˆ«æ˜¯å£°æ˜å¼å’Œè„šæœ¬å¼ã€‚å£°æ˜å¼å’Œè„šæœ¬å¼çš„æµæ°´çº¿ä»æ ¹æœ¬ä¸Šæ˜¯ä¸åŒçš„ï¼Œå£°æ˜å¼æµæ°´çº¿ä½¿ç¼–å†™å’Œè¯»å–æµæ°´çº¿ä»£ç æ›´å®¹æ˜“è®¾è®¡ï¼›è„šæœ¬å¼çš„æµæ°´çº¿è¯­æ³•ï¼Œæä¾›æ›´ä¸°å¯Œçš„è¯­æ³•ç‰¹æ€§ã€‚

```js
// å£°æ˜å¼è¯­æ³•
pipeline {
  // æŒ‡å®šè¿è¡Œæ­¤æµæ°´çº¿çš„èŠ‚ç‚¹
  agent { node { label "build" } }

  // æµæ°´çº¿çš„é˜¶æ®µ
  stages {
    // é˜¶æ®µ 1 è·å–ä»£ç 
    stage("CheckOut") {
      steps{
        script{
          println("è·å–ä»£ç ")
        }
      }
    }
    stage("Build"){
      steps{
        script{
          println("è¿è¡Œæ„å»º")
        }
      }
    }
  }
  post {
    always{
      script{
        println("æµæ°´çº¿ç»“æŸåï¼Œç»å¸¸åšçš„äº‹æƒ…")
      }
    }
    success{
      script{
        println("æµæ°´çº¿æˆåŠŸåï¼Œè¦åšçš„äº‹æƒ…")
      }
    }
    failure{
      script{
        println("æµæ°´çº¿å¤±è´¥åï¼Œè¦åšçš„äº‹æƒ…")
      }
    }
    aborted{
      script{
        println("æµæ°´çº¿å–æ¶ˆåï¼Œè¦åšçš„äº‹æƒ…")
      }
    }
  }
}
```

![pipeline](https://www.k8stech.net/jenkins-docs/pipelinesyntax/chapter01/images/03-jenkinslog.png)

### å…±äº«åº“ä¸ Groovy

**å…±äº«åº“**è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ¦‚å¿µï¼Œå…¶å®å…·æœ‰ç¼–ç¨‹èƒ½åŠ›çš„åŒå­¦åº”è¯¥æ¸…æ¥šä¸€äº›ã€‚ä¾‹å¦‚åœ¨ç¼–ç¨‹è¯­è¨€ Python ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°† Python ä»£ç å†™åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå½“ä»£ç æ•°é‡å¢åŠ ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»£ç æ‰“åŒ…æˆæ¨¡å—ç„¶åå†ä»¥ import çš„æ–¹å¼ä½¿ç”¨æ­¤æ¨¡å—ä¸­çš„æ–¹æ³•ã€‚

åœ¨ Jenkins ä¸­ä½¿ç”¨ [**Apache Groovy**](https://groovy-lang.org) è¯­æ³•ï¼Œå…±äº«åº“ä¸­å­˜å‚¨çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ª groovy çš„ç±»ï¼Œæ¯ä¸ªæ–‡ä»¶ï¼ˆç±»ï¼‰ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ã€‚æ¯ä¸ªæ–¹æ³•åŒ…å« groovy è¯­å¥å—ã€‚å¦‚ä¸‹ï¼Œåœ¨ Jenkinsfile ä¸­ä½¿ç”¨ `@Library ('jenkinslib') _` æ¥åŠ è½½å…±äº«åº“ï¼Œæ³¨æ„åé¢ç¬¦å· _ ç”¨äºåŠ è½½ï¼Œæœ€åå†è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•ã€‚

Groovy æ˜¯ä¸€ç§å¼ºå¤§çš„ã€å¯é€‰ç±»å‹çš„åŠ¨æ€è¯­è¨€ï¼Œå…·æœ‰é™æ€ç±»å‹å’Œé™æ€ç¼–è¯‘åŠŸèƒ½ï¼Œç”¨äº Java å¹³å°ï¼Œæ—¨åœ¨é€šè¿‡ç®€æ´ã€ç†Ÿæ‚‰ä¸”æ˜“äºå­¦ä¹ çš„è¯­æ³•æé«˜å¼€å‘äººå‘˜çš„ç”Ÿäº§åŠ›ã€‚å®ƒå¯ä»¥ä¸ä»»ä½• Java ç¨‹åºé¡ºåˆ©é›†æˆï¼Œå¹¶ç«‹å³ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›å¼ºå¤§çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬è„šæœ¬åŠŸèƒ½ã€é¢†åŸŸç‰¹å®šè¯­è¨€åˆ›ä½œã€è¿è¡Œæ—¶å’Œç¼–è¯‘æ—¶å…ƒç¼–ç¨‹ä»¥åŠå‡½æ•°å¼ç¼–ç¨‹ã€‚

```js
#!groovy

@Library('jenkinslib') _     

// ç±»çš„å®ä¾‹åŒ–
def tools = new org.devops.tools()

pipeline {
  agent { node {  label "master" }}

  stages {
    // ä¸‹è½½ä»£ç 
    stage("GetCode"){ 
      steps{  
        timeout(time:5, unit:"MINUTES"){   
          script{ 
            // è°ƒç”¨ç±»å®ä¾‹ä¸Šçš„æ–¹æ³•
            tools.PrintMes("è·å–ä»£ç ", 'green')
          }
        }
      }
    }
  }
}
```

### æµæ°´çº¿

Jenkins æµæ°´çº¿å¯ä»¥ä¸ä»¥ä¸‹å·¥å…·è¿›è¡Œé›†æˆï¼š

1. æ„å»ºå·¥å…· - å¦‚ Mavenã€Antã€Gradleã€Npm
   1. Jenkins è°ƒç”¨è¿™äº›å·¥å…·çš„æ–¹å¼æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡è°ƒç”¨ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åœ¨ Jenkins ç³»ç»Ÿé…ç½®ä¸­æ·»åŠ æ„å»ºå·¥å…·çš„ç¯å¢ƒå˜é‡ï¼›ä¸€ç§æ˜¯ç›´æ¥åœ¨ Jenkinsfile ä¸­å®šä¹‰ã€‚å®ç°çš„æ•ˆæœæ²¡æœ‰åŒºåˆ«ï¼Œè€Œåè€…æ›´åŠ çµæ´»å¯¹äºé…ç½® Jenkins æ— çŠ¶æ€åŒ–æœ‰å¥½å¤„ã€‚å…·ä½“å¯ä»¥[å‚è€ƒè¿™é‡Œ](https://www.k8stech.net/jenkins-docs/pipelineintegrated/chapter01/#jenkins) ğŸ‘ˆ
2. å‘å¸ƒå·¥å…· - å¦‚ Saltstackã€Ansible
3. ç”¨æˆ·è®¤è¯ç³»ç»Ÿ - LDAPã€Githubã€Gitlab
   1. Jenkins é»˜è®¤ä½¿ç”¨è‡ªå¸¦æ•°æ®åº“æ¨¡å¼å­˜å‚¨ç”¨æˆ·ï¼Œåœ¨ä¼ä¸šä¸­ä¸€èˆ¬éƒ½ä¼šæœ‰ç»Ÿä¸€çš„è®¤è¯ä¸­å¿ƒï¼Œä¾‹å¦‚ LDAPã€ActiveDirectory ä¸­ç®¡ç†ç”¨æˆ·ã€‚å¯ä»¥é…ç½® Jenkins é›†æˆå®ç°ç»Ÿä¸€ç”¨æˆ·ç®¡ç†ã€‚
4. ç‰ˆæœ¬æ§åˆ¶å·¥å…· - Gitlab
   1. å½“ Gitlab ä¸­è§¦å‘ push æ“ä½œï¼Œåˆ™è§¦å‘ç›¸å¯¹åº”çš„ Jenkins æµæ°´çº¿æ„å»ºã€‚å®ç°å¿«é€Ÿåé¦ˆä¸éªŒè¯ã€‚
      1. æ–¹å¼ 1ï¼š ä½¿ç”¨ **Gitlab CI**, å½“æœ‰ push è¯·æ±‚ï¼Œåœ¨ CI è„šæœ¬ä¸­è¿œç¨‹è§¦å‘ Jenkins é¡¹ç›®æ„å»ºã€‚éœ€è¦å‡†å¤‡ Gitlab runnerã€‚ç¼–å†™è§¦å‘ Jenkins è„šæœ¬
      2. æ–¹å¼ 2ï¼š ä½¿ç”¨ **Gitlab Webhook**, å½“æœ‰ push è¯·æ±‚ï¼Œç›´æ¥è§¦å‘ jenkins é¡¹ç›®æ„å»ºã€‚éœ€è¦é…ç½® Gitlab webhookã€‚éœ€è¦é…ç½® Jenkins é¡¹ç›® Hook
5. ä»£ç è´¨é‡ç®¡ç†å¹³å° - Sonarqube
   1. å¼€å‘äººå‘˜åœ¨ IDE å¼€å‘ä»£ç ï¼Œå¯ä»¥å®‰è£… **SonarLint** æ’ä»¶è¿›è¡Œæäº¤å‰ä»£ç æ‰«æï¼Œå½“å¼€å‘äººå‘˜æäº¤ä»£ç åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œè‡ªåŠ¨è§¦å‘ jenkins è¿›è¡Œä»£ç æ‰«æ
6. åˆ¶å“ä»“åº“ - å¦‚ nexusã€artiifactory
   1. åˆ¶å“ä¸»è¦è§£å†³ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ä¸‹è½½ç®¡ç†æ··ä¹±ï¼Œæ²¡æœ‰å‡†å…¥ç®¡æ§ä»¥åŠé’ˆå¯¹å¼•å…¥è¿›æ¥çš„ç¬¬ä¸‰ç»„ä»¶æ²¡æœ‰è¿›è¡Œç»„ä»¶æ‰«æï¼Œææ˜“å¼•å…¥æ¼æ´ç­‰ã€‚
7. è‡ªåŠ¨åŒ–æµ‹è¯• - å¦‚ JMeter

### CubeSats

**Cubesats** å®é™…ä¸Šå¯ä»¥ç†è§£ä¸ºåŸºäº `JAVA åç«¯æœåŠ¡ + Jenkins + Ansible + Nexus` çš„ä¸€ä¸ª CICD å¹³å°ï¼š

* Jenkins è´Ÿè´£å¤„ç†å„ç§æ„å»ºï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•ç­‰ä»»åŠ¡
* **Ansible** è´Ÿè´£éƒ¨ç½²äº§ç‰©ç­‰æ“ä½œã€‚Ansible æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿ç®¡ç†æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨æ¥å£çš„æ–¹å¼ï¼Œåœ¨æŒ‡å®šæœåŠ¡å™¨ä¸Šæ‰§è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚éƒ¨ç½²è¿‡ç¨‹å®è´¨ä¸Šæ˜¯è°ƒç”¨äº†å®ƒçš„æ¥å£ï¼Œç„¶åæ‰§è¡Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç‰¹å®šçš„éƒ¨ç½²è„šæœ¬ã€‚
* Nexus æœåŠ¡è¿™é‡Œæ˜¯æä¾›åˆ¶å“åº“ï¼Œå¯ä»¥ç”¨äºå­˜æ”¾å„ç§äº§ç‰©åŒ…ï¼ŒåŒ…æ‹¬ java å’Œ jsï¼Œæ–¹ä¾¿éƒ¨ç½²çš„æ—¶å€™æä¾›ä¸‹è½½ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸‹æ—¥å¸¸å®é™…ä½¿ç”¨ä½“éªŒï¼ŒåŒ…æ‹¬**æ„å»º**å’Œ**éƒ¨ç½²**ï¼š

ä»¥æäº¤åˆ° Git ä¸Šä¸ºæµç¨‹å¼€å§‹ï¼Œåœ¨ Cubesats ä¸Šé€‰æ‹©æ„å»ºï¼ŒCubesats ä¼šåˆ©ç”¨ Jenkins åˆ›å»ºä¸€ä¸ªä»»åŠ¡åˆ†é…ï¼Œå¹¶ä¸”æŠŠè¯¥ä»»åŠ¡åˆ†é…åˆ°ä¸€å°ç”¨äºæ„å»ºçš„æœºå™¨ (ä¸€èˆ¬ç§°ä¸ºä¸€ä¸ªèŠ‚ç‚¹)ï¼Œè¯¥ä»»åŠ¡ä¼šæ ¹æ®å…ˆå‰ç”¨æˆ·åœ¨ Cubesats ä¸­é…ç½®çš„ Git ä»“åº“åœ°å€ï¼Œæ‹‰å–å¯¹åº”çš„ä»“åº“ä»£ç åˆ°æœ¬åœ°æœºå™¨ä¸Šã€‚éšåï¼ŒJenkins ä¼šè°ƒç”¨ç”¨æˆ·äº‹å…ˆè®¾ç½®çš„æ„å»ºè„šæœ¬å‘½ä»¤ï¼Œé€šå¸¸éƒ½æ˜¯ Shell è„šæœ¬ã€‚æ‰§è¡ŒæˆåŠŸçš„è¯å°±ä¼šæŒ‰ç…§é¢„å…ˆè®¾å®šå¥½çš„è·¯å¾„ï¼ŒæŠŠè¯¥è·¯å¾„çš„æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…åˆ°ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ä¸­ï¼Œä¸€èˆ¬æ˜¯ zip æˆ–è€… tar ç»“å°¾çš„æ–‡ä»¶ï¼Œè€Œè¿™ä¸ªå‹ç¼©æ–‡ä»¶é€šå¸¸è¢«ç§°ä¸ºäº§ç‰©ã€‚æœ€åä¼šæŠŠæ–‡ä»¶ä¸Šä¼ åˆ°ä¸€ä¸ªä¸“â»”ç”¨äºå­˜æ”¾äº§ç‰©çš„èµ„æºæœåŠ¡å™¨ä¸Šï¼Œå¦‚ Verdaccioã€‚ä»¥ä¸Šéƒ½å®Œæˆåï¼Œåœ¨ Cubesats ä¸­å°±èƒ½çœ‹åˆ°ç•Œé¢ä¸Šæ˜¾ç¤ºæ„å»ºæˆåŠŸã€‚å½“ç„¶ï¼Œä»¥ä¸Šè¿‡ç¨‹å…¶å®è¿˜æœ‰å¾ˆå¤šç»†èŠ‚æ²¡æœ‰æåˆ°ï¼Œä½†æ˜¯æ€»ç»“ä¸‹å…¶å®å°±æ˜¯ **æ‰¾äº†å°æœºå™¨ï¼ŒæŠŠä»£ç æ‹‰ä¸‹æ¥ï¼Œç„¶åæ„å»ºä¸€ä¸‹ï¼ŒæŠŠ äº§ç‰©æ‰“ä¸ªåŒ…æ”¾åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹å°±è¢«ç§°ä¸ºæ„å»ºã€‚**

å½“æ„å»ºå®Œæˆåï¼Œæˆ‘ä»¬å°±ä¼šå‡†å¤‡å»å¯¹åº”çš„ç¯å¢ƒä¸­é€‰æ‹©å‘å¸ƒæˆ‘ä»¬åˆšæ‰çš„æ„å»ºå¥½çš„äº§ç‰©ã€‚åœ¨ç‚¹ä¸‹å‘å¸ƒæŒ‰é’®åï¼Œé€šå¸¸ä¼šåœ¨éœ€è¦éƒ¨ç½²æ–°ç‰ˆæœ¬äº§ç‰©çš„æœºå™¨ä¸Šæ‰§è¡Œç›¸åº”çš„è„šæœ¬ï¼Œå¤§ä½“ä¸Šå°±æ˜¯åœ¨è¯¥æœºå™¨ä¸Šä¸‹è½½äº§ç‰©ï¼Œç„¶åæŠŠå†…å®¹è§£å‹åˆ°æŸä¸ªè·¯å¾„ä¸‹ï¼Œè¿™ä¸ªè·¯å¾„é€šå¸¸æ˜¯ Nginx é…ç½®æŒ‡å®šçš„é™æ€èµ„æºè·¯å¾„ã€‚ä¸€èˆ¬æ¥è¯´å‰ç«¯çš„å‘å¸ƒè¦ç®€å•çš„å¤šï¼Œå¦‚æœæ¶‰åŠåˆ°åç«¯æœåŠ¡çš„å‘å¸ƒï¼Œåˆ™è¦å¤æ‚ä¸€äº›ã€‚ä¾‹å¦‚å‘å¸ƒä¸€ä¸ª Node.js çš„åç«¯æœåŠ¡çš„æ—¶å€™ï¼Œé€šå¸¸æ”¾åœ¨ PM2 å¯åŠ¨å…¥å£çš„è·¯å¾„ä¸‹ï¼Œç„¶åé€šè¿‡ PM2 å»å¯åŠ¨/æ›´æ–° Node.js çš„æœåŠ¡ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œå› ä¸ºå…·ä½“éƒ¨ç½²å› åº”ç”¨çš„ä¸åŒè€Œä¸åŒï¼Œä¹Ÿä¼šå–å†³äºå®æœºæˆ–è€… k8s è¿™ç§é›†ç¾¤å®¹å™¨çš„ä¸åŒè€Œå·®å¼‚å¾ˆå¤§ã€‚**æ€»æ¥çš„è¯´ï¼Œå‰ç«¯çš„éƒ¨ç½²å¤§ä½“ä¸Šå°±æ˜¯æ‰¾åˆ°å¯¹åº”æœåŠ¡çš„æœºå™¨ï¼ŒæŠŠäº§ç‰©ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åæ”¾åœ¨ WEB æœåŠ¡å®¹å™¨ (Nginx ä¹‹ç±»çš„) ä¸­ã€‚**

æˆ‘ä»¬å†æ¥çœ‹ä¸‹ç¤ºä¾‹å›¾ï¼š

![ci]( {{site.url}}/style/images/smms/cicd-ci.png )
![cd]( {{site.url}}/style/images/smms/cicd-cd.png )

> å…³äº PaaS å¹³å°çš„å†…å®¹å¯ä»¥æŸ¥çœ‹[è¿™ä¸€ç« èŠ‚]( {{site.url}}/2021/11/09/docker-k8s.html ) ğŸ‘ˆ

### Travis CI

[**Travis CI**](https://travis-ci.org) ä¹Ÿæ˜¯æä¾›çš„æŒç»­é›†æˆæœåŠ¡ï¼Œä½†å®ƒåªæ”¯æŒ Github/Bitbucket ä»£ç æ‰˜ç®¡å¹³å°ã€‚Travis è¦æ±‚é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹é¢ï¼Œå¿…é¡»æœ‰ä¸€ä¸ª `.travis.yml` æ–‡ä»¶ã€‚è¿™æ˜¯é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šäº† Travis çš„è¡Œä¸ºã€‚ä¸€æ—¦ä»£ç ä»“åº“æœ‰æ–°çš„ Commitï¼ŒTravis å°±ä¼šå»æ‰¾è¿™ä¸ªæ–‡ä»¶å¹¶æ‰§è¡Œé‡Œé¢çš„å‘½ä»¤ã€‚

å®ƒæä¾›äº†è®¸å¤šè‡ªåŠ¨ CI é€‰é¡¹ï¼Œç”±äº Travis CI æœåŠ¡å™¨æ‰˜ç®¡åœ¨äº‘ä¸­ï¼Œå› æ­¤æ— éœ€ä¸“ç”¨æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨è¿è¡Œäºä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„ä¸åŒè®¡ç®—æœºä¸Šçš„ä¸åŒç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ã€‚ç›¸å Jenkins åˆ™éœ€è¦æ­å»ºä¸“ç”¨æœåŠ¡å™¨ï¼Œä½†å…¶æœ¬èº«æ˜¯å…è´¹çš„ï¼›Travis CI å¯¹äºå¼€æºé¡¹ç›®æ˜¯å…è´¹çš„ï¼Œè€Œå¯¹äºå•†ä¸šé¡¹ç›®åˆ™éœ€è¦è´­ä¹°ä¼ä¸šè®¡åˆ’ã€‚

æ€»ç»“ä¸‹ä¸¤è€…çš„åŒºåˆ« - **å°å‹å¼€æºé¡¹ç›®æœ€é€‚åˆ Travis CIï¼Œå› ä¸ºå®ƒæ˜“äºè¿è¡Œä¸”è®¾ç½®è¿…é€Ÿã€‚å¤§å‹ä¼ä¸šæœ€é€‚åˆ Jenkinsï¼Œå› ä¸ºå®ƒä¸ºç§äººé¡¹ç›®æä¾›å…è´¹è®¸å¯å¹¶å…·æœ‰å¹¿æ³›çš„å¯å®šåˆ¶åŠŸèƒ½**ï¼š

1. Travis CI æ˜¯å•†ä¸š CI å·¥å…·ï¼Œè€Œ Jenkins æ˜¯å¼€æºå·¥å…·ã€‚
2. Jenkins éœ€è¦ç²¾å¿ƒè®¾ç½®æ—¶ï¼ŒTravis CI èŠ±è´¹çš„æ—¶é—´å¾ˆå°‘ã€‚
3. Travis CI æä¾›è¾ƒå°‘çš„è‡ªå®šä¹‰é€‰é¡¹ï¼Œè€Œ Jenkins æä¾›å¤§é‡çš„è‡ªå®šä¹‰é€‰é¡¹ã€‚
4. Travis CI æœ‰ä¸€ä¸ª YAML é…ç½®æ–‡ä»¶ï¼Œè€Œ Jenkins ä¸ºç”¨æˆ·æä¾›äº†å®Œæ•´çš„é…ç½®é€‰é¡¹ã€‚

## å…¶ä»–ç›¸å…³çŸ¥è¯†

### Maven & Nexus

åœ¨äº†è§£ [**Maven**](https://www.liaoxuefeng.com/wiki/1252599548343744/1309301146648610) ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸€ä¸ª Java é¡¹ç›®éœ€è¦çš„ä¸œè¥¿ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šå¼•å…¥å“ªäº›ä¾èµ–åŒ…ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ç”¨åˆ° commons loggingï¼Œæˆ‘ä»¬å°±å¿…é¡»æŠŠ commons logging çš„ jar åŒ…æ”¾å…¥ classpathã€‚å¦‚æœæˆ‘ä»¬è¿˜éœ€è¦ log4jï¼Œå°±éœ€è¦æŠŠ log4j ç›¸å…³çš„ jar åŒ…éƒ½æ”¾åˆ° classpath ä¸­ã€‚è¿™äº›å°±æ˜¯ä¾èµ–åŒ…çš„ç®¡ç†ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬è¦ç¡®å®šé¡¹ç›®çš„ç›®å½•ç»“æ„ã€‚ä¾‹å¦‚ï¼Œsrc ç›®å½•å­˜æ”¾ Java æºç ï¼Œresources ç›®å½•å­˜æ”¾é…ç½®æ–‡ä»¶ï¼Œbin ç›®å½•å­˜æ”¾ç¼–è¯‘ç”Ÿæˆçš„.class æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®ç¯å¢ƒï¼Œä¾‹å¦‚ JDK çš„ç‰ˆæœ¬ï¼Œç¼–è¯‘æ‰“åŒ…çš„æµç¨‹ï¼Œå½“å‰ä»£ç çš„ç‰ˆæœ¬å·ã€‚æœ€åï¼Œé™¤äº†ä½¿ç”¨ Eclipse è¿™æ ·çš„ IDE è¿›è¡Œç¼–è¯‘å¤–ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»èƒ½é€šè¿‡å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œç¼–è¯‘ï¼Œæ‰èƒ½å¤Ÿè®©é¡¹ç›®åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²ã€‚

è¿™äº›å·¥ä½œéš¾åº¦ä¸å¤§ï¼Œä½†æ˜¯éå¸¸çç¢ä¸”è€—æ—¶ã€‚å¦‚æœæ¯ä¸€ä¸ªé¡¹ç›®éƒ½è‡ªå·±æä¸€å¥—é…ç½®ï¼Œè‚¯å®šä¼šä¸€å›¢ç³Ÿã€‚æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–çš„ Java é¡¹ç›®ç®¡ç†å’Œæ„å»ºå·¥å…·ã€‚Maven å°±æ˜¯ä¸“é—¨ä¸º Java é¡¹ç›®æ‰“é€ çš„ç®¡ç†å’Œæ„å»ºå·¥å…·ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æœ‰ï¼š

1. æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„é¡¹ç›®ç»“æ„ï¼›
1. æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„æ„å»ºæµç¨‹ï¼ˆç¼–è¯‘ï¼Œæµ‹è¯•ï¼Œæ‰“åŒ…ï¼Œå‘å¸ƒç­‰ï¼‰ï¼›
1. æä¾›äº†ä¸€å¥—ä¾èµ–ç®¡ç†æœºåˆ¶ã€‚

ä¸€ä¸ªä½¿ç”¨ Maven ç®¡ç†çš„æ™®é€šçš„ Java é¡¹ç›®ï¼Œå®ƒçš„ç›®å½•ç»“æ„é»˜è®¤å¦‚ä¸‹ï¼š

```TEXT
a-maven-project
â”œâ”€â”€ pom.xml // é¡¹ç›®æè¿°æ–‡ä»¶
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ main
â”‚   â”‚   â”œâ”€â”€ java
â”‚   â”‚   â””â”€â”€ resources
â”‚   â””â”€â”€ test
â”‚       â”œâ”€â”€ java
â”‚       â””â”€â”€ resources
â””â”€â”€ target
```

æˆ‘ä»¬å†çœ‹ä¸‹ `pom.xml` é•¿å•¥æ ·ï¼š

```xml
<project ...>
 <modelVersion>4.0.0</modelVersion>
 <groupId>com.itranswarp.learnjava</groupId>
 <artifactId>hello</artifactId>
 <version>1.0</version>
 <packaging>jar</packaging>
 <properties>
  ...
 </properties>
 <dependencies>
  <dependency>
    <groupId>commons-logging</groupId>
    <artifactId>commons-logging</artifactId>
    <version>1.2</version>
  </dependency>
 </dependencies>
</project>
```

å…¶ä¸­ï¼Œ`groupId` ç±»ä¼¼äº Java çš„åŒ…åï¼Œé€šå¸¸æ˜¯å…¬å¸æˆ–ç»„ç»‡åç§°ï¼Œ`artifactId` ç±»ä¼¼äº Java çš„ç±»åï¼Œé€šå¸¸æ˜¯é¡¹ç›®åç§°ï¼Œå†åŠ ä¸Š `version`ï¼Œä¸€ä¸ª Maven å·¥ç¨‹å°±æ˜¯ç”± groupIdï¼ŒartifactId å’Œ version ä½œä¸ºå”¯ä¸€æ ‡è¯†ã€‚æˆ‘ä»¬åœ¨å¼•ç”¨å…¶ä»–ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯é€šè¿‡è¿™ 3 ä¸ªå˜é‡ç¡®å®šã€‚ä¾‹å¦‚ï¼Œä¾èµ– commons-loggingï¼š

```xml
<dependency>
  <groupId>commons-logging</groupId>
  <artifactId>commons-logging</artifactId>
  <version>1.2</version>
</dependency>
```

> ä½¿ç”¨ `<dependency>` å£°æ˜ä¸€ä¸ªä¾èµ–åï¼ŒMaven å°±ä¼šè‡ªåŠ¨ä¸‹è½½è¿™ä¸ªä¾èµ–åŒ…å¹¶æŠŠå®ƒæ”¾åˆ° classpath ä¸­ã€‚

å½“æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿° commons-logging è¿™äº›ç¬¬ä¸‰æ–¹å¼€æºåº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯é€šè¿‡ Maven è‡ªåŠ¨ä¸‹è½½å®ƒçš„ jar åŒ…ï¼Œå¹¶æ ¹æ®å…¶ pom.xml è§£æä¾èµ–ï¼Œè‡ªåŠ¨æŠŠç›¸å…³ä¾èµ–åŒ…éƒ½ä¸‹è½½ååŠ å…¥åˆ° classpathã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šå½“æˆ‘ä»¬è‡ªå·±å†™äº†ä¸€ä¸ªç‰›é€¼çš„å¼€æºåº“æ—¶ï¼Œéå¸¸å¸Œæœ›åˆ«äººä¹Ÿèƒ½ä½¿ç”¨ï¼Œæ€»ä¸èƒ½ç›´æ¥æ”¾ä¸ª jar åŒ…çš„é“¾æ¥è®©åˆ«äººä¸‹è½½å§ï¼Ÿ

å¦‚æœæˆ‘ä»¬æŠŠè‡ªå·±çš„å¼€æºåº“æ”¾åˆ° Maven çš„ repo ä¸­ï¼Œé‚£ä¹ˆï¼Œåˆ«äººåªéœ€æŒ‰æ ‡å‡†å¼•ç”¨ `groupId:artifactId:version`ï¼Œå³å¯è‡ªåŠ¨ä¸‹è½½ jar åŒ…ä»¥åŠç›¸å…³ä¾èµ–ã€‚bingoï¼Œä»¥ä¸‹æ˜¯ 3 ç§æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼š

1. ä»¥é™æ€æ–‡ä»¶å‘å¸ƒ
2. é€šè¿‡ Nexus å‘å¸ƒåˆ°ä¸­å¤®ä»“åº“ - å‘å¸ƒåˆ° `central.sonatype.org`ï¼Œå®ƒä¼šå®šæœŸè‡ªåŠ¨åŒæ­¥åˆ° Maven çš„ä¸­å¤®ä»“åº“
   1. å¾ˆå¤šå¤§å…¬å¸å†…éƒ¨éƒ½ä½¿ç”¨ Nexus ä½œä¸ºè‡ªå·±çš„ç§æœ‰ Maven ä»“åº“ï¼Œè€Œè¿™ä¸ª `central.sonatype.org` ç›¸å½“äºé¢å‘å¼€æºçš„ä¸€ä¸ª Nexus å…¬å…±æœåŠ¡
3. å‘å¸ƒåˆ°ç§æœ‰ä»“åº“ - ä¾‹å¦‚å…¬å¸è‡ªå·±æ­çš„ nexus æœåŠ¡å™¨
   1. å¦‚æœæ²¡æœ‰ç§æœ‰ Nexus æœåŠ¡å™¨ï¼Œè¿˜å¯ä»¥å‘å¸ƒåˆ° GitHub Packagesã€‚GitHub Packages æ˜¯ GitHub æä¾›çš„ä»“åº“æœåŠ¡ï¼Œæ”¯æŒ Mavenã€NPMã€Docker ç­‰ã€‚ä½¿ç”¨ GitHub Packages æ—¶ï¼Œæ— è®ºæ˜¯å‘å¸ƒ Artifactï¼Œè¿˜æ˜¯å¼•ç”¨å·²å‘å¸ƒçš„ Artifactï¼Œéƒ½éœ€è¦æ˜ç¡®çš„æˆæƒ Tokenï¼Œå› æ­¤ï¼ŒGitHub Packages åªèƒ½ä½œä¸ºç§æœ‰ä»“åº“ä½¿ç”¨ã€‚

### Artifactory ä¸åˆ¶å“åº“

**åˆ¶å“**å³æ„å»ºè¿‡ç¨‹çš„äº§ç‰©ï¼Œæ˜¯æŒ‡ç”±æºç ç¼–è¯‘æ‰“åŒ…ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸åŒçš„å¼€å‘è¯­è¨€å¯¹åº”ç€ä¸åŒæ ¼å¼çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™äº›äºŒè¿›åˆ¶é€šå¸¸å¯ä»¥ç›´æ¥è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šã€‚**åˆ¶å“åº“**ç”¨æ¥ç»Ÿä¸€ç®¡ç†ä¸åŒæ ¼å¼çš„è½¯ä»¶åˆ¶å“ã€‚é™¤äº†åŸºæœ¬çš„å­˜å‚¨åŠŸèƒ½ï¼Œè¿˜æä¾›äº†ç‰ˆæœ¬æ§åˆ¶ã€è®¿é—®æ§åˆ¶ã€å®‰å…¨æ‰«æã€ä¾èµ–åˆ†æç­‰é‡è¦åŠŸèƒ½ï¼Œæ˜¯ä¸€ç§ä¼ä¸šå¤„ç†è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ‰€æœ‰åŒ…ç±»å‹çš„æ ‡å‡†åŒ–æ–¹å¼ã€‚æ—¨åœ¨è§£å†³ä»¥ä¸‹ç—›ç‚¹ï¼š

1. ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ä¸‹è½½ç®¡ç†æ··ä¹±ï¼Œæ²¡æœ‰å‡†å…¥ç®¡æ§ï¼›
1. äº¤ä»˜åŒ…ä½¿ç”¨ FTP æˆ–è€… SVN è¿›è¡Œç®¡ç†ï¼Œç®¡ç†ç²’åº¦ç›¸å¯¹è¾ƒç²—ï¼›
1. ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…çš„å®‰å…¨é£é™©ç®¡ç†å½¢åŒè™šè®¾ï¼Œæˆ–è€…æ»åï¼›
1. ç”±äºå—åˆ°ç›‘ç®¡çº¦æŸï¼Œä¸€é”®éƒ¨ç½²æ˜¯ä¸å¯èƒ½ä»»åŠ¡ï¼Œè·¨ç½‘æ®µçš„åŒ…äº¤ä»˜æ™ºèƒ½ä¾èµ–äºæ‰‹å·¥æ‹·è´ï¼›
1. å›¢é˜Ÿå†…éƒ¨æ­å»ºçš„åˆ¶å“åº“æ˜¯å•ç‚¹çš„ï¼Œç¼ºä¹é›†ç¾¤éƒ¨ç½²ï¼›
1. å› ä¸ºæ²¡æœ‰ç»Ÿä¸€çš„åˆ¶å“åº“ï¼Œå­˜åœ¨é‡å¤å»ºè®¾çš„é—®é¢˜ï¼›ç»´æŠ¤æˆæœ¬é«˜ï¼Œæˆ–è€…è¯´ç›®å‰æ ¹æœ¬å°±æ²¡æœ‰ç»´æŠ¤ï¼›
1. é’ˆå¯¹å¼•å…¥è¿›æ¥çš„ç¬¬ä¸‰ç»„ä»¶æ²¡æœ‰è¿›è¡Œç»„ä»¶æ‰«æï¼Œææ˜“å¼•å…¥æ¼æ´ï¼›

> åˆ¶å“åº“å¯ä»¥è·Ÿæºä»£ç ååŒè¿›è¡Œç‰ˆæœ¬åŒ–æ§åˆ¶ï¼Œå¯ä»¥ä¸æœ¬åœ°å„æ„å»ºå·¥å…·å’Œäº‘ä¸Šçš„æŒç»­é›†æˆï¼ŒæŒç»­éƒ¨ç½²æ— ç¼ç»“åˆï¼Œå¹¶æ”¯æŒæ¼æ´æ‰«æç­‰ç‰¹æ€§ã€‚ä¸ºç ”å‘å›¢é˜Ÿæä¾›ä¼˜è´¨é«˜æ•ˆçš„æ„å»ºç‰©ç®¡ç†æœåŠ¡ï¼ŒæŠŠæ§æ„å»ºç‰©è´¨é‡ã€‚

æ‹¿ maven ä¸¾ä¾‹å­ï¼Œç¨‹åºå‘˜åªéœ€åœ¨ pom æ–‡ä»¶é…ä¸€ä¸ªæ–°ä¾èµ–å°±å¯ç›´æ¥ä»ä¸­å¤®åº“ä¸Šæ‹‰å–ä¸€ä¸ªä¸çŸ¥åçš„ä¸‰æ–¹åŒ…ï¼Œå±é™©ç³»æ•°ååˆ†é«˜ã€‚ä»è¶‹åŠ¿ä¸Šæ¥è¯´ï¼Œmaven ä¸­å¤®åº“æ–°å¢æ¼æ´åœ¨ 2018 å¹´å¢é•¿äº† 27%ï¼Œnpm åˆ™å¢é•¿äº† 47%ã€‚éšç€æˆ‘ä»¬å·¥ç¨‹çš„ä¾èµ–è¶Šå¤šï¼Œæˆ‘ä»¬å¼•å…¥æ¼æ´çš„é£é™©å‡ ç‡ä¹Ÿæ˜¯æ­£æ¯”å¢åŠ çš„ï¼›ä»ä¾èµ–å±‚æ¬¡æ¥è¯´ï¼Œnpmã€Maven å’Œ Ruby ä¸­çš„å¤§å¤šæ•°ä¾èµ–é¡¹éƒ½æ˜¯é—´æ¥ä¾èµ–é¡¹ï¼Œé—´æ¥ä¾èµ–é¡¹ä¸­çš„æ¼æ´å æ€»ä½“æ¼æ´çš„ 78%ï¼Œæ¼æ´éš¾ä»¥å‘ç°å¹¶ä¸”éš¾ä»¥ç»´æŠ¤ã€‚

å› æ­¤æˆ‘ä»¬é‡‡å–çš„æªæ–½æœ‰å®‰å…¨å·¦ç§»ï¼Œå¦‚ä¸‹è¢«åŠ¨è½¬ä¸»åŠ¨ï¼š

![åˆ¶å“](https://static001.geekbang.org/infoq/9f/9f127af539eeb900fadf9283b342b1fe.png)

ä¹Ÿå¯ä»¥å»ºç«‹å®‰å…¨ç™½åå•åˆ¶åº¦ï¼Œå¤§è‡´æ–¹æ¡ˆå¦‚ä¸‹ï¼š

1. åœ¨å¤–ç½‘å»ºç«‹å®‰å…¨æ¼æ´åº“ï¼Œå¼€æºçš„å¯ä»¥ä» NVDã€VnlrDB å®šæ—¶æ›´æ–°ï¼Œå•†ä¸šå¯ä»¥è´­ä¹° synk çš„æœåŠ¡ï¼›åŒæ­¥å»ºè®¾æœ‰ç™½åå•åˆ¶åº¦ç”¨äºç‰¹æ®ŠåŒ…ç”³è¯·ï¼Œç»Ÿä¸€æ•´åˆåˆ°æ•´ä½“çš„ä¿¡ä»»è§„åˆ™åº“ï¼›
2. åœ¨ DMZ åŒºå»ºè®¾ DMZ ä»£ç†å…¬ç½‘é•œåƒä»“åº“ï¼Œæ ¹æ®å®‰å…¨æ¼æ´åº“çš„è§„åˆ™è¿‡æ»¤ä»å…¬ç½‘ä¸Šæ‹‰å–ç¬¬ä¸‰æ–¹åŒ…ã€‚å¦‚æœç¬¬ä¸‰æ–¹åŒ…æ˜¯è¢«æ‰«æåˆ°æ¼æ´çš„ï¼Œåˆ™ç¦æ­¢æ‹‰å–åˆ°å†…ç½‘çš„åˆ¶å“ä»“åº“ã€‚

![ç™½åå•](https://static001.geekbang.org/infoq/74/743e3731fa69a9ffdec8f329f0ce8a26.png)

> ç°å¦‚ä»Šæ¯”è¾ƒæµè¡Œçš„åˆ¶å“åº“å¯ä»¥ç”¨ Nexus å’Œ [**Artifactory**](https://jfrog.com/artifactory/) æ­å»ºï¼Œç›®å‰ä¸¤è€…çš„å¯¹æ¯”å¯ä»¥[å‚è€ƒä¸‹è¿™é‡Œ](https://blog.csdn.net/jianghuafeng0/article/details/109518353) ğŸ‘ˆ

### Webhook

**Webhook** æ˜¯ä¸€ä¸ª API æ¦‚å¿µï¼Œæ˜¯å¾®æœåŠ¡ API çš„ä½¿ç”¨èŒƒå¼ä¹‹ä¸€ï¼Œä¹Ÿè¢«æˆä¸ºåå‘ APIï¼Œå®è´¨å°±æ˜¯ä¸€ä¸ªæ¥æ”¶ HTTP POSTï¼ˆæˆ– GETï¼ŒPUTï¼ŒDELETEï¼‰çš„ URLã€‚ä¸åƒä¼ ç»Ÿçš„ APIs æ–¹å¼ï¼Œä½ éœ€è¦ç”¨è½®è¯¢çš„æ–¹å¼æ¥è·å¾—å°½å¯èƒ½å®æ—¶çš„æ•°æ®ã€‚ä¸€ä¸ªå®ç°äº† Webhook çš„ API æä¾›æ–¹å°±æ˜¯åœ¨å½“äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ä¼šå‘è¿™ä¸ªé…ç½®å¥½çš„ URL å‘é€ä¸€æ¡ä¿¡æ¯ï¼Œä¸è¯·æ±‚ - å“åº”å¼ä¸åŒï¼Œä½¿ç”¨ Webhook ä½ å¯ä»¥å®æ—¶æ¥æ”¶åˆ°å˜åŒ–ã€‚ä¸¾ä¸ªä¾‹å­ï¼š

1. ä¼ ç»Ÿåšæ³• - é¡¹ç›® A éœ€è¦ä¸åœè½®è¯¢å»æ‹‰å–é¡¹ç›® B çš„æœ€æ–°æ•°æ®
2. webhook æœºåˆ¶ - é¡¹ç›® A æä¾›ä¸€ä¸ª webhook url, æ¯æ¬¡é¡¹ç›® B åˆ›å»ºæ–°æ•°æ®æ—¶ï¼Œä¾¿ä¼šå‘é¡¹ç›® A çš„ hook åœ°å€è¿›è¡Œè¯·æ±‚ï¼Œé¡¹ç›® A æ”¶åˆ°é¡¹ç›® B çš„è¯·æ±‚ï¼Œç„¶åå¯¹æ•°æ®è¿›è¡Œå¤„ç†

æˆ‘ä»¬å†ä»¥ [Github Webhook](https://docs.github.com/en/developers/webhooks-and-events/webhooks/about-webhooks) ä¸ºä¾‹ï¼ŒGitHub å…è®¸ä¸ºè‡ªå·±åˆ›å»ºçš„ä»“åº“æ³¨å†Œ Webhookï¼Œä¹‹åæ— è®ºæ˜¯ pull æ‹‰å–ä»£ç ã€push æ¨é€ä»£ç è¿˜æ˜¯å¡«å†™ issuesï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ”¶åˆ°é€šçŸ¥å’Œè¯¦æƒ…ã€‚æ¯”å¦‚å¯ä»¥è§¦å‘ CI æ„å»ºã€æ›´æ–°å¤‡ä»½é•œåƒå’Œè‡ªåŠ¨åŒ–éƒ¨ç½²ç­‰ã€‚

æˆ‘ä»¬åœ¨ä»“åº“ä¸‹çš„ settings å³å¯è®¾ç½® Webhookï¼Œé‡Œé¢åŒ…å«äº†å‡ ä¸ªé‡è¦çš„ä¿¡æ¯ï¼š

1. **Playload URL** - æ¥æ”¶ Webhook è¯·æ±‚çš„æœåŠ¡å™¨çš„åœ°å€
2. **Content type** - Webhooks can be delivered using different content types:
   1. The `application/json` content type will deliver the JSON payload directly as the body of the POST request.
   2. The `application/x-www-form-urlencoded` content type will send the JSON payload as a form parameter called payload.
3. **secret** - Setting a webhook secret allows you to ensure that POST requests sent to the payload URL are from GitHub. When you set a secret, you'll receive the `X-Hub-Signature` and `X-Hub-Signature-256` headers in the webhook POST request. For more information on how to use a secret with a signature header to secure your webhook payloads, see "[Securing your webhooks](https://docs.github.com/en/developers/webhooks-and-events/webhooks/securing-your-webhooks)."

![github-webhook]( {{site.url}}/style/images/smms/github-webhook.png )

> Github å®˜æ–¹ä¹Ÿæä¾›äº†æ•™ç¨‹ï¼Œéœ€è¦æ­å»ºä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨æ¥æ¥æ”¶ Webhook è®¯æ¯ï¼Œè¿™é‡Œæ¨èçš„æ˜¯ ngrokï¼Œä¸‹é¢ä¼šè®²åˆ°ã€‚

### ngrok

**ngrok** æ˜¯ä¸€ä¸ªåå‘ä»£ç†å·¥å…·ï¼Œé€šè¿‡åœ¨å…¬å…±çš„ç«¯ç‚¹å’Œæœ¬åœ°è¿è¡Œçš„ Web æœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªå®‰å…¨çš„é€šé“ã€‚ngrok å¯æ•è·å’Œåˆ†ææ‰€æœ‰é€šé“ä¸Šçš„æµé‡ï¼Œä¾¿äºåæœŸåˆ†æå’Œé‡æ”¾ã€‚ç®€å•æ¥è¯´ï¼Œ**åˆ©ç”¨ ngrok å¯ä»¥é€šè¿‡å¤–ç½‘æ¥è®¿é—®éƒ¨ç½²åœ¨æœ¬åœ°æœåŠ¡å™¨çš„ç½‘ç«™**ï¼Œå®ƒè¿˜æä¾›ä¸€ä¸ª Web ç®¡ç†é¡µæ¥ç›‘æ§ HTTP é€šä¿¡æŠ¥æ–‡ï¼Œæ–¹ä¾¿ç¨‹åºå‘˜å¼€å‘å’Œè°ƒè¯•ã€‚å¦å¤– ngrok è¿˜æ”¯æŒ TCP å±‚ç«¯å£æ˜ å°„ï¼Œä¸å±€é™äºæŸä¸€ç‰¹å®šçš„æœåŠ¡ã€‚æ”¯æŒ Mac OS Xï¼ŒLinuxï¼ŒWindows ç­‰å¹³å°ã€‚

![ngrok](https://camo.githubusercontent.com/c38e5f8cf24e62a3a2482897d4653b70e7d42649549b48cea4d90e873c5480c3/68747470733a2f2f6e67726f6b2e636f6d2f7374617469632f696d672f6f766572766965772e706e67)

> ä¼ ç»Ÿçš„åšæ³•æ˜¯åˆ©ç”¨èŠ±ç”Ÿå£³ç­‰åŠ¨æ€åŸŸåæˆ–è‡ªè¡Œæ­å»º VPN åšç«¯å£æ˜ å°„ï¼Œè€Œåˆ©ç”¨ ngrok å‡ æ¡å‘½ä»¤å°±æå®šã€‚

ngrok ä½¿ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œä»¥ macOS ä¸ºä¾‹ï¼Œä¸‹è½½ä¹‹åæ‰§è¡Œï¼š

```shell
./ngrok http 80
```

ä¹‹åä¼šè‡ªåŠ¨å¼€å¯ç»ˆç«¯ UI ç•Œé¢:

```TEXT
ngrok by @inconshreveable

Tunnel Status                 online
Version                       2.0/2.0
Web Interface                 http://127.0.0.1:4040
Forwarding                    http://92832de0.ngrok.io -> localhost:80
Forwarding                    https://92832de0.ngrok.io -> localhost:80

Connnections                  ttl     opn     rt1     rt5     p50     p90
                              0       0       0.00    0.00    0.00    0.00
```

æ‰“å¼€ `localhost:4040` é¡µé¢å¯ä»¥ç›‘æµ‹è¯·æ±‚è¯¦æƒ…ï¼š

![ngrok inspect](https://ngrok.com/static/img/inspect2.png)

## å‚è€ƒé“¾æ¥

1. [The Product Managersâ€™ Guide to Continuous Delivery and DevOps](https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/) By SUZIE PRINCE
2. [æ•æ·å¼€å‘ - MBA æ™ºåº“](https://wiki.mbalib.com/wiki/æ•æ·å¼€å‘)
3. [Atlassian - DevOps vs. ITIL -- Which matters for your team?](https://www.atlassian.com/itsm/itil/devops-vs-itil)
4. [GitHub Actions å…¥é—¨æ•™ç¨‹](http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html) By é˜®ä¸€å³°
5. [ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åˆ¶å“ç®¡ç†](https://xie.infoq.cn/article/f5f72e8a25f5b6581c0a2fb66) By Man
6. [Maven ä»‹ç»](https://www.liaoxuefeng.com/wiki/1252599548343744/1309301146648610) By å»–é›ªå³°
