---
layout: blog
front: true
comments: True
flag: Git
background: green
category: å‰ç«¯
title: Git Flow
date:   2018-03-10 23:36:00 GMT+0800 (CST)
update: 2020-02-24 18:21:00 GMT+0800 (CST)
background-image: /style/images/smms/github.png
tags:
- git
---
# {{ page.title }}

## ä»€ä¹ˆæ˜¯ Git

**Git** æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç”±å¤§ä½¬ Linux ä¹‹çˆ¶ Linus äº²è‡ªç¼–å†™çš„ï¼Œé»˜é»˜æµä¸‹äº†ç¾¡æ…•çš„æ³ªæ°´ ğŸ˜­ã€‚

### ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ VCS

**ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ(Version Control System - VCS)** æœ€åŸºæœ¬çš„åŠŸèƒ½æ˜¯ç‰ˆæœ¬æ§åˆ¶ã€‚å³åœ¨æ–‡ä»¶çš„ä¿®æ”¹å†ç¨‹ä¸­ä¿ç•™ä¿®æ”¹å†å²ï¼Œè®©ä½ å¯ä»¥æ–¹ä¾¿åœ°æ’¤é”€ä¹‹å‰å¯¹æ–‡ä»¶çš„ä¿®æ”¹æ“ä½œ:

* **ä¸­å¤®å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ(Centralized VCS)** - éƒ½æœ‰ä¸€ä¸ªå•ä¸€çš„é›†ä¸­ç®¡ç†çš„æœåŠ¡å™¨ï¼Œä¿å­˜æ‰€æœ‰æ–‡ä»¶çš„ä¿®è®¢ç‰ˆæœ¬ï¼Œè€ŒååŒå·¥ä½œçš„äººä»¬éƒ½é€šè¿‡å®¢æˆ·ç«¯è¿åˆ°è¿™å°æœåŠ¡å™¨ï¼Œå–å‡ºæœ€æ–°çš„æ–‡ä»¶æˆ–è€…æäº¤æ›´æ–°ã€‚ç¼ºç‚¹æ˜¯ä¸­å¤®æœåŠ¡å™¨çš„å•ç‚¹æ•…éšœå¯èƒ½å¯¼è‡´æ— æ³•æäº¤æ›´æ–°ï¼Œç”šè‡³å¯èƒ½ä¸¢å¤±å†å²è®°å½•ã€‚
* **åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ(Distributed VCS)** - å®¢æˆ·ç«¯å¹¶ä¸åªæå–æœ€æ–°ç‰ˆæœ¬çš„æ–‡ä»¶å¿«ç…§ï¼Œè€Œæ˜¯æŠŠä»£ç ä»“åº“å®Œæ•´åœ°é•œåƒä¸‹æ¥ã€‚è¿™ä¹ˆä¸€æ¥ï¼Œä»»ä½•ä¸€å¤„ååŒå·¥ä½œç”¨çš„æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œäº‹åéƒ½å¯ä»¥ç”¨ä»»ä½•ä¸€ä¸ªé•œåƒå‡ºæ¥çš„æœ¬åœ°ä»“åº“æ¢å¤ã€‚å› ä¸ºæ¯ä¸€æ¬¡çš„å…‹éš†æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯ä¸€æ¬¡å¯¹ä»£ç ä»“åº“çš„å®Œæ•´å¤‡ä»½ã€‚

![VCS]( {{site.url}}/style/images/smms/vcs.png )

### Git vs SVN

**SVN** ä½œä¸º CVCSï¼ŒGit ç›¸æ¯” SVN çš„ä¸»è¦ä¼˜ç‚¹:

* **ç›´æ¥è®°å½•å¿«ç…§ï¼Œè€Œéå·®å¼‚æ¯”è¾ƒ** - Git å­˜å‚¨é¡¹ç›®éšæ—¶é—´æ”¹å˜çš„å¿«ç…§ï¼Œæ•ˆç‡æ›´é«˜ï¼›è€Œ SVN å­˜å‚¨æ¯ä¸ªæ–‡ä»¶ä¸åˆå§‹ç‰ˆæœ¬çš„å·®å¼‚ã€‚
* **è¿‘ä¹æ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ¬åœ°æ‰§è¡Œ** - Git ä¸­çš„ç»å¤§å¤šæ•°æ“ä½œéƒ½åªéœ€è¦è®¿é—®æœ¬åœ°æ–‡ä»¶å’Œèµ„æºï¼Œæ‰€ä»¥é€Ÿåº¦æ›´å¿«ï¼Œè€Œä¸”æ— éœ€è”ç½‘ï¼›è€Œ SVN å¤„äºæ–­ç½‘çŠ¶æ€æ—¶æ˜¯æ— æ³•æäº¤æ›´æ–°çš„ã€‚
* **æ•°æ®å®Œæ•´æ€§** - Git ä¸­æ‰€æœ‰æ•°æ®åœ¨å­˜å‚¨å‰éƒ½é€šè¿‡ SHA-1 æ•£åˆ—è®¡ç®—æ ¡éªŒå’Œï¼Œç„¶åä»¥æ ¡éªŒå’Œæ¥å¼•ç”¨ã€‚å®é™…ä¸Šï¼ŒGit æ•°æ®åº“ä¸­ä¿å­˜çš„ä¿¡æ¯éƒ½æ˜¯ä»¥æ–‡ä»¶å†…å®¹çš„å“ˆå¸Œå€¼æ¥ç´¢å¼•ï¼Œè€Œä¸æ˜¯æ–‡ä»¶åï¼Œå¦‚ commit idã€‚
* **æ›´ä¼˜çš„åˆ†æ”¯** - Git ä¸­åˆ†æ”¯(branch)çš„åˆ›å»ºå®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥ç§»åŠ¨çš„æ–°çš„æŒ‡é’ˆï¼Œæ“ä½œå‡ ä¹èƒ½åœ¨ç¬é—´å®Œæˆï¼Œå¹¶ä¸”åœ¨ä¸åŒåˆ†æ”¯ä¹‹é—´çš„åˆ‡æ¢æ“ä½œä¹Ÿæ˜¯ä¸€æ ·ä¾¿æ·ï¼›è€Œ SVN ä¸­çš„åˆ†æ”¯æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç›®å½•ï¼Œä¸”è¿™ä¸ªç›®å½•æ‹¥æœ‰å®Œæ•´çš„å®é™…æ–‡ä»¶ï¼Œå ç”¨ç©ºé—´å¤§ä¸”ä½æ•ˆã€‚

## Git Flow

Git å¦‚æ­¤ä¼˜ç§€çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œç»™æˆ‘ä»¬æä¾›äº†æå¤§çš„ä¾¿åˆ©ï¼Œä½†æ˜¯åœ¨å®é™…å·¥ä½œä¸­ï¼Œä¸€ä¸ªé¡¹ç›®å¯èƒ½éœ€è¦å¾ˆå¤šäººç»´æŠ¤ï¼ŒååŒå·¥ä½œå°±æˆä¸ºäº†ä¸€ä¸ªå·¨å¤§çš„å¨èƒã€‚è€Œä¸”æœ‰å¯èƒ½æˆ‘ä»¬åªç”¨åˆ° Master æˆ–è€… Develop å°‘æ•°çš„åˆ†æ”¯ï¼Œå¹¶ä¸”æäº¤å†å²æ··ä¹±ã€‚åŸºäºä¸Šè¿°æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¸…æ™°çš„æµç¨‹å’Œè§„èŒƒï¼Œæ¥æ›´å¤§ç¨‹åº¦ä¸Šåœ°äº«å— Git å¸¦æ¥çš„ä¾¿åˆ©ï¼Œè¿™å°±æ˜¯æ¥ä¸‹æ¥è¦ä»‹ç»çš„ [**Git Flow**](https://nvie.com/posts/a-successful-git-branching-model/)ã€‚

### æµç¨‹å›¾

Git Flow å¸¸ç”¨çš„åˆ†æ”¯:

| åˆ†æ”¯ | æè¿° |
|:--------------|:---------|
| **Production** | å³ Master åˆ†æ”¯ï¼Œä¸»è¦åˆå¹¶æœ€è¿‘å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒçš„ä»£ç ï¼Œå¹¶æ‰“ä¸Šæ ‡ç­¾ï¼Œæ­¤åˆ†æ”¯åªèƒ½ä»å…¶ä»–åˆ†æ”¯åˆå¹¶ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹ |
| **Develop** | ä¸»è¦å¼€å‘åˆ†æ”¯ï¼ŒåŒ…å«æ‰€æœ‰è¦å‘å¸ƒåˆ°ä¸‹ä¸€ä¸ª Release çš„ä»£ç  |
| **Feature** | ä¸»è¦æ˜¯ç”¨æ¥å¼€å‘ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå¼€å‘å®Œæˆååˆå¹¶åˆ° Develop åˆ†æ”¯ï¼Œç„¶ååˆ é™¤è¯¥ç‰¹æ€§åˆ†æ”¯ |
| **Release** | å½“éœ€è¦å‘å¸ƒçš„æ—¶å€™ï¼ŒåŸºäº Develop åˆ†æ”¯åˆ›å»ºä¸€ä¸ª Release åˆ†æ”¯ï¼Œå®Œæˆå‘å¸ƒåå°†å…¶åˆå¹¶åˆ° Master å’Œ Develop åˆ†æ”¯ï¼Œç„¶ååˆ é™¤è¯¥å‘å¸ƒåˆ†æ”¯ |
| **Hotfix** | å½“åœ¨ Master åˆ†æ”¯å‘ç°æ–°çš„ Bug æ—¶å€™ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª Hotfix åˆ†æ”¯, å®Œæˆä¿®å¤åå°†å…¶åˆå¹¶å› Master å’Œ Develop åˆ†æ”¯ï¼Œæ‰€ä»¥ Hotfix çš„æ”¹åŠ¨ä¼šè¿›å…¥ä¸‹ä¸€ä¸ª Release |

![git-flow.png]( {{site.url}}/style/images/smms/git-flow.png )

> Git ä¸­åˆ†æ”¯å®é™…ä¸Šæ˜¯æŒ‡å‘æŸä¸ª commit çš„æŒ‡é’ˆã€‚

### Git å‘½ä»¤

æµç¨‹æˆ‘ä»¬çŸ¥é“äº†ï¼Œé‚£ä¹ˆå¦‚ä½•å»è¿ç”¨å‘¢ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œï¼Œä¸å¦¨æ¥çœ‹çœ‹æ —å­:

```SHELL
# -------------------- feature ------------------------
# åˆ›å»º feature åˆ†æ”¯å¹¶å¼€å‘
gco -b smd-feature develop
# å®Œæˆ feature åˆ†æ”¯ï¼Œåˆå¹¶åˆ° developï¼Œå¹¶åˆ é™¤
gco develop && gl
grb develop smd-feature
gm smd-feature && gp # rebase åˆå¹¶åˆ° develop

gb -d smd-feature # åˆ é™¤æœ¬åœ°
# gp origin :smd-feature # è‹¥æ¨é€è¿‡è¿œç«¯åˆ™åˆ é™¤è¿œç«¯åˆ†æ”¯

# -------------------- release ------------------------
# åˆ›å»º release åˆ†æ”¯ï¼Œå‡†å¤‡å‘å¸ƒ
gco -b release-0.1.0 develop
# å®Œæˆ releaseï¼Œåˆ†åˆ«åˆå¹¶åˆ° master å’Œ developï¼Œç„¶ååˆ é™¤æ‰“æ ‡ç­¾
gcm && gl
grb master release-0.1.0
gm release-0.1.0 && gp

gco develop && gl
grb develop release-0.1.0
gm release-0.1.0 && gp

gb -d release-0.1.0

git tag -a v0.1.0 master # æ‰“æ ‡ç­¾
gp --tags

# -------------------- hotfix ------------------------
# åˆ›å»º hotfix ä¿®å¤
gco -b hotfix-0.1.1 master
# å®Œæˆ hotfix ä¿®å¤ï¼Œåˆ†åˆ«åˆå¹¶åˆ° master å’Œ developï¼Œç„¶ååˆ é™¤æ‰“æ ‡ç­¾
# çœç•¥ä¸€ä¸‡ä¸ªå­—ï¼ŒåŒ release æ“ä½œ
git tag -a v0.1.1 master
gp --tags
```

### git flow å‘½ä»¤

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ Git å‘½ä»¤å»å®ç°å·¥ä½œæµè¿˜æ˜¯å¾ˆç¹ççš„ï¼Œå¾ˆå¯èƒ½ä½ ä¼šæ¼æ‰ä¸€äº›ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚ Git flow script:

```SHELL
# å®‰è£… git-flow
brew install git-flow
```

```SHELL
# åˆå§‹åŒ–
git flow init
# å¼€å§‹ feature
git flow feature start smd-feature
# å‘å¸ƒ feature
git flow feature publish smd-feature
# è·å–å·²å‘å¸ƒçš„ feature
git flow feature pull origin smd-feature
# å®Œæˆ feature
git flow feature finish smd-feature
# å¼€å§‹ release
git flow release start RELEASE [BASE]
# å‘å¸ƒ release
git flow release publish RELEASE
# å®Œæˆ release
git flow release finish RELEASE
# å¼€å§‹ hotfix
git flow hotfix start VERSION [BASENAME]
# å‘å¸ƒ hotfix
git flow hotfix finish VERSION
```

> ä¸Šè¿°å‘å¸ƒ(release)åŠ¨ä½œæŒ‡çš„æ˜¯ push åˆ°è¿œç«¯

<!-- TODO: -->
<!-- ![git-flow.png](https://i.loli.net/2020/02/24/4FMWxPZGkHN9i3Q.png) -->

### Sourcetree

æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ GUI æ¥æ›´ä¾¿æ·çš„å»æ“ä½œï¼Œå¯è§†åŒ–æ•ˆæœä¼šæ›´å¥½ï¼Œå€¼å¾—æ¨èçš„æ˜¯ [**Sourcetree**](https://www.sourcetreeapp.com)ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ gitflow å¯¹åº”çš„æ“ä½œå›¾ï¼Œæˆ‘ä»¬åªç”¨ç‚¹å‡»å¯¹åº”çš„åŠŸèƒ½æŒ‰é”®å°±å¯ä»¥å®ç°ä¸Šè¿°ä¸€äº›åŠŸèƒ½:

![source-tree.png]( {{site.url}}/style/images/smms/sourcce-tree.png )

![source-tree-2.png]( {{site.url}}/style/images/smms/sourcce-tree-2.png )

## .gitignore

é€šè¿‡ **.gitignore** æ–‡ä»¶é…ç½®å¯å¿½ç•¥è·Ÿè¸ªçš„æ–‡ä»¶ï¼Œå…¶æ ¼å¼è§„èŒƒå¦‚ä¸‹ï¼š

* æ‰€æœ‰ç©ºè¡Œæˆ–è€…ä»¥æ³¨é‡Šç¬¦å· ï¼ƒ å¼€å¤´çš„è¡Œéƒ½ä¼šè¢« Git å¿½ç•¥ã€‚
* å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ *globæ¨¡å¼* åŒ¹é…ã€‚
* åŒ¹é…æ¨¡å¼æœ€åè·Ÿåæ–œæ  (/) è¯´æ˜è¦å¿½ç•¥çš„æ˜¯ç›®å½•ã€‚
* è¦å¿½ç•¥æŒ‡å®šæ¨¡å¼ä»¥å¤–çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥åœ¨æ¨¡å¼å‰åŠ ä¸ŠæƒŠå¹å· (!) å–åã€‚

**globæ¨¡å¼** æ˜¯æŒ‡ shell æ‰€ä½¿ç”¨çš„ç®€åŒ–äº†çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚:

* æ˜Ÿå· (*) - åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦
* [abc] - åŒ¹é…ä»»ä½•ä¸€ä¸ªåˆ—åœ¨æ–¹æ‹¬å·ä¸­çš„å­—ç¬¦
* é—®å· (?) - åªåŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦
* [0-9] - è¡¨ç¤ºåŒ¹é…æ‰€æœ‰ 0 åˆ° 9 çš„æ•°å­—

ä»¥ä¸‹æ˜¯ .gitignore æ–‡ä»¶ç¤ºä¾‹ï¼Œå„ä¸ªè¯­è¨€ç¯å¢ƒä¸‹çš„æ ‡å‡†å¯[å‚è€ƒè¿™é‡Œ](https://github.com/github/gitignore) ğŸ‘ˆğŸ‘ˆğŸ‘ˆ

```SHELL
# æ­¤ä¸ºæ³¨é‡Š â€“ å°†è¢« Git å¿½ç•¥
# å¿½ç•¥æ‰€æœ‰ .a ç»“å°¾çš„æ–‡ä»¶
*.a
# ä½† lib.a é™¤å¤–
!lib.a
# ä»…ä»…å¿½ç•¥é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ TODO æ–‡ä»¶ï¼Œä¸åŒ…æ‹¬ subdir/TODO
/TODO
# å¿½ç•¥ build/ ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
build/
# ä¼šå¿½ç•¥ doc/notes.txt ä½†ä¸åŒ…æ‹¬ doc/server/arch.txt
doc/*.txt
# å¿½ç•¥ doc/ ç›®å½•ä¸‹æ‰€æœ‰æ‰©å±•åä¸º txt çš„æ–‡ä»¶
doc/**/*.txt
```

å¦‚æœæŸä¸ªæ–‡ä»¶å¯ä»¥æ”¾å¼€ï¼Œç›´æ¥åœ¨ .gitignore ä¸­å»é™¤å¯¹åº”é…ç½®å¹¶é‡æ–°è¿½è¸ªå³å¯;å¦‚æœæŸä¸ªæ–‡ä»¶åœ¨å¿½ç•¥å‰å·²ç»è¢«è¿½è¸ªï¼Œç›´æ¥åœ¨ .gitignore ä¸­æ·»åŠ æ˜¯æ— æ•ˆçš„ã€‚éœ€è¦å»é™¤æ–‡ä»¶ç¼“å­˜æˆ–è€…ç‰©ç†åˆ é™¤å†æäº¤:

```SHELL
git rm -r --cached filename
```

## .gitkeep

ä¸€èˆ¬è€Œè¨€ï¼Œgit ä¸ä¼šå»è¿½è¸ªç©ºçš„æ–‡ä»¶ç›®å½•ï¼Œå¦‚æœéœ€è¦è¿½è¸ªçš„è¯ï¼Œéœ€è¦åœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ— è®ºè¿™ä¸ªæ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Œå†…å®¹å¦‚ä½•ï¼Œåå­—æ˜¯ä»€ä¹ˆã€‚å› æ­¤ç¤¾åŒºçº¦å®šäº† **.gitkeep** è¿™ä¸ªæ–‡ä»¶åï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å–å .nofileã€.youcanseenothing ç­‰ç­‰ã€‚

## Git Hooks

**Git é’©å­(hooks)**éƒ½è¢«å­˜å‚¨åœ¨ Git ç›®å½•ä¸‹çš„ hooks å­ç›®å½•ä¸­ï¼Œå³å¤§éƒ¨åˆ†é¡¹ç›®ä¸­çš„ .git/hooksã€‚åœ¨ Git 1.6 ç‰ˆæœ¬ä¹‹åï¼Œè¿™äº›æ ·æœ¬åéƒ½æ˜¯ä»¥.sample ç»“å°¾ï¼Œå› æ­¤å¿…é¡»é‡æ–°å‘½åã€‚Git æä¾›ä¸¤ç»„é’©å­ï¼š[å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯](https://git-scm.com/book/zh/v1/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git%E6%8C%82%E9%92%A9)ã€‚

è¿™é‡Œç›´æ¥ä½¿ç”¨ [husky](https://github.com/typicode/husky)ï¼Œå®‰è£…åï¼Œ.git/hooks ç›®å½•é‡Œé¢çš„é’©å­éƒ½ä¼šè¢« husky æ›¿æ¢æ‰ã€‚åœ¨ package.json é‡Œè¿›è¡Œé…ç½®å³å¯:

```JSON
// ç‰ˆæœ¬ 0.14
"scripts": {
  "postcommit": "echo hi snow",
  "precommit": "echo hi tate"
}

// ç‰ˆæœ¬ 0.14 ä¹‹å
// å¯ç›´æ¥è¿è¡Œ ./node_modules/.bin/husky-upgrade è¿›è¡Œè¿ç§»
{
  "husky": {
    "hooks": {
      "pre-commit": "echo hi tate",
      "post-commit": "echo hi snow",
    }
  }
}
```

```SHELL
git commit -a -m 'add husky'
# husky > pre-commit (node v9.3.0)
# im tate
# husky > post-commit (node v9.3.0)
# im snow
# [master 8a1b6a3] add husky
```

## å‚è€ƒé“¾æ¥

1. [Git](https://git-scm.com/book/zh/v2)
2. [Git æ•™ç¨‹](https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000) By å»–é›ªå³°
3. [A successful Git branching model](http://nvie.com/posts/a-successful-git-branching-model/) By Vincent Driessen
4. [Git åœ¨å›¢é˜Ÿä¸­çš„æœ€ä½³å®è·µ--å¦‚ä½•æ­£ç¡®ä½¿ç”¨ Git Flow](http://www.cnblogs.com/cnblogsfans/p/5075073.html) By wangdeshui
