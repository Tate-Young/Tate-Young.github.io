---
layout: blog
front: true
comments: True
flag: HTML
background: green
category: 前端
title: postman 小技巧
date:   2021-01-07 21:54:00 GMT+0800 (CST)
background-image: https://miro.medium.com/max/1400/1*KAtiIej7Eydfpn5FWgwpgw.png
tags:
- webpack
---
# {{ page.title }}

[**postman**](https://learning.postman.com/docs/sending-requests/requests/) 使用这么久了，但是还是有一些好用的小功能被遗忘，这次就稍微整理一下吧。对于前端而言，它最大的功能莫过于接口调试或测试，这里也提到两个命令 **curl** 和 **httpie**，有兴趣的可以去看[这篇文章](( {{site.url}}/2018/04/15/linux-command.html#curl--httpie )) 👈

![postman]( {{site.url}}/style/images/smms/postman-interface.png )

## 变量

变量可以使我们在请求或脚本中存储和重复使用其值，通过将值保存在变量中，可以在集合，环境或请求中引用，也方便管理和修改。根据作用域层级主要可以分为:

* **global** - 全局
* **collection** - 集合
* **environment**  - 环境

![variables](https://assets.postman.com/postman-docs/env-quick-look.jpg)

1. **initial value** - 当你分享该集合或环境变量时，对方拿到的值
2. **current value** - 本地的值，不会被同步。可以点击 persist 按钮同步到 initial value

> 还有两种为 data 和 local，这里不做介绍

> postman 存储变量时会使用字符串，所以如果是对象或数组，可以先使用 `JSON.stringify()` 序列化，使用的时候 `JSON.parse()` 解析即可

### 设置变量

设置变量有好多种方式，可以点击到页面中相应位置进行编辑，也可以直接在需要设置的变量上右键:

![set as var](https://assets.postman.com/postman-docs/set-as-var-prompt.jpg)

![set var text](https://assets.postman.com/postman-docs/set-var-text.jpg)

还可以通过脚本来创建:

```JS
// global
pm.globals.set('key', 'value');

// collection
pm.collectionVariables.set('key', 'value');

// environment 注意是仅限于当前的环境
pm.environment.set('key', 'value');

// local - 本地变量优先级最高，可覆盖其他变量。一般只做临时覆盖其他变量来作测试
pm.variables.set('key', 'value');

// 同样也可以删除某个变量
pm.environment.unset('key');
```

### 获取变量

获取变量可以使用双大括号的插值表达式，在输入的时候默认会有联想:

![get var](https://assets.postman.com/postman-docs/vars-in-request.jpg)

定义好的变量也可以在脚本中直接使用，还有一些以 $ 开头的内置的动态变量，详细的列表可以[参考这里](https://learning.postman.com/docs/writing-scripts/script-references/variables-list/) 👈:

1. \{\{$guid}} - A v4 style guid
2. \{\{$timestamp}} - The current timestamp (Unix timestamp in seconds)
3. \{\{$randomInt}} - A random integer between 0 and 1000

```JS
// global
pm.globals.get('key');

// 获取动态变量的值，需要使用 replaceIn 方法
pm.variables.replaceIn('\{\{$randomFirstName}}') // Julian
```

### 使用场景

#### 请求前置脚本

前置脚本其实就是在 `Pre-requests Script` 中编写的 JS 脚本，当一个请求在发送之前，会先去执行前置脚本中的代码，因此有几个场景很适用，比如登录接口的密码，在发送前需要做加密处理，那么就可以在前置脚本中做加密处理；再比如说，有的接口的输入参数有一些随机数，每请求一次接口参数值都会发送变化，就可以在前置脚本中编写生成随机数的代码。总体来说，就是在请求接口之前对我们的请求数据进行进一步加工处理的都可以使用前置脚本这个功能:

比如下图，在请求 posts 时可以带上 id 参数，如果 id 是随机数的话，则可以在请求前先保存到变量中，然后请求的时候再从变量中去获取该值:

![pre-request-script]( {{site.url}}/style/images/smms/postman-pre-request-script.png )

#### 接口关联

有一个场景就是其中一个接口需要另一个接口的数据作为输入参数，那么这两个接口即有关联，我们需要做的就是先保存第一个接口的相关数据，然后在下一个接口中去获取该变量。比如需要根据游客 token 去获取认证 token:

```JS
// 在第一个获取游客 token 的接口的 Tests 测试中，将有效信息保存到 touristToken 集合变量中
const { info = '' } = pm.response.json()

pm.collectionVariables.set('touristToken', info)
```

接着我们在第二个获取认证 token 的接口的请求头中添加该参数: token: \{\{touristToken}}，之后我们还可以将该 Tests 测试中将获取到的认证的 token 同步到全局变量中:

```JS
const { info: { member: { token = '' } = {} } = {} } = pm.response.json()

pm.globals.set('token', token)
```

> to be continued
